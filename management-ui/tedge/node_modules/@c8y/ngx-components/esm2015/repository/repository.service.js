import * as tslib_1 from "tslib";
import { of, from, throwError, merge } from 'rxjs';
import { map, switchMap, takeWhile, take, filter, withLatestFrom } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { isNil, isUndefined, assign, set, head, get, isString, pick, cloneDeep, remove, find, forEach, map as _map } from 'lodash-es';
import { AlertService, gettext } from '@c8y/ngx-components';
import { InventoryService, InventoryBinaryService, IResult, IManagedObject, IManagedObjectBinary, IIdentified, QueriesUtil, IResultList, IFetchResponse, IOperation, OperationService, Realtime, OperationStatus, IEvent, EventService, EventBinaryService, IdReference } from '@c8y/client';
import { RepositoryType, REPOSITORY_BINARY_TYPES } from './repository.model';
let RepositoryService = class RepositoryService {
    constructor(inventory, inventoryBinary, operation, alert, event, realtime, eventBinary) {
        this.inventory = inventory;
        this.inventoryBinary = inventoryBinary;
        this.operation = operation;
        this.alert = alert;
        this.event = event;
        this.realtime = realtime;
        this.eventBinary = eventBinary;
        this.dateFrom = new Date(0);
        this.dateTo = new Date(Date.now() + 86400000); // 1 day in the future
        this.queriesUtil = new QueriesUtil();
    }
    /**
     * Lists repository entries of given type.
     * @param type The type of repository entries to list.
     * @param options Extra listing options.
     */
    listRepositoryEntries(type, options) {
        const defaultOrder = [{ name: 1 }];
        const defaultFilters = { type };
        const legacyFilters = { __has: `url` };
        let filters = {};
        let fullQuery = (options && options.query) || {};
        fullQuery = this.queriesUtil.addOrderbys(fullQuery, defaultOrder, 'prepend');
        fullQuery = this.queriesUtil.addAndFilter(fullQuery, defaultFilters);
        if (options && options.partialTextFilter) {
            const { partialText, properties } = options.partialTextFilter;
            const orFilter = { __or: properties.map(property => ({ [property]: `*${partialText}*` })) };
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, orFilter);
        }
        if (options && options.partialName) {
            // backwards compatibility if
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, { name: `*${options.partialName}*` });
        }
        if (options && options.skipLegacy) {
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, { __not: legacyFilters });
        }
        filters = Object.assign({ query: this.queriesUtil.buildQuery(fullQuery), pageSize: 50, withTotalPages: true }, ((options && options.params) || {}));
        return this.inventory.list(filters);
    }
    // TODO: merge with create()
    save(data, type, mo = {}) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            switch (type) {
                case RepositoryType.CONFIGURATION: {
                    Object.assign(mo, {
                        type: RepositoryType.CONFIGURATION,
                        configurationType: data.selected ? data.selected.configurationType : undefined,
                        name: data.version,
                        description: data.description,
                        deviceType: data.deviceType,
                        c8y_Global: {}
                    });
                    if (!data.deviceType && mo.id) {
                        mo.deviceType = null;
                    }
                    if (!data.selected && mo.id) {
                        mo.configurationType = null;
                    }
                    break;
                }
            }
            const existingUrl = mo.url;
            if (data.binary.url) {
                mo.url = data.binary.url;
            }
            else if (data.binary.file) {
                const response = yield this.inventoryBinary.create(data.binary.file, {
                    c8y_Global: {}
                });
                mo.url = response.data.self;
            }
            if (mo.id) {
                return this.updateEntry(mo, existingUrl);
            }
            return this.createEntry(mo);
        });
    }
    create(modal, type) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            switch (type) {
                case RepositoryType.FIRMWARE:
                case RepositoryType.SOFTWARE:
                    return this.createFirmwareOrSoftware(modal, type);
            }
        });
    }
    createFirmwareOrSoftware(modal, type) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let binary;
            let binaryURL;
            let repositoryEntry;
            let repositoryBinary;
            const mos = [];
            const { selected: { id: selectedId }, binary: { file, url } } = modal;
            try {
                if (file) {
                    ({ data: binary } = yield this.saveBinary(file));
                    ({ self: binaryURL } = binary);
                    mos.push(binary);
                }
                else {
                    binaryURL = url;
                }
                ({ data: repositoryEntry } = yield this.createOrUpdateRepositoryEntry(modal, type));
                if (isNil(selectedId)) {
                    mos.push(repositoryEntry);
                }
                ({ data: repositoryBinary } = yield this.createRepositoryBinary(modal, binaryURL, type, repositoryEntry));
                mos.push(repositoryBinary);
                if (file) {
                    yield this.linkBinary(repositoryBinary, binary);
                }
                return repositoryEntry;
            }
            catch (error) {
                this.cleanUp(mos);
                this.errorMsg();
                // Propagate error
                throw error;
            }
        });
    }
    saveBinary(file) {
        return this.inventoryBinary.create(file, { c8y_Global: {} });
    }
    createOrUpdateRepositoryEntry(modal, type) {
        const { selected: { id, name }, description, deviceType } = modal;
        const mo = {
            id,
            name: id ? undefined : name,
            description,
            type: id ? undefined : type,
            c8y_Global: {}
        };
        if (deviceType) {
            set(mo, 'c8y_Filter.type', deviceType);
        }
        return id
            ? this.inventory.update(mo)
            : this.inventory.create(mo);
    }
    createRepositoryBinary(modal, binaryURL, type, parent) {
        const mo = this.prepareRepositoryBinaryMO(modal, binaryURL, type);
        return this.inventory.childAdditionsCreate(mo, parent);
    }
    prepareRepositoryBinaryMO(modal, binaryURL, type) {
        const { version, patchVersion, dependency } = modal;
        const result = {
            type: REPOSITORY_BINARY_TYPES[type],
            [type]: {
                url: binaryURL
            },
            c8y_Global: {}
        };
        if (dependency) {
            set(result, [type, 'version'], patchVersion);
            assign(result, {
                c8y_Patch: {
                    dependency: dependency.c8y_Firmware.version
                }
            });
        }
        else {
            set(result, [type, 'version'], version);
        }
        return result;
    }
    linkBinary(repositoryBinary, binary) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const { id: repositoryBinaryId } = repositoryBinary;
            if (binary) {
                const { id: binaryId } = binary;
                return this.inventory.childAdditionsAdd(binaryId, repositoryBinaryId);
            }
        });
    }
    cleanUp(mosToDelete) {
        mosToDelete.forEach(mo => {
            const { c8y_IsBinary } = mo;
            isUndefined(c8y_IsBinary) ? this.delete(mo) : this.inventoryBinary.delete(mo);
        });
    }
    delete(entity) {
        return this.inventory.delete(entity, { forceCascade: true });
    }
    errorMsg() {
        const msg = gettext('Failed to save');
        this.alert.danger(msg);
    }
    getBaseVersionsCount$(entry) {
        if (this.isLegacyEntry(entry)) {
            return of(1);
        }
        return from(this.listBaseVersions(entry, { pageSize: 1, withTotalPages: true })).pipe(map(({ paging }) => paging.totalPages));
    }
    getBaseVersionFromMO(mo) {
        return this.isPatch(mo) ? get(mo, 'c8y_Patch.dependency') : get(mo, 'c8y_Firmware.version');
    }
    isPatch(mo) {
        return !!get(mo, 'c8y_Patch.dependency');
    }
    getPatchVersionsCount$(entry, baseVersion) {
        if (this.isLegacyEntry(baseVersion)) {
            return of(0);
        }
        return from(this.listPatchVersions(entry, baseVersion, { pageSize: 1, withTotalPages: true })).pipe(map(({ paging }) => paging.totalPages));
    }
    isLegacyEntry(entry) {
        return Boolean(entry.url);
    }
    /**
     * Lists all versions (base and patch ones) of given top level entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param params Additional query params.
     */
    listAllVersions(entry, params = {}) {
        if (this.isLegacyEntry(entry)) {
            return this.getBaseVersionResultListForLegacyEntry(entry);
        }
        const VERSION_FILTER_ORDER = {
            __filter: {},
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, VERSION_FILTER_ORDER, params);
    }
    /**
     * Lists base versions of given top level entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param params Additional query params.
     */
    listBaseVersions(entry, params = {}) {
        if (this.isLegacyEntry(entry)) {
            return this.getBaseVersionResultListForLegacyEntry(entry);
        }
        const NO_PATCH_FILTER_ORDER = {
            __filter: {
                __not: { __has: 'c8y_Patch' }
            },
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, NO_PATCH_FILTER_ORDER, params);
    }
    /**
     * Lists patch versions of given base version under the entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param baseVersion Base version.
     * @param params Additional query params.
     */
    listPatchVersions(entry, baseVersion, params = {}) {
        const version = isString(baseVersion) ? baseVersion : get(baseVersion, 'c8y_Firmware.version');
        const PATCH_FILTER_ORDER = {
            __filter: {
                'c8y_Patch.dependency': version
            },
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, PATCH_FILTER_ORDER, params);
    }
    /**
     * Lists patch versions of given base version under the entry including the base version.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * In terms of legacy base version the entry gets transformed to fit the needed data model.
     * @param entry Top level repository entry.
     * @param baseVersion Base version.
     * @param params Additional query params.
     */
    listBaseVersionAndPatches(entry, baseVersion, params = {}) {
        if (this.isLegacyEntry(entry)) {
            return Promise.resolve({
                data: [
                    Object.assign({
                        c8y_Firmware: {
                            version: entry.version,
                            url: entry.url
                        }
                    }, entry)
                ]
            });
        }
        const PATCH_FILTER_ORDER = {
            __filter: {
                __or: {
                    'c8y_Patch.dependency': baseVersion.c8y_Firmware.version,
                    'c8y_Firmware.version': baseVersion.c8y_Firmware.version
                }
            },
            __orderby: [{ 'c8y_Patch.dependency': 1 }, { 'c8y_Firmware.version': 1 }]
        };
        return this.listChildren(entry, PATCH_FILTER_ORDER, params);
    }
    listChildren(entry, filters = {}, params = {}) {
        const childrenFilters = { __bygroupid: entry.id };
        const query = this.queriesUtil.addAndFilter(filters, childrenFilters);
        // FIXME: needed because of issue in forOf directive (...)
        params.withTotalPages = true;
        return this.inventory.listQuery(query, params);
    }
    /**
     * Fetches all items from the list starting with the provided page.
     * @param firstPage The first page of the list to fetch all items for.
     */
    fetchAllItemsFromList(firstPage) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let allItems;
            if (!firstPage.then) {
                allItems = [...firstPage];
            }
            else {
                let { paging, data: items } = yield firstPage;
                allItems = [...items];
                while (paging && paging.nextPage) {
                    ({ paging, data: items } = yield paging.next());
                    allItems = [...allItems, ...items];
                }
            }
            return allItems;
        });
    }
    /**
     * Gets top level repository entry managed object for base or patch version.
     * @param mo Base or patch version managed object with parents.
     */
    getRepositoryEntryMO$(mo) {
        if (!mo) {
            return of(undefined);
        }
        const [reference] = get(mo, 'additionParents.references');
        const id = get(reference, 'managedObject.id');
        return id
            ? from(this.inventory.detail(id, { withChildren: false })).pipe(map(({ data }) => data))
            : of(undefined);
    }
    /**
     * Gets base or patch version managed object.
     * @param deviceRepositoryFragment Device repository fragment.
     * @param type Top level repository entry type.
     * @param configuration Configuration object with options:
     * - **skipLegacy** - `boolean` - Exclude legacy entries.
     * - **filters** - `object` - Filter object.
     *
     * @deprecated as it doesn't support 'missing url' case
     */
    getRepositoryBinaryMoByVersion(deviceRepositoryFragment, type, { skipLegacy = false, filters = {} } = {}) {
        const { version, url, name } = deviceRepositoryFragment;
        const repositoryBinaryType = REPOSITORY_BINARY_TYPES[type];
        let query;
        const newModelBaseVersionQuery = {
            [`${type}.version`]: version,
            [`${type}.url`]: url,
            type: repositoryBinaryType
        };
        const legacyVersionQuery = { url, type, name };
        filters = Object.assign({ withChildren: false, withParents: true }, filters);
        if (skipLegacy) {
            query = {
                __and: Object.assign({}, newModelBaseVersionQuery)
            };
        }
        else {
            query = {
                __or: [{ __and: Object.assign({}, newModelBaseVersionQuery) }, { __and: Object.assign({}, legacyVersionQuery) }]
            };
        }
        return this.inventory.listQuery(query, filters).then(({ data }) => head(data));
    }
    getBinaryName$(binaryUrl) {
        if (!binaryUrl) {
            return of('---');
        }
        const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
        if (!binaryId) {
            return of(binaryUrl);
        }
        return this.inventory.detail$(binaryId).pipe(map(mo => mo.name));
    }
    /**
     * Generates an inventory query object which can be used to find
     * repository entries of specified type matching the type of provided device.
     * @param repositoryType The type of repository entries which will be queried with the generated query.
     * @param device The device for which matching repository entries will be queried with the generated query.
     */
    getDeviceTypeQuery(repositoryType, device) {
        let result = { type: repositoryType };
        if (device.type) {
            if (repositoryType === RepositoryType.CONFIGURATION) {
                result = this.queriesUtil.addAndFilter(result, {
                    __or: [{ deviceType: device.type }, { __not: { __has: `deviceType` } }]
                });
            }
            else {
                result = this.queriesUtil.addAndFilter(result, {
                    __or: [
                        { 'c8y_Filter.type': device.type },
                        { 'c8y_Filter.type': '' },
                        { __not: { __has: `c8y_Filter.type` } }
                    ]
                });
            }
        }
        return result;
    }
    /**
     * Generates an inventory query object which can be used to find configuration repository entries
     * matching the type of provided device and specified configuration type.
     * @param device The device for which matching repository entries will be queried with the generated query.
     * @param configurationType Configuration type for which matching repository entries will be queried with the generated query.
     */
    getConfigurationTypeQuery(device, configurationType) {
        const query = this.getDeviceTypeQuery(RepositoryType.CONFIGURATION, device);
        return this.queriesUtil.addAndFilter(query, {
            __or: [
                { configurationType },
                { configurationType: '' },
                { __not: { __has: `configurationType` } }
            ]
        });
    }
    /**
     * Gets the list of software installed in the device in the uniform format.
     * Supports c8y_SoftwareList and c8y_Software fragments.
     * @param device The device whose software list should be returned.
     */
    getDeviceSoftwareList(device) {
        if (device.c8y_SoftwareList) {
            return cloneDeep(device.c8y_SoftwareList);
        }
        if (device.c8y_Software) {
            return _map(device.c8y_Software, (version, name) => ({ name, version }));
        }
        return [];
    }
    /**
     * Prepares a software update operation for given device and the list of changes, and sends it to the device.
     * @param device The device which the operation should be prepared for and sent to.
     * @param changes The list of software changes which should be applied.
     */
    createSoftwareUpdateOperation(device, changes) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const operation = this.getSoftwareUpdateOperation(device, changes);
            return (yield this.operation.create(operation)).data;
        });
    }
    /**
     * Prepares a software update operation for given device and changes.
     * Returned operation type depends on device's supported operations.
     * Supports c8y_SoftwareUpdate, c8y_SoftwareList, and c8y_Software operations.
     * @param device The device for which operation should be prepared.
     * @param changes The list of software changes which should be applied.
     */
    getSoftwareUpdateOperation(device, changes) {
        const operation = {
            deviceId: device.id,
            description: `Apply software changes: ${changes
                .map(change => `${change.action} "${change.name}"${change.version ? ` (version: ${change.version})` : ''}`)
                .join(', ')}`
        };
        if (device.c8y_SupportedOperations.includes('c8y_SoftwareUpdate')) {
            operation.c8y_SoftwareUpdate = cloneDeep(changes);
        }
        else if (device.c8y_SupportedOperations.includes('c8y_SoftwareList')) {
            operation.c8y_SoftwareList = cloneDeep(device.c8y_SoftwareList) || [];
            changes.forEach(change => {
                const deviceSoftware = pick(change, ['name', 'version', 'url']);
                if (change.action === 'delete') {
                    remove(operation.c8y_SoftwareList, deviceSoftware);
                }
                if (change.action === 'install') {
                    operation.c8y_SoftwareList.push(deviceSoftware);
                }
            });
        }
        else if (device.c8y_SupportedOperations.includes('c8y_Software')) {
            operation.c8y_Software = cloneDeep(device.c8y_Software) || {};
            changes.forEach(change => {
                if (change.action === 'delete') {
                    delete operation.c8y_Software[change.name];
                }
                if (change.action === 'install') {
                    operation.c8y_Software[change.name] = change.version;
                }
            });
        }
        return operation;
    }
    /**
     * Extracts the list of device software changes from given operation in the context of given device.
     * @param operation The operation from which the list should be extracted.
     * @param device The target device of the operation.
     */
    getDeviceSoftwareChangesFromOperation(operation, device) {
        if (operation.c8y_SoftwareUpdate) {
            return cloneDeep(operation.c8y_SoftwareUpdate);
        }
        if (operation.c8y_SoftwareList) {
            return this.getDeviceSoftwareChangesFromSoftwareListOperation(operation, device);
        }
        if (operation.c8y_Software) {
            return this.getDeviceSoftwareChangesFromSoftwareOperation(operation, device);
        }
        return [];
    }
    /**
     * Prepares a firmware update operation for given device and the selected repository binary, and sends it to the device.
     * @param device The device which the operation should be prepared for and sent to.
     * @param selectedOption The selected repository binary option.
     */
    createFirmwareUpdateOperation(device, selectedOption) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const operation = this.getFirmwareUpdateOperation(device, selectedOption);
            return (yield this.operation.create(operation)).data;
        });
    }
    /**
     * Prepares a firmware update operation for given device and selected version.
     * Supports c8y_Firmware operation.
     * @param device The device for which operation should be prepared.
     * @param selectedOption Selected firmware version.
     */
    getFirmwareUpdateOperation(device, selectedOption) {
        delete selectedOption.id;
        const operation = {
            deviceId: device.id,
            description: `Update firmware to: "${selectedOption.name}"${selectedOption.version ? ` (version: ${selectedOption.version})` : ''}`,
            c8y_Firmware: Object.assign({}, selectedOption)
        };
        return operation;
    }
    /**
     * Prepares a configuration file upload operation for given device and configuration type.
     * @param device The device for which operation should be prepared.
     * @param configurationType Selected configuration type.
     * @param isLegacy  A legacy operation is created without a configurationType.
     */
    getUploadConfigurationFileOperation(device, configurationType, isLegacy = false) {
        if (isLegacy) {
            return {
                deviceId: device.id,
                description: `Retrieve configuration snapshot from device ${device.name}`,
                c8y_UploadConfigFile: {}
            };
        }
        return {
            deviceId: device.id,
            description: `Retrieve ${configurationType} configuration snapshot from device ${device.name}`,
            c8y_UploadConfigFile: {
                type: configurationType
            }
        };
    }
    /**
     * Prepares a configuration file download operation for given device and configuration type.
     * @param device The device for which operation should be prepared.
     * @param configurationType Selected configuration type.
     * @param binaryUrl The url of a binary to be downloaded.
     * @param isLegacy A legacy operation is created without a configurationType.
     */
    getDownloadConfigurationFileOperation(device, configurationType, configSnapshot, isLegacy = false) {
        if (isLegacy) {
            return {
                deviceId: device.id,
                description: `Send configuration snapshot ${configSnapshot.name} to device ${device.name}`,
                c8y_DownloadConfigFile: {
                    url: configSnapshot.binaryUrl,
                    c8y_ConfigurationDump: {
                        id: configSnapshot.id
                    }
                }
            };
        }
        return {
            deviceId: device.id,
            description: `Send configuration snapshot ${configSnapshot.name} of configuration type ${configurationType} to device ${device.name}`,
            c8y_DownloadConfigFile: {
                url: configSnapshot.binaryUrl,
                type: configurationType
            }
        };
    }
    /**
     * Gets the last firmware update operation for given device.
     * Looks for c8y_Firmware operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    getLastFirmwareUpdateOperation(deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const filters = {
                deviceId,
                dateFrom: new Date(0).toISOString(),
                dateTo: new Date(Date.now()).toISOString(),
                revert: true,
                pageSize: 1
            };
            return this.getFirstMatchingOperation([Object.assign({}, filters, { fragmentType: 'c8y_Firmware' })]);
        });
    }
    /**
     * Gets the last software update operation for given device.
     * Looks for c8y_SoftwareUpdate, c8y_SoftwareList, or c8y_Software operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    getLastSoftwareUpdateOperation(deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const filters = {
                deviceId,
                dateFrom: new Date(0).toISOString(),
                dateTo: new Date(Date.now()).toISOString(),
                revert: true,
                pageSize: 1
            };
            return this.getFirstMatchingOperation([
                Object.assign({}, filters, { fragmentType: 'c8y_SoftwareUpdate' }),
                Object.assign({}, filters, { fragmentType: 'c8y_SoftwareList' }),
                Object.assign({}, filters, { fragmentType: 'c8y_Software' })
            ]);
        });
    }
    /**
     * Iterates over the list of filters and queries the operations.
     * If a query returns at least one operation, the first one will be returned.
     * Otherwise the next query will be performed.
     * If none of the queries returns any operation, null will be returned.
     * @param filtersList The list of filters for the queries.
     */
    getFirstMatchingOperation(filtersList) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let matchingOperation = null;
            for (const filters of filtersList) {
                const operations = (yield this.operation.list(filters)).data;
                if (operations.length) {
                    matchingOperation = operations[0];
                    break;
                }
            }
            return matchingOperation;
        });
    }
    /**
     * Creates the operation and returns an observable to track its progress.
     * Fails the observable when the operation returns FAILED status.
     * Completes the observable when the operation returns SUCCESSFUL status.
     * @param operation The operation to create and track.
     */
    createObservedOperation(operation) {
        return from(this.operation.create(operation)).pipe(map(({ data }) => data), take(1), switchMap(createdOperation => this.observeOperation(createdOperation)));
    }
    /**
     * Returns an observable to track progress of given operation.
     * Fails the observable when the operation returns FAILED status.
     * Completes the observable when the operation returns SUCCESSFUL status.
     * @param operation The operation to be observed.
     */
    observeOperation(operation) {
        const observedOperation$ = of(operation);
        const operationUpdates$ = observedOperation$.pipe(switchMap(observedOperation => this.realtime.observable(`/operations/${observedOperation.deviceId}`)), map(({ data }) => data), withLatestFrom(observedOperation$), filter(([operationUpdate, observedOperation]) => operationUpdate.id === observedOperation.id), switchMap(([operationUpdate]) => {
            if (operationUpdate.status === OperationStatus.FAILED) {
                return throwError(operationUpdate);
            }
            return of(operationUpdate);
        }), takeWhile(operationUpdate => operationUpdate.status !== OperationStatus.SUCCESSFUL, true));
        return merge(observedOperation$, operationUpdates$);
    }
    /**
     * Gets a single event with latest creationTime for the given device Id and event type.
     * @param deviceId The device Id for which the events should be queried.
     * @param type Event type.
     */
    getLatestConfigurationEvent(deviceId, type) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const eventFilter = {
                source: deviceId,
                type,
                dateFrom: this.dateFrom.toISOString(),
                dateTo: this.dateTo.toISOString(),
                pageSize: 1
            };
            const { data } = yield this.event.list(eventFilter);
            return data[0];
        });
    }
    /**
     * Gets a list of operations for the given device Id, and operation type.
     * @param deviceId The device Id for which the operation should be queried.
     * @param operationType Operation type fragment.
     */
    getConfigFileOperationList(deviceId, operationType) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const operationFilter = {
                deviceId,
                fragmentType: operationType,
                dateFrom: this.dateFrom.toISOString(),
                dateTo: this.dateTo.toISOString(),
                revert: true,
                pageSize: 2000
            };
            return (yield this.operation.list(operationFilter)).data;
        });
    }
    /**
     * Gets latest uploaded configuration snapshot for the given device, and configuration type.
     * @param device The device for which the configuration snapshot was uploaded.
     * @param configurationType Selected configuration type.
     */
    getConfigSnapshot(device, configurationType) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const event = yield this.getLatestConfigurationEvent(device.id, configurationType);
            let configSnapshot;
            if (event) {
                configSnapshot = {
                    time: event.time,
                    name: event.text,
                    deviceType: device.type,
                    configurationType
                };
                try {
                    configSnapshot.binary = yield (yield this.eventBinary.download(event)).text();
                    if (event.c8y_IsBinary) {
                        configSnapshot.binaryType = event.c8y_IsBinary.type;
                    }
                }
                catch (ex) {
                    const msg = gettext('Could not get the binary.');
                    this.alert.danger(msg);
                }
            }
            return configSnapshot;
        });
    }
    getLegacyConfigSnapshot(deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let configSnapshot;
            let mo;
            const device = (yield this.inventory.detail(deviceId, { withChildren: false })).data;
            const snapshotId = device.c8y_ConfigurationDump && device.c8y_ConfigurationDump.id;
            if (!snapshotId) {
                return;
            }
            try {
                mo = (yield this.inventory.detail(snapshotId)).data;
            }
            catch (ex) {
                // do nothing
            }
            if (mo) {
                configSnapshot = {
                    time: mo.creationTime,
                    name: mo.name
                };
                configSnapshot.binary = yield this.getBinaryText(mo.url, { allowExternal: false });
            }
            return configSnapshot;
        });
    }
    /**
     * Returns a binary object as text.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **allowExternal** - `boolean` - allows downloading external binary file
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    getBinaryText(binaryUrl, options) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
            let res;
            if (!binaryId && options.allowExternal) {
                res = yield this.getExternalBinaryResponse(binaryUrl, options);
            }
            else {
                res = yield this.getInternalBinaryResponse(binaryId, options);
            }
            if (!res) {
                return null;
            }
            return res.text();
        });
    }
    /**
     * Returns a binary object as File.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **allowExternal** - `boolean` - allows downloading external binary file
     */
    getBinaryFile(binaryUrl, options) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
            if (!binaryId && !options.allowExternal) {
                return null;
            }
            // @TODO: note that it doesn't solve issue with external binary here, such url won't have binaryId, so we won't know the name or contentType to use in File constructor, let's add a @FIXME comment for now?
            const { name, contentType } = (yield this.inventory.detail(binaryId)).data;
            const res = !!binaryId
                ? yield this.getInternalBinaryResponse(binaryId)
                : yield this.getExternalBinaryResponse(binaryUrl);
            const arrayBuffer = yield res.arrayBuffer();
            return new File([arrayBuffer], name, { type: contentType });
        });
    }
    /**
     * Gets the last configuration update operation for given device.
     * Looks for c8y_Configuration and c8y_SendConfiguration operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    getLastConfigUpdateOperation(deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const filters = {
                deviceId,
                dateFrom: new Date(0).toISOString(),
                dateTo: new Date(Date.now()).toISOString(),
                revert: true,
                pageSize: 1
            };
            return this.getFirstMatchingOperation([
                Object.assign({}, filters, { fragmentType: 'c8y_Configuration' }),
                Object.assign({}, filters, { fragmentType: 'c8y_SendConfiguration' })
            ]);
        });
    }
    /**
     * Prepares a configuration download operation for given device and its current configuration.
     * Supports c8y_SendConfiguration operation.
     * @param device The device for which operation should be prepared.
     */
    createTextBasedConfigurationReloadOperation(device) {
        return {
            deviceId: device.id,
            description: gettext('Requested current configuration'),
            c8y_SendConfiguration: {}
        };
    }
    /**
     * Prepares a configuration update operation for the given device.
     * Supports c8y_Configuration operation.
     * @param device The device for which operation should be prepared.
     * @param config The configuration which will update the existing one.
     */
    createTextBasedConfigurationUpdateOperation(device, config) {
        return {
            deviceId: device.id,
            description: gettext('Configuration update'),
            c8y_Configuration: {
                config
            }
        };
    }
    getBinary(binaryId) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                return yield this.inventoryBinary.download(binaryId);
            }
            catch (ex) {
                const msg = gettext('Could not get the binary.');
                this.alert.danger(msg);
            }
        });
    }
    /**
     * Gets all available snapshots from the repository for the given device.
     * @param device The device for which the snapshots should be prepared.
     * @param configurationType Selected configuration type.
     */
    getSnapshotsFromRepository(device, configurationType) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const searchQuery = this.getConfigurationTypeQuery(device, configurationType);
            const res = yield this.listRepositoryEntries(RepositoryType.CONFIGURATION, {
                query: searchQuery,
                params: { pageSize: 100 }
            });
            return res.data;
        });
    }
    /**
     * Returns a binary object.
     * @param binaryId binary ID
     * @param options The object with additional options:
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    getInternalBinaryResponse(binaryId, options = {}) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let res;
            try {
                res = yield this.inventoryBinary.download(binaryId);
            }
            catch (ex) {
                if (!options.noAlerts) {
                    const msg = gettext('Could not get the binary.');
                    this.alert.danger(msg);
                }
            }
            return res;
        });
    }
    /**
     * Returns a binary object.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    getExternalBinaryResponse(binaryUrl, options = {}) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let res;
            try {
                const fetchRes = yield fetch(binaryUrl);
                if (fetchRes.status >= 400) {
                    throw res;
                }
                res = fetchRes;
            }
            catch (_a) {
                if (!options.noAlerts) {
                    const msg = gettext('Could not get the external binary');
                    this.alert.danger(msg);
                }
            }
            return res;
        });
    }
    createEntry(mo) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const binaryId = yield this.inventoryBinary.getIdFromUrl(mo.url);
            const newMo = yield this.inventory.create(mo);
            if (binaryId) {
                yield this.inventory.childAdditionsAdd(binaryId, newMo.data);
            }
            return newMo;
        });
    }
    updateEntry(mo, url) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const existingBinaryId = yield this.inventoryBinary.getIdFromUrl(url);
            const newBinaryId = yield this.inventoryBinary.getIdFromUrl(mo.url);
            if (existingBinaryId && existingBinaryId !== newBinaryId) {
                const id = this.inventoryBinary.getIdFromUrl(url);
                yield this.inventoryBinary.delete(id);
            }
            if (newBinaryId) {
                yield this.inventory.childAdditionsAdd(newBinaryId, mo);
            }
            return this.inventory.update(mo);
        });
    }
    getBaseVersionResultListForLegacyEntry(entry) {
        return Promise.resolve({
            res: {},
            data: [
                Object.assign({}, entry, { [entry.type]: {
                        version: entry.version,
                        url: entry.url
                    } })
            ]
        });
    }
    getDeviceSoftwareChangesFromSoftwareListOperation(operation, device) {
        const changes = [];
        forEach(device.c8y_SoftwareList, deviceSoftware => {
            const operationSoftware = find(operation.c8y_SoftwareList, { name: deviceSoftware.name });
            if ((operationSoftware && operationSoftware.version) !==
                (deviceSoftware && deviceSoftware.version)) {
                changes.push(Object.assign({}, deviceSoftware, { action: 'delete' }));
            }
        });
        forEach(operation.c8y_SoftwareList, operationSoftware => {
            const deviceSoftware = find(device.c8y_SoftwareList, { name: operationSoftware.name });
            if ((operationSoftware && operationSoftware.version) !==
                (deviceSoftware && deviceSoftware.version)) {
                changes.push(Object.assign({}, operationSoftware, { action: 'install' }));
            }
        });
        return changes;
    }
    getDeviceSoftwareChangesFromSoftwareOperation(operation, device) {
        const changes = [];
        forEach(device.c8y_Software, (deviceSoftwareVersion, deviceSoftwareName) => {
            if (operation.c8y_Software[deviceSoftwareName] !== deviceSoftwareVersion) {
                changes.push({
                    name: deviceSoftwareName,
                    version: deviceSoftwareVersion,
                    action: 'delete'
                });
            }
        });
        forEach(operation.c8y_Software, (operationSoftwareVersion, operationSoftwareName) => {
            if (device.c8y_Software[operationSoftwareName] !== operationSoftwareVersion) {
                changes.push({
                    name: operationSoftwareName,
                    version: operationSoftwareVersion,
                    action: 'install'
                });
            }
        });
        return changes;
    }
};
RepositoryService.ctorParameters = () => [
    { type: InventoryService },
    { type: InventoryBinaryService },
    { type: OperationService },
    { type: AlertService },
    { type: EventService },
    { type: Realtime },
    { type: EventBinaryService }
];
RepositoryService = tslib_1.__decorate([
    Injectable()
], RepositoryService);
export { RepositoryService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvc2l0b3J5LyIsInNvdXJjZXMiOlsicmVwb3NpdG9yeS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQWMsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUNMLEtBQUssRUFDTCxXQUFXLEVBQ1gsTUFBTSxFQUNOLEdBQUcsRUFDSCxJQUFJLEVBQ0osR0FBRyxFQUNILFFBQVEsRUFDUixJQUFJLEVBQ0osU0FBUyxFQUNULE1BQU0sRUFDTixJQUFJLEVBQ0osT0FBTyxFQUNQLEdBQUcsSUFBSSxJQUFJLEVBQ1osTUFBTSxXQUFXLENBQUM7QUFDbkIsT0FBTyxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLHNCQUFzQixFQUN0QixPQUFPLEVBQ1AsY0FBYyxFQUNkLG9CQUFvQixFQUNwQixXQUFXLEVBQ1gsV0FBVyxFQUNYLFdBQVcsRUFDWCxjQUFjLEVBQ2QsVUFBVSxFQUNWLGdCQUFnQixFQUNoQixRQUFRLEVBQ1IsZUFBZSxFQUNmLE1BQU0sRUFDTixZQUFZLEVBQ1osa0JBQWtCLEVBQ2xCLFdBQVcsRUFDWixNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBT0wsY0FBYyxFQUNkLHVCQUF1QixFQU14QixNQUFNLG9CQUFvQixDQUFDO0FBRzVCLElBQWEsaUJBQWlCLEdBQTlCLE1BQWEsaUJBQWlCO0lBSzVCLFlB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Q0FBQyxJQUFJLENBQUM7b0JBQ1gsSUFBSSxFQUFFLGtCQUFrQjtvQkFDeEIsT0FBTyxFQUFFLHFCQUFxQjtvQkFDOUIsTUFBTSxFQUFFLFFBQVE7aUJBQ08sQ0FBQyxDQUFDO2FBQzVCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDLHdCQUF3QixFQUFFLHFCQUFxQixFQUFFLEVBQUU7WUFDbEYsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLHFCQUFxQixDQUFDLEtBQUssd0JBQXdCLEVBQUU7Z0JBQzNFLE9BQU8sQ0FBQyxJQUFJLENBQUM7b0JBQ1gsSUFBSSxFQUFFLHFCQUFxQjtvQkFDM0IsT0FBTyxFQUFFLHdCQUF3QjtvQkFDakMsTUFBTSxFQUFFLFNBQVM7aUJBQ00sQ0FBQyxDQUFDO2FBQzVCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0NBQ0YsQ0FBQTs7WUE3b0NzQixnQkFBZ0I7WUFDVixzQkFBc0I7WUFDNUIsZ0JBQWdCO1lBQ3BCLFlBQVk7WUFDWixZQUFZO1lBQ1QsUUFBUTtZQUNMLGtCQUFrQjs7QUFaOUIsaUJBQWlCO0lBRDdCLFVBQVUsRUFBRTtHQUNBLGlCQUFpQixDQW1wQzdCO1NBbnBDWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgZnJvbSwgdGhyb3dFcnJvciwgbWVyZ2UgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwLCB0YWtlV2hpbGUsIHRha2UsIGZpbHRlciwgd2l0aExhdGVzdEZyb20gfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBpc05pbCxcbiAgaXNVbmRlZmluZWQsXG4gIGFzc2lnbixcbiAgc2V0LFxuICBoZWFkLFxuICBnZXQsXG4gIGlzU3RyaW5nLFxuICBwaWNrLFxuICBjbG9uZURlZXAsXG4gIHJlbW92ZSxcbiAgZmluZCxcbiAgZm9yRWFjaCxcbiAgbWFwIGFzIF9tYXBcbn0gZnJvbSAnbG9kYXNoLWVzJztcbmltcG9ydCB7IEFsZXJ0U2VydmljZSwgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHtcbiAgSW52ZW50b3J5U2VydmljZSxcbiAgSW52ZW50b3J5QmluYXJ5U2VydmljZSxcbiAgSVJlc3VsdCxcbiAgSU1hbmFnZWRPYmplY3QsXG4gIElNYW5hZ2VkT2JqZWN0QmluYXJ5LFxuICBJSWRlbnRpZmllZCxcbiAgUXVlcmllc1V0aWwsXG4gIElSZXN1bHRMaXN0LFxuICBJRmV0Y2hSZXNwb25zZSxcbiAgSU9wZXJhdGlvbixcbiAgT3BlcmF0aW9uU2VydmljZSxcbiAgUmVhbHRpbWUsXG4gIE9wZXJhdGlvblN0YXR1cyxcbiAgSUV2ZW50LFxuICBFdmVudFNlcnZpY2UsXG4gIEV2ZW50QmluYXJ5U2VydmljZSxcbiAgSWRSZWZlcmVuY2Vcbn0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHtcbiAgUmVwb3NpdG9yeUNhdGVnb3J5LFxuICBSZXBvc2l0b3J5QmluYXJ5LFxuICBGaXJtd2FyZUJpbmFyeSxcbiAgU29mdHdhcmVCaW5hcnksXG4gIEZpcm13YXJlUGF0Y2hCaW5hcnksXG4gIE1vZGFsTW9kZWwsXG4gIFJlcG9zaXRvcnlUeXBlLFxuICBSRVBPU0lUT1JZX0JJTkFSWV9UWVBFUyxcbiAgRGV2aWNlRmlybXdhcmUsXG4gIERldmljZVNvZnR3YXJlLFxuICBEZXZpY2VTb2Z0d2FyZUNoYW5nZSxcbiAgU2VsZWN0ZWRSZXBvc2l0b3J5QmluYXJ5LFxuICBDb25maWd1cmF0aW9uU25hcHNob3Rcbn0gZnJvbSAnLi9yZXBvc2l0b3J5Lm1vZGVsJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJlcG9zaXRvcnlTZXJ2aWNlIHtcbiAgcmVhZG9ubHkgZGF0ZUZyb20gPSBuZXcgRGF0ZSgwKTtcbiAgcmVhZG9ubHkgZGF0ZVRvID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDg2NDAwMDAwKTsgLy8gMSBkYXkgaW4gdGhlIGZ1dHVyZVxuICBwcml2YXRlIHF1ZXJpZXNVdGlsOiBRdWVyaWVzVXRpbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGludmVudG9yeTogSW52ZW50b3J5U2VydmljZSxcbiAgICBwcml2YXRlIGludmVudG9yeUJpbmFyeTogSW52ZW50b3J5QmluYXJ5U2VydmljZSxcbiAgICBwcml2YXRlIG9wZXJhdGlvbjogT3BlcmF0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0OiBBbGVydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBldmVudDogRXZlbnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhbHRpbWU6IFJlYWx0aW1lLFxuICAgIHByaXZhdGUgZXZlbnRCaW5hcnk6IEV2ZW50QmluYXJ5U2VydmljZVxuICApIHtcbiAgICB0aGlzLnF1ZXJpZXNVdGlsID0gbmV3IFF1ZXJpZXNVdGlsKCk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgcmVwb3NpdG9yeSBlbnRyaWVzIG9mIGdpdmVuIHR5cGUuXG4gICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHJlcG9zaXRvcnkgZW50cmllcyB0byBsaXN0LlxuICAgKiBAcGFyYW0gb3B0aW9ucyBFeHRyYSBsaXN0aW5nIG9wdGlvbnMuXG4gICAqL1xuICBsaXN0UmVwb3NpdG9yeUVudHJpZXMoXG4gICAgdHlwZTogUmVwb3NpdG9yeVR5cGUsXG4gICAgb3B0aW9ucz86IHtcbiAgICAgIC8qKiBBZGRpdGlvbmFsIHF1ZXJ5LiAqL1xuICAgICAgcXVlcnk/OiBhbnk7XG4gICAgICAvKiogKGRlcHJlY2F0ZWQgLSB0byBiZSByZW1vdmVkKSBPbmx5IGluY2x1ZGUgZW50cmllcyB3aXRoIG1hdGNoaW5nIHBhcnRpYWwgbmFtZXMuICovXG4gICAgICBwYXJ0aWFsTmFtZT86IHN0cmluZztcbiAgICAgIC8qKiBJbmNsdWRlIGVudHJpZXMgd2l0aCBtYXRjaGluZyBwYXJ0aWFsIHRleHQgaW4gdGhlIHNwZWNpZmllZCBwcm9wZXJ0aWVzLiAqL1xuICAgICAgcGFydGlhbFRleHRGaWx0ZXI/OiB7IHBhcnRpYWxUZXh0OiBzdHJpbmc7IHByb3BlcnRpZXM6IHN0cmluZ1tdIH07XG4gICAgICAvKiogRXhjbHVkZSBsZWdhY3kgZW50cmllcy4gKi9cbiAgICAgIHNraXBMZWdhY3k/OiBib29sZWFuO1xuICAgICAgLyoqIE90aGVyIHJlcXVlc3QgcGFyYW1zLiAqL1xuICAgICAgcGFyYW1zPzogYW55O1xuICAgIH1cbiAgKSB7XG4gICAgY29uc3QgZGVmYXVsdE9yZGVyID0gW3sgbmFtZTogMSB9XTtcbiAgICBjb25zdCBkZWZhdWx0RmlsdGVycyA9IHsgdHlwZSB9O1xuICAgIGNvbnN0IGxlZ2FjeUZpbHRlcnMgPSB7IF9faGFzOiBgdXJsYCB9O1xuICAgIGxldCBmaWx0ZXJzID0ge307XG5cbiAgICBsZXQgZnVsbFF1ZXJ5ID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5xdWVyeSkgfHwge307XG4gICAgZnVsbFF1ZXJ5ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRPcmRlcmJ5cyhmdWxsUXVlcnksIGRlZmF1bHRPcmRlciwgJ3ByZXBlbmQnKTtcblxuICAgIGZ1bGxRdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKGZ1bGxRdWVyeSwgZGVmYXVsdEZpbHRlcnMpO1xuXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJ0aWFsVGV4dEZpbHRlcikge1xuICAgICAgY29uc3QgeyBwYXJ0aWFsVGV4dCwgcHJvcGVydGllcyB9ID0gb3B0aW9ucy5wYXJ0aWFsVGV4dEZpbHRlcjtcbiAgICAgIGNvbnN0IG9yRmlsdGVyID0geyBfX29yOiBwcm9wZXJ0aWVzLm1hcChwcm9wZXJ0eSA9PiAoeyBbcHJvcGVydHldOiBgKiR7cGFydGlhbFRleHR9KmAgfSkpIH07XG4gICAgICBmdWxsUXVlcnkgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihmdWxsUXVlcnksIG9yRmlsdGVyKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnBhcnRpYWxOYW1lKSB7XG4gICAgICAvLyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBpZlxuICAgICAgZnVsbFF1ZXJ5ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIoZnVsbFF1ZXJ5LCB7IG5hbWU6IGAqJHtvcHRpb25zLnBhcnRpYWxOYW1lfSpgIH0pO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2tpcExlZ2FjeSkge1xuICAgICAgZnVsbFF1ZXJ5ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIoZnVsbFF1ZXJ5LCB7IF9fbm90OiBsZWdhY3lGaWx0ZXJzIH0pO1xuICAgIH1cblxuICAgIGZpbHRlcnMgPSB7XG4gICAgICBxdWVyeTogdGhpcy5xdWVyaWVzVXRpbC5idWlsZFF1ZXJ5KGZ1bGxRdWVyeSksXG4gICAgICBwYWdlU2l6ZTogNTAsXG4gICAgICB3aXRoVG90YWxQYWdlczogdHJ1ZSxcbiAgICAgIC4uLigob3B0aW9ucyAmJiBvcHRpb25zLnBhcmFtcykgfHwge30pXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkubGlzdChmaWx0ZXJzKTtcbiAgfVxuXG4gIC8vIFRPRE86IG1lcmdlIHdpdGggY3JlYXRlKClcbiAgYXN5bmMgc2F2ZShkYXRhOiBNb2RhbE1vZGVsLCB0eXBlOiBSZXBvc2l0b3J5VHlwZSwgbW86IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+ID0ge30pIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgUmVwb3NpdG9yeVR5cGUuQ09ORklHVVJBVElPTjoge1xuICAgICAgICBPYmplY3QuYXNzaWduKG1vLCB7XG4gICAgICAgICAgdHlwZTogUmVwb3NpdG9yeVR5cGUuQ09ORklHVVJBVElPTixcbiAgICAgICAgICBjb25maWd1cmF0aW9uVHlwZTogZGF0YS5zZWxlY3RlZCA/IGRhdGEuc2VsZWN0ZWQuY29uZmlndXJhdGlvblR5cGUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgbmFtZTogZGF0YS52ZXJzaW9uLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGRldmljZVR5cGU6IGRhdGEuZGV2aWNlVHlwZSxcbiAgICAgICAgICBjOHlfR2xvYmFsOiB7fVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFkYXRhLmRldmljZVR5cGUgJiYgbW8uaWQpIHtcbiAgICAgICAgICBtby5kZXZpY2VUeXBlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRhdGEuc2VsZWN0ZWQgJiYgbW8uaWQpIHtcbiAgICAgICAgICBtby5jb25maWd1cmF0aW9uVHlwZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZXhpc3RpbmdVcmwgPSBtby51cmw7XG4gICAgaWYgKGRhdGEuYmluYXJ5LnVybCkge1xuICAgICAgbW8udXJsID0gZGF0YS5iaW5hcnkudXJsO1xuICAgIH0gZWxzZSBpZiAoZGF0YS5iaW5hcnkuZmlsZSkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5jcmVhdGUoZGF0YS5iaW5hcnkuZmlsZSwge1xuICAgICAgICBjOHlfR2xvYmFsOiB7fVxuICAgICAgfSBhcyBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0Pik7XG4gICAgICBtby51cmwgPSByZXNwb25zZS5kYXRhLnNlbGY7XG4gICAgfVxuXG4gICAgaWYgKG1vLmlkKSB7XG4gICAgICByZXR1cm4gdGhpcy51cGRhdGVFbnRyeShtbywgZXhpc3RpbmdVcmwpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVFbnRyeShtbyk7XG4gIH1cblxuICBhc3luYyBjcmVhdGUobW9kYWw6IE1vZGFsTW9kZWwsIHR5cGU6IFJlcG9zaXRvcnlUeXBlKSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFJlcG9zaXRvcnlUeXBlLkZJUk1XQVJFOlxuICAgICAgY2FzZSBSZXBvc2l0b3J5VHlwZS5TT0ZUV0FSRTpcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRmlybXdhcmVPclNvZnR3YXJlKG1vZGFsLCB0eXBlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjcmVhdGVGaXJtd2FyZU9yU29mdHdhcmUoXG4gICAgbW9kYWw6IE1vZGFsTW9kZWwsXG4gICAgdHlwZTogUmVwb3NpdG9yeVR5cGVcbiAgKTogUHJvbWlzZTxSZXBvc2l0b3J5Q2F0ZWdvcnk+IHtcbiAgICBsZXQgYmluYXJ5OiBJTWFuYWdlZE9iamVjdEJpbmFyeTtcbiAgICBsZXQgYmluYXJ5VVJMOiBzdHJpbmc7XG4gICAgbGV0IHJlcG9zaXRvcnlFbnRyeTogUmVwb3NpdG9yeUNhdGVnb3J5O1xuICAgIGxldCByZXBvc2l0b3J5QmluYXJ5OiBGaXJtd2FyZUJpbmFyeSB8IFNvZnR3YXJlQmluYXJ5O1xuICAgIGNvbnN0IG1vcyA9IFtdO1xuICAgIGNvbnN0IHtcbiAgICAgIHNlbGVjdGVkOiB7IGlkOiBzZWxlY3RlZElkIH0sXG4gICAgICBiaW5hcnk6IHsgZmlsZSwgdXJsIH1cbiAgICB9ID0gbW9kYWw7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICh7IGRhdGE6IGJpbmFyeSB9ID0gYXdhaXQgdGhpcy5zYXZlQmluYXJ5KGZpbGUpKTtcbiAgICAgICAgKHsgc2VsZjogYmluYXJ5VVJMIH0gPSBiaW5hcnkpO1xuICAgICAgICBtb3MucHVzaChiaW5hcnkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmluYXJ5VVJMID0gdXJsO1xuICAgICAgfVxuXG4gICAgICAoeyBkYXRhOiByZXBvc2l0b3J5RW50cnkgfSA9IGF3YWl0IHRoaXMuY3JlYXRlT3JVcGRhdGVSZXBvc2l0b3J5RW50cnkobW9kYWwsIHR5cGUpKTtcbiAgICAgIGlmIChpc05pbChzZWxlY3RlZElkKSkge1xuICAgICAgICBtb3MucHVzaChyZXBvc2l0b3J5RW50cnkpO1xuICAgICAgfVxuXG4gICAgICAoeyBkYXRhOiByZXBvc2l0b3J5QmluYXJ5IH0gPSBhd2FpdCB0aGlzLmNyZWF0ZVJlcG9zaXRvcnlCaW5hcnkoXG4gICAgICAgIG1vZGFsLFxuICAgICAgICBiaW5hcnlVUkwsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIHJlcG9zaXRvcnlFbnRyeVxuICAgICAgKSk7XG4gICAgICBtb3MucHVzaChyZXBvc2l0b3J5QmluYXJ5KTtcblxuICAgICAgaWYgKGZpbGUpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5saW5rQmluYXJ5KHJlcG9zaXRvcnlCaW5hcnksIGJpbmFyeSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXBvc2l0b3J5RW50cnk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuY2xlYW5VcChtb3MpO1xuICAgICAgdGhpcy5lcnJvck1zZygpO1xuXG4gICAgICAvLyBQcm9wYWdhdGUgZXJyb3JcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHNhdmVCaW5hcnkoZmlsZTogRmlsZSk6IFByb21pc2U8SVJlc3VsdDxJTWFuYWdlZE9iamVjdEJpbmFyeT4+IHtcbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnlCaW5hcnkuY3JlYXRlKGZpbGUsIHsgYzh5X0dsb2JhbDoge30gfSBhcyBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0Pik7XG4gIH1cblxuICBjcmVhdGVPclVwZGF0ZVJlcG9zaXRvcnlFbnRyeShcbiAgICBtb2RhbDogTW9kYWxNb2RlbCxcbiAgICB0eXBlOiBSZXBvc2l0b3J5VHlwZVxuICApOiBQcm9taXNlPElSZXN1bHQ8UmVwb3NpdG9yeUNhdGVnb3J5Pj4ge1xuICAgIGNvbnN0IHtcbiAgICAgIHNlbGVjdGVkOiB7IGlkLCBuYW1lIH0sXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIGRldmljZVR5cGVcbiAgICB9ID0gbW9kYWw7XG5cbiAgICBjb25zdCBtbyA9IHtcbiAgICAgIGlkLFxuICAgICAgbmFtZTogaWQgPyB1bmRlZmluZWQgOiBuYW1lLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICB0eXBlOiBpZCA/IHVuZGVmaW5lZCA6IHR5cGUsXG4gICAgICBjOHlfR2xvYmFsOiB7fVxuICAgIH07XG5cbiAgICBpZiAoZGV2aWNlVHlwZSkge1xuICAgICAgc2V0KG1vLCAnYzh5X0ZpbHRlci50eXBlJywgZGV2aWNlVHlwZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGlkXG4gICAgICA/ICh0aGlzLmludmVudG9yeS51cGRhdGUobW8pIGFzIFByb21pc2U8SVJlc3VsdDxSZXBvc2l0b3J5Q2F0ZWdvcnk+PilcbiAgICAgIDogKHRoaXMuaW52ZW50b3J5LmNyZWF0ZShtbykgYXMgUHJvbWlzZTxJUmVzdWx0PFJlcG9zaXRvcnlDYXRlZ29yeT4+KTtcbiAgfVxuXG4gIGNyZWF0ZVJlcG9zaXRvcnlCaW5hcnkoXG4gICAgbW9kYWw6IE1vZGFsTW9kZWwsXG4gICAgYmluYXJ5VVJMOiBzdHJpbmcsXG4gICAgdHlwZTogUmVwb3NpdG9yeVR5cGUsXG4gICAgcGFyZW50OiBSZXBvc2l0b3J5Q2F0ZWdvcnlcbiAgKTogUHJvbWlzZTxJUmVzdWx0PEZpcm13YXJlQmluYXJ5IHwgU29mdHdhcmVCaW5hcnkgfCBGaXJtd2FyZVBhdGNoQmluYXJ5Pj4ge1xuICAgIGNvbnN0IG1vID0gdGhpcy5wcmVwYXJlUmVwb3NpdG9yeUJpbmFyeU1PKG1vZGFsLCBiaW5hcnlVUkwsIHR5cGUpO1xuXG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5LmNoaWxkQWRkaXRpb25zQ3JlYXRlKG1vLCBwYXJlbnQpIGFzIFByb21pc2U8XG4gICAgICBJUmVzdWx0PEZpcm13YXJlQmluYXJ5IHwgU29mdHdhcmVCaW5hcnkgfCBGaXJtd2FyZVBhdGNoQmluYXJ5PlxuICAgID47XG4gIH1cblxuICBwcmVwYXJlUmVwb3NpdG9yeUJpbmFyeU1PKG1vZGFsOiBNb2RhbE1vZGVsLCBiaW5hcnlVUkw6IHN0cmluZywgdHlwZTogUmVwb3NpdG9yeVR5cGUpIHtcbiAgICBjb25zdCB7IHZlcnNpb24sIHBhdGNoVmVyc2lvbiwgZGVwZW5kZW5jeSB9ID0gbW9kYWw7XG4gICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgdHlwZTogUkVQT1NJVE9SWV9CSU5BUllfVFlQRVNbdHlwZV0sXG4gICAgICBbdHlwZV06IHtcbiAgICAgICAgdXJsOiBiaW5hcnlVUkxcbiAgICAgIH0sXG4gICAgICBjOHlfR2xvYmFsOiB7fVxuICAgIH07XG5cbiAgICBpZiAoZGVwZW5kZW5jeSkge1xuICAgICAgc2V0KHJlc3VsdCwgW3R5cGUsICd2ZXJzaW9uJ10sIHBhdGNoVmVyc2lvbik7XG4gICAgICBhc3NpZ24ocmVzdWx0LCB7XG4gICAgICAgIGM4eV9QYXRjaDoge1xuICAgICAgICAgIGRlcGVuZGVuY3k6IGRlcGVuZGVuY3kuYzh5X0Zpcm13YXJlLnZlcnNpb25cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldChyZXN1bHQsIFt0eXBlLCAndmVyc2lvbiddLCB2ZXJzaW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGFzeW5jIGxpbmtCaW5hcnkoXG4gICAgcmVwb3NpdG9yeUJpbmFyeTogRmlybXdhcmVCaW5hcnkgfCBTb2Z0d2FyZUJpbmFyeSxcbiAgICBiaW5hcnk6IElNYW5hZ2VkT2JqZWN0QmluYXJ5XG4gICkge1xuICAgIGNvbnN0IHsgaWQ6IHJlcG9zaXRvcnlCaW5hcnlJZCB9ID0gcmVwb3NpdG9yeUJpbmFyeTtcbiAgICBpZiAoYmluYXJ5KSB7XG4gICAgICBjb25zdCB7IGlkOiBiaW5hcnlJZCB9ID0gYmluYXJ5O1xuICAgICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5LmNoaWxkQWRkaXRpb25zQWRkKGJpbmFyeUlkLCByZXBvc2l0b3J5QmluYXJ5SWQpO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFuVXAobW9zVG9EZWxldGU6IElJZGVudGlmaWVkW10pIHtcbiAgICBtb3NUb0RlbGV0ZS5mb3JFYWNoKG1vID0+IHtcbiAgICAgIGNvbnN0IHsgYzh5X0lzQmluYXJ5IH0gPSBtbztcbiAgICAgIGlzVW5kZWZpbmVkKGM4eV9Jc0JpbmFyeSkgPyB0aGlzLmRlbGV0ZShtbykgOiB0aGlzLmludmVudG9yeUJpbmFyeS5kZWxldGUobW8pO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlKGVudGl0eTogSUlkZW50aWZpZWQpOiBQcm9taXNlPElSZXN1bHQ8bnVsbD4+IHtcbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkuZGVsZXRlKGVudGl0eSwgeyBmb3JjZUNhc2NhZGU6IHRydWUgfSk7XG4gIH1cblxuICBlcnJvck1zZygpIHtcbiAgICBjb25zdCBtc2cgPSBnZXR0ZXh0KCdGYWlsZWQgdG8gc2F2ZScpO1xuICAgIHRoaXMuYWxlcnQuZGFuZ2VyKG1zZyk7XG4gIH1cblxuICBnZXRCYXNlVmVyc2lvbnNDb3VudCQoZW50cnk6IElNYW5hZ2VkT2JqZWN0KTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBpZiAodGhpcy5pc0xlZ2FjeUVudHJ5KGVudHJ5KSkge1xuICAgICAgcmV0dXJuIG9mKDEpO1xuICAgIH1cbiAgICByZXR1cm4gZnJvbSh0aGlzLmxpc3RCYXNlVmVyc2lvbnMoZW50cnksIHsgcGFnZVNpemU6IDEsIHdpdGhUb3RhbFBhZ2VzOiB0cnVlIH0pKS5waXBlKFxuICAgICAgbWFwKCh7IHBhZ2luZyB9KSA9PiBwYWdpbmcudG90YWxQYWdlcylcbiAgICApO1xuICB9XG5cbiAgZ2V0QmFzZVZlcnNpb25Gcm9tTU8obW86IFJlcG9zaXRvcnlCaW5hcnkpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlzUGF0Y2gobW8pID8gZ2V0KG1vLCAnYzh5X1BhdGNoLmRlcGVuZGVuY3knKSA6IGdldChtbywgJ2M4eV9GaXJtd2FyZS52ZXJzaW9uJyk7XG4gIH1cblxuICBpc1BhdGNoKG1vOiBSZXBvc2l0b3J5QmluYXJ5KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhZ2V0KG1vLCAnYzh5X1BhdGNoLmRlcGVuZGVuY3knKTtcbiAgfVxuXG4gIGdldFBhdGNoVmVyc2lvbnNDb3VudCQoZW50cnk6IElNYW5hZ2VkT2JqZWN0LCBiYXNlVmVyc2lvbjogRmlybXdhcmVCaW5hcnkpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIGlmICh0aGlzLmlzTGVnYWN5RW50cnkoYmFzZVZlcnNpb24pKSB7XG4gICAgICByZXR1cm4gb2YoMCk7XG4gICAgfVxuICAgIHJldHVybiBmcm9tKFxuICAgICAgdGhpcy5saXN0UGF0Y2hWZXJzaW9ucyhlbnRyeSwgYmFzZVZlcnNpb24sIHsgcGFnZVNpemU6IDEsIHdpdGhUb3RhbFBhZ2VzOiB0cnVlIH0pXG4gICAgKS5waXBlKG1hcCgoeyBwYWdpbmcgfSkgPT4gcGFnaW5nLnRvdGFsUGFnZXMpKTtcbiAgfVxuXG4gIGlzTGVnYWN5RW50cnkoZW50cnk6IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJvb2xlYW4oZW50cnkudXJsKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0cyBhbGwgdmVyc2lvbnMgKGJhc2UgYW5kIHBhdGNoIG9uZXMpIG9mIGdpdmVuIHRvcCBsZXZlbCBlbnRyeS5cbiAgICogVmVyc2lvbnMgYXJlIG9yZGVyZWQgYnkgY3JlYXRpb24gdGltZSAoYXNzdW1pbmcgdGhlIGVhcmxpZXIgY3JlYXRlZCwgdGhlIG9sZGVyIHRoZSB2ZXJzaW9uKS5cbiAgICogQHBhcmFtIGVudHJ5IFRvcCBsZXZlbCByZXBvc2l0b3J5IGVudHJ5LlxuICAgKiBAcGFyYW0gcGFyYW1zIEFkZGl0aW9uYWwgcXVlcnkgcGFyYW1zLlxuICAgKi9cbiAgbGlzdEFsbFZlcnNpb25zKGVudHJ5OiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0PiwgcGFyYW1zID0ge30pIHtcbiAgICBpZiAodGhpcy5pc0xlZ2FjeUVudHJ5KGVudHJ5KSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QmFzZVZlcnNpb25SZXN1bHRMaXN0Rm9yTGVnYWN5RW50cnkoZW50cnkpO1xuICAgIH1cblxuICAgIGNvbnN0IFZFUlNJT05fRklMVEVSX09SREVSID0ge1xuICAgICAgX19maWx0ZXI6IHt9LFxuICAgICAgX19vcmRlcmJ5OiBbeyAnY3JlYXRpb25UaW1lLmRhdGUnOiAtMSB9LCB7IGNyZWF0aW9uVGltZTogLTEgfV1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmxpc3RDaGlsZHJlbihlbnRyeSwgVkVSU0lPTl9GSUxURVJfT1JERVIsIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgYmFzZSB2ZXJzaW9ucyBvZiBnaXZlbiB0b3AgbGV2ZWwgZW50cnkuXG4gICAqIFZlcnNpb25zIGFyZSBvcmRlcmVkIGJ5IGNyZWF0aW9uIHRpbWUgKGFzc3VtaW5nIHRoZSBlYXJsaWVyIGNyZWF0ZWQsIHRoZSBvbGRlciB0aGUgdmVyc2lvbikuXG4gICAqIEBwYXJhbSBlbnRyeSBUb3AgbGV2ZWwgcmVwb3NpdG9yeSBlbnRyeS5cbiAgICogQHBhcmFtIHBhcmFtcyBBZGRpdGlvbmFsIHF1ZXJ5IHBhcmFtcy5cbiAgICovXG4gIGxpc3RCYXNlVmVyc2lvbnMoZW50cnk6IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+LCBwYXJhbXMgPSB7fSkge1xuICAgIGlmICh0aGlzLmlzTGVnYWN5RW50cnkoZW50cnkpKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRCYXNlVmVyc2lvblJlc3VsdExpc3RGb3JMZWdhY3lFbnRyeShlbnRyeSk7XG4gICAgfVxuXG4gICAgY29uc3QgTk9fUEFUQ0hfRklMVEVSX09SREVSID0ge1xuICAgICAgX19maWx0ZXI6IHtcbiAgICAgICAgX19ub3Q6IHsgX19oYXM6ICdjOHlfUGF0Y2gnIH1cbiAgICAgIH0sXG4gICAgICBfX29yZGVyYnk6IFt7ICdjcmVhdGlvblRpbWUuZGF0ZSc6IC0xIH0sIHsgY3JlYXRpb25UaW1lOiAtMSB9XVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMubGlzdENoaWxkcmVuKGVudHJ5LCBOT19QQVRDSF9GSUxURVJfT1JERVIsIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgcGF0Y2ggdmVyc2lvbnMgb2YgZ2l2ZW4gYmFzZSB2ZXJzaW9uIHVuZGVyIHRoZSBlbnRyeS5cbiAgICogVmVyc2lvbnMgYXJlIG9yZGVyZWQgYnkgY3JlYXRpb24gdGltZSAoYXNzdW1pbmcgdGhlIGVhcmxpZXIgY3JlYXRlZCwgdGhlIG9sZGVyIHRoZSB2ZXJzaW9uKS5cbiAgICogQHBhcmFtIGVudHJ5IFRvcCBsZXZlbCByZXBvc2l0b3J5IGVudHJ5LlxuICAgKiBAcGFyYW0gYmFzZVZlcnNpb24gQmFzZSB2ZXJzaW9uLlxuICAgKiBAcGFyYW0gcGFyYW1zIEFkZGl0aW9uYWwgcXVlcnkgcGFyYW1zLlxuICAgKi9cbiAgbGlzdFBhdGNoVmVyc2lvbnMoZW50cnk6IElNYW5hZ2VkT2JqZWN0LCBiYXNlVmVyc2lvbjogRmlybXdhcmVCaW5hcnkgfCBzdHJpbmcsIHBhcmFtcyA9IHt9KSB7XG4gICAgY29uc3QgdmVyc2lvbiA9IGlzU3RyaW5nKGJhc2VWZXJzaW9uKSA/IGJhc2VWZXJzaW9uIDogZ2V0KGJhc2VWZXJzaW9uLCAnYzh5X0Zpcm13YXJlLnZlcnNpb24nKTtcbiAgICBjb25zdCBQQVRDSF9GSUxURVJfT1JERVIgPSB7XG4gICAgICBfX2ZpbHRlcjoge1xuICAgICAgICAnYzh5X1BhdGNoLmRlcGVuZGVuY3knOiB2ZXJzaW9uXG4gICAgICB9LFxuICAgICAgX19vcmRlcmJ5OiBbeyAnY3JlYXRpb25UaW1lLmRhdGUnOiAtMSB9LCB7IGNyZWF0aW9uVGltZTogLTEgfV1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmxpc3RDaGlsZHJlbihlbnRyeSwgUEFUQ0hfRklMVEVSX09SREVSLCBwYXJhbXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RzIHBhdGNoIHZlcnNpb25zIG9mIGdpdmVuIGJhc2UgdmVyc2lvbiB1bmRlciB0aGUgZW50cnkgaW5jbHVkaW5nIHRoZSBiYXNlIHZlcnNpb24uXG4gICAqIFZlcnNpb25zIGFyZSBvcmRlcmVkIGJ5IGNyZWF0aW9uIHRpbWUgKGFzc3VtaW5nIHRoZSBlYXJsaWVyIGNyZWF0ZWQsIHRoZSBvbGRlciB0aGUgdmVyc2lvbikuXG4gICAqIEluIHRlcm1zIG9mIGxlZ2FjeSBiYXNlIHZlcnNpb24gdGhlIGVudHJ5IGdldHMgdHJhbnNmb3JtZWQgdG8gZml0IHRoZSBuZWVkZWQgZGF0YSBtb2RlbC5cbiAgICogQHBhcmFtIGVudHJ5IFRvcCBsZXZlbCByZXBvc2l0b3J5IGVudHJ5LlxuICAgKiBAcGFyYW0gYmFzZVZlcnNpb24gQmFzZSB2ZXJzaW9uLlxuICAgKiBAcGFyYW0gcGFyYW1zIEFkZGl0aW9uYWwgcXVlcnkgcGFyYW1zLlxuICAgKi9cbiAgbGlzdEJhc2VWZXJzaW9uQW5kUGF0Y2hlcyhlbnRyeTogSU1hbmFnZWRPYmplY3QsIGJhc2VWZXJzaW9uOiBJTWFuYWdlZE9iamVjdCwgcGFyYW1zID0ge30pIHtcbiAgICBpZiAodGhpcy5pc0xlZ2FjeUVudHJ5KGVudHJ5KSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgIGRhdGE6IFtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBjOHlfRmlybXdhcmU6IHtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBlbnRyeS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgIHVybDogZW50cnkudXJsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbnRyeVxuICAgICAgICAgIClcbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgUEFUQ0hfRklMVEVSX09SREVSID0ge1xuICAgICAgX19maWx0ZXI6IHtcbiAgICAgICAgX19vcjoge1xuICAgICAgICAgICdjOHlfUGF0Y2guZGVwZW5kZW5jeSc6IGJhc2VWZXJzaW9uLmM4eV9GaXJtd2FyZS52ZXJzaW9uLFxuICAgICAgICAgICdjOHlfRmlybXdhcmUudmVyc2lvbic6IGJhc2VWZXJzaW9uLmM4eV9GaXJtd2FyZS52ZXJzaW9uXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBfX29yZGVyYnk6IFt7ICdjOHlfUGF0Y2guZGVwZW5kZW5jeSc6IDEgfSwgeyAnYzh5X0Zpcm13YXJlLnZlcnNpb24nOiAxIH1dXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5saXN0Q2hpbGRyZW4oZW50cnksIFBBVENIX0ZJTFRFUl9PUkRFUiwgcGFyYW1zKTtcbiAgfVxuXG4gIGxpc3RDaGlsZHJlbihlbnRyeTogUGFydGlhbDxJTWFuYWdlZE9iamVjdD4sIGZpbHRlcnMgPSB7fSwgcGFyYW1zOiBhbnkgPSB7fSkge1xuICAgIGNvbnN0IGNoaWxkcmVuRmlsdGVycyA9IHsgX19ieWdyb3VwaWQ6IGVudHJ5LmlkIH07XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihmaWx0ZXJzLCBjaGlsZHJlbkZpbHRlcnMpO1xuICAgIC8vIEZJWE1FOiBuZWVkZWQgYmVjYXVzZSBvZiBpc3N1ZSBpbiBmb3JPZiBkaXJlY3RpdmUgKC4uLilcbiAgICBwYXJhbXMud2l0aFRvdGFsUGFnZXMgPSB0cnVlO1xuICAgIHJldHVybiB0aGlzLmludmVudG9yeS5saXN0UXVlcnkocXVlcnksIHBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2hlcyBhbGwgaXRlbXMgZnJvbSB0aGUgbGlzdCBzdGFydGluZyB3aXRoIHRoZSBwcm92aWRlZCBwYWdlLlxuICAgKiBAcGFyYW0gZmlyc3RQYWdlIFRoZSBmaXJzdCBwYWdlIG9mIHRoZSBsaXN0IHRvIGZldGNoIGFsbCBpdGVtcyBmb3IuXG4gICAqL1xuICBhc3luYyBmZXRjaEFsbEl0ZW1zRnJvbUxpc3QoZmlyc3RQYWdlKSB7XG4gICAgbGV0IGFsbEl0ZW1zO1xuXG4gICAgaWYgKCFmaXJzdFBhZ2UudGhlbikge1xuICAgICAgYWxsSXRlbXMgPSBbLi4uZmlyc3RQYWdlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHsgcGFnaW5nLCBkYXRhOiBpdGVtcyB9ID0gYXdhaXQgZmlyc3RQYWdlO1xuICAgICAgYWxsSXRlbXMgPSBbLi4uaXRlbXNdO1xuXG4gICAgICB3aGlsZSAocGFnaW5nICYmIHBhZ2luZy5uZXh0UGFnZSkge1xuICAgICAgICAoeyBwYWdpbmcsIGRhdGE6IGl0ZW1zIH0gPSBhd2FpdCBwYWdpbmcubmV4dCgpKTtcbiAgICAgICAgYWxsSXRlbXMgPSBbLi4uYWxsSXRlbXMsIC4uLml0ZW1zXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYWxsSXRlbXM7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0b3AgbGV2ZWwgcmVwb3NpdG9yeSBlbnRyeSBtYW5hZ2VkIG9iamVjdCBmb3IgYmFzZSBvciBwYXRjaCB2ZXJzaW9uLlxuICAgKiBAcGFyYW0gbW8gQmFzZSBvciBwYXRjaCB2ZXJzaW9uIG1hbmFnZWQgb2JqZWN0IHdpdGggcGFyZW50cy5cbiAgICovXG4gIGdldFJlcG9zaXRvcnlFbnRyeU1PJChtbzogSU1hbmFnZWRPYmplY3QpOiBPYnNlcnZhYmxlPElNYW5hZ2VkT2JqZWN0IHwgdW5kZWZpbmVkPiB7XG4gICAgaWYgKCFtbykge1xuICAgICAgcmV0dXJuIG9mKHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIGNvbnN0IFtyZWZlcmVuY2VdID0gZ2V0KG1vLCAnYWRkaXRpb25QYXJlbnRzLnJlZmVyZW5jZXMnKTtcbiAgICBjb25zdCBpZCA9IGdldChyZWZlcmVuY2UsICdtYW5hZ2VkT2JqZWN0LmlkJyk7XG4gICAgcmV0dXJuIGlkXG4gICAgICA/IGZyb20odGhpcy5pbnZlbnRvcnkuZGV0YWlsKGlkLCB7IHdpdGhDaGlsZHJlbjogZmFsc2UgfSkpLnBpcGUobWFwKCh7IGRhdGEgfSkgPT4gZGF0YSkpXG4gICAgICA6IG9mKHVuZGVmaW5lZCk7XG4gIH1cbiAgLyoqXG4gICAqIEdldHMgYmFzZSBvciBwYXRjaCB2ZXJzaW9uIG1hbmFnZWQgb2JqZWN0LlxuICAgKiBAcGFyYW0gZGV2aWNlUmVwb3NpdG9yeUZyYWdtZW50IERldmljZSByZXBvc2l0b3J5IGZyYWdtZW50LlxuICAgKiBAcGFyYW0gdHlwZSBUb3AgbGV2ZWwgcmVwb3NpdG9yeSBlbnRyeSB0eXBlLlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvbiBDb25maWd1cmF0aW9uIG9iamVjdCB3aXRoIG9wdGlvbnM6XG4gICAqIC0gKipza2lwTGVnYWN5KiogLSBgYm9vbGVhbmAgLSBFeGNsdWRlIGxlZ2FjeSBlbnRyaWVzLlxuICAgKiAtICoqZmlsdGVycyoqIC0gYG9iamVjdGAgLSBGaWx0ZXIgb2JqZWN0LlxuICAgKlxuICAgKiBAZGVwcmVjYXRlZCBhcyBpdCBkb2Vzbid0IHN1cHBvcnQgJ21pc3NpbmcgdXJsJyBjYXNlXG4gICAqL1xuICBnZXRSZXBvc2l0b3J5QmluYXJ5TW9CeVZlcnNpb24oXG4gICAgZGV2aWNlUmVwb3NpdG9yeUZyYWdtZW50OiBEZXZpY2VGaXJtd2FyZSB8IERldmljZVNvZnR3YXJlLFxuICAgIHR5cGU6IFJlcG9zaXRvcnlUeXBlLFxuICAgIHsgc2tpcExlZ2FjeSA9IGZhbHNlLCBmaWx0ZXJzID0ge30gfTogeyBza2lwTGVnYWN5PzogYm9vbGVhbjsgZmlsdGVycz86IG9iamVjdCB9ID0ge31cbiAgKTogUHJvbWlzZTxJTWFuYWdlZE9iamVjdD4ge1xuICAgIGNvbnN0IHsgdmVyc2lvbiwgdXJsLCBuYW1lIH0gPSBkZXZpY2VSZXBvc2l0b3J5RnJhZ21lbnQ7XG4gICAgY29uc3QgcmVwb3NpdG9yeUJpbmFyeVR5cGUgPSBSRVBPU0lUT1JZX0JJTkFSWV9UWVBFU1t0eXBlXTtcbiAgICBsZXQgcXVlcnk7XG4gICAgY29uc3QgbmV3TW9kZWxCYXNlVmVyc2lvblF1ZXJ5ID0ge1xuICAgICAgW2Ake3R5cGV9LnZlcnNpb25gXTogdmVyc2lvbixcbiAgICAgIFtgJHt0eXBlfS51cmxgXTogdXJsLFxuICAgICAgdHlwZTogcmVwb3NpdG9yeUJpbmFyeVR5cGVcbiAgICB9O1xuICAgIGNvbnN0IGxlZ2FjeVZlcnNpb25RdWVyeSA9IHsgdXJsLCB0eXBlLCBuYW1lIH07XG4gICAgZmlsdGVycyA9IHsgd2l0aENoaWxkcmVuOiBmYWxzZSwgd2l0aFBhcmVudHM6IHRydWUsIC4uLmZpbHRlcnMgfTtcblxuICAgIGlmIChza2lwTGVnYWN5KSB7XG4gICAgICBxdWVyeSA9IHtcbiAgICAgICAgX19hbmQ6IHtcbiAgICAgICAgICAuLi5uZXdNb2RlbEJhc2VWZXJzaW9uUXVlcnlcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcXVlcnkgPSB7XG4gICAgICAgIF9fb3I6IFt7IF9fYW5kOiB7IC4uLm5ld01vZGVsQmFzZVZlcnNpb25RdWVyeSB9IH0sIHsgX19hbmQ6IHsgLi4ubGVnYWN5VmVyc2lvblF1ZXJ5IH0gfV1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5Lmxpc3RRdWVyeShxdWVyeSwgZmlsdGVycykudGhlbigoeyBkYXRhIH0pID0+IGhlYWQoZGF0YSkpO1xuICB9XG5cbiAgZ2V0QmluYXJ5TmFtZSQoYmluYXJ5VXJsOiBzdHJpbmcpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIGlmICghYmluYXJ5VXJsKSB7XG4gICAgICByZXR1cm4gb2YoJy0tLScpO1xuICAgIH1cblxuICAgIGNvbnN0IGJpbmFyeUlkID0gdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKGJpbmFyeVVybCk7XG4gICAgaWYgKCFiaW5hcnlJZCkge1xuICAgICAgcmV0dXJuIG9mKGJpbmFyeVVybCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmludmVudG9yeS5kZXRhaWwkKGJpbmFyeUlkKS5waXBlKG1hcChtbyA9PiBtby5uYW1lKSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIGFuIGludmVudG9yeSBxdWVyeSBvYmplY3Qgd2hpY2ggY2FuIGJlIHVzZWQgdG8gZmluZFxuICAgKiByZXBvc2l0b3J5IGVudHJpZXMgb2Ygc3BlY2lmaWVkIHR5cGUgbWF0Y2hpbmcgdGhlIHR5cGUgb2YgcHJvdmlkZWQgZGV2aWNlLlxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeVR5cGUgVGhlIHR5cGUgb2YgcmVwb3NpdG9yeSBlbnRyaWVzIHdoaWNoIHdpbGwgYmUgcXVlcmllZCB3aXRoIHRoZSBnZW5lcmF0ZWQgcXVlcnkuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggbWF0Y2hpbmcgcmVwb3NpdG9yeSBlbnRyaWVzIHdpbGwgYmUgcXVlcmllZCB3aXRoIHRoZSBnZW5lcmF0ZWQgcXVlcnkuXG4gICAqL1xuICBnZXREZXZpY2VUeXBlUXVlcnkocmVwb3NpdG9yeVR5cGU6IFJlcG9zaXRvcnlUeXBlLCBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0KTogb2JqZWN0IHtcbiAgICBsZXQgcmVzdWx0ID0geyB0eXBlOiByZXBvc2l0b3J5VHlwZSB9O1xuICAgIGlmIChkZXZpY2UudHlwZSkge1xuICAgICAgaWYgKHJlcG9zaXRvcnlUeXBlID09PSBSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OKSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKHJlc3VsdCwge1xuICAgICAgICAgIF9fb3I6IFt7IGRldmljZVR5cGU6IGRldmljZS50eXBlIH0sIHsgX19ub3Q6IHsgX19oYXM6IGBkZXZpY2VUeXBlYCB9IH1dXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIocmVzdWx0LCB7XG4gICAgICAgICAgX19vcjogW1xuICAgICAgICAgICAgeyAnYzh5X0ZpbHRlci50eXBlJzogZGV2aWNlLnR5cGUgfSxcbiAgICAgICAgICAgIHsgJ2M4eV9GaWx0ZXIudHlwZSc6ICcnIH0sXG4gICAgICAgICAgICB7IF9fbm90OiB7IF9faGFzOiBgYzh5X0ZpbHRlci50eXBlYCB9IH1cbiAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBhbiBpbnZlbnRvcnkgcXVlcnkgb2JqZWN0IHdoaWNoIGNhbiBiZSB1c2VkIHRvIGZpbmQgY29uZmlndXJhdGlvbiByZXBvc2l0b3J5IGVudHJpZXNcbiAgICogbWF0Y2hpbmcgdGhlIHR5cGUgb2YgcHJvdmlkZWQgZGV2aWNlIGFuZCBzcGVjaWZpZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG1hdGNoaW5nIHJlcG9zaXRvcnkgZW50cmllcyB3aWxsIGJlIHF1ZXJpZWQgd2l0aCB0aGUgZ2VuZXJhdGVkIHF1ZXJ5LlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgQ29uZmlndXJhdGlvbiB0eXBlIGZvciB3aGljaCBtYXRjaGluZyByZXBvc2l0b3J5IGVudHJpZXMgd2lsbCBiZSBxdWVyaWVkIHdpdGggdGhlIGdlbmVyYXRlZCBxdWVyeS5cbiAgICovXG4gIGdldENvbmZpZ3VyYXRpb25UeXBlUXVlcnkoZGV2aWNlOiBJTWFuYWdlZE9iamVjdCwgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZyk6IG9iamVjdCB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLmdldERldmljZVR5cGVRdWVyeShSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OLCBkZXZpY2UpO1xuICAgIHJldHVybiB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihxdWVyeSwge1xuICAgICAgX19vcjogW1xuICAgICAgICB7IGNvbmZpZ3VyYXRpb25UeXBlIH0sXG4gICAgICAgIHsgY29uZmlndXJhdGlvblR5cGU6ICcnIH0sXG4gICAgICAgIHsgX19ub3Q6IHsgX19oYXM6IGBjb25maWd1cmF0aW9uVHlwZWAgfSB9XG4gICAgICBdXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGlzdCBvZiBzb2Z0d2FyZSBpbnN0YWxsZWQgaW4gdGhlIGRldmljZSBpbiB0aGUgdW5pZm9ybSBmb3JtYXQuXG4gICAqIFN1cHBvcnRzIGM4eV9Tb2Z0d2FyZUxpc3QgYW5kIGM4eV9Tb2Z0d2FyZSBmcmFnbWVudHMuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSB3aG9zZSBzb2Z0d2FyZSBsaXN0IHNob3VsZCBiZSByZXR1cm5lZC5cbiAgICovXG4gIGdldERldmljZVNvZnR3YXJlTGlzdChkZXZpY2U6IElNYW5hZ2VkT2JqZWN0KTogRGV2aWNlU29mdHdhcmVbXSB7XG4gICAgaWYgKGRldmljZS5jOHlfU29mdHdhcmVMaXN0KSB7XG4gICAgICByZXR1cm4gY2xvbmVEZWVwKGRldmljZS5jOHlfU29mdHdhcmVMaXN0KTtcbiAgICB9XG4gICAgaWYgKGRldmljZS5jOHlfU29mdHdhcmUpIHtcbiAgICAgIHJldHVybiBfbWFwKGRldmljZS5jOHlfU29mdHdhcmUsICh2ZXJzaW9uLCBuYW1lKSA9PiAoeyBuYW1lLCB2ZXJzaW9uIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBhcmVzIGEgc29mdHdhcmUgdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCB0aGUgbGlzdCBvZiBjaGFuZ2VzLCBhbmQgc2VuZHMgaXQgdG8gdGhlIGRldmljZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIHdoaWNoIHRoZSBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkIGZvciBhbmQgc2VudCB0by5cbiAgICogQHBhcmFtIGNoYW5nZXMgVGhlIGxpc3Qgb2Ygc29mdHdhcmUgY2hhbmdlcyB3aGljaCBzaG91bGQgYmUgYXBwbGllZC5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY2hhbmdlczogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXVxuICApOiBQcm9taXNlPElPcGVyYXRpb24+IHtcbiAgICBjb25zdCBvcGVyYXRpb24gPSB0aGlzLmdldFNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKGRldmljZSwgY2hhbmdlcyk7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLm9wZXJhdGlvbi5jcmVhdGUob3BlcmF0aW9uKSkuZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIHNvZnR3YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZSBhbmQgY2hhbmdlcy5cbiAgICogUmV0dXJuZWQgb3BlcmF0aW9uIHR5cGUgZGVwZW5kcyBvbiBkZXZpY2UncyBzdXBwb3J0ZWQgb3BlcmF0aW9ucy5cbiAgICogU3VwcG9ydHMgYzh5X1NvZnR3YXJlVXBkYXRlLCBjOHlfU29mdHdhcmVMaXN0LCBhbmQgYzh5X1NvZnR3YXJlIG9wZXJhdGlvbnMuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNoYW5nZXMgVGhlIGxpc3Qgb2Ygc29mdHdhcmUgY2hhbmdlcyB3aGljaCBzaG91bGQgYmUgYXBwbGllZC5cbiAgICovXG4gIGdldFNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKGRldmljZTogSU1hbmFnZWRPYmplY3QsIGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW10pOiBJT3BlcmF0aW9uIHtcbiAgICBjb25zdCBvcGVyYXRpb246IElPcGVyYXRpb24gPSB7XG4gICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgZGVzY3JpcHRpb246IGBBcHBseSBzb2Z0d2FyZSBjaGFuZ2VzOiAke2NoYW5nZXNcbiAgICAgICAgLm1hcChcbiAgICAgICAgICBjaGFuZ2UgPT5cbiAgICAgICAgICAgIGAke2NoYW5nZS5hY3Rpb259IFwiJHtjaGFuZ2UubmFtZX1cIiR7XG4gICAgICAgICAgICAgIGNoYW5nZS52ZXJzaW9uID8gYCAodmVyc2lvbjogJHtjaGFuZ2UudmVyc2lvbn0pYCA6ICcnXG4gICAgICAgICAgICB9YFxuICAgICAgICApXG4gICAgICAgIC5qb2luKCcsICcpfWBcbiAgICB9O1xuICAgIGlmIChkZXZpY2UuYzh5X1N1cHBvcnRlZE9wZXJhdGlvbnMuaW5jbHVkZXMoJ2M4eV9Tb2Z0d2FyZVVwZGF0ZScpKSB7XG4gICAgICBvcGVyYXRpb24uYzh5X1NvZnR3YXJlVXBkYXRlID0gY2xvbmVEZWVwKGNoYW5nZXMpO1xuICAgIH0gZWxzZSBpZiAoZGV2aWNlLmM4eV9TdXBwb3J0ZWRPcGVyYXRpb25zLmluY2x1ZGVzKCdjOHlfU29mdHdhcmVMaXN0JykpIHtcbiAgICAgIG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0ID0gY2xvbmVEZWVwKGRldmljZS5jOHlfU29mdHdhcmVMaXN0KSB8fCBbXTtcbiAgICAgIGNoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4ge1xuICAgICAgICBjb25zdCBkZXZpY2VTb2Z0d2FyZTogRGV2aWNlU29mdHdhcmUgPSBwaWNrKGNoYW5nZSwgWyduYW1lJywgJ3ZlcnNpb24nLCAndXJsJ10pO1xuICAgICAgICBpZiAoY2hhbmdlLmFjdGlvbiA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICByZW1vdmUob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZUxpc3QsIGRldmljZVNvZnR3YXJlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhbmdlLmFjdGlvbiA9PT0gJ2luc3RhbGwnKSB7XG4gICAgICAgICAgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZUxpc3QucHVzaChkZXZpY2VTb2Z0d2FyZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZGV2aWNlLmM4eV9TdXBwb3J0ZWRPcGVyYXRpb25zLmluY2x1ZGVzKCdjOHlfU29mdHdhcmUnKSkge1xuICAgICAgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZSA9IGNsb25lRGVlcChkZXZpY2UuYzh5X1NvZnR3YXJlKSB8fCB7fTtcbiAgICAgIGNoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4ge1xuICAgICAgICBpZiAoY2hhbmdlLmFjdGlvbiA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICBkZWxldGUgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVtjaGFuZ2UubmFtZV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYW5nZS5hY3Rpb24gPT09ICdpbnN0YWxsJykge1xuICAgICAgICAgIG9wZXJhdGlvbi5jOHlfU29mdHdhcmVbY2hhbmdlLm5hbWVdID0gY2hhbmdlLnZlcnNpb247XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gb3BlcmF0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3RzIHRoZSBsaXN0IG9mIGRldmljZSBzb2Z0d2FyZSBjaGFuZ2VzIGZyb20gZ2l2ZW4gb3BlcmF0aW9uIGluIHRoZSBjb250ZXh0IG9mIGdpdmVuIGRldmljZS5cbiAgICogQHBhcmFtIG9wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIGZyb20gd2hpY2ggdGhlIGxpc3Qgc2hvdWxkIGJlIGV4dHJhY3RlZC5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgdGFyZ2V0IGRldmljZSBvZiB0aGUgb3BlcmF0aW9uLlxuICAgKi9cbiAgZ2V0RGV2aWNlU29mdHdhcmVDaGFuZ2VzRnJvbU9wZXJhdGlvbihcbiAgICBvcGVyYXRpb246IElPcGVyYXRpb24sXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdFxuICApOiBEZXZpY2VTb2Z0d2FyZUNoYW5nZVtdIHtcbiAgICBpZiAob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVVwZGF0ZSkge1xuICAgICAgcmV0dXJuIGNsb25lRGVlcChvcGVyYXRpb24uYzh5X1NvZnR3YXJlVXBkYXRlKTtcbiAgICB9XG4gICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0KSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXREZXZpY2VTb2Z0d2FyZUNoYW5nZXNGcm9tU29mdHdhcmVMaXN0T3BlcmF0aW9uKG9wZXJhdGlvbiwgZGV2aWNlKTtcbiAgICB9XG4gICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmUpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldERldmljZVNvZnR3YXJlQ2hhbmdlc0Zyb21Tb2Z0d2FyZU9wZXJhdGlvbihvcGVyYXRpb24sIGRldmljZSk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGZpcm13YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZSBhbmQgdGhlIHNlbGVjdGVkIHJlcG9zaXRvcnkgYmluYXJ5LCBhbmQgc2VuZHMgaXQgdG8gdGhlIGRldmljZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIHdoaWNoIHRoZSBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkIGZvciBhbmQgc2VudCB0by5cbiAgICogQHBhcmFtIHNlbGVjdGVkT3B0aW9uIFRoZSBzZWxlY3RlZCByZXBvc2l0b3J5IGJpbmFyeSBvcHRpb24uXG4gICAqL1xuICBhc3luYyBjcmVhdGVGaXJtd2FyZVVwZGF0ZU9wZXJhdGlvbihcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LFxuICAgIHNlbGVjdGVkT3B0aW9uOiBTZWxlY3RlZFJlcG9zaXRvcnlCaW5hcnlcbiAgKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gdGhpcy5nZXRGaXJtd2FyZVVwZGF0ZU9wZXJhdGlvbihkZXZpY2UsIHNlbGVjdGVkT3B0aW9uKTtcbiAgICByZXR1cm4gKGF3YWl0IHRoaXMub3BlcmF0aW9uLmNyZWF0ZShvcGVyYXRpb24pKS5kYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBhcmVzIGEgZmlybXdhcmUgdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCBzZWxlY3RlZCB2ZXJzaW9uLlxuICAgKiBTdXBwb3J0cyBjOHlfRmlybXdhcmUgb3BlcmF0aW9uLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqIEBwYXJhbSBzZWxlY3RlZE9wdGlvbiBTZWxlY3RlZCBmaXJtd2FyZSB2ZXJzaW9uLlxuICAgKi9cbiAgZ2V0RmlybXdhcmVVcGRhdGVPcGVyYXRpb24oXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCxcbiAgICBzZWxlY3RlZE9wdGlvbjogU2VsZWN0ZWRSZXBvc2l0b3J5QmluYXJ5XG4gICk6IElPcGVyYXRpb24ge1xuICAgIGRlbGV0ZSBzZWxlY3RlZE9wdGlvbi5pZDtcblxuICAgIGNvbnN0IG9wZXJhdGlvbjogSU9wZXJhdGlvbiA9IHtcbiAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICBkZXNjcmlwdGlvbjogYFVwZGF0ZSBmaXJtd2FyZSB0bzogXCIke3NlbGVjdGVkT3B0aW9uLm5hbWV9XCIke1xuICAgICAgICBzZWxlY3RlZE9wdGlvbi52ZXJzaW9uID8gYCAodmVyc2lvbjogJHtzZWxlY3RlZE9wdGlvbi52ZXJzaW9ufSlgIDogJydcbiAgICAgIH1gLFxuICAgICAgYzh5X0Zpcm13YXJlOiB7IC4uLnNlbGVjdGVkT3B0aW9uIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIG9wZXJhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGNvbmZpZ3VyYXRpb24gZmlsZSB1cGxvYWQgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkLlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgU2VsZWN0ZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gaXNMZWdhY3kgIEEgbGVnYWN5IG9wZXJhdGlvbiBpcyBjcmVhdGVkIHdpdGhvdXQgYSBjb25maWd1cmF0aW9uVHlwZS5cbiAgICovXG4gIGdldFVwbG9hZENvbmZpZ3VyYXRpb25GaWxlT3BlcmF0aW9uKFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZyxcbiAgICBpc0xlZ2FjeTogYm9vbGVhbiA9IGZhbHNlXG4gICk6IElPcGVyYXRpb24ge1xuICAgIGlmIChpc0xlZ2FjeSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBSZXRyaWV2ZSBjb25maWd1cmF0aW9uIHNuYXBzaG90IGZyb20gZGV2aWNlICR7ZGV2aWNlLm5hbWV9YCxcbiAgICAgICAgYzh5X1VwbG9hZENvbmZpZ0ZpbGU6IHt9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUmV0cmlldmUgJHtjb25maWd1cmF0aW9uVHlwZX0gY29uZmlndXJhdGlvbiBzbmFwc2hvdCBmcm9tIGRldmljZSAke1xuICAgICAgICBkZXZpY2UubmFtZVxuICAgICAgfWAsXG4gICAgICBjOHlfVXBsb2FkQ29uZmlnRmlsZToge1xuICAgICAgICB0eXBlOiBjb25maWd1cmF0aW9uVHlwZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBjb25maWd1cmF0aW9uIGZpbGUgZG93bmxvYWQgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkLlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgU2VsZWN0ZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gYmluYXJ5VXJsIFRoZSB1cmwgb2YgYSBiaW5hcnkgdG8gYmUgZG93bmxvYWRlZC5cbiAgICogQHBhcmFtIGlzTGVnYWN5IEEgbGVnYWN5IG9wZXJhdGlvbiBpcyBjcmVhdGVkIHdpdGhvdXQgYSBjb25maWd1cmF0aW9uVHlwZS5cbiAgICovXG4gIGdldERvd25sb2FkQ29uZmlndXJhdGlvbkZpbGVPcGVyYXRpb24oXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCxcbiAgICBjb25maWd1cmF0aW9uVHlwZTogc3RyaW5nLFxuICAgIGNvbmZpZ1NuYXBzaG90OiBDb25maWd1cmF0aW9uU25hcHNob3QsXG4gICAgaXNMZWdhY3k6IGJvb2xlYW4gPSBmYWxzZVxuICApOiBJT3BlcmF0aW9uIHtcbiAgICBpZiAoaXNMZWdhY3kpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgU2VuZCBjb25maWd1cmF0aW9uIHNuYXBzaG90ICR7Y29uZmlnU25hcHNob3QubmFtZX0gdG8gZGV2aWNlICR7ZGV2aWNlLm5hbWV9YCxcbiAgICAgICAgYzh5X0Rvd25sb2FkQ29uZmlnRmlsZToge1xuICAgICAgICAgIHVybDogY29uZmlnU25hcHNob3QuYmluYXJ5VXJsLFxuICAgICAgICAgIGM4eV9Db25maWd1cmF0aW9uRHVtcDoge1xuICAgICAgICAgICAgaWQ6IGNvbmZpZ1NuYXBzaG90LmlkXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgU2VuZCBjb25maWd1cmF0aW9uIHNuYXBzaG90ICR7XG4gICAgICAgIGNvbmZpZ1NuYXBzaG90Lm5hbWVcbiAgICAgIH0gb2YgY29uZmlndXJhdGlvbiB0eXBlICR7Y29uZmlndXJhdGlvblR5cGV9IHRvIGRldmljZSAke2RldmljZS5uYW1lfWAsXG4gICAgICBjOHlfRG93bmxvYWRDb25maWdGaWxlOiB7XG4gICAgICAgIHVybDogY29uZmlnU25hcHNob3QuYmluYXJ5VXJsLFxuICAgICAgICB0eXBlOiBjb25maWd1cmF0aW9uVHlwZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGFzdCBmaXJtd2FyZSB1cGRhdGUgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UuXG4gICAqIExvb2tzIGZvciBjOHlfRmlybXdhcmUgb3BlcmF0aW9ucy5cbiAgICogQHBhcmFtIGRldmljZUlkIFRoZSBJRCBvZiB0aGUgZGV2aWNlIHRvIGZpbmQgYW4gb3BlcmF0aW9uIGZvci5cbiAgICovXG4gIGFzeW5jIGdldExhc3RGaXJtd2FyZVVwZGF0ZU9wZXJhdGlvbihkZXZpY2VJZDogc3RyaW5nIHwgbnVtYmVyKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgIGRldmljZUlkLFxuICAgICAgZGF0ZUZyb206IG5ldyBEYXRlKDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IG5ldyBEYXRlKERhdGUubm93KCkpLnRvSVNPU3RyaW5nKCksXG4gICAgICByZXZlcnQ6IHRydWUsXG4gICAgICBwYWdlU2l6ZTogMVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0Rmlyc3RNYXRjaGluZ09wZXJhdGlvbihbeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfRmlybXdhcmUnIH1dKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBsYXN0IHNvZnR3YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZS5cbiAgICogTG9va3MgZm9yIGM4eV9Tb2Z0d2FyZVVwZGF0ZSwgYzh5X1NvZnR3YXJlTGlzdCwgb3IgYzh5X1NvZnR3YXJlIG9wZXJhdGlvbnMuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgSUQgb2YgdGhlIGRldmljZSB0byBmaW5kIGFuIG9wZXJhdGlvbiBmb3IuXG4gICAqL1xuICBhc3luYyBnZXRMYXN0U29mdHdhcmVVcGRhdGVPcGVyYXRpb24oZGV2aWNlSWQ6IHN0cmluZyB8IG51bWJlcik6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICBkZXZpY2VJZCxcbiAgICAgIGRhdGVGcm9tOiBuZXcgRGF0ZSgwKS50b0lTT1N0cmluZygpLFxuICAgICAgZGF0ZVRvOiBuZXcgRGF0ZShEYXRlLm5vdygpKS50b0lTT1N0cmluZygpLFxuICAgICAgcmV2ZXJ0OiB0cnVlLFxuICAgICAgcGFnZVNpemU6IDFcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZpcnN0TWF0Y2hpbmdPcGVyYXRpb24oW1xuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfU29mdHdhcmVVcGRhdGUnIH0sXG4gICAgICB7IC4uLmZpbHRlcnMsIGZyYWdtZW50VHlwZTogJ2M4eV9Tb2Z0d2FyZUxpc3QnIH0sXG4gICAgICB7IC4uLmZpbHRlcnMsIGZyYWdtZW50VHlwZTogJ2M4eV9Tb2Z0d2FyZScgfVxuICAgIF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEl0ZXJhdGVzIG92ZXIgdGhlIGxpc3Qgb2YgZmlsdGVycyBhbmQgcXVlcmllcyB0aGUgb3BlcmF0aW9ucy5cbiAgICogSWYgYSBxdWVyeSByZXR1cm5zIGF0IGxlYXN0IG9uZSBvcGVyYXRpb24sIHRoZSBmaXJzdCBvbmUgd2lsbCBiZSByZXR1cm5lZC5cbiAgICogT3RoZXJ3aXNlIHRoZSBuZXh0IHF1ZXJ5IHdpbGwgYmUgcGVyZm9ybWVkLlxuICAgKiBJZiBub25lIG9mIHRoZSBxdWVyaWVzIHJldHVybnMgYW55IG9wZXJhdGlvbiwgbnVsbCB3aWxsIGJlIHJldHVybmVkLlxuICAgKiBAcGFyYW0gZmlsdGVyc0xpc3QgVGhlIGxpc3Qgb2YgZmlsdGVycyBmb3IgdGhlIHF1ZXJpZXMuXG4gICAqL1xuICBhc3luYyBnZXRGaXJzdE1hdGNoaW5nT3BlcmF0aW9uKGZpbHRlcnNMaXN0OiBhbnlbXSk6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGxldCBtYXRjaGluZ09wZXJhdGlvbiA9IG51bGw7XG5cbiAgICBmb3IgKGNvbnN0IGZpbHRlcnMgb2YgZmlsdGVyc0xpc3QpIHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSAoYXdhaXQgdGhpcy5vcGVyYXRpb24ubGlzdChmaWx0ZXJzKSkuZGF0YTtcbiAgICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCkge1xuICAgICAgICBtYXRjaGluZ09wZXJhdGlvbiA9IG9wZXJhdGlvbnNbMF07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtYXRjaGluZ09wZXJhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRoZSBvcGVyYXRpb24gYW5kIHJldHVybnMgYW4gb2JzZXJ2YWJsZSB0byB0cmFjayBpdHMgcHJvZ3Jlc3MuXG4gICAqIEZhaWxzIHRoZSBvYnNlcnZhYmxlIHdoZW4gdGhlIG9wZXJhdGlvbiByZXR1cm5zIEZBSUxFRCBzdGF0dXMuXG4gICAqIENvbXBsZXRlcyB0aGUgb2JzZXJ2YWJsZSB3aGVuIHRoZSBvcGVyYXRpb24gcmV0dXJucyBTVUNDRVNTRlVMIHN0YXR1cy5cbiAgICogQHBhcmFtIG9wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIHRvIGNyZWF0ZSBhbmQgdHJhY2suXG4gICAqL1xuICBjcmVhdGVPYnNlcnZlZE9wZXJhdGlvbihvcGVyYXRpb246IElPcGVyYXRpb24pOiBPYnNlcnZhYmxlPElPcGVyYXRpb24+IHtcbiAgICByZXR1cm4gZnJvbSh0aGlzLm9wZXJhdGlvbi5jcmVhdGUob3BlcmF0aW9uKSkucGlwZShcbiAgICAgIG1hcCgoeyBkYXRhIH0pID0+IGRhdGEpLFxuICAgICAgdGFrZSgxKSxcbiAgICAgIHN3aXRjaE1hcChjcmVhdGVkT3BlcmF0aW9uID0+IHRoaXMub2JzZXJ2ZU9wZXJhdGlvbihjcmVhdGVkT3BlcmF0aW9uKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gb2JzZXJ2YWJsZSB0byB0cmFjayBwcm9ncmVzcyBvZiBnaXZlbiBvcGVyYXRpb24uXG4gICAqIEZhaWxzIHRoZSBvYnNlcnZhYmxlIHdoZW4gdGhlIG9wZXJhdGlvbiByZXR1cm5zIEZBSUxFRCBzdGF0dXMuXG4gICAqIENvbXBsZXRlcyB0aGUgb2JzZXJ2YWJsZSB3aGVuIHRoZSBvcGVyYXRpb24gcmV0dXJucyBTVUNDRVNTRlVMIHN0YXR1cy5cbiAgICogQHBhcmFtIG9wZXJhdGlvbiBUaGUgb3BlcmF0aW9uIHRvIGJlIG9ic2VydmVkLlxuICAgKi9cbiAgb2JzZXJ2ZU9wZXJhdGlvbihvcGVyYXRpb246IElPcGVyYXRpb24pOiBPYnNlcnZhYmxlPElPcGVyYXRpb24+IHtcbiAgICBjb25zdCBvYnNlcnZlZE9wZXJhdGlvbiQgPSBvZihvcGVyYXRpb24pO1xuICAgIGNvbnN0IG9wZXJhdGlvblVwZGF0ZXMkID0gb2JzZXJ2ZWRPcGVyYXRpb24kLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAob2JzZXJ2ZWRPcGVyYXRpb24gPT5cbiAgICAgICAgdGhpcy5yZWFsdGltZS5vYnNlcnZhYmxlKGAvb3BlcmF0aW9ucy8ke29ic2VydmVkT3BlcmF0aW9uLmRldmljZUlkfWApXG4gICAgICApLFxuICAgICAgbWFwKCh7IGRhdGEgfSkgPT4gZGF0YSksXG4gICAgICB3aXRoTGF0ZXN0RnJvbShvYnNlcnZlZE9wZXJhdGlvbiQpLFxuICAgICAgZmlsdGVyKChbb3BlcmF0aW9uVXBkYXRlLCBvYnNlcnZlZE9wZXJhdGlvbl0pID0+IG9wZXJhdGlvblVwZGF0ZS5pZCA9PT0gb2JzZXJ2ZWRPcGVyYXRpb24uaWQpLFxuICAgICAgc3dpdGNoTWFwKChbb3BlcmF0aW9uVXBkYXRlXSkgPT4ge1xuICAgICAgICBpZiAob3BlcmF0aW9uVXBkYXRlLnN0YXR1cyA9PT0gT3BlcmF0aW9uU3RhdHVzLkZBSUxFRCkge1xuICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKG9wZXJhdGlvblVwZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9mKG9wZXJhdGlvblVwZGF0ZSk7XG4gICAgICB9KSxcbiAgICAgIHRha2VXaGlsZShvcGVyYXRpb25VcGRhdGUgPT4gb3BlcmF0aW9uVXBkYXRlLnN0YXR1cyAhPT0gT3BlcmF0aW9uU3RhdHVzLlNVQ0NFU1NGVUwsIHRydWUpXG4gICAgKTtcbiAgICByZXR1cm4gbWVyZ2Uob2JzZXJ2ZWRPcGVyYXRpb24kLCBvcGVyYXRpb25VcGRhdGVzJCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhIHNpbmdsZSBldmVudCB3aXRoIGxhdGVzdCBjcmVhdGlvblRpbWUgZm9yIHRoZSBnaXZlbiBkZXZpY2UgSWQgYW5kIGV2ZW50IHR5cGUuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgZGV2aWNlIElkIGZvciB3aGljaCB0aGUgZXZlbnRzIHNob3VsZCBiZSBxdWVyaWVkLlxuICAgKiBAcGFyYW0gdHlwZSBFdmVudCB0eXBlLlxuICAgKi9cbiAgYXN5bmMgZ2V0TGF0ZXN0Q29uZmlndXJhdGlvbkV2ZW50KFxuICAgIGRldmljZUlkOiBzdHJpbmcgfCBudW1iZXIsXG4gICAgdHlwZTogc3RyaW5nXG4gICk6IFByb21pc2U8SUV2ZW50IHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgZXZlbnRGaWx0ZXI6IG9iamVjdCA9IHtcbiAgICAgIHNvdXJjZTogZGV2aWNlSWQsXG4gICAgICB0eXBlLFxuICAgICAgZGF0ZUZyb206IHRoaXMuZGF0ZUZyb20udG9JU09TdHJpbmcoKSxcbiAgICAgIGRhdGVUbzogdGhpcy5kYXRlVG8udG9JU09TdHJpbmcoKSxcbiAgICAgIHBhZ2VTaXplOiAxXG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5ldmVudC5saXN0KGV2ZW50RmlsdGVyKTtcbiAgICByZXR1cm4gZGF0YVswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGEgbGlzdCBvZiBvcGVyYXRpb25zIGZvciB0aGUgZ2l2ZW4gZGV2aWNlIElkLCBhbmQgb3BlcmF0aW9uIHR5cGUuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgZGV2aWNlIElkIGZvciB3aGljaCB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBxdWVyaWVkLlxuICAgKiBAcGFyYW0gb3BlcmF0aW9uVHlwZSBPcGVyYXRpb24gdHlwZSBmcmFnbWVudC5cbiAgICovXG4gIGFzeW5jIGdldENvbmZpZ0ZpbGVPcGVyYXRpb25MaXN0KFxuICAgIGRldmljZUlkOiBzdHJpbmcgfCBudW1iZXIsXG4gICAgb3BlcmF0aW9uVHlwZTogc3RyaW5nXG4gICk6IFByb21pc2U8SU9wZXJhdGlvbltdPiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uRmlsdGVyOiBvYmplY3QgPSB7XG4gICAgICBkZXZpY2VJZCxcbiAgICAgIGZyYWdtZW50VHlwZTogb3BlcmF0aW9uVHlwZSxcbiAgICAgIGRhdGVGcm9tOiB0aGlzLmRhdGVGcm9tLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IHRoaXMuZGF0ZVRvLnRvSVNPU3RyaW5nKCksXG4gICAgICByZXZlcnQ6IHRydWUsXG4gICAgICBwYWdlU2l6ZTogMjAwMFxuICAgIH07XG5cbiAgICByZXR1cm4gKGF3YWl0IHRoaXMub3BlcmF0aW9uLmxpc3Qob3BlcmF0aW9uRmlsdGVyKSkuZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGxhdGVzdCB1cGxvYWRlZCBjb25maWd1cmF0aW9uIHNuYXBzaG90IGZvciB0aGUgZ2l2ZW4gZGV2aWNlLCBhbmQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIHRoZSBjb25maWd1cmF0aW9uIHNuYXBzaG90IHdhcyB1cGxvYWRlZC5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIFNlbGVjdGVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICovXG4gIGFzeW5jIGdldENvbmZpZ1NuYXBzaG90KFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZ1xuICApOiBQcm9taXNlPENvbmZpZ3VyYXRpb25TbmFwc2hvdCB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IGV2ZW50OiBJRXZlbnQgPSBhd2FpdCB0aGlzLmdldExhdGVzdENvbmZpZ3VyYXRpb25FdmVudChkZXZpY2UuaWQsIGNvbmZpZ3VyYXRpb25UeXBlKTtcbiAgICBsZXQgY29uZmlnU25hcHNob3Q6IENvbmZpZ3VyYXRpb25TbmFwc2hvdDtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIGNvbmZpZ1NuYXBzaG90ID0ge1xuICAgICAgICB0aW1lOiBldmVudC50aW1lLFxuICAgICAgICBuYW1lOiBldmVudC50ZXh0LFxuICAgICAgICBkZXZpY2VUeXBlOiBkZXZpY2UudHlwZSxcbiAgICAgICAgY29uZmlndXJhdGlvblR5cGVcbiAgICAgIH07XG4gICAgICB0cnkge1xuICAgICAgICBjb25maWdTbmFwc2hvdC5iaW5hcnkgPSBhd2FpdCAoYXdhaXQgdGhpcy5ldmVudEJpbmFyeS5kb3dubG9hZChldmVudCkpLnRleHQoKTtcbiAgICAgICAgaWYgKGV2ZW50LmM4eV9Jc0JpbmFyeSkge1xuICAgICAgICAgIGNvbmZpZ1NuYXBzaG90LmJpbmFyeVR5cGUgPSBldmVudC5jOHlfSXNCaW5hcnkudHlwZTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnQ291bGQgbm90IGdldCB0aGUgYmluYXJ5LicpO1xuICAgICAgICB0aGlzLmFsZXJ0LmRhbmdlcihtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29uZmlnU25hcHNob3Q7XG4gIH1cblxuICBhc3luYyBnZXRMZWdhY3lDb25maWdTbmFwc2hvdChkZXZpY2VJZCkge1xuICAgIGxldCBjb25maWdTbmFwc2hvdDogQ29uZmlndXJhdGlvblNuYXBzaG90O1xuICAgIGxldCBtbztcbiAgICBjb25zdCBkZXZpY2UgPSAoYXdhaXQgdGhpcy5pbnZlbnRvcnkuZGV0YWlsKGRldmljZUlkLCB7IHdpdGhDaGlsZHJlbjogZmFsc2UgfSkpLmRhdGE7XG4gICAgY29uc3Qgc25hcHNob3RJZCA9IGRldmljZS5jOHlfQ29uZmlndXJhdGlvbkR1bXAgJiYgZGV2aWNlLmM4eV9Db25maWd1cmF0aW9uRHVtcC5pZDtcbiAgICBpZiAoIXNuYXBzaG90SWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgbW8gPSAoYXdhaXQgdGhpcy5pbnZlbnRvcnkuZGV0YWlsKHNuYXBzaG90SWQpKS5kYXRhO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAvLyBkbyBub3RoaW5nXG4gICAgfVxuICAgIGlmIChtbykge1xuICAgICAgY29uZmlnU25hcHNob3QgPSB7XG4gICAgICAgIHRpbWU6IG1vLmNyZWF0aW9uVGltZSxcbiAgICAgICAgbmFtZTogbW8ubmFtZVxuICAgICAgfTtcbiAgICAgIGNvbmZpZ1NuYXBzaG90LmJpbmFyeSA9IGF3YWl0IHRoaXMuZ2V0QmluYXJ5VGV4dChtby51cmwsIHsgYWxsb3dFeHRlcm5hbDogZmFsc2UgfSk7XG4gICAgfVxuICAgIHJldHVybiBjb25maWdTbmFwc2hvdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYmluYXJ5IG9iamVjdCBhcyB0ZXh0LlxuICAgKiBAcGFyYW0gYmluYXJ5VXJsIFRoZSBVUkwgdG8gZmluZCBiaW5hcnlcbiAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgb3B0aW9uczpcbiAgICogLSAqKmFsbG93RXh0ZXJuYWwqKiAtIGBib29sZWFuYCAtIGFsbG93cyBkb3dubG9hZGluZyBleHRlcm5hbCBiaW5hcnkgZmlsZVxuICAgKiAtICoqbm9BbGVydHMqKiAtIGBib29sZWFuYCAtIGRvIG5vdCBkaXNwbGF5IGFuIGFsZXJ0IG1lc3NhZ2U7IGRlZmF1bHRzIHRvIGBmYWxzZWBcbiAgICovXG4gIGFzeW5jIGdldEJpbmFyeVRleHQoXG4gICAgYmluYXJ5VXJsOiBzdHJpbmcsXG4gICAgb3B0aW9uczogeyBhbGxvd0V4dGVybmFsOiBib29sZWFuOyBub0FsZXJ0cz86IGJvb2xlYW4gfVxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGJpbmFyeUlkID0gdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKGJpbmFyeVVybCk7XG4gICAgbGV0IHJlcztcbiAgICBpZiAoIWJpbmFyeUlkICYmIG9wdGlvbnMuYWxsb3dFeHRlcm5hbCkge1xuICAgICAgcmVzID0gYXdhaXQgdGhpcy5nZXRFeHRlcm5hbEJpbmFyeVJlc3BvbnNlKGJpbmFyeVVybCwgb3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuZ2V0SW50ZXJuYWxCaW5hcnlSZXNwb25zZShiaW5hcnlJZCwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmICghcmVzKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHJlcy50ZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGJpbmFyeSBvYmplY3QgYXMgRmlsZS5cbiAgICogQHBhcmFtIGJpbmFyeVVybCBUaGUgVVJMIHRvIGZpbmQgYmluYXJ5XG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKiphbGxvd0V4dGVybmFsKiogLSBgYm9vbGVhbmAgLSBhbGxvd3MgZG93bmxvYWRpbmcgZXh0ZXJuYWwgYmluYXJ5IGZpbGVcbiAgICovXG4gIGFzeW5jIGdldEJpbmFyeUZpbGUoYmluYXJ5VXJsOiBzdHJpbmcsIG9wdGlvbnM6IHsgYWxsb3dFeHRlcm5hbDogYm9vbGVhbiB9KTogUHJvbWlzZTxGaWxlPiB7XG4gICAgY29uc3QgYmluYXJ5SWQgPSB0aGlzLmludmVudG9yeUJpbmFyeS5nZXRJZEZyb21VcmwoYmluYXJ5VXJsKTtcbiAgICBpZiAoIWJpbmFyeUlkICYmICFvcHRpb25zLmFsbG93RXh0ZXJuYWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBAVE9ETzogbm90ZSB0aGF0IGl0IGRvZXNuJ3Qgc29sdmUgaXNzdWUgd2l0aCBleHRlcm5hbCBiaW5hcnkgaGVyZSwgc3VjaCB1cmwgd29uJ3QgaGF2ZSBiaW5hcnlJZCwgc28gd2Ugd29uJ3Qga25vdyB0aGUgbmFtZSBvciBjb250ZW50VHlwZSB0byB1c2UgaW4gRmlsZSBjb25zdHJ1Y3RvciwgbGV0J3MgYWRkIGEgQEZJWE1FIGNvbW1lbnQgZm9yIG5vdz9cbiAgICBjb25zdCB7IG5hbWUsIGNvbnRlbnRUeXBlIH0gPSAoYXdhaXQgdGhpcy5pbnZlbnRvcnkuZGV0YWlsKGJpbmFyeUlkKSkuZGF0YTtcbiAgICBjb25zdCByZXMgPSAhIWJpbmFyeUlkXG4gICAgICA/IGF3YWl0IHRoaXMuZ2V0SW50ZXJuYWxCaW5hcnlSZXNwb25zZShiaW5hcnlJZClcbiAgICAgIDogYXdhaXQgdGhpcy5nZXRFeHRlcm5hbEJpbmFyeVJlc3BvbnNlKGJpbmFyeVVybCk7XG4gICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXMuYXJyYXlCdWZmZXIoKTtcbiAgICByZXR1cm4gbmV3IEZpbGUoW2FycmF5QnVmZmVyXSwgbmFtZSwgeyB0eXBlOiBjb250ZW50VHlwZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBsYXN0IGNvbmZpZ3VyYXRpb24gdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlLlxuICAgKiBMb29rcyBmb3IgYzh5X0NvbmZpZ3VyYXRpb24gYW5kIGM4eV9TZW5kQ29uZmlndXJhdGlvbiBvcGVyYXRpb25zLlxuICAgKiBAcGFyYW0gZGV2aWNlSWQgVGhlIElEIG9mIHRoZSBkZXZpY2UgdG8gZmluZCBhbiBvcGVyYXRpb24gZm9yLlxuICAgKi9cbiAgYXN5bmMgZ2V0TGFzdENvbmZpZ1VwZGF0ZU9wZXJhdGlvbihkZXZpY2VJZDogc3RyaW5nIHwgbnVtYmVyKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3QgZmlsdGVycyA9IHtcbiAgICAgIGRldmljZUlkLFxuICAgICAgZGF0ZUZyb206IG5ldyBEYXRlKDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IG5ldyBEYXRlKERhdGUubm93KCkpLnRvSVNPU3RyaW5nKCksXG4gICAgICByZXZlcnQ6IHRydWUsXG4gICAgICBwYWdlU2l6ZTogMVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0Rmlyc3RNYXRjaGluZ09wZXJhdGlvbihbXG4gICAgICB7IC4uLmZpbHRlcnMsIGZyYWdtZW50VHlwZTogJ2M4eV9Db25maWd1cmF0aW9uJyB9LFxuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfU2VuZENvbmZpZ3VyYXRpb24nIH1cbiAgICBdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGNvbmZpZ3VyYXRpb24gZG93bmxvYWQgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIGl0cyBjdXJyZW50IGNvbmZpZ3VyYXRpb24uXG4gICAqIFN1cHBvcnRzIGM4eV9TZW5kQ29uZmlndXJhdGlvbiBvcGVyYXRpb24uXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICovXG4gIGNyZWF0ZVRleHRCYXNlZENvbmZpZ3VyYXRpb25SZWxvYWRPcGVyYXRpb24oZGV2aWNlOiBJTWFuYWdlZE9iamVjdCk6IElPcGVyYXRpb24ge1xuICAgIHJldHVybiB7XG4gICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgZGVzY3JpcHRpb246IGdldHRleHQoJ1JlcXVlc3RlZCBjdXJyZW50IGNvbmZpZ3VyYXRpb24nKSxcbiAgICAgIGM4eV9TZW5kQ29uZmlndXJhdGlvbjoge31cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBhcmVzIGEgY29uZmlndXJhdGlvbiB1cGRhdGUgb3BlcmF0aW9uIGZvciB0aGUgZ2l2ZW4gZGV2aWNlLlxuICAgKiBTdXBwb3J0cyBjOHlfQ29uZmlndXJhdGlvbiBvcGVyYXRpb24uXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNvbmZpZyBUaGUgY29uZmlndXJhdGlvbiB3aGljaCB3aWxsIHVwZGF0ZSB0aGUgZXhpc3Rpbmcgb25lLlxuICAgKi9cbiAgY3JlYXRlVGV4dEJhc2VkQ29uZmlndXJhdGlvblVwZGF0ZU9wZXJhdGlvbihkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LCBjb25maWc6IHN0cmluZyk6IElPcGVyYXRpb24ge1xuICAgIHJldHVybiB7XG4gICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgZGVzY3JpcHRpb246IGdldHRleHQoJ0NvbmZpZ3VyYXRpb24gdXBkYXRlJyksXG4gICAgICBjOHlfQ29uZmlndXJhdGlvbjoge1xuICAgICAgICBjb25maWdcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZ2V0QmluYXJ5KGJpbmFyeUlkOiBJZFJlZmVyZW5jZSk6IFByb21pc2U8SUZldGNoUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmRvd25sb2FkKGJpbmFyeUlkKTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnQ291bGQgbm90IGdldCB0aGUgYmluYXJ5LicpO1xuICAgICAgdGhpcy5hbGVydC5kYW5nZXIobXNnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbGwgYXZhaWxhYmxlIHNuYXBzaG90cyBmcm9tIHRoZSByZXBvc2l0b3J5IGZvciB0aGUgZ2l2ZW4gZGV2aWNlLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIHRoZSBzbmFwc2hvdHMgc2hvdWxkIGJlIHByZXBhcmVkLlxuICAgKiBAcGFyYW0gY29uZmlndXJhdGlvblR5cGUgU2VsZWN0ZWQgY29uZmlndXJhdGlvbiB0eXBlLlxuICAgKi9cbiAgYXN5bmMgZ2V0U25hcHNob3RzRnJvbVJlcG9zaXRvcnkoZGV2aWNlLCBjb25maWd1cmF0aW9uVHlwZSkge1xuICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gdGhpcy5nZXRDb25maWd1cmF0aW9uVHlwZVF1ZXJ5KGRldmljZSwgY29uZmlndXJhdGlvblR5cGUpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMubGlzdFJlcG9zaXRvcnlFbnRyaWVzKFJlcG9zaXRvcnlUeXBlLkNPTkZJR1VSQVRJT04sIHtcbiAgICAgIHF1ZXJ5OiBzZWFyY2hRdWVyeSxcbiAgICAgIHBhcmFtczogeyBwYWdlU2l6ZTogMTAwIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzLmRhdGE7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGJpbmFyeSBvYmplY3QuXG4gICAqIEBwYXJhbSBiaW5hcnlJZCBiaW5hcnkgSURcbiAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgb3B0aW9uczpcbiAgICogLSAqKm5vQWxlcnRzKiogLSBgYm9vbGVhbmAgLSBkbyBub3QgZGlzcGxheSBhbiBhbGVydCBtZXNzYWdlOyBkZWZhdWx0cyB0byBgZmFsc2VgXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEludGVybmFsQmluYXJ5UmVzcG9uc2UoXG4gICAgYmluYXJ5SWQ6IElkUmVmZXJlbmNlLFxuICAgIG9wdGlvbnM6IHsgbm9BbGVydHM/OiBib29sZWFuIH0gPSB7fVxuICApOiBQcm9taXNlPElGZXRjaFJlc3BvbnNlPiB7XG4gICAgbGV0IHJlcztcbiAgICB0cnkge1xuICAgICAgcmVzID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuZG93bmxvYWQoYmluYXJ5SWQpO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICBpZiAoIW9wdGlvbnMubm9BbGVydHMpIHtcbiAgICAgICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnQ291bGQgbm90IGdldCB0aGUgYmluYXJ5LicpO1xuICAgICAgICB0aGlzLmFsZXJ0LmRhbmdlcihtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBiaW5hcnkgb2JqZWN0LlxuICAgKiBAcGFyYW0gYmluYXJ5VXJsIFRoZSBVUkwgdG8gZmluZCBiaW5hcnlcbiAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgb3B0aW9uczpcbiAgICogLSAqKm5vQWxlcnRzKiogLSBgYm9vbGVhbmAgLSBkbyBub3QgZGlzcGxheSBhbiBhbGVydCBtZXNzYWdlOyBkZWZhdWx0cyB0byBgZmFsc2VgXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEV4dGVybmFsQmluYXJ5UmVzcG9uc2UoXG4gICAgYmluYXJ5VXJsOiBzdHJpbmcsXG4gICAgb3B0aW9uczogeyBub0FsZXJ0cz86IGJvb2xlYW4gfSA9IHt9XG4gICk6IFByb21pc2U8SUZldGNoUmVzcG9uc2U+IHtcbiAgICBsZXQgcmVzO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmZXRjaFJlcyA9IGF3YWl0IGZldGNoKGJpbmFyeVVybCk7XG4gICAgICBpZiAoZmV0Y2hSZXMuc3RhdHVzID49IDQwMCkge1xuICAgICAgICB0aHJvdyByZXM7XG4gICAgICB9XG4gICAgICByZXMgPSBmZXRjaFJlcztcbiAgICB9IGNhdGNoIHtcbiAgICAgIGlmICghb3B0aW9ucy5ub0FsZXJ0cykge1xuICAgICAgICBjb25zdCBtc2cgPSBnZXR0ZXh0KCdDb3VsZCBub3QgZ2V0IHRoZSBleHRlcm5hbCBiaW5hcnknKTtcbiAgICAgICAgdGhpcy5hbGVydC5kYW5nZXIobXNnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlRW50cnkobW86IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+KSB7XG4gICAgY29uc3QgYmluYXJ5SWQgPSBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5nZXRJZEZyb21VcmwobW8udXJsKTtcbiAgICBjb25zdCBuZXdNbyA9IGF3YWl0IHRoaXMuaW52ZW50b3J5LmNyZWF0ZShtbyk7XG4gICAgaWYgKGJpbmFyeUlkKSB7XG4gICAgICBhd2FpdCB0aGlzLmludmVudG9yeS5jaGlsZEFkZGl0aW9uc0FkZChiaW5hcnlJZCwgbmV3TW8uZGF0YSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdNbztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlRW50cnkobW86IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+LCB1cmwpIHtcbiAgICBjb25zdCBleGlzdGluZ0JpbmFyeUlkID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKHVybCk7XG4gICAgY29uc3QgbmV3QmluYXJ5SWQgPSBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5nZXRJZEZyb21VcmwobW8udXJsKTtcbiAgICBpZiAoZXhpc3RpbmdCaW5hcnlJZCAmJiBleGlzdGluZ0JpbmFyeUlkICE9PSBuZXdCaW5hcnlJZCkge1xuICAgICAgY29uc3QgaWQgPSB0aGlzLmludmVudG9yeUJpbmFyeS5nZXRJZEZyb21VcmwodXJsKTtcbiAgICAgIGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmRlbGV0ZShpZCk7XG4gICAgfVxuICAgIGlmIChuZXdCaW5hcnlJZCkge1xuICAgICAgYXdhaXQgdGhpcy5pbnZlbnRvcnkuY2hpbGRBZGRpdGlvbnNBZGQobmV3QmluYXJ5SWQsIG1vKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5LnVwZGF0ZShtbyk7XG4gIH1cblxuICBwcml2YXRlIGdldEJhc2VWZXJzaW9uUmVzdWx0TGlzdEZvckxlZ2FjeUVudHJ5KGVudHJ5KSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICByZXM6IHt9IGFzIElGZXRjaFJlc3BvbnNlLFxuICAgICAgZGF0YTogW1xuICAgICAgICB7XG4gICAgICAgICAgLi4uZW50cnksXG4gICAgICAgICAgW2VudHJ5LnR5cGVdOiB7XG4gICAgICAgICAgICB2ZXJzaW9uOiBlbnRyeS52ZXJzaW9uLFxuICAgICAgICAgICAgdXJsOiBlbnRyeS51cmxcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9IGFzIElSZXN1bHRMaXN0PElNYW5hZ2VkT2JqZWN0Pik7XG4gIH1cblxuICBwcml2YXRlIGdldERldmljZVNvZnR3YXJlQ2hhbmdlc0Zyb21Tb2Z0d2FyZUxpc3RPcGVyYXRpb24oXG4gICAgb3BlcmF0aW9uOiBJT3BlcmF0aW9uLFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3RcbiAgKTogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXSB7XG4gICAgY29uc3QgY2hhbmdlczogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXSA9IFtdO1xuICAgIGZvckVhY2goZGV2aWNlLmM4eV9Tb2Z0d2FyZUxpc3QsIGRldmljZVNvZnR3YXJlID0+IHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvblNvZnR3YXJlID0gZmluZChvcGVyYXRpb24uYzh5X1NvZnR3YXJlTGlzdCwgeyBuYW1lOiBkZXZpY2VTb2Z0d2FyZS5uYW1lIH0pO1xuICAgICAgaWYgKFxuICAgICAgICAob3BlcmF0aW9uU29mdHdhcmUgJiYgb3BlcmF0aW9uU29mdHdhcmUudmVyc2lvbikgIT09XG4gICAgICAgIChkZXZpY2VTb2Z0d2FyZSAmJiBkZXZpY2VTb2Z0d2FyZS52ZXJzaW9uKVxuICAgICAgKSB7XG4gICAgICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICAgICAgLi4uZGV2aWNlU29mdHdhcmUsXG4gICAgICAgICAgYWN0aW9uOiAnZGVsZXRlJ1xuICAgICAgICB9IGFzIERldmljZVNvZnR3YXJlQ2hhbmdlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBmb3JFYWNoKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0LCBvcGVyYXRpb25Tb2Z0d2FyZSA9PiB7XG4gICAgICBjb25zdCBkZXZpY2VTb2Z0d2FyZSA9IGZpbmQoZGV2aWNlLmM4eV9Tb2Z0d2FyZUxpc3QsIHsgbmFtZTogb3BlcmF0aW9uU29mdHdhcmUubmFtZSB9KTtcbiAgICAgIGlmIChcbiAgICAgICAgKG9wZXJhdGlvblNvZnR3YXJlICYmIG9wZXJhdGlvblNvZnR3YXJlLnZlcnNpb24pICE9PVxuICAgICAgICAoZGV2aWNlU29mdHdhcmUgJiYgZGV2aWNlU29mdHdhcmUudmVyc2lvbilcbiAgICAgICkge1xuICAgICAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgICAgIC4uLm9wZXJhdGlvblNvZnR3YXJlLFxuICAgICAgICAgIGFjdGlvbjogJ2luc3RhbGwnXG4gICAgICAgIH0gYXMgRGV2aWNlU29mdHdhcmVDaGFuZ2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjaGFuZ2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZXZpY2VTb2Z0d2FyZUNoYW5nZXNGcm9tU29mdHdhcmVPcGVyYXRpb24oXG4gICAgb3BlcmF0aW9uOiBJT3BlcmF0aW9uLFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3RcbiAgKTogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXSB7XG4gICAgY29uc3QgY2hhbmdlczogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXSA9IFtdO1xuICAgIGZvckVhY2goZGV2aWNlLmM4eV9Tb2Z0d2FyZSwgKGRldmljZVNvZnR3YXJlVmVyc2lvbiwgZGV2aWNlU29mdHdhcmVOYW1lKSA9PiB7XG4gICAgICBpZiAob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVtkZXZpY2VTb2Z0d2FyZU5hbWVdICE9PSBkZXZpY2VTb2Z0d2FyZVZlcnNpb24pIHtcbiAgICAgICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgICAgICBuYW1lOiBkZXZpY2VTb2Z0d2FyZU5hbWUsXG4gICAgICAgICAgdmVyc2lvbjogZGV2aWNlU29mdHdhcmVWZXJzaW9uLFxuICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZSdcbiAgICAgICAgfSBhcyBEZXZpY2VTb2Z0d2FyZUNoYW5nZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZm9yRWFjaChvcGVyYXRpb24uYzh5X1NvZnR3YXJlLCAob3BlcmF0aW9uU29mdHdhcmVWZXJzaW9uLCBvcGVyYXRpb25Tb2Z0d2FyZU5hbWUpID0+IHtcbiAgICAgIGlmIChkZXZpY2UuYzh5X1NvZnR3YXJlW29wZXJhdGlvblNvZnR3YXJlTmFtZV0gIT09IG9wZXJhdGlvblNvZnR3YXJlVmVyc2lvbikge1xuICAgICAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgICAgIG5hbWU6IG9wZXJhdGlvblNvZnR3YXJlTmFtZSxcbiAgICAgICAgICB2ZXJzaW9uOiBvcGVyYXRpb25Tb2Z0d2FyZVZlcnNpb24sXG4gICAgICAgICAgYWN0aW9uOiAnaW5zdGFsbCdcbiAgICAgICAgfSBhcyBEZXZpY2VTb2Z0d2FyZUNoYW5nZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNoYW5nZXM7XG4gIH1cbn1cbiJdfQ==