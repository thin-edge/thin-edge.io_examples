!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@c8y/ngx-components"),require("lodash-es"),require("rxjs"),require("@angular/core"),require("@c8y/client"),require("@c8y/ngx-components/api"),require("rxjs/operators"),require("ngx-bootstrap/collapse"),require("ngx-bootstrap/dropdown"),require("@ngx-translate/core")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/assets-navigator",["exports","@c8y/ngx-components","lodash-es","rxjs","@angular/core","@c8y/client","@c8y/ngx-components/api","rxjs/operators","ngx-bootstrap/collapse","ngx-bootstrap/dropdown","@ngx-translate/core"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"]["assets-navigator"]={}),e.c8y["ngx-components"],e.lodashEs,e.rxjs,e.ng.core,e.client,e.c8y["ngx-components"].api,e.rxjs.operators,e.collapse,e.dropdown,e.core$1)}(this,(function(e,t,r,o,n,i,s,c,a,u,p){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function l(e,t){function r(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var h=function(){return(h=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function y(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function f(e,t){return function(r,o){t(r,o,e)}}function v(e,t,r,o){return new(r||(r=Promise))((function(n,i){function s(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))}function g(e,t){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var b,S,G=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.priority=-1/0,r.label=t.gettext("Load more"),r.icon="plus",r.droppable=!0,r}return l(r,e),r}(t.NavigatorNode);(b=e.GroupFragment||(e.GroupFragment={})).groupType="c8y_DeviceGroup",b.subGroupType="c8y_DeviceSubgroup",b.groupFragmentType="c8y_IsDeviceGroup",b.dataBrokerSourceFragment="c8y_BrokerSource",b.dynamicGroupType="c8y_DynamicGroup",b.dynamicGroupFragment="c8y_IsDynamicGroup",b.dynamicGroupColumnConfig="c8y_UIDeviceFilterConfig",b.dynamicGroupQueryString="c8y_DeviceQueryString",(S=e.Action||(e.Action={}))[S.FETCH=0]="FETCH",S[S.NEXT=1]="NEXT",S[S.REFRESH=2]="REFRESH",S[S.LOADING_DONE=3]="LOADING_DONE";var N=function(n){function i(e,t){void 0===t&&(t={});var r=n.call(this,t)||this;return r.service=e,r.root=r.root||!1,r.mo=r.mo||{},r.path=r.root?"group":r.isDeviceOrProbablyChildDevice?"device/"+r.mo.id:"group/"+r.mo.id,r.draggable=!r.service.moduleConfig.disableDragAndDrop&&!r.root,r.droppable=!r.service.moduleConfig.disableDragAndDrop&&!r.isDeviceOrProbablyChildDevice,r.routerLinkExact=r.root,r.updateIcon(!1),r.onUpdateSubscription=r.service.onUpdate(r).subscribe((function(e){var t=e.data,o=e.method;return r.refresh(t,o)})),r}return l(i,n),Object.defineProperty(i.prototype,"label",{get:function(){return this.root&&t.gettext("Groups")||this.mo.name||"--"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasChildren",{get:function(){return this.root||this.service.groups.isGroup(this.mo)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconComponent",{get:function(){return this.isDeviceOrProbablyChildDevice?t.DeviceStatusComponent:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDevice",{get:function(){return!!this.mo.c8y_IsDevice},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDeviceOrProbablyChildDevice",{get:function(){return this.isDevice||this.isNeitherDeviceOrGroup},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isNeitherDeviceOrGroup",{get:function(){var e=this.service.groups,t=e.isGroup,r=e.isDynamicGroup;return!(t(this.mo)||r(this.mo)||this.isDevice||this.root)},enumerable:!0,configurable:!0}),i.prototype.openOnStart=function(e){if(this.root&&(this.service.moduleConfig.openOnStart||/^\/group\//.test(e)))return!0;var t=e.match(/\/(group)\/(\d+)/);if(t){var o=t[2];return[].concat(r.get(this.mo,"childAssets.references",[])).some((function(e){return e.managedObject.id===o}))}return!1},i.prototype.refresh=function(t,r){if(void 0===t&&(t={}),void 0===r&&(r="GET"),t.id===this.mo.id)this.mo=t;else if("DELETE"===r)return void this.parents.forEach((function(e){return e.refresh()}));this.events&&this.events.next(e.Action.REFRESH)},i.prototype.click=function(t){void 0===t&&(t={}),this.isDeviceOrProbablyChildDevice?this.service.preferBreadcrumb(this.parents):(this.hookEvents(),this.updateIcon(t.open),t.open&&this.events.next(e.Action.FETCH))},i.prototype.sort=function(){this.children.sort((function(e,t){return e.priority>t.priority?-1:e.priority<t.priority?1:0}))},i.prototype.addManagedObject=function(e){var t=this.mo.childAdditions;this.isChildAddition(t,e)||this.add(this.service.createChildNode(e))},i.prototype.isChildAddition=function(e,t){return e&&e.references.some((function(e){return e.managedObject.id===t.id}))},i.prototype.destroy=function(){this.onUpdateSubscription.unsubscribe()},Object.defineProperty(i.prototype,"canDrop",{get:function(){var e=this,t=this.service.draggedData;if(t){var r=!!t.find((function(t){return t===e})),o=this.children.some((function(e){return e.mo&&e.mo.id===t.mo.id})),n=this===t||r||o;return this.droppable&&!n}return this.droppable},enumerable:!0,configurable:!0}),i.prototype.dragStart=function(e){n.prototype.dragStart.call(this,e),this.service.draggedData=this,this.service.rootNode.droppable=!this.isDeviceOrProbablyChildDevice},i.prototype.dragEnd=function(e){n.prototype.dragEnd.call(this,e)},i.prototype.drop=function(e){return v(this,void 0,void 0,(function(){var t;return g(this,(function(r){switch(r.label){case 0:return n.prototype.drop.call(this,e),t=this.service.draggedData,this.canDrop?[4,this.moveNode(t)]:[3,2];case 1:return r.sent(),[3,3];case 2:this.draggedHover=!1,this.service.draggedData=void 0,r.label=3;case 3:return[2]}}))}))},i.prototype.hookEvents=function(){var e=this;this.events||(this.events=new o.Subject,this.events.subscribe((function(t){e.loading||e.handleEvent(t)})))},i.prototype.fetch=function(){return this.root?this.service.getRootNodes():this.service.getGroupItems(this.mo.id)},i.prototype.handleEvent=function(t){return v(this,void 0,void 0,(function(){var r,o;return g(this,(function(n){switch(n.label){case 0:return this.children.length||t!==e.Action.FETCH?[3,2]:(this.loading=!0,r=this.addNodes,[4,this.fetch()]);case 1:return r.apply(this,[n.sent()]),this.loading=!1,[3,5];case 2:return t!==e.Action.NEXT?[3,4]:(this.loadMoreNode.loading=!0,o=this.addNodes,[4,this.paging.next()]);case 3:return o.apply(this,[n.sent()]),this.loadMoreNode.loading=!1,[3,5];case 4:t===e.Action.REFRESH&&(this.loading=!1,this.paging=void 0,this.loadMoreNode=void 0,this.empty(),this.events.next(e.Action.FETCH)),n.label=5;case 5:return[2]}}))}))},i.prototype.addNodes=function(t){var r=this;if(t.paging){var o=this.paging=t.paging,n=o.currentPage,i=o.nextPage,s=o.pageSize;1===n&&this.empty();var c=t.data.length,a=!!i&&c===s;this.toggleLoadMore(a)}(t.data||t).map((function(e){return r.addManagedObject(e)})),this.events.next(e.Action.LOADING_DONE)},i.prototype.toggleLoadMore=function(t){var r=this;!this.loadMoreNode&&t&&(this.loadMoreNode=new G,this.add(this.loadMoreNode),this.loadMoreNode.click=function(){return r.events.next(e.Action.NEXT)}),this.loadMoreNode&&(this.loadMoreNode.hidden=!t)},i.prototype.moveNode=function(e){return v(this,void 0,void 0,(function(){var t,r;return g(this,(function(o){switch(o.label){case 0:return o.trys.push([0,6,7,8]),[4,this.showDropConfirm(e)];case 1:return t=o.sent(),[4,this.verifyNodeAccess(e)];case 2:return o.sent(),[4,this.addMovedNode(e)];case 3:return o.sent(),t?[3,5]:[4,this.removeMovedNode(e)];case 4:o.sent(),o.label=5;case 5:return this.expand(),[3,8];case 6:return(r=o.sent())&&this.service.alert.addServerFailure(r),[3,8];case 7:return this.draggedHover=!1,this.service.draggedData=void 0,[7];case 8:return[2]}}))}))},i.prototype.showDropConfirm=function(e){return v(this,void 0,void 0,(function(){var r;return g(this,(function(o){return this.confirm.title=t.gettext("Move"),this.confirm.message=t.gettext("Do you want to move the group?"),r=[{label:t.gettext("Cancel"),action:function(){return Promise.reject()}},{label:t.gettext("Move"),status:"default",action:function(){return Promise.resolve(!1)}}],e.isDeviceOrProbablyChildDevice&&(this.confirm.title=t.gettext("Move or add"),this.confirm.message=t.gettext("Do you want to move or add the device?"),r.push({label:t.gettext("Add"),status:"primary",action:function(){return Promise.resolve(!0)}})),[2,this.confirm.show(r)]}))}))},i.prototype.verifyNodeAccess=function(e){return v(this,void 0,void 0,(function(){return g(this,(function(t){return[2,this.service.inventory.update({id:e.mo.id})]}))}))},i.prototype.addMovedNode=function(t){return v(this,void 0,void 0,(function(){var r,o;return g(this,(function(n){switch(n.label){case 0:return this.root?[4,this.service.inventory.update({id:t.mo.id,type:e.GroupFragment.groupType})]:[3,2];case 1:return o=n.sent().data,r=o,[3,4];case 2:return[4,this.service.inventory.childAssetsAdd(t.mo,this.mo)];case 3:o=n.sent().data,r=o,n.label=4;case 4:return this.addManagedObject(r),[2]}}))}))},i.prototype.removeMovedNode=function(t){return v(this,void 0,void 0,(function(){var r,o,n,i,s,c;return g(this,(function(a){switch(a.label){case 0:a.trys.push([0,8,9,10]),r=m(t.parents),o=r.next(),a.label=1;case 1:return o.done||(n=o.value).mo&&n.mo.type===e.GroupFragment.dynamicGroupType?[3,7]:n.root?[4,this.service.inventory.update({id:t.mo.id,type:e.GroupFragment.subGroupType})]:[3,3];case 2:return a.sent(),[3,5];case 3:return[4,this.service.inventory.childAssetsRemove(t.mo,n.mo)];case 4:a.sent(),a.label=5;case 5:n.remove(t),a.label=6;case 6:return o=r.next(),[3,1];case 7:return[3,10];case 8:return i=a.sent(),s={error:i},[3,10];case 9:try{o&&!o.done&&(c=r.return)&&c.call(r)}finally{if(s)throw s.error}return[7];case 10:return[2]}}))}))},i.prototype.updateIcon=function(t){this.icon=this.service.groups.icon(this.root?{type:e.GroupFragment.groupType}:this.mo,t)},i}(t.NavigatorNode),x=function(e){function t(t,r){void 0===r&&(r={});var o=e.call(this,t,r)||this;return o.service=t,o.draggable=!1,o.droppable=!1,o}return l(t,e),Object.defineProperty(t.prototype,"hasChildren",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this.mo.c8y_DeviceQueryString},enumerable:!0,configurable:!0}),t.prototype.fetch=function(){return this.service.getDynamicGroupItems(this.query)},t}(N),D=new n.InjectionToken("AssetNodeConfig"),O=function(){function t(){this.icons={brokerSourceInactive:{icon:"c8y-group-remote-inactive"},brokerSource:{icon:"c8y-group-remote",iconOpen:"c8y-group-remote-open"},group:{icon:"c8y-group",iconOpen:"c8y-group-open"},dynamicGroup:{icon:"c8y-group-smart",iconOpen:"c8y-group-smart-open"},other:{icon:"circle",iconClass:"statusUnknown"}},this.dataBrokerSourceFragmentInactive="_"+e.GroupFragment.dataBrokerSourceFragment}return t.prototype.isGroup=function(t){return!!t[e.GroupFragment.groupFragmentType]||t.type===e.GroupFragment.groupType||t.type===e.GroupFragment.subGroupType},t.prototype.isDynamicGroup=function(t){return!!t[e.GroupFragment.dynamicGroupFragment]||t.type===e.GroupFragment.dynamicGroupType},t.prototype.isDataBroker=function(t){return!!t[e.GroupFragment.dataBrokerSourceFragment]||!!t[this.dataBrokerSourceFragmentInactive]},t.prototype.isDataBrokerActive=function(t){return!!t[e.GroupFragment.dataBrokerSourceFragment]&&!t[this.dataBrokerSourceFragmentInactive]},t.prototype.isDevice=function(e){return!!e.c8y_IsDevice},t.prototype.icon=function(e,t){void 0===t&&(t=!1);var r="other";this.isDynamicGroup(e)?r="dynamicGroup":this.isDataBrokerActive(e)?r="brokerSource":this.isDataBroker(e)?r="brokerSourceInactive":this.isGroup(e)&&(r="group");var o=this.icons[r];return t&&o.iconOpen||o.icon},t.prototype.isAnyGroup=function(e){return this.isGroup(e)||this.isDynamicGroup(e)||this.isDataBroker(e)||this.isDataBrokerActive(e)},t=y([n.Injectable()],t)}(),F=function(){function r(e,t,r,o,n,s,c,a,u){this.inventory=e,this.groups=t,this.apiService=r,this.modal=o,this.alert=n,this.breadcrumbService=s,this.user=c,this.appState=a,this.moduleConfig=u,this.firstUrl=!0,this.PAGE_SIZE=20,this.moduleConfig=h({rootNodePriority:2e3},u||{}),this.queriesUtil=new i.QueriesUtil}return r.prototype.createRootNode=function(){return this.rootNode=this.createAssetNode({root:!0,priority:this.moduleConfig.rootNodePriority}),this.rootNode},r.prototype.createDynamicGroupNode=function(e){return new x(this,e)},r.prototype.createAssetNode=function(e){return new N(this,e)},r.prototype.createChildNode=function(t){var r={mo:t};return t.type===e.GroupFragment.dynamicGroupType?this.createDynamicGroupNode(r):this.createAssetNode(r)},r.prototype.getRootNodes=function(t){var r={pageSize:this.PAGE_SIZE,withChildren:!1,query:this.queriesUtil.buildQuery(this.rootQueryFilter())},o=t||r;return this.user.hasRole(this.appState.currentUser.value,"ROLE_INVENTORY_READ")||(delete o.query,Object.assign(o,{fragmentType:e.GroupFragment.groupFragmentType,onlyRoots:!0})),this.inventory.list(this.createFilter(o))},r.prototype.getGroupItems=function(e,t){void 0===t&&(t={});var r={withChildren:!1,pageSize:this.PAGE_SIZE,query:this.groupQueryFilter(e)};return this.inventory.childAssetsList(e,h({},r,t))},r.prototype.getDynamicGroupItems=function(e,t){void 0===t&&(t={});var r=t.query,o=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r}(t,["query"]),n=r,i=h({q:this.buildCombinedQuery(e,n)},o);return this.inventory.list(this.createFilter(i))},r.prototype.getDeviceChildren=function(e,t){void 0===t&&(t={});var r={withChildren:!1,pageSize:this.PAGE_SIZE,query:this.groupQueryFilter(e)};return this.inventory.childDevicesList(e,h({},r,t))},r.prototype.groupQueryFilter=function(e){return"$filter=(bygroupid("+e+"))$orderby=name"},r.prototype.rootQueryFilter=function(){var t=this.moduleConfig,r={__filter:{type:""+e.GroupFragment.groupType},__orderby:[{name:1}]};if(t.smartGroups){var o={__filter:{__and:[{type:""+e.GroupFragment.dynamicGroupType},{__has:""+e.GroupFragment.dynamicGroupFragment},{__not:{__has:e.GroupFragment.dynamicGroupFragment+".invisible"}}]}};this.queriesUtil.addOrFilter(r,o)}return r},r.prototype.onUpdate=function(e){var t=this,r=e.mo,n=e.root;return r.id?this.apiService.hookResponse((function(e){var t=e.url,o=e.method;return["PUT","DELETE","POST"].includes(o)&&RegExp("((inventory/managedObjects)|(service/smartgroup/smartgroups))/"+r.id).test(t)})).pipe(c.filter((function(){return!t.draggedData})),c.mergeMap(this.apiService.resolveData),c.filter((function(e){return!e.data.c8y_Dashboard}))):n?this.apiService.hookResponse((function(e){var t=e.url,r=e.method;return RegExp("((inventory/managedObjects)|(service/smartgroup/smartgroups))/?$").test(t)&&"POST"===r})).pipe(c.mergeMap(this.apiService.resolveData),c.filter((function(e){return t.isNewManagedObjectRoot(e)}))):o.empty()},r.prototype.isNewManagedObjectRoot=function(t){void 0===t&&(t={});var r=t.data,o=!1;return"object"==typeof r&&!(o=!!r[e.GroupFragment.groupFragmentType])&&this.moduleConfig.smartGroups&&(o=!!r[e.GroupFragment.dynamicGroupFragment]),o},r.prototype.preferBreadcrumb=function(e){1===e.length&&this.breadcrumbService.selectPreferredByPath(e[0].path)},r.prototype.createFilter=function(e){void 0===e&&(e={});return h({},{currentPage:1,withTotalPages:!0,pageSize:10},e)},r.prototype.buildCombinedQuery=function(e,t){var r;e&&t?r=this.queriesUtil.buildQuery({__useFilterQueryString:e})+" "+t:r=e||t||"";return r},r.ctorParameters=function(){return[{type:i.InventoryService},{type:O},{type:s.ApiService},{type:t.ModalService},{type:t.AlertService},{type:t.BreadcrumbService},{type:i.UserService},{type:t.AppStateService},{type:void 0,decorators:[{type:n.Optional},{type:n.Inject,args:[D]}]}]},r=y([n.Injectable(),f(8,n.Optional()),f(8,n.Inject(D))],r)}(),E=function(){function e(e){this.service=e}return e.prototype.get=function(){return this.service.rootNode||this.service.createRootNode(),this.service.rootNode},e.ctorParameters=function(){return[{type:F}]},e=y([n.Injectable()],e)}(),A=function(){function e(){}var r;return r=e,e.config=function(e){return{ngModule:r,providers:[{provide:D,useValue:e}]}},e=r=y([n.NgModule({declarations:[],imports:[t.ModalModule,t.DeviceStatusModule],providers:[t.ModalService,F,O,{provide:t.HOOK_NAVIGATOR_NODES,useClass:E,multi:!0}],entryComponents:[t.DeviceStatusComponent]})],e)}(),C=function(e){function t(t,r){void 0===r&&(r={});var o=e.call(this,t,r)||this;return o.service=t,o}return l(t,e),t}(N),I=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.PAGE_SIZE=5,e}return l(r,t),r.prototype.createGroupNode=function(e){return new C(this,e)},r.prototype.createChildNode=function(e){var t={mo:e};return this.createGroupNode(t)},r.prototype.subAssetsQueryFilter=function(){var t=this.rootQueryFilter(),r=this.queriesUtil.addOrFilter(t,{type:e.GroupFragment.subGroupType});return this.queriesUtil.buildQuery(r)},r.prototype.getGroupItems=function(e){return this.inventory.childAssetsList(e,{query:this.subAssetsQueryFilter(),withChildren:!1,pageSize:this.PAGE_SIZE,withTotalPages:!0})},r=y([n.Injectable()],r)}(F),w=function(){function e(e){this.groupNodeService=e,this.selected=[],this.onChange=new n.EventEmitter}return e.prototype.ngOnInit=function(){this.rootNode=this.groupNodeService.createGroupNode({root:!0})},e.prototype.select=function(e){-1===this.getIndexOfSelected(this.selected,e)&&this.selected.push(e),this.onChange.emit(this.selected)},e.prototype.deselect=function(e){var t=this.getIndexOfSelected(this.selected,e);t>-1&&this.selected.splice(t,1),this.onChange.emit(this.selected)},e.prototype.getIndexOfSelected=function(e,t){return e.findIndex((function(e){return e.id===t.id}))},e.ctorParameters=function(){return[{type:I}]},y([n.Input()],e.prototype,"selected",void 0),y([n.Output()],e.prototype,"onChange",void 0),e=y([n.Component({selector:"c8y-asset-selector",template:'<c8y-asset-selector-node [node]="rootNode" [preselected]="selected"></c8y-asset-selector-node>\n'})],e)}(),P=function(){function r(e,t,r){this.translateService=e,this.cd=t,this.parentNode=r,this.preselected=[],this.showPath=!1,this.level=0,this.checked=!1,this.unsubscribe$=new o.Subject}return Object.defineProperty(r.prototype,"expandTitle",{get:function(){return this.node.open?t.gettext("Collapse"):t.gettext("Expand")},enumerable:!0,configurable:!0}),r.prototype.ngOnInit=function(){return v(this,void 0,void 0,(function(){var t=this;return g(this,(function(r){return this.breadcrumb=this.node.label,this.setupBreadcrumbsAndLevel(this.node),this.node instanceof C&&this.node.hookEvents(),this.node.root&&this.click(),this.node.events&&this.node.events.pipe(c.takeUntil(this.unsubscribe$),c.filter((function(t){return t===e.Action.LOADING_DONE}))).subscribe((function(){t.cd.markForCheck()})),this.checked=this.isPreselected(),[2]}))}))},r.prototype.click=function(){this.node.open=!this.node.open,this.node.click({open:this.node.open})},r.prototype.setupBreadcrumbsAndLevel=function(e){if(e.parents&&e.parents.length){var t=e.parents[0];this.breadcrumb=this.translateService.instant(t.label)+" > "+this.breadcrumb,this.level++,this.setupBreadcrumbsAndLevel(t)}},r.prototype.selected=function(e){this.checked=!this.checked,this.updateSelection(e.mo)},r.prototype.ngOnDestroy=function(){this.unsubscribe$.next(!0),this.unsubscribe$.complete()},r.prototype.isPreselected=function(){return!(this.node.root||!this.node.mo)&&this.parentNode.getIndexOfSelected(this.preselected,this.node.mo)>-1},r.prototype.updateSelection=function(e){this.checked?this.parentNode.select(e):this.parentNode.deselect(e)},r.ctorParameters=function(){return[{type:p.TranslateService},{type:n.ChangeDetectorRef},{type:w}]},y([n.Input()],r.prototype,"node",void 0),y([n.Input()],r.prototype,"preselected",void 0),y([n.Input()],r.prototype,"showPath",void 0),r=y([n.Component({selector:"c8y-asset-selector-node",template:'<div\n  class="d-flex collapsible"\n  [ngClass]="{ \'expanded separator-top\': node.open }"\n  title="{{ breadcrumb | translate }}"\n  *ngIf="!node.root && !node.hidden"\n>\n  <div\n    class="p-t-8 p-b-8 m-r-8"\n    [ngStyle]="{ \'padding-left\': level < 6 ? (level - 1) * 8 + \'px\' : \'24px\' }"\n    [style.visibility]="node.routerLinkExact ? \'hidden\' : \'visible\'"\n  >\n    <label class="c8y-checkbox">\n      <input type="checkbox" (change)="selected(node)" [checked]="checked" />\n      <span></span>\n    </label>\n  </div>\n  <div\n    class="flex-grow flex-item-middle p-t-8 p-b-8 text-truncate p-r-8"\n    [style.cursor]="node.routerLinkExact ? \'pointer\' : \'normal\'"\n    (click)="node.routerLinkExact ? node.click() : \'\'"\n  >\n    <i\n      [c8yIcon]="node.icon"\n      *ngIf="node.icon === \'c8y-group-smart\'"\n      [title]="\'Smart group\' | translate"\n      class="c8y-icon c8y-icon-duocolor m-r-4 text-16"\n    ></i>\n    <i\n      [c8yIcon]="node.icon"\n      *ngIf="node.icon !== \'c8y-group-smart\'"\n      [title]="\'Group\' | translate"\n      class="c8y-icon c8y-icon-duocolor m-r-4 text-16"\n    ></i>\n    <span title="{{ breadcrumb }}">\n      {{ node.label | translate }}\n      \x3c!-- use just for search results to display the path --\x3e\n      <p *ngIf="showPath" class="text-truncate">\n        <small class="text-muted" title="{{ breadcrumb }}">\n          <em>{{ breadcrumb }}</em>\n        </small>\n      </p>\n      \x3c!-- up to here --\x3e\n    </span>\n  </div>\n  <div>\n    <button\n      [title]="expandTitle"\n      class="collapse-btn btn"\n      (click)="click()"\n      [attr.aria-expanded]="!node.open"\n    >\n      <i c8yIcon="angle-down" [ngClass]="{ \'text-primary\': node.open }"></i>\n    </button>\n  </div>\n</div>\n<div class="collapse" [ngClass]="{ \'separator-bottom\': node.open }" [collapse]="!node.open">\n  <c8y-asset-selector-node\n    *ngFor="let childNode of node.children"\n    [node]="childNode"\n    [preselected]="preselected || []"\n  ></c8y-asset-selector-node>\n</div>\n'})],r)}(),_=function(){function e(){}return e=y([n.NgModule({imports:[t.CommonModule,a.CollapseModule,u.BsDropdownModule],exports:[P,w],providers:[I],declarations:[P,w]})],e)}();e.ASSET_NAVIGATOR_CONFIG=D,e.AssetNode=N,e.AssetNodeFactory=E,e.AssetNodeService=F,e.AssetSelectorComponent=w,e.AssetSelectorModule=_,e.AssetSelectorNodeComponent=P,e.AssetsNavigatorModule=A,e.DeviceGroupService=O,e.DynamicGroupNode=x,e.GroupNode=C,e.GroupNodeService=I,e.LoadMoreNode=G,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-assets-navigator.umd.min.js.map