!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("lodash-es"),require("ngx-bootstrap/modal"),require("rxjs"),require("rxjs/operators"),require("@c8y/ngx-components"),require("@ngx-translate/core"),require("@angular/router"),require("@c8y/client"),require("@angular/forms"),require("ngx-bootstrap/dropdown"),require("ngx-bootstrap/tooltip"),require("ngx-bootstrap/popover")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/context-dashboard",["exports","@angular/core","lodash-es","ngx-bootstrap/modal","rxjs","rxjs/operators","@c8y/ngx-components","@ngx-translate/core","@angular/router","@c8y/client","@angular/forms","ngx-bootstrap/dropdown","ngx-bootstrap/tooltip","ngx-bootstrap/popover"],e):e(((t=t||self).c8y=t.c8y||{},t.c8y["ngx-components"]=t.c8y["ngx-components"]||{},t.c8y["ngx-components"]["context-dashboard"]={}),t.ng.core,t.lodashEs,t.modal,t.rxjs,t.rxjs.operators,t.c8y["ngx-components"],t.core$1,t.ng.router,t.client,t.ng.forms,t.dropdown,t.tooltip,t.popover)}(this,(function(t,e,n,i,a,s,o,r,c,l,d,h,p,u){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var g=function(){return(g=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function b(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]])}return n}function v(t,e,n,i){var a,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(o=(s<3?a(o):s>3?a(e,n,o):a(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function y(t,e){return function(n,i){e(n,i,t)}}function m(t,e,n,i){return new(n||(n=Promise))((function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function r(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,r)}c((i=i.apply(t,e||[])).next())}))}function f(t,e){var n,i,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(s){return function(r){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,r])}}}function x(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,a,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(t){a={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o}var D,C=new e.InjectionToken("ContextDashboardConfig");(D=t.ContextDashboardType||(t.ContextDashboardType={})).Device="device",D.DeviceType="type",D.Group="group",D.Named="name",D.Report="report";var w=[{label:o.gettext("Regular`style`"),class:"panel-title-regular",description:o.gettext("The widget has no border between header and content.")},{label:o.gettext("Border`style`"),class:"panel-title-border",description:o.gettext("The widget has a small separation border between header and content.")},{label:o.gettext("Overlay`style`"),class:"panel-title-overlay",description:o.gettext("The widget content overlays the header.")},{label:o.gettext("Hidden`style`"),class:"panel-title-hidden",description:o.gettext("The widget header is not shown.")}],S=[{label:o.gettext("Light`style`"),class:"panel-content-light",description:o.gettext("The widget is styled with a light background and has low contrast.")},{label:o.gettext("Dark`style`"),class:"panel-content-dark",description:o.gettext("The widget is styled with a dark background and has high contrast.")},{label:o.gettext("Transparent`style`"),class:"panel-content-transparent",description:o.gettext("The widget is styled with a transparent background and therefore is border-less.")},{label:o.gettext("Branded`style`"),class:"panel-content-branded",description:o.gettext("The widget is styled with the main brand color.")}],T=[{label:o.gettext("Light`theme`"),class:"dashboard-theme-light",description:o.gettext("The dashboard is styled with a light background and has low contrast.")},{label:o.gettext("Dark`theme`"),class:"dashboard-theme-dark",description:o.gettext("The dashboard is styled with a dark background and has high contrast.")},{label:o.gettext("Transparent`theme`"),class:"dashboard-theme-transparent",description:o.gettext("The dashboard is styled with a transparent background and therefore is border-less.")},{label:o.gettext("Branded`theme`"),class:"dashboard-theme-branded",description:o.gettext("The dashboard is styled with the main brand color.")}],I=function(){function t(t,e,n){this.dynamicComponentService=t,this.translateService=e,this.moduleConfig=n}return t.prototype.getWidgetDefinition=function(t){return m(this,void 0,void 0,(function(){return f(this,(function(e){return[2,this.dynamicComponentService.getById$(t).toPromise()]}))}))},t.prototype.getWidgetDefinitions=function(){var t=this,e=Array.from(this.dynamicComponentService.state).map((function(e){return g({},e,{label:t.translateService.instant(e.label)})}));return n.cloneDeep(n.sortBy(e,"label").filter(this.moduleConfig.widgetFilter))},t.ctorParameters=function(){return[{type:o.DynamicComponentService},{type:r.TranslateService},{type:void 0,decorators:[{type:e.Inject,args:[C]}]}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(o.DynamicComponentService),e.ɵɵinject(r.TranslateService),e.ɵɵinject(C))},token:t,providedIn:"root"}),t=v([e.Injectable({providedIn:"root"}),y(2,e.Inject(C))],t)}(),_=function(){function i(t,e,n,i,a,s,o,r,c){this.inventory=t,this.tabs=e,this.modal=n,this.translateService=i,this.router=a,this.user=s,this.appState=o,this.navigator=r,this.permissions=c,this.REPORT_PARTIAL_NAME="report_",this.cache=new Map,this.DEFAULT_PAGESIZE=1e3,this.FRAGMENT_NAME="c8y_Dashboard",this.DASHBOARD_ROUTE_PATH="dashboard",this.INDEX_SPLIT="!",this._formDisabled=!0}return Object.defineProperty(i.prototype,"formDisabled",{get:function(){return this._formDisabled},set:function(t){this._formDisabled=t},enumerable:!0,configurable:!0}),i.prototype.create=function(e,i){return m(this,void 0,void 0,(function(){var a,s,o,r,c,l;return f(this,(function(d){switch(d.label){case 0:return"string"==typeof i?(a=i,s=t.ContextDashboardType.Named):(a=i.contextData.id,s=this.getDashboardTypeFromViewContext(e,i)),o={},n.assign(o,{c8y_Dashboard:e}),r=s===t.ContextDashboardType.DeviceType?e.deviceTypeValue:a,c=this.createFragmentKey(s,r),o[c]={},this.shouldSetGlobal(o)&&n.assign(o,{c8y_Global:{}}),o.name=o.c8y_Dashboard.name,s!==t.ContextDashboardType.Group&&s!==t.ContextDashboardType.Device?[3,2]:[4,this.inventory.childAdditionsCreate(o,a)];case 1:return l=d.sent(),[3,4];case 2:return[4,this.inventory.create(o)];case 3:l=d.sent(),d.label=4;case 4:return[2,l.data]}}))}))},i.prototype.detail=function(t){return m(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:return[4,this.inventory.detail(t)];case 1:return e=n.sent().data,this.cache.set(t.id,e),[2,e]}}))}))},i.prototype.update=function(t){return m(this,void 0,void 0,(function(){var e,i;return f(this,(function(a){switch(a.label){case 0:return t.name=t.c8y_Dashboard.name,(e=this.clean(n.pick(t,[this.FRAGMENT_NAME,"id","name"]))).c8y_Global=this.shouldSetGlobal(t),[4,this.inventory.update(e)];case 1:return i=a.sent().data,this.cache.set(t.id,i),[2,i]}}))}))},i.prototype.delete=function(t,e){return void 0===e&&(e=!0),m(this,void 0,void 0,(function(){var n,i,a=this;return f(this,(function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),e?(n=o.gettext('You are about to delete the dashboard "{{ dashboardName }}". Do you want to proceed?'),this.isDeviceType(t)&&(n=o.gettext('You are about to delete the dashboard "{{ dashboardName }}" from all devices of the type "{{ deviceType }}".\n           Do you want to proceed?')),[4,this.modal.confirm(o.gettext("Delete dashboard"),this.translateService.instant(n,{dashboardName:t.c8y_Dashboard.name,deviceType:t.c8y_Dashboard.deviceTypeValue}),o.Status.DANGER,{ok:o.gettext("Delete"),cancel:o.gettext("Cancel")})]):[3,2];case 1:s.sent(),s.label=2;case 2:return[4,this.inventory.delete(t)];case 3:return s.sent(),i=Array.from(this.tabs.state).find((function(e){return e.path.endsWith(a.DASHBOARD_ROUTE_PATH+"/"+t.id)})),this.tabs.remove(i),this.tabs.refresh(),[3,5];case 4:return s.sent(),[3,5];case 5:return[2]}}))}))},i.prototype.activateDashboards=function(t,e){var n=t.params.dashboardId;return n?this.getDashboard$(n,e,t.parent.data.contextData).pipe(s.tap((function(e){t.data={dashboard:e}})),s.map((function(){return!0})),s.catchError((function(){return a.of(!1)}))):this.getTabs$(t.data.contextData,e)},i.prototype.getNamedDashboardOrCreate=function(e,n){var i=this,o=this.mapWidgets(n);return this.getDashboard$(e,[t.ContextDashboardType.Named]).pipe(s.throwIfEmpty(),s.catchError((function(){return a.from(i.create({children:o,widgetClasses:{"dashboard-theme-light":!0,"panel-title-regular":!0}},e))})))},i.prototype.refreshTabs=function(t){return m(this,void 0,void 0,(function(){var e,n,i,a,s,o,r=this;return f(this,(function(c){switch(c.label){case 0:return this.isNamed(t)?[3,2]:(e=Array.from(this.tabs.state).find((function(e){return e.path.endsWith(r.DASHBOARD_ROUTE_PATH+"/"+t.id)})),[4,this.detail(t)]);case 1:n=c.sent(),e&&(i=n.c8y_Dashboard,a=i.icon,s=i.priority,o=i.name,e.icon=a,e.priority=s,e.label=o),this.tabs.refresh(),c.label=2;case 2:return[2]}}))}))},i.prototype.updateNavigatorItem=function(t){var e=this;if(this.navigator.state.forEach((function(n){n.path==="reports/"+t.id&&e.navigator.remove(n)})),t.c8y_IsNavigatorNode){var n=new o.NavigatorNode({label:t.name,path:"reports/"+t.id,icon:t.icon,priority:t.priority});this.navigator.add(n)}},i.prototype.navigateToDashboard=function(t){return m(this,void 0,void 0,(function(){return f(this,(function(e){return/dashboard/.test(this.router.url)?this.router.navigate(["..",t.id],{relativeTo:o.getActivatedRoute(this.router)}):this.router.navigate(["..",this.DASHBOARD_ROUTE_PATH,t.id],{relativeTo:o.getActivatedRoute(this.router)}),[2]}))}))},i.prototype.canEditDashboard=function(t){return this.permissions.canEdit(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"],t)},i.prototype.isNamed=function(e){var i=this;return n.some(n.keys(e),(function(e){return new RegExp("^"+i.FRAGMENT_NAME+i.INDEX_SPLIT+t.ContextDashboardType.Named+i.INDEX_SPLIT).test(e)}))},i.prototype.isReport=function(e){var i=this;return n.some(n.keys(e),(function(e){return new RegExp("^"+i.FRAGMENT_NAME+i.INDEX_SPLIT+t.ContextDashboardType.Named+i.INDEX_SPLIT+i.REPORT_PARTIAL_NAME).test(e)}))},i.prototype.isDeviceType=function(e){var i=this;return n.some(n.keys(e),(function(e){return new RegExp("^"+i.FRAGMENT_NAME+i.INDEX_SPLIT+t.ContextDashboardType.DeviceType+i.INDEX_SPLIT).test(e)}))},i.prototype.getStyling=function(t,e,n){var i=t.find((function(t){return t&&new RegExp(e,"i").test(t.class)}));return i?i.class:n},i.prototype.mapWidgets=function(t){return n.keyBy(t.map((function(t){return t.id=String(Math.random()).substr(2),t})),"id")},i.prototype.getDashboard$=function(e,i,o){var r=this,c=this.cache.get(e),l=o?this.getContextDashboards(o,i):[this.getNamedDashboard(e)],d=this.getContextDashboards$(l).pipe(s.tap((function(t){return r.cacheDashboard(t)})),s.filter((function(i){return i.id===e||n.has(i,""+r.FRAGMENT_NAME+r.INDEX_SPLIT+t.ContextDashboardType.Named+r.INDEX_SPLIT+e)})));return c?a.of(c):d},i.prototype.getTabs$=function(t,e){var n=this,i=this.getContextDashboards(t,e);return this.setBaseContextRoute(t,e),this.getContextDashboards$(i).pipe(s.map((function(t){return n.removeDashboardMoProperty(t)})),s.tap((function(t){return n.cacheDashboard(t)})),s.map((function(t){return n.createDashboardTab(t)})),s.toArray())},i.prototype.getContextDashboards$=function(t){return a.from(t).pipe(s.mergeAll(),s.mergeMap((function(t){return t.data})))},i.prototype.setBaseContextRoute=function(e,n){var i=n.includes(t.ContextDashboardType.Device)?t.ContextDashboardType.Device:t.ContextDashboardType.Group;this.currentContextRoute=i+"/"+e.id},i.prototype.removeDashboardMoProperty=function(t){var e=n.cloneDeep(t),i=n.get(e,"c8y_Dashboard.children"),a=!1;return n.forEach(i,(function(t){n.get(t,"componentTransformConfigWithContext")&&(delete t.componentTransformConfigWithContext,a=!0),n.get(t,"config.dashboardMo")&&(delete t.config.dashboardMo,a=!0)})),a&&this.update(e),e},i.prototype.cacheDashboard=function(t){this.cache.set(t.id,t)},i.prototype.createDashboardTab=function(t){var e=t.c8y_Dashboard,n=t.id;return{icon:e.icon,path:this.DASHBOARD_ROUTE_PATH+"/"+n,label:e.name,priority:e.priority,hide:this.isReport(t)}},i.prototype.clean=function(t){var e=JSON.stringify(t,(function(t,e){if("$$hashKey"!==t&&"klasses"!==t)return e}));return JSON.parse(e)},i.prototype.getNamedDashboard=function(e){return this.inventory.list({fragmentType:""+this.FRAGMENT_NAME+this.INDEX_SPLIT+t.ContextDashboardType.Named+this.INDEX_SPLIT+e,pageSize:1})},i.prototype.getContextDashboards=function(t,e){var n=this;return e.map((function(e){return n.inventory.list({fragmentType:n.createDashboardFragment(t,e),pageSize:n.DEFAULT_PAGESIZE})}))},i.prototype.createDashboardFragment=function(e,n){var i;return i=e.c8y_Report?""+this.REPORT_PARTIAL_NAME+e.id:n===t.ContextDashboardType.DeviceType?e.type:e.id,""+this.FRAGMENT_NAME+this.INDEX_SPLIT+n+this.INDEX_SPLIT+i},i.prototype.getDashboardTypeFromViewContext=function(e,n){var i;return n.context===o.ViewContext.Device&&(i=e.deviceType?t.ContextDashboardType.DeviceType:t.ContextDashboardType.Device),n.context===o.ViewContext.Group&&(i=t.ContextDashboardType.Group),i},i.prototype.createFragmentKey=function(t,e){return[this.FRAGMENT_NAME,t,e].join(this.INDEX_SPLIT)},i.prototype.shouldSetGlobal=function(t){return this.isNamed(t)&&!this.isReport(t)||this.isDeviceType(t)?{}:null},i.ctorParameters=function(){return[{type:l.InventoryService},{type:o.TabsService},{type:o.ModalService},{type:r.TranslateService},{type:c.Router},{type:l.UserService},{type:o.AppStateService},{type:o.NavigatorService},{type:o.Permissions}]},i=v([e.Injectable()],i)}(),N=function(){function t(t,e,n){var i=this;this.widgetService=t,this.modal=e,this.contextDashboardService=n,this.mode="select",this.searchChange$=new a.Subject,this.searchTerm="",this.styling={headerClass:"panel-title-regular",contentClass:"panel-content-light"},this.defaultStyling={headerClass:"panel-title-regular",contentClass:"panel-content-light"},this.possibleStyling={WIDGET_HEADER_CLASSES:w,WIDGET_CONTENT_CLASSES:S},this.isUpgrade=!1,this.result=new Promise((function(t,e){i._save=t,i._cancel=e}))}return Object.defineProperty(t.prototype,"isEdit",{get:function(){return!!this.current},enumerable:!0,configurable:!0}),t.prototype.ngAfterContentInit=function(){var t=this;this.components=this.widgetService.getWidgetDefinitions(),this.selected&&(this.current=n.clone(this.selected),this.select(this.selected,this.isEdit?"config":"select")),this.searchSub=this.searchChange$.pipe(s.switchMap((function(t){return a.iif((function(){return 13!==t.which}),a.timer(200),a.timer(10))}))).subscribe((function(){t.search()})),this.mo.c8y_Dashboard.classes&&(this.styling=this.setDefaultStyle(g({},this.mo.c8y_Dashboard.classes,this.mo.c8y_Dashboard.widgetClasses,this.isEdit?this.current.data.classes:{})),this.defaultStyling=this.setDefaultStyle(g({},this.mo.c8y_Dashboard.classes,this.mo.c8y_Dashboard.widgetClasses)))},t.prototype.save=function(){return m(this,void 0,void 0,(function(){var t,e,i,a,s,o,r,c,l;return f(this,(function(d){switch(d.label){case 0:return[4,this.dynamicComponent.callLifeCycleHooks().toPromise()];case 1:return d.sent()?(t=this.selected.data,e=t._x,i=t._y,a=t._width,s=t._height,this.widgetConfig&&this.widgetConfig.device&&(o=this.widgetConfig.device,r=o.id,c=o.name,this.widgetConfig.device={id:r,name:c}),l=g({_x:e,_y:i,_width:a,_height:s,config:n.omit(this.widgetConfig,"settings"),title:this.selected.data.title,componentId:this.selected.id,id:this.isEdit?this.current.data.id:String(Math.random()).substr(2),classes:this.getStyle()},this.isEdit?{}:this.widgetConfig.settings.widgetDefaults),this._save(l),[2]):[2]}}))}))},t.prototype.select=function(t,e){if(void 0===e&&(e="config"),t.data=t.data||{},this.selected=t,this.isUpgrade=!!n.get(t,"data.settings.upgrade"),this.contextDashboardService.formDisabled=this.isUpgrade,this.isEdit){var i=this.current.data,a=i._x,s=i._y,o=i._width,r=i._height,c=i.classes,l=i.title;this.selected.data=g({},this.selected.data,{_x:a,_y:s,_width:o,_height:r,classes:c,title:l})}this.widgetConfig=n.cloneDeep(this.composeWidgetConfig(this.selected,this.context)),this.selected.data.title=this.selected.data.title||t.label,this.componentLabel=t.label,this.mode=e},t.prototype.search=function(){var t=this;this.searchTerm.length>0?this.searchResult=this.components.filter((function(e){return new RegExp(n.escapeRegExp(t.searchTerm.trim()),"i").test(e.label)})):this.resetSearch()},t.prototype.resetSearch=function(){this.searchTerm="",this.searchResult=void 0},t.prototype.changeMode=function(t){this.mode=t},t.prototype.close=function(){this._cancel(),this.modal.hide()},t.prototype.getStyle=function(t){void 0===t&&(t=!1);var e={};return!t&&this.isDashboardDefaultStyle(this.styling.headerClass)||(e[this.styling.headerClass]=!0),!t&&this.isDashboardDefaultStyle(this.styling.contentClass)||(e[this.styling.contentClass]=!0),t&&(e["dashboard-theme-"+this.defaultStyling.contentClass.split("-").pop()]=!0),e},t.prototype.ngOnDestroy=function(){this.contextDashboardService.formDisabled=!0,this.searchSub&&this.searchSub.unsubscribe()},t.prototype.isDashboardDefaultStyle=function(t){var e=g({},this.mo.c8y_Dashboard.classes,this.mo.c8y_Dashboard.widgetClasses),n=Object.keys(e).map((function(t){return{class:t}}));return!!this.contextDashboardService.getStyling(n,t.split("-").pop(),void 0)},t.prototype.setDefaultStyle=function(t){var e=this,n=this.styling.contentClass,i=this.styling.headerClass;return Object.keys(t).map((function(t){return t.split("-").pop()})).forEach((function(t){n=e.contextDashboardService.getStyling(S,t,n),i=e.contextDashboardService.getStyling(w,t,i)})),{headerClass:i,contentClass:n}},t.prototype.composeWidgetConfig=function(t,e){void 0===e&&(e={});var i=g({settings:g({},t.data.settings,n.get(t.data.settings,"ng1.options"),n.get(t.data,"ng1.options"),{context:e,dashboardMo:this.mo.c8y_Dashboard})},t.data.config);return this.applyTargetIfDeviceDashboard(i)},t.prototype.applyTargetIfDeviceDashboard=function(t){var e=this.contextDashboardService.isDeviceType(this.mo);e&&(t.settings.hideTarget=e,(t.settings.ng1?t.settings.ng1.options.noDeviceTarget:t.settings.noDeviceTarget)||(t.device={id:this.context.id,name:this.context.name}));return t},t.ctorParameters=function(){return[{type:I},{type:i.BsModalRef},{type:_}]},v([e.ViewChild("config",{static:!1})],t.prototype,"dynamicComponent",void 0),t=v([e.Component({selector:"c8y-widget-config",template:'<div class="modal-header separator">\n  <h3 *ngIf="!current" translate>Add widget</h3>\n  <h3 *ngIf="current" translate>Edit widget</h3>\n</div>\n<form #configForm="ngForm" name="form">\n  <div class="c8y-modal-tabs">\n    <div class="tabContainer">\n      <ul class="nav nav-tabs nav-tabsc8y p-l-24">\n        <li [class.active]="mode === \'select\'">\n          <button type="button" class="btn" (click)="changeMode(\'select\'); (false)">\n            <i c8yIcon="th-large"></i> <span class="txt" translate>Select widget</span>\n          </button>\n        </li>\n        <li [class.active]="mode === \'config\'">\n          <button\n            type="button"\n            class="btn"\n            [disabled]="!selected"\n            (click)="changeMode(\'config\'); (false)"\n          >\n            <i c8yIcon="cog"></i> <span class="txt" translate>Configuration</span>\n          </button>\n        </li>\n        <li [class.active]="mode === \'style\'">\n          <button\n            type="button"\n            class="btn"\n            [disabled]="!selected"\n            (click)="changeMode(\'style\'); (false)"\n          >\n            <i c8yIcon="paint-brush"></i> <span class="txt" translate>Appearance</span>\n          </button>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <div class="modal-inner-scroll">\n    <div\n      *ngIf="mode === \'select\'"\n      class="bg-white p-l-24 p-r-24 p-t-8 p-b-8 sticky-header-top-0"\n      style="z-index: 2;"\n    >\n      <div class="row">\n        <div class="col-sm-6">\n          <div class="input-group input-group-search">\n            <input\n              class="form-control"\n              placeholder="{{ \'Search…\' | translate }}"\n              type="text"\n              [(ngModel)]="searchTerm"\n              [ngModelOptions]="{ standalone: true }"\n              (keydown)="searchChange$.next($event)"\n            />\n            <span class="input-group-btn">\n              <button class="btn btn-clean" (click)="resetSearch()" type="button">\n                <i [c8yIcon]="searchTerm.length === 0 ? \'search\' : \'close\'"></i>\n              </button>\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="modal-body bg-gray-lighter" *ngIf="mode === \'select\'">\n      <div class="card-group card-select m-b-0" >\n        <div\n          class="col-md-3 col-sm-4 col-xs-6"\n          *ngFor="let cmp of searchResult || components"\n          title="{{ cmp.description | translate }}"\n        >\n          <div class="card p-8" [class.active]="selected === cmp" (click)="select(cmp)">\n            <div\n              class="text-center p-8 m-b-8 flex-col flex-center"\n              style="min-height: 170px; background-color: var(--body-background-color, #f2f3f4);"\n            >\n              <ng-container *ngIf="!cmp.previewImage; else previewImage">\n                <h1><i c8yIcon="file-image-o"></i></h1>\n                <small translate>Preview not available</small>\n              </ng-container>\n              <ng-template #previewImage>\n                <img class="img-responsive" [src]="cmp.previewImage" />\n              </ng-template>\n            </div>\n            <p class="card-title text-truncate">\n              <c8y-highlight\n                text="{{ cmp.label | translate }}"\n                [pattern]="searchTerm"\n              ></c8y-highlight>\n            </p>\n          </div>\n        </div>\n\n        <div class="c8y-empty-state text-center" *ngIf="searchResult && searchResult.length === 0">\n          <h1 c8yIcon="search"></h1>\n          <h3 translate>No widgets found.</h3>\n          <div class="d-flex">\n            <p translate class="m-r-8">Rephrase your search term.</p>\n            <button class="btn btn-primary" (click)="resetSearch()" translate>\n              Reset search\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- The following is intentional set to hidden to allow the ViewChild ref in the controller --\x3e\n    <div\n      class="modal-body"\n      *ngIf="selected"\n      [hidden]="mode !== \'config\'"\n      style="min-height: calc(100vh - 290px);"\n    >\n      <h4 class="text-left">\n        <strong>\n          {{ selected.label | translate }}\n        </strong>\n      </h4>\n      <p class="m-b-24">\n        {{ selected.description | translate }}\n      </p>\n      <div class="row">\n        \x3c!-- change to col-sm-6 when preview is available --\x3e\n        <div class="col-sm-12">\n          <div class="legend form-block" translate>Configuration</div>\n          <c8y-form-group>\n            <label for="widgetTitle" translate>Title</label>\n            <input\n              id="widgetTitle"\n              [(ngModel)]="selected.data.title"\n              type="text"\n              name="title"\n              class="form-control"\n              placeholder="{{ \'e.g.\' | translate }} {{ componentLabel | translate }}"\n              required\n            />\n          </c8y-form-group>\n\n          \x3c!-- This is an upgraded component for the device selector and still needs to be migrated --\x3e\n          <c8y-dynamic-component\n            componentId="device.selector.legacy"\n            [config]="widgetConfig"\n            [notFoundError]="false"\n            *ngIf="!isUpgrade"\n          ></c8y-dynamic-component>\n\n          <c8y-dynamic-component\n            [componentId]="selected.id"\n            mode="config"\n            [config]="widgetConfig"\n            [notFoundError]="false"\n            #config\n          ></c8y-dynamic-component>\n        </div>\n        \x3c!-- markup for the preview\n\n        <div class="col-sm-6 sticky-header-top-0" >\n          <div class="legend form-block">\n            Preview\n          </div>\n          <div class="bg-gray-lighter p-16">\n            <div class="card card-dashboard m-b-0">\n              <div class="card-header-actions">\n                <div class="card-title text-uppercase">{{ selected.data.title }}</div>\n                <div class="header-actions">\n                  <div class="optionsBtn dropdow" class="btnIcon dropdown-toggle c8y-dropdown">\n                    <i c8yIcon="cog"></i>\n                  </div>\n                </div>\n              </div>\n              <div class="card-inner-scroll">\n                <div class="card-block" style="min-height: 240px;">\n                  include here the widget\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      --\x3e</div>\n    </div>\n\n    <div *ngIf="mode === \'style\'" class="modal-body p-t-0" style="min-height: calc(100vh - 290px);">\n      <div class="row">\n        <div class="col-xs-6">\n          <c8y-appearance-settings\n            [(themeClass)]="styling.contentClass"\n            [(headerClass)]="styling.headerClass"\n            [possibleStylingTheme]="possibleStyling.WIDGET_CONTENT_CLASSES"\n            [possibleStylingHeader]="possibleStyling.WIDGET_HEADER_CLASSES"\n            [defaultThemeClass]="defaultStyling.contentClass"\n            [defaultHeaderClass]="defaultStyling.headerClass"\n          >\n          </c8y-appearance-settings>\n        </div>\n        <div class="col-xs-6 sticky-header-top-0">\n          <c8y-widget-preview [previewClasses]="getStyle(true)"></c8y-widget-preview>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="modal-footer">\n    <button\n      type="button"\n      title="{{ \'Cancel\' | translate }}"\n      class="btn btn-default"\n      (click)="close()"\n      translate\n    >\n      Cancel\n    </button>\n    <button\n      title="{{ \'Save\' | translate }}"\n      class="btn btn-primary"\n      (click)="save()"\n      translate\n      [disabled]="contextDashboardService.formDisabled || configForm.invalid"\n      c8yProductExperience\n      [actionName]="current ? \'editWidget\' : \'createWidget\'"\n      [actionData]="{ widgetName: selected && selected.id }"\n    >\n      Save\n    </button>\n  </div>\n</form>\n'})],t)}(),k=function(){function n(t){this.contextDashboardService=t}return n.prototype.canActivate=function(e){return this.contextDashboardService.activateDashboards(e,[t.ContextDashboardType.Device,t.ContextDashboardType.DeviceType])},n.ctorParameters=function(){return[{type:_}]},n=v([e.Injectable()],n)}(),E=function(){function n(t){this.contextDashboardService=t}return n.prototype.canActivate=function(e){return this.contextDashboardService.activateDashboards(e,[t.ContextDashboardType.Group])},n.ctorParameters=function(){return[{type:_}]},n=v([e.Injectable()],n)}(),R=function(){function t(){this.previewClasses={"dashboard-theme-light":!0,"panel-title-regular":!0}}return v([e.Input()],t.prototype,"previewClasses",void 0),v([e.Input()],t.prototype,"tab",void 0),t=v([e.Component({selector:"c8y-widget-preview",template:'<div class="legend form-block" translate>Preview</div>\n<label *ngIf="tab" translate>Tab and layout</label>\n<label *ngIf="!tab" translate>Layout</label>\n<div class="dashboard-preview-slot" [ngClass]="previewClasses">\n  <div\n    class="page-tabs page-tabs-horizontal navigator-open p-absolute overflow-hidden"\n    style="left: 0; margin: 0 15px;"\n    *ngIf="tab"\n  >\n    <div class="tabContainer hidden-xs">\n      <ul class="nav nav-tabs nav-tabsc8y">\n        <li class="active" style="left: 16px;">\n          <a routerlinkactive="" title="{{ tab.name }}">\n            <i class="text-primary" [c8yIcon]="tab.icon"></i>\n            <span class="txt">{{ tab.name }}</span></a\n          >\n        </li>\n      </ul>\n    </div>\n    <div class="visible-xs mobile-tabs"></div>\n  </div>\n  <div [ngClass]="{ \'m-t-64\': !!tab }">\n    <div class="card card-dashboard" style="height: 360px;">\n      <div class="card-header-actions" style="z-index: 8;">\n        <div class="card-title">\n          <span translate>Widget title</span>\n        </div>\n        <div class="header-actions">\n          <div class="optionsBtn dropdown">\n            <a href="" (click)="(false)" class="dropdown-toggle c8y-dropdown">\n              <i c8yIcon="cog"></i>\n            </a>\n          </div>\n        </div>\n      </div>\n      <div class="card-inner-scroll p-t-16">\n        <p translate>Widget example content.</p>\n      </div>\n    </div>\n  </div>\n</div>\n'})],t)}(),A=function(){function t(t,e,n,i){var a=this;this.modal=t,this.contextDashboardService=n,this.navigatorService=i,this.styling={themeClass:"dashboard-theme-light",headerClass:"panel-title-regular"},this.possibleStyling={DASHBOARD_THEME_CLASSES:T,WIDGET_HEADER_CLASSES:w},this.result=new Promise((function(t,e){a._save=t,a._cancel=e})),this.DEFAULT_DASHBOARD_MARGIN=12,this.DEFAULT_DASHBOARD_ICON="th",this.DEFAULT_DASHBOARD_PRIORITY=1e4,this.icons=e,this.filteredIcons=e}return t.prototype.ngAfterContentInit=function(){var t={name:this.isReport?"Report":"Dashboard",priority:this.DEFAULT_DASHBOARD_PRIORITY,icon:this.DEFAULT_DASHBOARD_ICON,deviceTypeValue:this.deviceType};this.dashboard?(this.current=n.clone(this.dashboard),this.setDashboardStyle()):(this.dashboard=t,this.dashboardDetailForm.form.markAsDirty()),this.setTitle(),this.navigatorNodes$=this.navigatorService.items$,this.namePlaceholder=this.isReport?o.gettext("e.g. My report"):o.gettext("e.g. My dashboard")},t.prototype.setTitle=function(){this.titleName=this.isReport?o.gettext("report"):o.gettext("dashboard"),this.titleAction=this.current?o.gettext("Edit"):o.gettext("Add")},t.prototype.save=function(){var t,e;this.dashboard.classes=((t={})[this.styling.themeClass]=!0,t),this.dashboard.widgetClasses=((e={})[this.styling.headerClass]=!0,e),this.dashboard.c8y_IsNavigatorNode=this.dashboard.c8y_IsNavigatorNode?{}:this.current?null:void 0,this._save(this.dashboard)},t.prototype.close=function(){this._cancel(),this.modal.hide()},t.prototype.getDashboardPreviewStyle=function(){var t={};return t[this.styling.headerClass]=!0,t[this.styling.themeClass]=!0,t},t.prototype.selectIcon=function(t){this.dashboard.icon=t,this.dashboardDetailForm.form.markAsDirty()},t.prototype.updateFiltered=function(t){if(t){var e=new RegExp(t,"i");this.filteredIcons=this.icons.filter((function(t){return e.test(t)}))}else this.filteredIcons=this.icons},t.prototype.setDashboardStyle=function(){var t=this,e=g({},this.dashboard.classes,this.dashboard.widgetClasses);Object.keys(e).map((function(t){return t.split("-").pop()})).forEach((function(e){t.styling.themeClass=t.contextDashboardService.getStyling(T,e,t.styling.themeClass),t.styling.headerClass=t.contextDashboardService.getStyling(w,e,t.styling.headerClass)}))},t.ctorParameters=function(){return[{type:i.BsModalRef},{type:Array,decorators:[{type:e.Inject,args:[o.ICON_LIST]}]},{type:_},{type:o.NavigatorService}]},v([e.ViewChild("dashboardDetailForm",{static:!0})],t.prototype,"dashboardDetailForm",void 0),t=v([e.Component({selector:"c8y-dashboard-detail",template:'<div class="viewport-modal">\n  <div class="modal-header separator-bottom">\n    <h3>{{ titleAction | translate }}&nbsp;{{ titleName | translate }}</h3>\n  </div>\n\n  <div class="modal-inner-scroll">\n    <div class="p-l-24 p-r-24">\n      <form #dashboardDetailForm="ngForm" class="d-contents">\n        <div class="row">\n          <div class="col-sm-6">\n            <div *ngIf="!isNamedDashboard || isReport">\n              <h6 class="legend form-block">\n                <span>{{ \'General\' | translate }}</span>\n              </h6>\n              <div class="d-flex">\n                <c8y-form-group>\n                  <label class="d-block">{{ \'Icon\' | translate }}</label>\n                  <div dropdown class="dropdown">\n                    <button\n                      title="{{ \'Icon\' | translate }}"\n                      class="btn-default btn btn-gray"\n                      dropdownToggle\n                    >\n                      <i c8yIcon="{{ dashboard.icon }}"></i>\n                      <span class="caret"></span>\n                    </button>\n                    <ul\n                      *dropdownMenu\n                      class="dropdown-menu modal-inner-scroll dropdown-menu-grid-4 m-l-0"\n                      style="max-height: 250px;"\n                    >\n                      <ng-container *ngFor="let icon of filteredIcons">\n                        <li (click)="selectIcon(icon)">\n                          <a\n                            class="interact"\n                            title="{{ icon }}"\n                            [ngClass]="{ active: dashboard.icon === icon }"\n                          >\n                            <i class="icon" [c8yIcon]="icon"></i>\n                          </a>\n                        </li>\n                      </ng-container>\n                    </ul>\n                  </div>\n                </c8y-form-group>\n                <c8y-form-group class="flex-grow">\n                  <label>\n                    <span class="m-r-4">{{ \'Menu label\' | translate }}</span>\n                    <button\n                      class="btn btn-clean"\n                      popover="{{\n                        \'Menu label to display in submenu when dashboard is attached\' | translate\n                      }}"\n                      triggers="focus"\n                      placement="right"\n                      container="body"\n                    >\n                      <i [c8yIcon]="\'question-circle-o\'" class="text-primary"></i>\n                    </button>\n                  </label>\n                  <input\n                    title="{{ \'Menu label\' | translate }}"\n                    class="form-control"\n                    name="name"\n                    [(ngModel)]="dashboard.name"\n                    placeholder="{{ namePlaceholder | translate }}"\n                    maxlength="512"\n                    required\n                  />\n                </c8y-form-group>\n              </div>\n              <c8y-form-group *ngIf="isReport">\n                <label translate>Description</label>\n                <textarea\n                  class="form-control"\n                  rows="2"\n                  name="description"\n                  [(ngModel)]="dashboard.description"\n                ></textarea>\n              </c8y-form-group>\n              <div class="row">\n                <div class="col-sm-6" *ngIf="!isReport">\n                  <c8y-form-group>\n                    <label>\n                      <span class="m-r-4">{{ \'Position in navigation\' | translate }}</span>\n                      <button\n                        class="btn btn-clean"\n                        popover="{{\n                          \'Position in navigation menu (10000 first, -10000 last)\' | translate\n                        }}"\n                        triggers="focus"\n                        placement="right"\n                        container="body"\n                      >\n                        <i [c8yIcon]="\'question-circle-o\'" class="text-primary"></i>\n                      </button>\n                    </label>\n                    <input\n                      title="{{ \'Position in navigation\' | translate }}"\n                      type="number"\n                      class="form-control"\n                      name="priority"\n                      [(ngModel)]="dashboard.priority"\n                      min="-10000"\n                      max="10000"\n                      placeholder="{{ \'e.g.\' | translate }} 500"\n                      required\n                    />\n                  </c8y-form-group>\n                </div>\n\n                <div class="col-sm-6" *ngIf="isReport">\n                  <label translate>Navigator menu item</label>\n                  <c8y-form-group>\n                    <label title="{{ \'Show in navigator\' | translate }}" class="c8y-checkbox">\n                      <input\n                        type="checkbox"\n                        name="isNavigatorNode"\n                        [(ngModel)]="!!dashboard.c8y_IsNavigatorNode"\n                      /><span></span>\n                      <span>{{ \'Show in navigator\' | translate }}</span>\n                    </label>\n                  </c8y-form-group>\n                </div>\n                <div class="col-sm-6" *ngIf="isReport">\n                  <c8y-form-group>\n                    <label>\n                      <span class="m-r-4">{{ \'Position in navigator\' | translate }}</span>\n                      <ng-template #positionInNavPop>\n                        <span>\n                          {{\n                            \'Position in navigator (10001 first, -10000 last).\' | translate\n                          }}&nbsp;\n                          {{ \'Existing nodes:\' | translate }}\n                        </span>\n                        <ul class="list-unstyled m-t-16">\n                          <li *ngFor="let node of navigatorNodes$ | async">\n                            <i [c8yIcon]="node.icon"></i>\n                            <span class="word-break m-l-4 m-r-16">\n                              {{\n                                node.label.length > 15\n                                  ? (node.label | slice: 0:15) + \'...\'\n                                  : node.label\n                              }}\n                            </span>\n                            <span class="pull-right"> {{ node.priority }} </span>\n                          </li>\n                        </ul>\n                      </ng-template>\n                      <button\n                        class="btn btn-clean"\n                        [popover]="positionInNavPop"\n                        triggers="focus"\n                        placement="right"\n                        container="body"\n                      >\n                        <i [c8yIcon]="\'question-circle-o\'" class="text-primary"></i>\n                      </button>\n                    </label>\n                    <input\n                      title="{{ \'Position in navigation\' | translate }}"\n                      type="number"\n                      class="form-control"\n                      name="priority"\n                      [(ngModel)]="dashboard.priority"\n                      min="-10000"\n                      max="20000"\n                      placeholder="{{ \'e.g.\' | translate }} 500"\n                    />\n                  </c8y-form-group>\n                </div>\n              </div>\n\n              <div *ngIf="!current && deviceType">\n                <div class="form-group">\n                  <label\n                    title="{{ \'Apply dashboard to all devices of type\' | translate }}"\n                    class="c8y-checkbox"\n                  >\n                    <input type="checkbox" name="deviceType" [(ngModel)]="dashboard.deviceType" />\n                    <span></span>\n                    <span class="m-r-4">\n                      {{ \'Apply dashboard to all devices of type\' | translate }}\n                      <i>{{ dashboard.deviceTypeValue }}</i>\n                    </span>\n                  </label>\n                </div>\n\n                <div class="alert alert-info  m-b-24" *ngIf="isDeviceType">\n                  <i c8y-icon="info"></i>\n                  {{ \'This dashboard is shared between all devices of the type \' | translate }}\n                  <i>{{ dashboard.deviceTypeValue }}</i>\n                </div>\n              </div>\n            </div>\n            <c8y-appearance-settings\n              [(themeClass)]="styling.themeClass"\n              [(headerClass)]="styling.headerClass"\n            >\n            </c8y-appearance-settings>\n            <div class="row">\n              <div class="col-sm-6">\n                <c8y-form-group class="p-b-24 m-b-0">\n                  <label>{{ \'Widget margin\' | translate }}</label>\n                  <div class="input-group">\n                    <input\n                      title="{{ \'Widget margin\' | translate }}"\n                      id="margin"\n                      name="margin"\n                      type="number"\n                      class="form-control"\n                      [(ngModel)]="dashboard.widgetMargin"\n                      min="0"\n                      max="50"\n                      placeholder="{{ DEFAULT_DASHBOARD_MARGIN }}"\n                    />\n                    <span class="input-group-addon">px</span>\n                  </div>\n                </c8y-form-group>\n              </div>\n              <div class="col-sm-6">\n                <c8y-form-group class="p-b-24 m-b-0">\n                  <label translate>Widget titles</label>\n                  <label title="{{ \'Translate if possible\' | translate }}" class="c8y-checkbox">\n                    <input\n                      type="checkbox"\n                      name="translateWidgetTitle"\n                      [(ngModel)]="dashboard.translateWidgetTitle"\n                    /><span></span>\n                    <span>{{ \'Translate if possible\' | translate }}</span>\n                  </label>\n                </c8y-form-group>\n              </div>\n            </div>\n          </div>\n\n          <div class="col-sm-6">\n            <c8y-widget-preview\n              [tab]="!isNamedDashboard ? dashboard : undefined"\n              [previewClasses]="getDashboardPreviewStyle()"\n            ></c8y-widget-preview>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n\n  <div class="modal-footer">\n    <button title="{{ \'Cancel\' | translate }}" class="btn btn-default" (click)="close()">\n      {{ \'Cancel\' | translate }}\n    </button>\n    <button\n      title="{{ \'Save\' | translate }}"\n      class="btn btn-primary"\n      (click)="save()"\n      [disabled]="dashboardDetailForm.form.invalid || dashboardDetailForm.form.pristine"\n    >\n      {{ \'Save\' | translate }}\n    </button>\n  </div>\n</div>\n'}),y(1,e.Inject(o.ICON_LIST))],t)}(),O=function(){function t(){this.themeClass="dashboard-theme-light",this.headerClass="panel-title-regular",this.themeClassChange=new e.EventEmitter,this.headerClassChange=new e.EventEmitter,this.possibleStylingTheme=T,this.possibleStylingHeader=w}return t.prototype.themeClassClick=function(t){t=this.resetToDefault(t,this.themeClass,this.defaultThemeClass),this.themeClass=t,this.themeClassChange.emit(t)},t.prototype.headerClassClick=function(t){t=this.resetToDefault(t,this.headerClass,this.defaultHeaderClass),this.headerClass=t,this.headerClassChange.emit(t)},t.prototype.resetToDefault=function(t,e,n){return n&&t===e&&(t=n),t},v([e.Input()],t.prototype,"themeClass",void 0),v([e.Input()],t.prototype,"headerClass",void 0),v([e.Input()],t.prototype,"defaultThemeClass",void 0),v([e.Input()],t.prototype,"defaultHeaderClass",void 0),v([e.Output()],t.prototype,"themeClassChange",void 0),v([e.Output()],t.prototype,"headerClassChange",void 0),v([e.Input()],t.prototype,"possibleStylingTheme",void 0),v([e.Input()],t.prototype,"possibleStylingHeader",void 0),t=v([e.Component({selector:"c8y-appearance-settings",template:'<h6 class="legend form-block"><span translate>Layout</span></h6>\n<div class="row ">\n  <div class="col-sm-6 m-b-32">\n    <label translate>Theme</label>\n    <ul class="list-group" style="box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);">\n      <li\n        class="list-group-item flex-row"\n        style="align-items: center; box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.05);"\n        *ngFor="let themeClassItem of possibleStylingTheme; let i = index"\n      >\n        <div class="list-item-checkbox">\n          <label class="c8y-radio">\n            <input\n              type="radio"\n              [id]="\'groupradiocontentclass\' + i"\n              name="content"\n              [value]="themeClassItem.class"\n              [ngModel]="themeClass"\n              (click)="themeClassClick(themeClassItem.class)"\n            />\n            <span></span>\n          </label>\n        </div>\n        <label [for]="\'groupradiocontentclass\' + i">\n          <span>{{ themeClassItem.label | translate }}</span>\n          <br />\n          <small *ngIf="themeClassItem.class === defaultThemeClass" class="text-muted" translate\n            >Dashboard default</small\n          >\n        </label>\n        <button\n          class="btn btn-clean flex-item-top"\n          popover="{{ themeClassItem.description | translate }}"\n          container="body"\n          placement="top"\n          triggers="focus"\n        >\n          <i [c8yIcon]="\'question-circle-o\'" class="text-primary"></i>\n        </button>\n      </li>\n    </ul>\n  </div>\n  <div class="col-sm-6">\n    <label translate>Widget header style</label>\n    <ul class="list-group" style="box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);">\n      <li\n        class="list-group-item flex-row a-i-center"\n        style="box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.05);"\n        *ngFor="let headerClassItem of possibleStylingHeader; let i = index"\n      >\n        <div class="list-item-checkbox">\n          <label class="c8y-radio">\n            <input\n              type="radio"\n              [id]="\'groupradioheaderclass\' + i"\n              name="header"\n              [value]="headerClassItem.class"\n              [ngModel]="headerClass"\n              (click)="headerClassClick(headerClassItem.class)"\n            />\n            <span></span>\n          </label>\n        </div>\n        <label [for]="\'groupradioheaderclass\' + i">\n          <span>{{ headerClassItem.label | translate }}</span>\n          <br />\n          <small *ngIf="headerClassItem.class === defaultHeaderClass" class="text-muted" translate\n            >Dashboard default</small\n          >\n        </label>\n        <button\n          class="btn btn-clean flex-item-top"\n          popover="{{ headerClassItem.description | translate }}"\n          container="body"\n          placement="top"\n          triggers="focus"\n        >\n          <i [c8yIcon]="\'question-circle-o\'" class="text-primary"></i>\n        </button>\n      </li>\n    </ul>\n  </div>\n</div>\n',viewProviders:[{provide:d.ControlContainer,useExisting:d.NgForm}]})],t)}(),M=function(){function t(t,e,n,i,a,s,o,r,c,l){this.route=t,this.router=e,this.contextDashboardService=n,this.alert=i,this.renderer=a,this.moduleConfig=s,this.widgetService=o,this.bsModal=r,this.inventory=c,this.gainsightService=l,this.childrenClasses="",this.setTitle=!1,this.disabled=!1,this.defaultWidgets=[],this.canDelete=!0,this.isLoading=!0,this.class="",this.widgets=[]}return t.prototype.ngOnInit=function(){this.name?this.loadNamedDashboard():this.loadContextDashboard()},t.prototype.applyDeviceTarget=function(t){t.config.device&&(t.config.device={id:this.context.id,name:this.context.name})},t.prototype.ngOnDestroy=function(){this.dataSub&&this.dataSub.unsubscribe()},t.prototype.restore=function(){return m(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return this.isLoading=!0,this.mo.c8y_Dashboard.children=this.contextDashboardService.mapWidgets(this.defaultWidgets),[4,this.contextDashboardService.update(this.mo)];case 1:return t.sent(),this.onLoad(),[2]}}))}))},t.prototype.updateDashboardChildren=function(t){return m(this,void 0,void 0,(function(){var e,i,a,s=this;return f(this,(function(o){return e=t.children,i=this.mo,a=n.keyBy(e.map((function(t){return s.componentToWidget(t)})),"id"),i.c8y_Dashboard.children=a,[2,this.contextDashboardService.update(i)]}))}))},t.prototype.deleteDashboard=function(){return m(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return[4,this.contextDashboardService.delete(this.mo)];case 1:return e.sent(),this.route.parent&&(t=this.route.parent.snapshot.url.map((function(t){return t.path})).join("/"),this.router.navigateByUrl(t)),[2]}}))}))},t.prototype.editDashboard=function(){return m(this,void 0,void 0,(function(){var t,e,i,a,s,o,r,c,l,d,h,p,u;return f(this,(function(g){switch(g.label){case 0:(t=this.contextDashboardService.isReport(this.mo))&&(e=this.context,i=e.name,l=e.icon,h=e.priority,d=e.c8y_IsNavigatorNode,p=e.description,Object.assign(this.dashboard,{name:i,icon:l,priority:h,c8y_IsNavigatorNode:d,description:p})),a={dashboard:this.dashboard,deviceType:this.context.type,isDeviceType:this.contextDashboardService.isDeviceType(this.mo),isNamedDashboard:this.contextDashboardService.isNamed(this.mo),isReport:t},s=this.bsModal.show(A,{class:"modal-lg",initialState:a,ignoreBackdropClick:!0}).content,g.label=1;case 1:return g.trys.push([1,5,,6]),o=n.cloneDeep(this.mo),[4,s.result];case 2:return r=g.sent(),t?(c=r.name,l=r.icon,d=r.c8y_IsNavigatorNode,h=r.priority,p=r.description,u=b(r,["name","icon","c8y_IsNavigatorNode","priority","description"]),o.c8y_Dashboard=u,this.updateReport({id:this.context.id,name:c,icon:l,c8y_IsNavigatorNode:d,priority:h,description:p})):o.c8y_Dashboard=r,[4,this.contextDashboardService.update(o)];case 3:return g.sent(),[4,this.contextDashboardService.refreshTabs(o)];case 4:return g.sent(),this.onLoad(),s.close(),[3,6];case 5:return g.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.editWidget=function(t){return m(this,void 0,void 0,(function(){var e,n,i,a,s,o;return f(this,(function(r){switch(r.label){case 0:return e=t.source,n=e.x,i=e.y,a=e.width,s=e.height,[4,this.widgetService.getWidgetDefinition(t.widget.name||t.widget.componentId)];case 1:return(o=r.sent())?[4,this.addWidget(g({},o,{data:g({},o.data,t.widget,{_x:n,_y:i,_width:a,_height:s})}))]:(this.addWidget(),[2]);case 2:return r.sent(),[2]}}))}))},t.prototype.addWidget=function(t){return m(this,void 0,void 0,(function(){var e,i,a;return f(this,(function(s){switch(s.label){case 0:e={mo:this.mo,context:this.context.c8y_Report?{}:this.context,selected:n.cloneDeep(t)},i=this.bsModal.show(N,{class:"modal-lg",initialState:e,ignoreBackdropClick:!0}).content,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,i.result];case 2:return a=s.sent(),this.mo.c8y_Dashboard.children||(this.mo.c8y_Dashboard.children={}),this.mo.c8y_Dashboard.children[a.id]=a,this.contextDashboardService.update(this.mo),a.classes=this.mergeWidgetClasses(a),[4,this.updateWidget(a)];case 3:return s.sent(),i.close(),[3,5];case 4:return s.sent(),[3,5];case 5:return[2]}}))}))},t.prototype.updateWidget=function(t){return m(this,void 0,void 0,(function(){var e,i,a;return f(this,(function(s){switch(s.label){case 0:return e=n.findIndex(this.widgets,{id:t.id}),i=-1===e,[4,this.mapLegacy(t)];case 1:return a=s.sent(),i?this.widgets.push(a):this.widgets.splice(e,1,a),[2]}}))}))},t.prototype.deleteWidget=function(t){var e=this,n=t.widget,i=t.source;delete this.mo.c8y_Dashboard.children[n.id];var a=this.widgets.find((function(t){return t.id===n.id}));this.widgets.splice(this.widgets.indexOf(a),1),setTimeout((function(){var t=new o.DashboardChildChange(i);t.collapseUpAll(),e.updateDashboardChildren(t)}))},t.prototype.addDashboardClassToBody=function(){var t=this;this.class.split(" ").forEach((function(e){t.renderer.addClass(document.body,e)}))},t.prototype.removeDashboardClassFromBody=function(){var t=this;this.class.split(" ").forEach((function(e){t.renderer.removeClass(document.body,e)}))},t.prototype.toggleFreeze=function(t){return m(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:this.toggleIsFrozenFlag(t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.contextDashboardService.update(this.mo)];case 2:return n.sent(),this.dashboard.isFrozen?this.alert.success(o.gettext("Your dashboard is locked now.")):this.alert.success(o.gettext("Your dashboard is unlocked now.")),[3,4];case 3:return e=n.sent(),this.alert.addServerFailure(e),this.toggleIsFrozenFlag(t),[3,4];case 4:return[2]}}))}))},t.prototype.updateReport=function(t){return m(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:return[4,this.inventory.update(t)];case 1:return e=n.sent(),this.context=e.data,this.route.parent&&(this.route.parent.snapshot.data.contextData=this.context),this.contextDashboardService.updateNavigatorItem(e.data),[2]}}))}))},t.prototype.toggleIsFrozenFlag=function(t){t.isFrozen=!t.isFrozen,this.dashboard.isFrozen=t.isFrozen},t.prototype.loadContextDashboard=function(){var t=this;this.dataSub=this.route.data.subscribe((function(e){var n=e.dashboard;t.context=t.route.parent.snapshot.data.contextData,t.mo=n,t.dashboard=t.mo.c8y_Dashboard,t.onLoad(!0)}))},t.prototype.loadNamedDashboard=function(){var t=this;this.dataSub=this.contextDashboardService.getNamedDashboardOrCreate(this.name,this.defaultWidgets).subscribe((function(e){t.context=t.context||{},t.mo=e,t.dashboard=t.mo.c8y_Dashboard,t.onLoad(!0)}))},t.prototype.onLoad=function(t){return m(this,void 0,void 0,(function(){var e,i,a,s,o,r,c=this;return f(this,(function(l){switch(l.label){case 0:return[4,this.contextDashboardService.canEditDashboard(this.mo)];case 1:return e=l.sent(),this.disabled=!e,i=n.cloneDeep(this.mo.c8y_Dashboard.children),a=this.contextDashboardService.isDeviceType(this.mo),s=this.contextDashboardService.isReport(this.mo),o=g({"c8y-grid-dashboard":!0,dashboard:!0},this.dashboard.classes),r=this,[4,Promise.all(n.values(i).map((function(e){return e.classes=c.mergeWidgetClasses(e),a&&c.applyDeviceTarget(e),t&&c.gainsightService.triggerEvent("loadWidget",{widgetName:e.componentId||e.name}),c.mapLegacy(e)})))];case 2:return r.widgets=l.sent(),this.class=Object.keys(o).join(" "),s&&this.addReportDashboardSettings(),this.isLoading=!1,[2]}}))}))},t.prototype.mergeWidgetClasses=function(t){var e,i=w.find((function(e){return t.classes&&t.classes[e.class]}))?g({},t.classes):g({},this.dashboard.widgetClasses,t.classes);return g(((e={card:!0,"card-dashboard":!0})[n.kebabCase(t.componentId||t.name)]=!0,e),i)},t.prototype.componentToWidget=function(t){return g({},n.omit(t.data,["componentTransformConfigWithContext","transformConfigWithContext"]),{_x:t.x,_y:t.y,_width:t.width,_height:t.height})},t.prototype.mapLegacy=function(t){return m(this,void 0,void 0,(function(){var e;return f(this,(function(i){switch(i.label){case 0:return[4,this.widgetService.getWidgetDefinition(t.componentId||t.name)];case 1:return e=i.sent(),n.get(e,"data.settings.upgrade")?(t.widgetComponent=e.data.settings.widgetComponent,t.configComponent=e.data.settings.configComponent,t.templateUrl=e.data.settings.templateUrl,t.configTemplateUrl=e.data.settings.configTemplateUrl,t.transformConfigWithContext=e.data.settings.componentTransformConfigWithContext||e.data.settings.transformConfigWithContext):(delete t.templateUrl,delete t.configTemplateUrl),[2,t]}}))}))},t.prototype.addReportDashboardSettings=function(){this.setTitle=!0,this.title=this.context.name,this.breadcrumbSettings={icon:"th",label:"Reports",path:"reports"},this.canDelete=!1},t.ctorParameters=function(){return[{type:c.ActivatedRoute},{type:c.Router},{type:_},{type:o.AlertService},{type:e.Renderer2},{type:void 0,decorators:[{type:e.Inject,args:[C]}]},{type:I},{type:i.BsModalService},{type:l.InventoryService},{type:o.GainsightService}]},v([e.Input()],t.prototype,"name",void 0),v([e.Input()],t.prototype,"childrenClasses",void 0),v([e.Input()],t.prototype,"context",void 0),v([e.Input()],t.prototype,"setTitle",void 0),v([e.Input()],t.prototype,"disabled",void 0),v([e.Input()],t.prototype,"defaultWidgets",void 0),v([e.Input()],t.prototype,"canDelete",void 0),v([e.Input()],t.prototype,"isLoading",void 0),v([e.Input()],t.prototype,"breadcrumbSettings",void 0),v([e.HostBinding("class")],t.prototype,"class",void 0),t=v([e.Component({selector:"c8y-context-dashboard",template:'<c8y-action-bar-item [placement]="\'more\'" *ngIf="defaultWidgets.length > 0">\n  <button (click)="restore()" [disabled]="dashboard?.isFrozen || disabled">\n    <i c8yIcon="undo"></i>&nbsp;<span translate>Restore dashboard</span>\n  </button>\n</c8y-action-bar-item>\n\n<c8y-widgets-dashboard\n  [context]="context"\n  [contextDashboard]="dashboard"\n  [widgets]="widgets"\n  [settings]="{\n    isLoading: isLoading,\n    isFrozen: dashboard?.isFrozen,\n    isDisabled: disabled,\n    canDelete: canDelete,\n    translateWidgetTitle: dashboard?.translateWidgetTitle,\n    allowFullscreen: moduleConfig.allowFullscreen,\n    title: setTitle ? dashboard.name || title : undefined,\n    widgetMargin: dashboard?.widgetMargin\n  }"\n  [breadcrumb]="breadcrumbSettings"\n  (onFreeze)="toggleFreeze($event)"\n  (onChangeDashboard)="updateDashboardChildren($event)"\n  (onAddWidget)="addWidget()"\n  (onEditWidget)="editWidget($event)"\n  (onDeleteWidget)="deleteWidget($event)"\n  (onChangeStart)="addDashboardClassToBody()"\n  (onChangeEnd)="removeDashboardClassFromBody()"\n  (onEditDashboard)="editDashboard()"\n  (onDeleteDashboard)="deleteDashboard()"\n>\n</c8y-widgets-dashboard>\n',host:{style:"\n      display: block;\n    ",class:"dashboard c8y-grid-dashboard"}}),y(5,e.Inject(C))],t)}(),L=function(){function t(t,e,n,i){this.router=t,this.contextDashboardService=e,this.bsModal=n,this.permissions=i}return t.prototype.get=function(t){return m(this,void 0,void 0,(function(){var e,n,i=this;return f(this,(function(a){switch(a.label){case 0:return e=!t.parent||t.snapshot.data.context?t.snapshot.data:t.parent.snapshot.data,[4,this.isEnabled(e)];case 1:return n=a.sent(),[2,[{label:o.gettext("Add dashboard"),priority:2500,action:function(){return i.addDashboard(e)},disabled:!n}]]}}))}))},t.prototype.addDashboard=function(t){return m(this,void 0,void 0,(function(){var e,n,i,a;return f(this,(function(s){switch(s.label){case 0:t.context===o.ViewContext.Device&&(e={deviceType:t.contextData.type}),n=this.bsModal.show(A,{class:"modal-lg",initialState:e,ignoreBackdropClick:!0}).content,s.label=1;case 1:return s.trys.push([1,5,,6]),[4,n.result];case 2:return i=s.sent(),[4,this.contextDashboardService.create(i,t)];case 3:return a=s.sent(),[4,this.contextDashboardService.navigateToDashboard(a)];case 4:return s.sent(),n.close(),[3,6];case 5:return s.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.isEnabled=function(t){return m(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return t.contextData&&t.contextData.id?[4,this.permissions.canEdit(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"],t.contextData)]:[3,2];case 1:return[2,e.sent()&&[o.ViewContext.Device,o.ViewContext.Group].includes(t.context)];case 2:return[2,this.permissions.hasAnyRole(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"])&&[o.ViewContext.Device,o.ViewContext.Group].includes(t.context)]}}))}))},t.ctorParameters=function(){return[{type:c.Router},{type:_},{type:i.BsModalService},{type:o.Permissions}]},t=v([e.Injectable()],t)}(),F={allowFullscreen:!0,widgetFilter:function(t){var e=t.data;return!(e&&e.settings&&e.settings.noNewWidgets)},routes:[{path:"dashboard/:dashboardId",component:M,canActivate:[k],context:o.ViewContext.Device},{path:"dashboard/:dashboardId",component:M,canActivate:[E],context:o.ViewContext.Group}]},P=function(){function t(){}var n;return n=t,t.config=function(t){return void 0===t&&(t={}),{ngModule:n,providers:[{provide:C,useValue:g({},F,t)},_,k,E,{provide:o.HOOK_ONCE_ROUTE,useValue:g({},F,t).routes,multi:!0},{provide:o.HOOK_ACTION,useClass:L,multi:!0}]}},t=n=v([e.NgModule({declarations:[O,M,N,R,A],imports:[o.CoreModule,p.TooltipModule,u.PopoverModule,h.BsDropdownModule.forRoot()],exports:[M,N],entryComponents:[M,N,A]})],t)}(),W=function(){function t(t,e){this.inventoryService=t,this.navigatorService=e,this.queriesUtil=new l.QueriesUtil}return t.prototype.listReports=function(t){void 0===t&&(t={});var e={__has:"c8y_Report"};t.filter&&(e=this.queriesUtil.addAndFilter(e,t.filter));var n={query:this.queriesUtil.buildQuery(e),pageSize:t.pageSize||50,withTotalPages:!0};return this.inventoryService.list(n)},t.prototype.createReport=function(t){var e={};return Object.assign(e,t),Object.assign(e,{c8y_Report:{}}),this.inventoryService.create(e)},t.prototype.addReportNavigatorNode=function(t){var e=new o.NavigatorNode({label:t.name,path:"reports/"+t.id,icon:t.icon,priority:t.priority});this.navigatorService.add(e)},t.prototype.removeNavigatorNode=function(t){var e=this;this.navigatorService.state.forEach((function(n){n.path!=="reports/"+t.id||e.navigatorService.remove(n)}))},t.ctorParameters=function(){return[{type:l.InventoryService},{type:o.NavigatorService}]},t=v([e.Injectable()],t)}(),G=function(){function n(t,e,n,i,r,c,l){var d=this;this.inventoryService=t,this.contextDashboardService=e,this.bsModal=n,this.translateService=i,this.modal=r,this.alertService=c,this.reportDashboardService=l,this.textFilter$=new a.BehaviorSubject(""),this.reload$=new a.BehaviorSubject(null),this.reloading=!1,this.reports$=a.combineLatest(this.textFilter$.pipe(s.debounceTime(400),s.distinctUntilChanged()),this.reload$).pipe(s.tap((function(){d.reloading=!0})),s.switchMap((function(t){var e=x(t,1)[0];return d.loadReports(e)})),s.tap((function(){d.reloading=!1})),s.shareReplay(1)),this.DELETED_SUCCESS_MSG=o.gettext("Report deleted.")}return n.prototype.loadReports=function(t){return m(this,void 0,void 0,(function(){return f(this,(function(e){return[2,t?this.reportDashboardService.listReports({filter:{name:"*"+t+"*"}}):this.reportDashboardService.listReports()]}))}))},n.prototype.add=function(){return m(this,void 0,void 0,(function(){var t,e,n,i,a,s,o,r,c,l,d;return f(this,(function(h){switch(h.label){case 0:t={isReport:!0,isNamedDashboard:!0},e=this.bsModal.show(A,{class:"modal-lg",ignoreBackdropClick:!0,initialState:t}).content,h.label=1;case 1:return h.trys.push([1,5,,6]),[4,e.result];case 2:return n=h.sent(),i=n.name,a=n.icon,s=n.c8y_IsNavigatorNode,o=n.priority,r=n.description,c=b(n,["name","icon","c8y_IsNavigatorNode","priority","description"]),[4,this.reportDashboardService.createReport({name:i,icon:a,c8y_IsNavigatorNode:s,priority:o,description:r})];case 3:return l=h.sent().data,[4,this.contextDashboardService.create(c,""+this.contextDashboardService.REPORT_PARTIAL_NAME+l.id)];case 4:return h.sent(),l.c8y_IsNavigatorNode&&this.reportDashboardService.addReportNavigatorNode(l),this.reload$.next(),e.close(),[3,6];case 5:if(d=h.sent())throw new Error("Something went wrong: "+d);return[3,6];case 6:return[2]}}))}))},n.prototype.delete=function(e){return m(this,void 0,void 0,(function(){var n,i,a=this;return f(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),n=o.gettext('You are about to delete the report "{{ reportName }}". Do you want to proceed?'),[4,this.modal.confirm(o.gettext("Delete report"),this.translateService.instant(n,{reportName:e.name}),o.Status.DANGER,{ok:o.gettext("Delete"),cancel:o.gettext("Cancel")})];case 1:return r.sent(),this.contextDashboardService.getDashboard$("report_"+e.id,[t.ContextDashboardType.Named]).pipe(s.take(1)).subscribe((function(t){return a.contextDashboardService.delete(t,!1)})),[4,this.inventoryService.delete(e.id)];case 2:return r.sent(),this.alertService.success(this.DELETED_SUCCESS_MSG),e.c8y_IsNavigatorNode&&this.reportDashboardService.removeNavigatorNode(e),this.reload$.next(),[3,4];case 3:if(i=r.sent())throw new Error("Something went wrong: "+i);return[3,4];case 4:return[2]}}))}))},n.prototype.update=function(t){return m(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return t.c8y_IsNavigatorNode=t.c8y_IsNavigatorNode?{}:null,[4,this.inventoryService.update(t)];case 1:return e.sent(),t.c8y_IsNavigatorNode?this.reportDashboardService.addReportNavigatorNode(t):this.reportDashboardService.removeNavigatorNode(t),[2]}}))}))},n.ctorParameters=function(){return[{type:l.InventoryService},{type:_},{type:i.BsModalService},{type:r.TranslateService},{type:o.ModalService},{type:o.AlertService},{type:W}]},v([e.ViewChild(o.FilterInputComponent,{static:!1})],n.prototype,"filter",void 0),n=v([e.Component({selector:"c8y-report-dashboard-list",template:'<c8y-title>\n  <span translate>\n    Reports\n  </span>&nbsp;\n</c8y-title>\n\n<c8y-action-bar-item [placement]="\'left\'" itemClass="navbar-form">\n  <div class="input-group input-group-search">\n    <input class="form-control"\n      type="search"\n      title="{{ \'Filter…\' | translate }}"\n      placeholder="{{ \'Filter…\' | translate }}"\n      [ngModel]="textFilter$ | async"\n      (ngModelChange)="textFilter$.next($event)"\n    />\n    <span class="input-group-addon">\n      <i c8yIcon="search"\n        *ngIf="(textFilter$ | async).length === 0"\n      ></i>\n      <i class="text-muted"\n        c8yIcon="times"\n        *ngIf="(textFilter$ | async).length > 0"\n        (click)="textFilter$.next(\'\')"\n      ></i>\n    </span>\n  </div>\n</c8y-action-bar-item>\n\n<c8y-action-bar-item [placement]="\'right\'">\n  <button class="btn btn-link"\n    title="{{ \'Add report\' | translate }}"\n    (click)="add()"\n    >\n    <i c8yIcon="plus-circle"></i>\n    {{ \'Add report\' | translate }}\n  </button>\n</c8y-action-bar-item>\n\n<c8y-action-bar-item [placement]="\'right\'">\n  <button class="btn btn-link"\n    title="{{ \'Reload\' | translate }}"\n    (click)="loadReports()"\n  >\n    <i [ngClass]="{ \'icon-spin\': reloading }"\n      c8yIcon="refresh"\n    ></i>\n    {{ \'Reload\' | translate }}\n  </button>\n</c8y-action-bar-item>\n\n<div class="p-b-32">\n  <c8y-list-group>\n    <c8y-li class="page-sticky-header hidden-xs hidden-sm"\n      *ngIf="(reports$ | async)?.data.length > 0"\n    >\n      <c8y-li-icon>\n        <i class="fa"></i>\n      </c8y-li-icon>\n      <c8y-li-body class="content-flex-80">\n        <div class="col-3">\n          {{ \'Report\' | translate }}\n        </div>\n        <div class="col-6">\n          {{ \'Description\' | translate }}\n        </div>\n        <div class="col-2">\n          {{ \'Show in navigator\' | translate }}\n        </div>\n      </c8y-li-body>\n    </c8y-li>\n\n    <c8y-li *c8yFor="let report of reports$; let i = index; loadMore: \'auto\'">\n      <c8y-li-icon [icon]="report.icon"></c8y-li-icon>\n      <c8y-li-body class="content-flex-70">\n        <div class="col-3">\n          <button class="btn-clean"\n            title="{{ report.name }}"\n            routerLink="/reports/{{ report.id }}"\n          >\n            <span class="text-truncate">\n              {{ report.name }}\n            </span>\n          </button>\n        </div>\n        <div class="col-6">\n          <small class="text-truncate-wrap">\n            <em class="text-muted"\n              *ngIf="!report.description; else showDescription"\n            >\n              {{ \'No description available\' | translate }}\n            </em>\n            <ng-template #showDescription>\n              {{ report.description }}\n            </ng-template>\n          </small>\n        </div>\n        <div class="col-2">\n          <span class="m-t-8 visible-xs"></span>\n          <label class="c8y-switch c8y-switch--inline"\n            title="{{ \'Show in navigator\' | translate }}"\n          >\n            <input\n              [(ngModel)]="!!report.c8y_IsNavigatorNode"\n              type="checkbox"\n              (change)="update(report)"\n            />\n            <span></span>\n            <span class="visible-xs">\n              {{ \'Show in navigator\' | translate }}\n            </span>\n          </label>\n        </div>\n        <div class="col-1 text-right hidden-xs">\n          <button class="btn-dot showOnHover pull-right"\n            (click)="delete(report)"\n            title="{{ \'Remove report\' | translate }}"\n          >\n            <i class="text-danger"\n            c8yIcon="minus-circle"\n            ></i>\n          </button>\n        </div>\n        <div class="visible-xs p-t-8 text-right">\n          <button class="btn-danger btn btn-xs"\n            (click)="delete(report)"\n            title="{{ \'Remove report\' | translate }}"\n          >\n            <i c8yIcon="trash"></i>\n            Delete\n          </button>\n        </div>\n      </c8y-li-body>\n    </c8y-li>\n  </c8y-list-group>\n</div>\n\n<div class="c8y-empty-state text-center m-t-40"\n  *ngIf="(reports$ | async)?.data.length === 0"\n  >\n  <h1 c8yIcon="c8y-reports" class="c8y-icon-duocolor"></h1>\n  <h3 translate>\n    There are no reports defined\n  </h3>\n  <p translate>\n    Add a report first.\n  </p>\n  <div>\n    <button class="btn btn-primary"\n      (click)="add()"\n      translate\n    >\n      Add report\n    </button>\n  </div>\n  <p c8y-guide-docs>\n    <small translate ngNonBindable\n      >Find out more in the\n      <a c8y-guide-href="users-guide/cockpit/#reports">\n        User guide`KEEP_ORIGINAL`\n      </a>.\n      </small>\n  </p>\n</div>\n'})],n)}(),j=function(){function t(){this.DEFAULT_HOME_WIDGETS=[{name:"cockpit.welcome.widget",title:o.gettext(""),_x:0,_y:0,_height:5,_width:12,classes:{"panel-title-hidden":!0}},{name:"Asset Alarms",title:o.gettext("Active, critical alarms"),_x:0,_y:5,_height:4,_width:6},{name:"Recent Alarms",title:o.gettext("Recent alarms"),_x:0,_y:9,_height:4,_width:6},{name:"Map",title:o.gettext("Map"),_x:6,_y:5,_height:8,_width:6}]}return t=v([e.Component({selector:"c8y-cockpit-dashboard",template:'<c8y-title>\n  {{\'Home\' | translate}}\n</c8y-title>\n\n<c8y-context-dashboard\n  name="home-cockpit1"\n  [defaultWidgets]="DEFAULT_HOME_WIDGETS"\n  [canDelete]="false"\n></c8y-context-dashboard>\n'})],t)}(),B=function(){function t(t,e,n,i,a){this.tenantService=t,this.docs=e,this.router=n,this.navigator=i,this.applicationService=a,this.quickLinks=[],this.CONFIGURATION_NODE="Configuration",this.TRIAL="TRIAL"}return t.prototype.ngOnInit=function(){return m(this,void 0,void 0,(function(){var t,e=this;return f(this,(function(n){switch(n.label){case 0:return t=this,[4,this.tenantService.currentTenantType()];case 1:return t.tenantType=n.sent(),this.setMessage(),this.navSubscription=this.navigator.items$.subscribe((function(t){e.navNodes=t,e.configurationNode=t.find((function(t){return t.label===e.CONFIGURATION_NODE}))})),this.docsSubscription=this.docs.items$.subscribe((function(t){e.links=t})),this.createConnectSmartphoneQuickLink(),[4,this.createQuicklinkRegisterDevice()];case 2:return n.sent(),this.tenantType===this.TRIAL?(this.createQuicklinkUserGuide(),[2]):(this.createQuicklinkAddGroup(),this.createQuickLinkReports(),this.createQuickLinkExports(),this.createQuicklinkSmartRules(),[2])}}))}))},t.prototype.ngOnDestroy=function(){this.docsSubscription&&!this.docsSubscription.closed&&this.docsSubscription.unsubscribe(),this.navSubscription&&!this.navSubscription.closed&&this.navSubscription.unsubscribe()},t.prototype.setMessage=function(){this.tenantType===this.TRIAL?this.welcomeMessage=o.gettext("\n        The Cockpit application allows you to build IoT applications in minutes.\n        To get started, connect any device to the platform.\n        If you do not have an IoT device to hand, you can start by connecting your smartphone.\n        Click below to be guided through the process.\n      "):this.welcomeMessage=o.gettext("\n        The Cockpit application provides you with options to manage\n        and monitor Internet of Things assets and data from business perspective.\n      ")},t.prototype.createQuicklinkAddGroup=function(){var t=this.links.find((function(t){return"Add group"===t.label}));t&&this.quickLinks.push(t)},t.prototype.createConnectSmartphoneQuickLink=function(){var t=this.links.find((function(t){return"Connect smartphone"===t.label}));t&&this.quickLinks.push(t)},t.prototype.createQuickLinkReports=function(){var t=this,e=o.gettext("Reports"),n={icon:"th",label:e,url:"/reports"},i=this.findNavigatorNode(e,this.navNodes);i&&(n.click=function(){i.open=!0,t.router.navigateByUrl(n.url)},this.quickLinks.push(n))},t.prototype.createQuickLinkExports=function(){var t=this,e=o.gettext("Exports"),n={icon:"c8y-reports",label:e,url:"/export"};this.isConfigChildNodeShown(e)&&(n.click=function(){t.configurationNode.open=!0,t.router.navigateByUrl(n.url)},this.quickLinks.push(n))},t.prototype.createQuicklinkSmartRules=function(){var t=this,e={icon:"c8y-smart-rules",label:o.gettext("Smart rules"),url:"/rules"};this.isConfigChildNodeShown("Global smart rules")&&(e.click=function(){t.configurationNode.open=!0,t.router.navigateByUrl(e.url)},this.quickLinks.push(e))},t.prototype.createQuicklinkRegisterDevice=function(){return m(this,void 0,void 0,(function(){var t,e,n,i;return f(this,(function(a){switch(a.label){case 0:return[4,this.applicationService.listByUser()];case 1:return(t=a.sent().data)&&(e=t.find((function(t){return"devicemanagement"===t.contextPath})))&&(n=this.applicationService.getHref(e),i={icon:"c8y-device-connect",label:o.gettext("Register device"),click:function(){return window.open(n+"/#/deviceregistration","_self")}},this.quickLinks.push(i)),[2]}}))}))},t.prototype.createQuicklinkUserGuide=function(){var t=this,e={icon:"c8y-user",label:o.gettext("User guide"),url:"/users-guide/getting-started",click:function(){var n=t.docs.getUserGuideLink(e.url);window.open(n)}};this.quickLinks.push(e)},t.prototype.isConfigChildNodeShown=function(t){if(this.configurationNode&&this.configurationNode.show){var e=this.findNavigatorNode(t,this.configurationNode.children);return!!e&&e.show}return!1},t.prototype.findNavigatorNode=function(t,e){if(e&&e.length>0)return e.find((function(e){return e.label===t}))},t.ctorParameters=function(){return[{type:l.TenantService},{type:o.DocsService},{type:c.Router},{type:o.NavigatorService},{type:l.ApplicationService}]},v([e.Input()],t.prototype,"config",void 0),t=v([e.Component({selector:"c8y-welcome-to-cockpit",template:'<div class="welcome-widget welcome-cockpit">\n  <div class="flex-row">\n    <div class="col-xs-12 col-md-5 flex-item-v-stretch p-24">\n      <h2 class="text-light">{{ \'Welcome to Cockpit\' | translate }}</h2>\n      <p class="text-16 text-light p-t-16 p-b-24">{{ welcomeMessage | translate }}</p>\n      <div class="card-group interact-grid tight-grid">\n        <div *ngFor="let link of quickLinks" class="col-sm-4 col-xs-6">\n          <c8y-quick-link\n            (click)="link.click ? link.click() : false"\n            [icon]="link.icon"\n            [label]="link.label"\n            class="card"\n            c8yProductExperience\n            [actionName]="\'welcomeWidgetClicked\'"\n            [actionData]="{ link: link.label }"\n          >\n          </c8y-quick-link>\n        </div>\n      </div>\n    </div>\n    \x3c!-- <div class="col-sm-6 welcome-illustration flex-item-v-stretch"></div> --\x3e\n  </div>\n</div>\n'})],t)}(),H=function(){function t(t){this.dashboard=t}return t.prototype.restore=function(){this.dashboard.restore()},t.ctorParameters=function(){return[{type:M,decorators:[{type:e.Host}]}]},t=v([e.Component({selector:"c8y-legacy-welcome-widget",template:'<div class="card-block">\n  <p class="lead" c8y-guide-docs>\n    <span>{{ \'Welcome to Cockpit\' | translate }}.</span>\n    <span title="{{ \'Browse the manual\' | translate }}" class="cockpit-welcome-manual" translate ngNonBindable\n      >Browse the manual <a c8y-guide-href="users-guide/cockpit/">here</a>.</span\n    >\n  </p>\n  <p class="m-t-16">\n    <em>{{ \'New default dashboard available.\' | translate }} </em>\n  </p>\n  <button class="btn btn-primary btn-sm m-t-16" (click)="restore(); (false)" translate>\n    Get new dashboard\n  </button>\n</div>\n'}),y(0,e.Host())],t)}(),U="";try{U=require("@c8y/style/img/welcome-widget-pr.png")}catch(t){}var $=[{label:o.gettext("Home"),icon:"home",priority:1e4,path:"/"}],q=[{id:"cockpit.welcome.widget",label:o.gettext("Welcome to Cockpit"),description:o.gettext("Displays a welcome message for Cockpit"),component:B,previewImage:U,data:{settings:{noNewWidgets:!1,widgetDefaults:{_width:12,_height:6},ng1:{options:{noDeviceTarget:!0,groupsSelectable:!1}}}}}],V=[{id:"Cockpit Welcome",label:o.gettext("Welcome to Cockpit"),description:o.gettext("Displays a welcome message for Cockpit"),component:H,data:{settings:{noNewWidgets:!0,ng1:{options:{noDeviceTarget:!0,groupsSelectable:!1}}}}}],z=function(){function t(){}return t=v([e.NgModule({entryComponents:[j,B,H],imports:[o.DocsModule,o.CoreModule,P.config({routes:[{path:"dashboard/:dashboardId",component:M,canActivate:[k],context:o.ViewContext.Device},{path:"dashboard/:dashboardId",component:M,canActivate:[E],context:o.ViewContext.Group},{path:"",component:j}]}),o.QuickLinkModule],declarations:[j,B,H],providers:[{provide:o.HOOK_NAVIGATOR_NODES,useValue:$,multi:!0},{provide:o.HOOK_COMPONENTS,multi:!0,useValue:q},{provide:o.HOOK_COMPONENTS,multi:!0,useValue:V}]})],t)}(),Q=function(){function n(t){this.contextDashboardService=t}return n.prototype.canActivate=function(e){var n=this,i=e.data.contextData&&e.data.contextData.id;return a.from(this.contextDashboardService.activateDashboards(e,[t.ContextDashboardType.Named])).pipe(s.tap((function(t){return Array.isArray(t)&&0===t.length?n.createDashboardIfNotExist(i):a.of(!0)})))},n.prototype.createDashboardIfNotExist=function(t){return this.contextDashboardService.create({},"report_"+t).then((function(){return!0}))},n.ctorParameters=function(){return[{type:_}]},n=v([e.Injectable()],n)}(),X=function(){function t(t,e,n){this.navigatorService=t,this.inventoryService=e,this.reportDashboardService=n,this.loaded=!1}return t.prototype.get=function(){return m(this,void 0,void 0,(function(){var t=this;return f(this,(function(e){switch(e.label){case 0:return this.loaded?[3,2]:(this.loaded=!0,this.navigatorService.add(new o.NavigatorNode({label:o.gettext("Reports"),path:"reports",icon:"c8y-reports",priority:5})),[4,this.reportDashboardService.listReports({filter:{__has:"c8y_IsNavigatorNode"},pageSize:2e3})]);case 1:e.sent().data.forEach((function(e){var n=new o.NavigatorNode({label:e.name,path:"reports/"+e.id,icon:e.icon,priority:e.priority});t.navigatorService.add(n)})),e.label=2;case 2:return[2]}}))}))},t.ctorParameters=function(){return[{type:o.NavigatorService},{type:l.InventoryService},{type:W}]},t=v([e.Injectable()],t)}(),Y=[{path:"dashboard/:dashboardId",component:M,canActivate:[Q],context:o.ViewContext.Report}],K=function(){function t(){}return t=v([e.NgModule({declarations:[G],entryComponents:[],imports:[o.CoreModule,P,c.RouterModule.forChild([{path:"reports",component:G}])],providers:[Q,X,W,{provide:o.HOOK_ONCE_ROUTE,useValue:Y,multi:!0},{provide:o.HOOK_NAVIGATOR_NODES,useClass:X,multi:!0}]})],t)}();t.AppearanceSettingsComponent=O,t.CONTEXT_DASHBOARD_CONFIG=C,t.CockpitDashboardComponent=j,t.CockpitDashboardModule=z,t.ContextDashboardComponent=M,t.ContextDashboardModule=P,t.ContextDashboardService=_,t.DASHBOARD_THEME_CLASSES=T,t.DashboardActionsFactory=L,t.DashboardDetailComponent=A,t.DeviceDashboardGuard=k,t.GroupDashboardGuard=E,t.LegacyWelcomeComponent=H,t.ReportDashboardGuard=Q,t.ReportDashboardListComponent=G,t.ReportDashboardModule=K,t.ReportDashboardNavigationFactory=X,t.ReportDashboardService=W,t.WIDGET_CONTENT_CLASSES=S,t.WIDGET_HEADER_CLASSES=w,t.WelcomeToCockpit=B,t.WidgetConfigComponent=N,t.WidgetPreviewComponent=R,t.WidgetService=I,t.ɵ0=$,t.ɵ1=q,t.ɵ2=V,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-context-dashboard.umd.min.js.map