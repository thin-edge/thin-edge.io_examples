!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("lodash-es"),require("@c8y/client"),require("rxjs"),require("@angular/router"),require("@c8y/ngx-components"),require("@angular/upgrade/static"),require("@angular/cdk/tree"),require("ngx-bootstrap/buttons"),require("lodash"),require("@ngx-translate/core"),require("ngx-bootstrap/collapse"),require("ngx-bootstrap/dropdown"),require("ngx-bootstrap/tooltip"),require("ngx-bootstrap/popover"),require("rxjs/operators"),require("@angular/platform-browser/animations"),require("angular"),require("@c8y/ng1-modules/core/bootstrap")):"function"==typeof define&&define.amd?define("@c8y/ngx-components/protocol-opcua",["exports","@angular/core","@angular/forms","lodash-es","@c8y/client","rxjs","@angular/router","@c8y/ngx-components","@angular/upgrade/static","@angular/cdk/tree","ngx-bootstrap/buttons","lodash","@ngx-translate/core","ngx-bootstrap/collapse","ngx-bootstrap/dropdown","ngx-bootstrap/tooltip","ngx-bootstrap/popover","rxjs/operators","@angular/platform-browser/animations","angular","@c8y/ng1-modules/core/bootstrap"],t):t(((e=e||self).c8y=e.c8y||{},e.c8y["ngx-components"]=e.c8y["ngx-components"]||{},e.c8y["ngx-components"]["protocol-opcua"]={}),e.ng.core,e.ng.forms,e.lodashEs,e.client,e.rxjs,e.ng.router,e.c8y["ngx-components"],e.ng.upgrade.static,e.ng.cdk.tree,e.buttons,e.lodash,e.core$1,e.collapse,e.dropdown,e.tooltip,e.popover,e.rxjs.operators,e.ng.platformBrowser.animations,e.angular,e.bootstrap)}(this,(function(e,t,n,i,s,o,r,a,c,l,d,p,u,h,v,g,m,f,y,b,S){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var I=function(e,t){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function w(e,t){function n(){this.constructor=e}I(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function N(e,t,n,i){var s,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,n,r):s(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r}function C(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))}function x(e,t){var n,i,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=2&o[0]?i.return:o[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;switch(i=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(s=r.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],i=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function P(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,o=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return r}var k=function(){function e(){this.hasCustomAction=!1,this.placeholders="${value}, ${serverId}, ${nodeId}, ${deviceId}"}return e.prototype.getHeaderPair=function(){return{key:"",value:""}},Object.defineProperty(e.prototype,"headers",{get:function(){return this.customAction.headers},enumerable:!0,configurable:!0}),e.prototype.addHeader=function(){this.customAction.headers.push(this.getHeaderPair())},e.prototype.updateCustomAction=function(){this.hasCustomAction=!this.hasCustomAction},e.prototype.removeCustomAction=function(e){this.customAction.headers.splice(e,1)},e.prototype.trackByIndex=function(e){return e},e.prototype.ngOnInit=function(){i.get(this.customAction,"endpoint")&&(this.hasCustomAction=!0)},N([t.Input()],e.prototype,"customAction",void 0),e=N([t.Component({selector:"opcua-device-protocol-mapping-customaction",template:'<div class="list-group">\n  <div class="list-group-item">\n    <div class="flex-row">\n      <div class="list-item-switch">\n        <label class="c8y-switch">\n          <input\n            type="checkbox"\n            name="hasCustomAction"\n            [(ngModel)]="hasCustomAction"\n            (click)="updateCustomAction()"\n          />\n          <span></span>\n        </label>\n      </div>\n      <div class="list-item-icon">\n        <i c8yIcon="wrench"></i>\n      </div>\n      <div class="list-item-title" translate>\n        Custom action\n      </div>\n    </div>\n    <div [collapse]="!hasCustomAction" [isAnimated]="true">\n      <div class="p-t-8" *ngIf="hasCustomAction">\n        <fieldset ngModelGroup="headers">\n          <div class="legend form-block" translate>Headers</div>\n          <div class="tight-grid flex-row hidden-xs">\n            <div class="col-sm-4">\n              <label translate>Key</label>\n            </div>\n            <div class="col-sm-4">\n              <label translate>Value</label>\n            </div>\n          </div>\n          <div\n            *ngFor="let header of headers; trackBy: trackByIndex; let i = index; last as isLast"\n            class="flex-row tight-grid row"\n            [ngModelGroup]="i"\n          >\n            <div class="col-xs-5 col-sm-4">\n              <c8y-form-group class="form-group-sm">\n                <label class="visible-xs" translate>Key</label>\n                <div class="input-group">\n                  <input\n                    class="form-control"\n                    type="text"\n                    name="key"\n                    placeholder="{{ \'e.g.\' | translate }} Content-Type"\n                    required\n                    [(ngModel)]="header.key"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class="col-xs-5 col-sm-4">\n              <c8y-form-group class="form-group-sm">\n                <label class="visible-xs" translate>Value</label>\n                <div class="input-group">\n                  <input\n                    class="form-control"\n                    type="text"\n                    name="value"\n                    placeholder="{{ \'e.g.\' | translate }} application/json"\n                    required\n                    [(ngModel)]="header.value"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class="col-xs-2">\n              <div class="form-group">\n                <label class="visible-xs">&nbsp;</label>\n                <button class="btn btn-clean" *ngIf="customAction.headers.length !== 1">\n                  <i c8yIcon="minus-circle" class="text-danger" (click)="removeCustomAction(i)"></i>\n                </button>\n                <button class="btn btn-clean" *ngIf="isLast">\n                  <i c8yIcon="plus-circle" class="text-primary" (click)="addHeader()"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </fieldset>\n        <div class="legend form-block" translate>Action</div>\n        <div class="row">\n          <div class="col-md-4">\n            <c8y-form-group class="form-group-sm">\n              <label>\n                <span translate>Endpoint</span>\n              </label>\n              <div class="input-group">\n                <input\n                  class="form-control"\n                  type="text"\n                  name="endpoint"\n                  placeholder="{{ \'e.g.\' | translate }} http://localhost:1080/cucumber"\n                  required\n                  [(ngModel)]="customAction.endpoint"\n                />\n              </div>\n            </c8y-form-group>\n          </div>\n          <div class="col-md-4">\n            <c8y-form-group class="form-group-sm">\n              <label translate>Body template</label>\n              <textarea\n                #model=\'ngModel\'\n                [heightPerRow]="40"\n                class="form-control"\n                rows="3"\n                name="bodyTemplate"\n                placeholder="({{\'required\' | translate}})"\n                [(ngModel)]="customAction.bodyTemplate"\n                required\n              ></textarea>\n              <div class="help-block" *ngIf="model.untouched || !model.errors">\n                {{ \'The following placeholders are available:\' | translate }} {{ placeholders }}\n              </div>\n            </c8y-form-group>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n',viewProviders:[{provide:n.ControlContainer,useExisting:n.NgModelGroup}]})],e)}(),M=function(){function e(e){this.client=e,this.microserviceUrl="/service/opcua-mgmt-service/address-space",this.header={"Content-Type":"application/json"},this.nodeNavigationData$=new o.BehaviorSubject({node:void 0,selectedAncestorIds:[]})}return e.prototype.resetTreeToRootNode=function(){this.triggerNodeToOpen({node:void 0,selectedAncestorIds:[]})},e.prototype.triggerNodeToOpen=function(e){this.nodeNavigationData$.next(e)},e.prototype.getNodeNavData$=function(){return this.nodeNavigationData$.asObservable()},e.prototype.getNode=function(e,t){if(e&&e.length>0)return t&&t.length>0?this.getNodeById(e,t):this.getRootNode(e)},e.prototype.getRootNode=function(e){if(e&&e.length>0){var t={method:"GET",headers:this.header};return this.client.fetch(this.microserviceUrl+"/"+e,t)}},e.prototype.getNodeById=function(e,t){if(e&&t&&e.length>0&&t.length>0){var n={method:"GET",headers:this.header},i=encodeURIComponent(t);return this.client.fetch(this.microserviceUrl+"/"+e+"?nodeId="+i,n)}},e.prototype.getChildrenOf=function(e,t){if(t&&e.nodeId&&t.length>0&&e.nodeId.length>0){var n={method:"GET",headers:this.header},i=encodeURIComponent(e.nodeId);return this.client.fetch(this.microserviceUrl+"/"+t+"/children?nodeId="+i,n)}},e.prototype.childrenAvailable=function(e){return!(!e||0===e.length)&&e.some((function(e){return!e.inverse&&e.hierarchical}))},e.prototype.getSearchedNodes=function(e,t){return C(this,void 0,void 0,(function(){var n,i;return x(this,(function(s){switch(s.label){case 0:return n="service/opcua-mgmt-service/search/"+t+"/",i={headers:this.header,params:{searchString:"*"+e+"*"}},[4,this.client.fetch(n,i)];case 1:return[2,s.sent().json()]}}))}))},e.prototype.getIcon=function(e){return{Object:"cube",Variable:"th-list",Method:"random",View:"window-maximize",ObjectType:"c8y-group",VariableType:"c8y-group",ReferenceType:"c8y-group",DataType:"c8y-group"}[e]||"circle"},e.ctorParameters=function(){return[{type:s.FetchClient}]},e=N([t.Injectable()],e)}(),O=function(){function e(e){this.addressSpaceService=e,this.selected=!1,this.showDetails=!1,this.toggleAttrDetail=new t.EventEmitter}return Object.defineProperty(e.prototype,"node",{set:function(e){this._node=e,e?this.setNodeData(e):this.showDetails=!1},enumerable:!0,configurable:!0}),e.prototype.setNodeData=function(e){this.showDetails=!0;var t=e.attributes,n=e.references;this.nodeDataRef=n;this.nodeDataAttr=Object.assign({},t,i.omit(e,["attributes","references","children","currentlyLoadingChildren","expanded","browsePath","relativePath","parentNode"]))},e.prototype.toggleDetail=function(e){this.showDetails=!this.showDetails,this.toggleAttrDetail.emit(e)},e.prototype.navigateTo=function(e){var t={node:this._node,selectedAncestorIds:e};this.toggleDetail(this._node),this.addressSpaceService.triggerNodeToOpen(t)},e.ctorParameters=function(){return[{type:M}]},N([t.Input()],e.prototype,"node",null),N([t.Output()],e.prototype,"toggleAttrDetail",void 0),e=N([t.Component({selector:"opcua-address-space-detail",template:'<div\n  class="card flex-scroll m-b-4 split-row-2 animated fast"\n  style="pointer-events: all"\n  [ngClass]="{ fadeInRightBig: showDetails, fadeOutRightBig: !showDetails }"\n>\n  <div class="card-header separator ">\n    <h4>{{ \'Attributes\' | translate }}</h4>\n    <button\n      class="close flex-item-right visible-sm visible-xs"\n      title="{{ \'Close\' | translate }}"\n      (click)="toggleDetail(nodeDataAttr)"\n    >\n      &times;\n    </button>\n  </div>\n  <div class="card-inner-scroll">\n    <div class="card-block">\n      <table class="table table-striped table-condensed">\n        <colgroup>\n          <col width="50%" />\n          <col width="50%" />\n        </colgroup>\n        <thead>\n          <tr>\n            <th>{{ \'Attribute\' | translate }}</th>\n            <th>{{ \'Value\' | translate }}</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr *ngFor="let item of nodeDataAttr | keyvalue">\n            <td>{{ item.key }}</td>\n            <td *ngIf="item.key === \'absolutePaths\'" class="text-break-word">\n              {{ item.value | json }}\n            </td>\n            <td *ngIf="item.key === \'ancestorNodeIds\'" class="text-break-word">\n              <a *ngFor="let value of item.value" (click)="navigateTo(value)">\n                {{ value | json }}</a\n              >\n            </td>\n            <td *ngIf="item.key !== \'absolutePaths\' && item.key !== \'ancestorNodeIds\'">\n              {{ item.value }}\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n<div\n  class="card flex-scroll split-row-2 animated fast"\n  style="pointer-events: all"\n  [ngClass]="{ fadeInRightBig: showDetails, fadeOutRightBig: !showDetails }"\n>\n  <div class="card-header separator">\n    <h4>{{ \'References\' | translate }}</h4>\n  </div>\n  <div class="card-inner-scroll">\n    <div class="card-block">\n      <table class="table table-striped table-condensed">\n        <colgroup>\n          <col width="50%" />\n          <col width="50%" />\n        </colgroup>\n        <thead>\n          <tr>\n            <th>{{ \'Attribute\' | translate }}</th>\n            <th>{{ \'Value\' | translate }}</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr *ngFor="let item of nodeDataRef">\n            <td>{{ item.referenceLabel }}</td>\n            <td class="text-break-word">{{ item.targetLabel }}</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n'})],e)}(),A=function(){function e(e,t,n,i){this.client=e,this.inventoryService=t,this.router=n,this.alertService=i,this.microserviceUrl="/service/opcua-mgmt-service/server",this.deviceTypeProtocolUrl="/service/opcua-mgmt-service/deviceTypes",this.header={"Content-Type":"application/json"},this.binaryService=t.binary}return e.prototype.getServers=function(e){if(e&&e.length>0){var t={method:"GET",headers:this.header};return this.client.fetch(this.microserviceUrl+"/"+e,t)}},e.prototype.createServer=function(e){if(this.doesGatewayIdExist(e)){this.cleanUpPayload(e);var t={method:"POST",headers:this.header,body:JSON.stringify(e)};return this.client.fetch(""+this.microserviceUrl,t)}},e.prototype.updateServer=function(e){return C(this,void 0,void 0,(function(){var t,n,i;return x(this,(function(s){switch(s.label){case 0:return this.doesGatewayIdExist(e)&&this.doesIdExist(e)?(this.cleanUpPayload(e),t={method:"POST",headers:this.header,body:JSON.stringify(e)},[4,this.client.fetch(""+this.microserviceUrl,t)]):[3,6];case 1:n=s.sent(),i=void 0,s.label=2;case 2:return s.trys.push([2,4,,5]),[4,n.json()];case 3:return i=s.sent(),[3,5];case 4:return s.sent(),[3,5];case 5:if(200===n.status)return[2,i];this.alertService.addServerFailure({data:i,res:n}),s.label=6;case 6:return[2]}}))}))},e.prototype.removeServer=function(e){if(this.doesGatewayIdExist(e)&&this.doesIdExist(e)){return this.client.fetch(this.microserviceUrl+"/"+e.gatewayId+"/"+e.id,{method:"DELETE"})}},e.prototype.getKeystore=function(e){return e&&e.length>0?this.inventoryService.detail(e):null},e.prototype.uploadKeystore=function(e){return e&&e.size>0?this.binaryService.create(e):Promise.reject("Invalid file")},e.prototype.updateKeystore=function(e,t){return C(this,void 0,void 0,(function(){var n;return x(this,(function(i){switch(i.label){case 0:return e&&e.length>0&&t&&t.size>0?[4,this.removeKeystore(e)]:[3,2];case 1:if((n=i.sent().res)&&204===n.status)return[2,this.uploadKeystore(t)];i.label=2;case 2:return[2,Promise.reject("Invalid file")]}}))}))},e.prototype.removeKeystore=function(e){if(e&&e.length>0)return this.binaryService.delete(e)},e.prototype.getMoId=function(){var e=this.router.routerState.snapshot.url;return new RegExp(/device\/\d+/).test(e)?e.match(/\d+/)[0]:""},e.prototype.getId=function(){var e=this.router.routerState.snapshot.url;if(new RegExp(/deviceprotocols/).test(e)&&RegExp(/\d+$/).test(e))return e.match(/\d+$/)[0]},e.prototype.getDeviceProtocol=function(e){return C(this,void 0,void 0,(function(){var t;return x(this,(function(n){return t={method:"GET",headers:this.header},[2,this.client.fetch(this.deviceTypeProtocolUrl+"/"+e,t)]}))}))},e.prototype.updateDeviceProtocol=function(e){return C(this,void 0,void 0,(function(){var t;return x(this,(function(n){return t={method:"PUT",headers:this.header,body:JSON.stringify(e)},[2,this.client.fetch(this.deviceTypeProtocolUrl+"/"+e.id,t)]}))}))},e.prototype.createDeviceProtocol=function(e){return C(this,void 0,void 0,(function(){var t;return x(this,(function(n){return t={method:"POST",headers:this.header,body:JSON.stringify(e)},[2,this.client.fetch(""+this.deviceTypeProtocolUrl,t)]}))}))},e.prototype.doesGatewayIdExist=function(e){return e&&e.gatewayId&&e.gatewayId.length>0},e.prototype.doesIdExist=function(e){return e&&e.id&&e.id.length>0&&"new"!==e.id},e.prototype.cleanUpPayload=function(e){e&&(e.id&&"new"===e.id&&delete e.id,e.quickInfo&&delete e.quickInfo)},e.ctorParameters=function(){return[{type:s.FetchClient},{type:s.InventoryService},{type:r.Router},{type:a.AlertService}]},e=N([t.Injectable()],e)}(),R=function(){function e(){this.type="c8y_OPCUA_Device_Agent"}return e.prototype.canActivate=function(e){var t=e.data.contextData;return t&&t.type===this.type},e=N([t.Injectable()],e)}(),D=function(){function e(e){this.el=e}var s;return s=e,e.prototype.validate=function(e){if(e.value){if(!this.isValidJson(e.value))return{invalidBrowsePathNotation:!0};if(this.isBrowsePathUnique(e.value))return{browsePathNotUnique:!0}}return null},e.prototype.isValidJson=function(e){try{var t=JSON.parse(e);return!i.isEmpty(t)}catch(e){return!1}},e.prototype.toArray=function(e){return JSON.parse(e)},e.prototype.isBrowsePathUnique=function(e){var t=this,n=this.getMappings();return!!i.some(n,(function(n){if(i.isEqual(n.browsePath,t.toArray(e))&&n.id!==t.model.id)return n}))},e.ctorParameters=function(){return[{type:t.ElementRef}]},N([t.Input()],e.prototype,"getMappings",void 0),N([t.Input()],e.prototype,"model",void 0),e=s=N([t.Directive({selector:"[c8yBrowsePathValidator][ngModel]",providers:[{provide:n.NG_VALIDATORS,useExisting:t.forwardRef((function(){return s})),multi:!0}]})],e)}(),E=function(e){function n(t,n){return e.call(this,"c8yObjectMapping",t,n)||this}return w(n,e),n.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Injector}]},N([t.Input()],n.prototype,"mapping",void 0),N([t.Input()],n.prototype,"customActions",void 0),N([t.Input()],n.prototype,"autoObserveParams",void 0),N([t.Input()],n.prototype,"hideAutoObserve",void 0),n=N([t.Directive({selector:"c8y-object-mapping"})],n)}(c.UpgradeComponent),T=function(){function e(e,n){var i=this;this.alertService=e,this.addressSpaceService=n,this.onAction=new t.EventEmitter,this.isPathFocused=!1,this.isBrowsePathUniq=!0,this.dataReporting="default",this.isTreeOpen=!1,this.isNew=!1,this.resetModel=!1,this.moId="",this.getMappings=function(){return i.getParentAttr("mappings")}}return e.prototype.toggleDetail=function(){this.isDetailOpen=!this.isDetailOpen,this.resetModel&&this.initialFormSetup()},e.prototype.ngOnInit=function(){this.dataReportingName="ReportingMode"+this.index,this.initialFormSetup()},e.prototype.ngOnChanges=function(e){e._model.previousValue&&!i.isEqual(this._model,e._model.previousValue.SimpleChange)&&this.mapping&&this.mapping.name===this._model.name&&(this.mapping.id=this._model.id)},e.prototype.initialFormSetup=function(){var e={headers:[{key:"Authorization",value:""},{key:"Content-Type",value:""}],bodyTemplate:"",type:"HttpPost",endpoint:""};this.mapping=i.assign({},{id:"",browsePath:[],name:"",subscriptionType:{type:"None"}},i.cloneDeep(this._model)),i.isEmpty(this.mapping.browsePath)?(this.isNew=!0,this.isDetailOpen=!0):(this.browsePath=this.stringfyBrowsePath(this.mapping.browsePath),this.nodeDisplayName=this.mapping.name),this.referencedRootNodeId?(this.referencedNode={nodeId:this.referencedRootNodeId},this.addressSpaceService.triggerNodeToOpen({node:{nodeId:this.referencedRootNodeId,children:[],expanded:!1,absolutePaths:[[]]},selectedAncestorIds:[]})):this.referencedNode={nodeId:""},i.get(this.mapping,"customAction")?(this.customAction=i.assign(e,i.get(this.mapping,"customAction")),this.customAction.headers=this.mapHeadersObjectToList(i.get(this.customAction,"headers"))):this.customAction=i.assign({},e),i.unset(this.mapping,"customAction"),i.get(this._model,"subscriptionType")?this.dataReporting="custom":this.dataReporting="default",this.resetModel=!1},e.prototype.showAddressSpaceTree=function(){return!i.isEmpty(this.referencedServerId)},e.prototype.ngAfterViewInit=function(){i.get(this.mapping,"subscriptionType")&&"None"!==i.get(this.mapping,"subscriptionType.type")&&(this.dataReporting="custom")},e.prototype.mapHeadersObjectToList=function(e){if(Object.keys(e).length>0)return Object.keys(e).map((function(t){return{key:t,value:e[t]}}))},e.prototype.stringfyBrowsePath=function(e){return JSON.stringify(e)},e.prototype.updateBrowsePath=function(e){this.mapping.browsePath=e.relativePath,this.nodeDisplayName=e.displayName,this.mapping.name=this.nodeDisplayName,this.browsePath=this.stringfyBrowsePath(this.mapping.browsePath),this.browsePathModel.control.markAsDirty()},e.prototype.updateDisplayname=function(){this.mapping.name=this.nodeDisplayName},e.prototype.updateBrowsePathInput=function(){if(this.browsePath)try{this.mapping.browsePath=JSON.parse(this.browsePath)}catch(e){return}},e.prototype.save=function(){if("default"===this.dataReporting&&i.unset(this.mapping,"subscriptionType"),i.get(this.mapping,"measurementCreation")){var e=this.mapping.measurementCreation;i.set(e,"fragmentName",i.get(e,"type"))}var t;if(this.subFormRef.value.customAction.hasCustomAction){var n=this.customAction.headers.reduce((function(e,t){return e[t.key]=t.value,e}),{});t=i.assign({},this.customAction,{headers:n})}this.onAction.emit({action:"save",data:i.assign({},this.mapping,{customAction:t})}),this.isDetailOpen=!1},e.prototype.cancel=function(){this.isDetailOpen=!1,this.resetModel=!0,"new"===this.mapping.id&&this.onAction.emit({action:"delete",data:i.assign({},this.mapping)})},e.prototype.onDelete=function(){this.onAction.emit({action:"delete",data:this.mapping})},e.prototype.canSave=function(e){var t=this;return e.valid&&t.objectMappingForm.$componentScope.mappingForm.$valid&&(e.dirty||t.objectMappingForm.$componentScope.mappingForm.$dirty)},e.prototype.isActive=function(){return this.isDetailOpen},e.prototype.setTreeFromRefNode=function(){this.referencedRootNodeId&&this.addressSpaceService.triggerNodeToOpen({node:{nodeId:this.referencedRootNodeId,children:[],expanded:!1,absolutePaths:[[]]},selectedAncestorIds:[]})},e.ctorParameters=function(){return[{type:a.AlertService},{type:M}]},N([t.ViewChild(E,{static:!1})],e.prototype,"objectMappingForm",void 0),N([t.ViewChild("variableForm",{static:!1})],e.prototype,"subFormRef",void 0),N([t.ViewChild("browsePathModel",{static:!1})],e.prototype,"browsePathModel",void 0),N([t.Input("resource")],e.prototype,"_model",void 0),N([t.Input()],e.prototype,"index",void 0),N([t.Input()],e.prototype,"getParentAttr",void 0),N([t.Input()],e.prototype,"referencedServerId",void 0),N([t.Input()],e.prototype,"referencedRootNodeId",void 0),N([t.Output()],e.prototype,"onAction",void 0),e=N([t.Component({selector:"opcua-device-protocol-mapping",template:'<div class="list-group-item collapsible" [ngClass]="{ expanded: isDetailOpen }">\n  <div class="flex-row" (click)="toggleDetail()">\n    <div class="list-item-actions">\n      <button class="btn btn-clean showOnHover flex-item-right" title="{{ \'Delete\' | translate }}">\n        <i c8yIcon="minus-circle" class="text-danger" (click)="onDelete()"></i>\n      </button>\n      <button\n        type="button"\n        title="{{ \'Expand\' | translate }}"\n        class="collapse-btn"\n        [ngClass]="{ active: isDetailOpen }"\n      >\n        <i c8yIcon="chevron-down"></i>\n      </button>\n    </div>\n\n    <div class="list-item-icon">\n      <i c8yIcon="sliders"></i>\n    </div>\n\n    <div class="list-item-body">\n      <div class="row flex-row">\n        <div class="col-sm-7 col-xs-12">\n          <p>\n            {{ nodeDisplayName }}<br />\n            <small\n              *ngIf="mapping.browsePath.length > 0"\n              class="text-muted text-truncate"\n              title="{{ mapping.browsePath | json }}"\n              >{{ mapping.browsePath | json }}</small\n            >\n          </p>\n          <p></p>\n        </div>\n        <div class="col-sm-4 col-xs-10">\n          <div class="list-functionalities">\n            <label class="small m-r-8 hidden-xs" translate>Functionalities</label>&nbsp;\n            <c8y-object-mapping-status-icons [mapping]="mapping"></c8y-object-mapping-status-icons>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="detail" [collapse]="!isDetailOpen" [isAnimated]="true">\n    <div class="form" [ngModelGroup]="index" #variableForm="ngModelGroup" *ngIf="isDetailOpen">\n      <div class="row p-t-8">\n        <c8y-form-group class="col-md-4" [status]="!isBrowsePathUniq ? \'error\' : \'\'">\n          <label translate>Path</label>\n          <div\n            class="dropdown"\n            dropdown\n            #dropdown="bs-dropdown"\n            [insideClick]="true"\n            style="width:100%;"\n          >\n            <input\n              class="form-control"\n              c8yBrowsePathValidator\n              [getMappings]="getMappings"\n              [model]="mapping"\n              type="text"\n              name="browsePath"\n              dropdownToggle\n              placeholder="{{ \'e.g.\' | translate }} {{ [\'2:Node1\', \'2:SubNode1\'] | json }}"\n              [(ngModel)]="browsePath"\n              (change)="updateBrowsePathInput()"\n              (focus)="setTreeFromRefNode()"\n              required\n              #browsePathModel="ngModel"\n              autocomplete="off"\n            />\n            <div\n              *dropdownMenu\n              class="dropdown-menu panel-inner-scroll"\n              style="max-height:200px; width: 100%;"\n            >\n              <opcua-address-space-tree\n                *ngIf="showAddressSpaceTree()"\n                [node]="referencedNode"\n                [moId]="referencedServerId"\n                (selectedNode)="updateBrowsePath($event); dropdown.hide()"\n              ></opcua-address-space-tree>\n            </div>\n          </div>\n          <c8y-messages>\n            <c8y-message\n              name="invalidBrowsePathNotation"\n              text="{{ \'Must be a valid array of strings.\' | translate }}"\n            ></c8y-message>\n            <c8y-message\n              name="browsePathNotUnique"\n              text="{{ \'Variable with this path is already added.\' | translate }}"\n            ></c8y-message>\n          </c8y-messages>\n        </c8y-form-group>\n\n        <c8y-form-group class="col-md-4">\n          <label translate>Name</label>\n          <div class="input-group">\n            <input\n              class="form-control"\n              type="test"\n              name="displayName"\n              placeholder="{{ \'e.g. childDevice2\' | translate }} "\n              required\n              [(ngModel)]="nodeDisplayName"\n              (change)="updateDisplayname()"\n              autocomplete="off"\n            />\n          </div>\n        </c8y-form-group>\n      </div>\n      <div class="row" ngModelGroup="dataReportingSection">\n        <c8y-form-group class="col-sm-4 col-md-3 col-lg-2">\n          <label>\n            <span translate>Data reporting</span>\n          </label>\n          <div class="input-group">\n            <label title="{{ \'Default\' | translate }}" class="c8y-radio radio-inline">\n              <input\n                type="radio"\n                [(ngModel)]="dataReporting"\n                name="{{ dataReportingName }}"\n                value="default"\n              />\n              <span></span>\n              <span>{{ \'Default\' | translate }}</span>\n            </label>\n            <label title="{{ \'Custom\' | translate }}" class="c8y-radio radio-inline">\n              <input\n                type="radio"\n                [(ngModel)]="dataReporting"\n                name="{{ dataReportingName }}"\n                value="custom"\n              />\n              <span></span>\n              <span>{{ \'Custom\' | translate }}</span>\n            </label>\n          </div>\n        </c8y-form-group>\n        <div\n          class="col-sm-8 col-md-9 col-lg-10"\n          *ngIf="dataReporting === \'custom\'"\n          ngModelGroup="overriddenSubscription"\n        >\n          <opcua-device-protocol-data-reporting\n            [model]="mapping"\n          ></opcua-device-protocol-data-reporting>\n        </div>\n      </div>\n\n      <c8y-object-mapping [mapping]="mapping" [hideAutoObserve]="true"></c8y-object-mapping>\n      <div ngModelGroup="customAction">\n        <opcua-device-protocol-mapping-customaction\n          [customAction]="customAction"\n        ></opcua-device-protocol-mapping-customaction>\n      </div>\n      <button\n        title="{{ \'Cancel\' | translate }}"\n        id="cancelBtn"\n        class="btn btn-default m-t-16 m-b-16"\n        (click)="cancel()"\n      >\n        {{ \'Cancel\' | translate }}\n      </button>\n      <button\n        title="{{ \'Save\' | translate }}"\n        id="saveBtn"\n        class="btn btn-primary m-t-16 m-b-16"\n        (click)="save()"\n        [disabled]="!canSave(variableForm)"\n      >\n        {{ \'Save\' | translate }}\n      </button>\n    </div>\n  </div>\n</div>\n',viewProviders:[{provide:n.ControlContainer,useExisting:n.NgModelGroup}]})],e)}(),j=function(){function e(e,t,n,i){var s=this;this.changeDetectorRef=e,this.opcuaService=t,this.alertService=n,this.router=i,this.initialModel={id:"",fieldbusType:"opcuaV2",description:"",unit:"",fieldbusVersion:4,name:"",referencedServerId:"",referencedRootNodeId:"",subscriptionType:{type:"None"},mappings:[],overriddenSubscriptions:[],applyConstraints:{browsePathMatchesRegex:"",matchesNodeIds:[],serverObjectHasFragment:"",matchesServerIds:[]},enabled:""},this.isLoaded=!0,this.getParentAttr=function(e){return p.get(s.model,e)}}return e.prototype.ngAfterContentChecked=function(){this.changeDetectorRef.detectChanges()},e.prototype.getMapping=function(){return this.model.mappings},e.prototype.getEmptyMappingObject=function(){return{id:"new",browsePath:[]}},e.prototype.getOverriddenSubscriptionsByPath=function(e){return p.find(this.model.overriddenSubscriptions,{browsePath:e})},e.prototype.getStructuredResource=function(e){var t=this.getOverriddenSubscriptionsByPath(e.browsePath),n=p.assign({},e);return t&&(n=p.assign({},e,{subscriptionType:t.subscriptionType})),n},e.prototype.ngOnInit=function(){return C(this,void 0,void 0,(function(){var e,t,n,i;return x(this,(function(s){switch(s.label){case 0:return(e=this.opcuaService.getId())?[4,this.opcuaService.getDeviceProtocol(e)]:[3,7];case 1:return(t=s.sent())&&200!==t.status?t.json?[4,t.json()]:[3,3]:[3,5];case 2:return n=s.sent(),[3,4];case 3:n=void 0,s.label=4;case 4:return i=n,this.alertService.addServerFailure({data:i,res:t}),this.isLoaded=!1,[3,7];case 5:return[4,t.json()];case 6:(i=s.sent())&&null===i.applyConstraints&&delete i.applyConstraints,i&&null===i.subscriptionType&&delete i.subscriptionType,this.model=p.assign(this.initialModel,i),this.model.mappings||(this.model.mappings=[]),this.model=p.assign(this.initialModel,this.updateViableMapping(i)),this.isLoaded=!1,s.label=7;case 7:return[2]}}))}))},e.prototype.updateViableMapping=function(e){var t=e.mappings,n=[];return t&&(n=t.map((function(e,t){return p.assign(e,{id:t})}))),p.assign(e,{mappings:n})},e.prototype.trackByIndex=function(e){return e},e.prototype.addVariable=function(){this.model.mappings.push(this.getEmptyMappingObject())},e.prototype.updateVariable=function(e){var t=this.model.mappings,n=p.findIndex(t,{id:e.id});t.splice(n,1),"new"===e.id&&(e.id=t.length),t.push(e)},e.prototype.removeVariable=function(e){var t=this.model.mappings,n=p.findIndex(t,{id:e.id});t.splice(n,1)},e.prototype.actionHandler=function(e){switch(e.action){case"save":this.updateVariable(e.data);break;case"delete":this.removeVariable(e.data)}},e.prototype.extractOverridSubscriptionType=function(e){var t=[],n=[];return e.forEach((function(e){"new"!==e.id&&(e.subscriptionType&&t.push(p.assign({browsePath:e.browsePath},{subscriptionType:e.subscriptionType})),n.push(p.omit(e,["subscriptionType"])))})),[n,t]},e.prototype.prepareRequestJson=function(e){var t={},n=P(this.extractOverridSubscriptionType(e.mappings),2),i=n[0],s=n[1];return t=p.assign(t,p.pick(e,Object.keys(this.initialModel)),{mappings:i,overriddenSubscriptions:s})},e.prototype.save=function(){return C(this,void 0,void 0,(function(){var e,t,n;return x(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.opcuaService.updateDeviceProtocol(this.prepareRequestJson(this.model))];case 1:return[4,(e=i.sent()).json()];case 2:return t=i.sent(),e&&200===e.status?(this.router.navigate(["deviceprotocols"]),this.alertService.success(a.gettext("Device protocol saved."))):(n=t.details,this.alertService.addServerFailure({res:e,data:n})),[3,4];case 3:return i.sent(),this.alertService.danger(a.gettext("Failed to save. Try again.")),[3,4];case 4:return[2]}}))}))},e.prototype.canSave=function(e){if(this.instanceList&&this.instanceList.filter((function(e){return e.isActive()})).length>0)return!0;return!e.form.valid},e.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:A},{type:a.AlertService},{type:r.Router}]},N([t.ViewChildren(T)],e.prototype,"instanceList",void 0),e=N([t.Component({selector:"opcua-device-protocol-detail",template:'<c8y-title *ngIf="!isLoaded">{{ model.name }}</c8y-title>\n<div>\n  <form #deviceTypeForm="ngForm" name="detailForm" *ngIf="!isLoaded">\n    <opcua-device-protocol-description [model]="model"></opcua-device-protocol-description>\n    <div class="card m-b-4">\n      <div class="card-header separator">\n        <h4 translate>Variables</h4>\n      </div>\n      <div class="list-group" *ngIf="model.mappings.length > 0" ngModelGroup="variable">\n        <opcua-device-protocol-mapping\n          *ngFor="let resource of getMapping(); trackBy: trackByIndex; let i = index"\n          [index]="i"\n          [referencedServerId]="model.referencedServerId"\n          [referencedRootNodeId]="model.referencedRootNodeId"\n          [resource]="getStructuredResource(resource)"\n          [getParentAttr]="getParentAttr"\n          (onAction)="actionHandler($event)"\n        >\n        </opcua-device-protocol-mapping>\n      </div>\n      <div class="card-block">\n        <div class="c8y-empty-state text-left" *ngIf="model.mappings.length === 0">\n          <h1 c8yIcon="sliders"></h1>\n          <p translate>No variables to display. Click below to add.</p>\n        </div>\n        <button\n          title="{{ \'Add variable\' | translate }}"\n          class="btn-add-block addVariableBtn"\n          (click)="addVariable()"\n        >\n          <i c8yIcon="plus-circle"></i> {{ \'Add variable\' | translate }}\n        </button>\n      </div>\n    </div>\n    <div class="card m-b-4">\n      <div class="card-header separator">\n        <h4 translate>Data reporting</h4>\n      </div>\n      <div class="card-block" ngModelGroup="subscription">\n        <opcua-device-protocol-data-reporting\n          [groupName]="\'subscription\'"\n          [model]="model"\n        ></opcua-device-protocol-data-reporting>\n      </div>\n    </div>\n    <div class="card">\n      <div class="card-header separator">\n        <h4 translate>Auto apply constraints</h4>\n      </div>\n      <div class="card-block overflow-visible" ngModelGroup="autoApply">\n        <opcua-auto-apply [model]="model"></opcua-auto-apply>\n      </div>\n    </div>\n\n    <span>\n      <div class="text-center page-footer m-t-16">\n        <div class="btn-save-wrapper animated">\n          <button\n            title="{{ \'Save\' | translate }}"\n            id="deviceTypeSave"\n            class="btn btn-primary"\n            (click)="save()"\n            [disabled]="canSave(deviceTypeForm)"\n            translate\n          >\n            Save\n          </button>\n        </div>\n      </div>\n    </span>\n  </form>\n</div>\n'})],e)}(),_=function(){function e(){this.onSubscriptionChange=new t.EventEmitter,this.subscription={type:"None"},this.subscriptionParameters={samplingRate:void 0,deadbandType:"None",deadbandValue:void 0,ranges:"",queueSize:void 0,dataChangeTrigger:"Status",discardOldest:!0},this.cyclicReadParameters={rate:void 0},this.types=[{value:"None",label:a.gettext("None")},{value:"CyclicRead",label:a.gettext("Cyclic read")},{value:"Subscription",label:a.gettext("Subscription")}],this.filters=[{value:"None",label:a.gettext("None")},{value:"absolute",label:a.gettext("Absolute")},{value:"percent",label:a.gettext("Percent")}],this.triggers=[{value:"Status",label:a.gettext("Status")},{value:"StatusValue",label:a.gettext("Status/Value")},{value:"StatusValueTimestamp",label:a.gettext("Status/Value/Timestamp")}],this.discard=[{value:!0,label:a.gettext("oldest`data`")},{value:!1,label:a.gettext("newest`data`")}],this.requireCyclic=!1,this.requireSubscription=!1,this.subscriptionTypeName="subscriptionType",this.parseReadingInterval=function(e){return p.toInteger(e.target.value)}}return Object.defineProperty(e.prototype,"model",{set:function(e){e.subscriptionType&&(this.subscription=e.subscriptionType,"CyclicRead"===this.subscription.type&&(this.cyclicReadParameters=e.subscriptionType.cyclicReadParameters,this.requireCyclic=!0,this.requireSubscription=!1),"Subscription"===this.subscription.type&&(this.subscriptionParameters=e.subscriptionType.subscriptionParameters,this.requireCyclic=!1,this.requireSubscription=!0),"None"===this.subscription.type&&(this.requireCyclic=!1,this.requireSubscription=!1)),this._model=e,this.subscriptionTypeName="subscriptionType"+e.id},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){var e=this;setTimeout((function(){p.unset(e.subscription,"subscriptionParameters"),p.unset(e.subscription,"cyclicReadParameters"),"CyclicRead"===e.subscription.type?(e.requireCyclic=!0,e.requireSubscription=!1,p.set(e.subscription,"cyclicReadParameters",e.cyclicReadParameters)):"Subscription"===e.subscription.type?(e.requireCyclic=!1,e.requireSubscription=!0,p.set(e.subscription,"subscriptionParameters",e.subscriptionParameters)):"None"===e.subscription.type&&(e.requireCyclic=!1,e.requireSubscription=!1)}))},N([t.Input()],e.prototype,"model",null),N([t.Input()],e.prototype,"groupName",void 0),N([t.Output()],e.prototype,"onSubscriptionChange",void 0),e=N([t.Component({selector:"opcua-device-protocol-data-reporting",template:'<c8y-form-group>\n  <label translate>Mechanism</label>\n  <label\n    title="{{ mechanism.label | translate }}"\n    class="c8y-radio radio-inline"\n    *ngFor="let mechanism of types"\n  >\n    <input\n      type="radio"\n      name="{{subscriptionTypeName}}"\n      [value]="mechanism.value"\n      [(ngModel)]="subscription.type"\n      (change)="updateModel()"\n      required\n    />\n    <span></span>\n    <span>{{ mechanism.label | translate }}</span>\n  </label>\n</c8y-form-group>\n\n<div class="row collapse" [collapse]="subscription.type != \'CyclicRead\'" [isAnimated]="true">\n  <div class="col-sm-6 col-md-4 col-lg-3">\n    <c8y-form-group>\n      <label translate>Reading interval</label>\n      <div class="input-group">\n        <input\n          class="form-control"\n          type="number"\n          name="rate"\n          [(ngModel)]="cyclicReadParameters.rate"\n          placeholder="{{ \'e.g.\' | translate }} 50"\n          [required]="requireCyclic"\n          min="50"\n        />\n        <span class="input-group-addon units" title="{{ \'Milliseconds\' | translate }}">\n          {{ \'msec\' | translate }}\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n</div>\n\n<div class="row collapse" [collapse]="subscription.type != \'Subscription\'" [isAnimated]="true">\n  <div class="col-sm-6 col-lg-4">\n    <c8y-form-group>\n      <label translate>Sampling interval</label>\n      <div class="input-group">\n        <input\n          class="form-control"\n          type="number"\n          name="samplingRate"\n          [(ngModel)]="subscriptionParameters.samplingRate"\n          placeholder="{{ \'e.g.\' | translate }} 500"\n          [required]="requireSubscription"\n          min="0"\n        />\n        <span class="input-group-addon units" title="{{ \'Milliseconds\' | translate }}" translate>\n          msec\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n  <div class="col-sm-6 col-lg-4">\n    <c8y-form-group>\n      <label translate>Queue size</label>\n      <div class="input-group">\n        <input\n          class="form-control"\n          type="number"\n          name="queueSize"\n          [(ngModel)]="subscriptionParameters.queueSize"\n          placeholder="{{ \'e.g.\' | translate }} 10"\n          min="1"\n        />\n        <span class="input-group-addon">\n          <strong translate>Discard</strong>&nbsp;\n          <label\n            *ngFor="let discardOption of discard"\n            title="{{ discardOption.label | translate }}"\n            class="c8y-radio radio-inline"\n          >\n            <input\n              type="radio"\n              name="discard"\n              [value]="discardOption.value"\n              [(ngModel)]="subscriptionParameters.discardOldest"\n              [required]="requireSubscription"\n            />\n            <span></span>\n            <span>{{ discardOption.label | translate }}</span>\n          </label>\n        </span>\n      </div>\n    </c8y-form-group>\n  </div>\n  <div class="clearfix"></div>\n  <div class="col-sm-6 col-lg-4">\n    <c8y-form-group>\n      <label translate>Data change trigger</label>\n      <label\n        *ngFor="let trigger of triggers"\n        title="{{ trigger.label | translate }}"\n        class="c8y-radio radio-inline"\n      >\n        <input\n          type="radio"\n          name="dataChangeTrigger"\n          [value]="trigger.value"\n          [(ngModel)]="subscriptionParameters.dataChangeTrigger"\n          [required]="requireSubscription"\n        />\n        <span></span>\n        <span>{{ trigger.label | translate }}</span>\n      </label>\n    </c8y-form-group>\n  </div>\n  <div class="col-sm-6 col-lg-4">\n    <c8y-form-group>\n      <label translate>Deadband filter</label>\n      <label\n        *ngFor="let deadbandFilter of filters"\n        title="{{ deadbandFilter.label | translate }}"\n        class="c8y-radio radio-inline"\n      >\n        <input\n          type="radio"\n          name="deadbandType"\n          [value]="deadbandFilter.value"\n          [(ngModel)]="subscriptionParameters.deadbandType"\n          [required]="requireSubscription"\n        />\n        <span></span>\n        <span>{{ deadbandFilter.label | translate }}</span>\n      </label>\n    </c8y-form-group>\n    <div [collapse]="subscriptionParameters.deadbandType == \'None\'" [isAnimated]="true">\n      <c8y-form-group>\n        <label translate>Deadband value</label>\n        <input\n          class="form-control"\n          type="number"\n          name="deadbandValue"\n          [(ngModel)]="subscriptionParameters.deadbandValue"\n          placeholder="{{ \'e.g.\' | translate }} 10"\n          [required]="subscriptionParameters.deadbandType != \'None\'"\n          min="0"\n        />\n      </c8y-form-group>\n    </div>\n  </div>\n</div>\n',viewProviders:[{provide:n.ControlContainer,useExisting:n.NgModelGroup}]})],e)}(),F=function(e){function n(t,n){return e.call(this,"c8yObjectMappingStatusIcons",t,n)||this}return w(n,e),n.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Injector}]},N([t.Input()],n.prototype,"mapping",void 0),n=N([t.Directive({selector:"c8y-object-mapping-status-icons"})],n)}(c.UpgradeComponent),q=function(){function e(e,n){this.addressSpaceService=e,this.opcuaService=n,this.selectednode=!1,this.loading=!1,this.searchInProgress=!1,this.focusStatus=new t.EventEmitter,this.moId=""}return e.prototype.ngOnInit=function(){return C(this,void 0,void 0,(function(){return x(this,(function(e){return this.filterLabel=a.gettext("Filterâ€¦"),this.moId=this.opcuaService.getMoId(),[2]}))}))},e.prototype.ngOnDestroy=function(){this.addressSpaceService.resetTreeToRootNode()},e.prototype.searchNodes=function(){return C(this,void 0,void 0,(function(){var e;return x(this,(function(t){switch(t.label){case 0:return this.searchInProgress=!0,this.clearNodeListAndCheckSearchString(),this.isSearch?(this.currentNode=void 0,e=this,[4,this.addressSpaceService.getSearchedNodes(this.searchKey,this.moId)]):[3,2];case 1:e.nodeList=t.sent(),this.searchInProgress=!1,this.nodeList.resultLabel=a.gettext("Results found"),t.label=2;case 2:return[2]}}))}))},e.prototype.clearNodeListAndCheckSearchString=function(){this.isSearch=void 0!==this.searchKey&&""!==this.searchKey,this.isSearch||(this.searchInProgress=!1)},e.prototype.clearSearch=function(){this.isSearch=!1,this.searchKey="",this.currentNode=void 0},e.prototype.getIcon=function(e){return this.addressSpaceService.getIcon(e)},e.prototype.selectNode=function(e){return C(this,void 0,void 0,(function(){var t,n;return x(this,(function(i){switch(i.label){case 0:return e&&e.nodeId&&e.nodeId.length>0?[4,this.addressSpaceService.getNodeById(this.moId,e.nodeId)]:[3,3];case 1:return t=i.sent(),n=this.toggleCurrentNode,[4,t.json()];case 2:n.apply(this,[i.sent()]),i.label=3;case 3:return[2]}}))}))},e.prototype.toggleCurrentNode=function(e){this.currentNode=this.isNodeSet(e)?void 0:e},e.prototype.backHandler=function(e){this.isSearch=!1,this.focusStatus.emit(e),this.toggleCurrentNode(e)},e.prototype.isNodeSet=function(e){return void 0!==this.currentNode&&this.currentNode.nodeId===e.nodeId},e.ctorParameters=function(){return[{type:M},{type:A}]},N([t.Output()],e.prototype,"focusStatus",void 0),e=N([t.Component({selector:"opcua-address-space",template:'<div class="row split-scroll">\n  <div class="col-md-5 col-xs-12 scroll-column no-gutter-r">\n    <div class="card bg-gray-lighter split-scroll flex-scroll">\n      <div class="card-block separator-bottom">\n        <div class="input-group input-group-search" style="margin: -4px 0;">\n          <input\n            class="form-control"\n            type="search"\n            placeholder="{{ filterLabel | translate }}"\n            (keydown.enter)="searchNodes()"\n            [(ngModel)]="searchKey"\n          />\n          <span class="input-group-btn">\n            <button *ngIf="!isSearch" type="submit" class="btn btn-clean" (click)="searchNodes()">\n              <i c8yIcon="search"></i>\n            </button>\n            <button *ngIf="isSearch" class="btn btn-clean" (click)="clearSearch()">\n              <i c8yIcon="times"></i>\n            </button>\n          </span>\n        </div>\n        <div *ngIf="isSearch && !loading" class="p-t-16">\n          <p *ngIf="!searchInProgress">\n            <em>{{ nodeList.resultLabel | translate }}</em\n            >&nbsp;\n            <span class="badge badge-info">{{ nodeList?.length }}</span>\n          </p>\n        </div>\n      </div>\n\n      <div class="p-8" *ngIf="(isSearch && loading) || searchInProgress">\n        <div class="spinner p-relative">\n          <div class="rect1"></div>\n          <div class="rect2"></div>\n          <div class="rect3"></div>\n          <div class="rect4"></div>\n          <div class="rect5"></div>\n        </div>\n      </div>\n\n      <div class="flex-content-scroll" *ngIf="isSearch && !loading && !searchInProgress">\n        <div\n          class="list-group list-group-links"\n          *ngIf="isSearch && !loading"\n          >\n          <button\n            *ngFor="let nodeItem of nodeList"\n            (click)="selectNode(nodeItem)"\n            [ngClass]="{ \'list-group-item flex-row\': true }"\n          >\n            <div class="list-group-icon m-r-4">\n              <i class="m-r-4" [c8yIcon]="getIcon(nodeItem.nodeClassName)"></i>\n            </div>\n            <div class="list-item-body text-truncate">\n              <span tile="nodeId">{{ nodeItem.nodeId }}</span>\n              {{ nodeItem.displayName }}\n            </div>\n          </button>\n        </div>\n      </div>\n      <div class="flex-content-scroll" *ngIf="!isSearch">\n        <opcua-address-space-tree\n          (selectedNode)="toggleCurrentNode($event)"\n          [focusEmitter]="focusStatus"\n        ></opcua-address-space-tree>\n      </div>\n    </div>\n  </div>\n  <opcua-address-space-detail\n    [node]="currentNode"\n    class="col-md-7 col-xs-12 scroll-column no-gutter-l"\n    style="pointer-events: none;"\n    (toggleAttrDetail)="backHandler($event)"\n  ></opcua-address-space-detail>\n</div>\n'})],e)}(),L=function(){function e(e){this.app=e,this.microserviceName="opcua-mgmt-service"}return e.prototype.canActivate=function(){return this.checkApp||(this.checkApp=this.app.isApplicationAvailable(this.microserviceName)),this.checkApp},e.ctorParameters=function(){return[{type:a.AppStateService}]},e=N([t.Injectable()],e)}(),B=function(){function e(e){this.fileName="",this.targetConnectionState="1",this.minIntervalNumber=1,this.connectionStatusLabel="",this.canceled=new t.EventEmitter,this.removed=new t.EventEmitter,this.saved=new t.EventEmitter,this.changePassword=!1,this.initialPasswordRequired=!0,this.NONE="NONE",this.SIGN="SIGN",this.SIGN_ENC="SIGN_ENCRYPT",this.securityPolicies={sign:["BASIC256_"+this.SIGN,"BASIC128RSA15_"+this.SIGN,"BASIC256SHA256_"+this.SIGN],sign_enc:["BASIC256_"+this.SIGN_ENC,"BASIC128RSA15_"+this.SIGN_ENC,"BASIC256SHA256_"+this.SIGN_ENC]},this.ANONYM={id:1,value:a.gettext("Anonymous")},this.USER_PASSWORD={id:2,value:a.gettext("Username/Password")},this.KEY_BASED={id:3,value:a.gettext("Key-based Authentication")},this.initialKeystore={lastModified:0,name:"",type:"",slice:null,size:0},this.keystore=this.initialKeystore,this.authSwitch=!1,this.opcuaService=e}return Object.defineProperty(e.prototype,"server",{get:function(){return this._server},set:function(e){e&&(this._server=i.cloneDeep(e),this.model=i.cloneDeep(e),this.fileName=this.model.config.keystoreFilename,e.id&&"new"===e.id?(this.targetConnectionState="1",this.model.config.targetConnectionState="enabled"):this.targetConnectionState="enabled"===this.model.config.targetConnectionState?"1":"0",this.updateConnectionStatusLabel(this._server),this.setNewPassword())},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){return C(this,void 0,void 0,(function(){return x(this,(function(e){return this.authSwitch=!1,this.securityModes=[this.NONE,this.SIGN,this.SIGN_ENC],this.authenticationModes=[this.ANONYM,this.USER_PASSWORD,this.KEY_BASED],this.setCurrentAuthenticationMode(),this.setCurrentSecurityMode(),[2]}))}))},e.prototype.ngOnChanges=function(){this.setCurrentSecurityMode(),this.setCurrentAuthenticationMode()},e.prototype.cancel=function(){this.canceled.emit(this.model)},e.prototype.remove=function(){return C(this,void 0,void 0,(function(){return x(this,(function(e){switch(e.label){case 0:return[4,this.removeKeystore(this.model)];case 1:return e.sent(),this.removed.emit(this.model),[2]}}))}))},e.prototype.save=function(){return C(this,void 0,void 0,(function(){var e,t;return x(this,(function(n){switch(n.label){case 0:return this.keystore&&this.keystore.size>0&&this.keystore.name&&this.keystore.name.length>0?[4,this.uploadKeystore(this.model.config.keystoreBinaryId)]:[3,2];case 1:(e=n.sent())&&e.data&&e.data.id&&(this.model.config.keystoreBinaryId=e.data.id),this.keystore=this.initialKeystore,n.label=2;case 2:return this.authSwitch&&this.removeKeystore(this.server),(t=this.getModelConfig("userPassword"))&&t.length>0&&(this.model.config.passwordEncrypted=!1),this.saved.emit(this.model),[2]}}))}))},e.prototype.uploadFile=function(e){1===e.length?(this.keystore=e[0].file,this.fileName=this.keystore.name):console.warn("Tried to import... Import aborted.")},e.prototype.setPolicy=function(e){e===this.NONE?this.model.config.securityMode=this.NONE:e===this.SIGN?this.model.config.securityMode=this.securityPolicies.sign[0]:e===this.SIGN_ENC&&(this.model.config.securityMode=this.securityPolicies.sign_enc[0])},e.prototype.setServerConnection=function(e){this.model.config.targetConnectionState="0"!==e?"enabled":"disabled"},e.prototype.updateAuthentication=function(e){if(e&&e.id)switch(e.id){case 1:this.resetUserAuthentication(),this.resetKeyBasedAuthentication();break;case 2:this.resetKeyBasedAuthentication(),this.restoreUserData(),this.setNewPassword();break;case 3:this.resetUserAuthentication(),this.restoreKeyBasedData();break;default:console.warn("Invalid authentication id",e.id)}},e.prototype.updateConnectionStatusLabel=function(e){var t=e.c8y_Connection&&"CONNECTED"===e.c8y_Connection.status?a.gettext("Connected"):a.gettext("Disconnected");this.connectionStatusLabel=t},e.prototype.setNewPassword=function(){var e=this.getModelConfig("userName");e&&e.length>0?(this.changePassword=!1,this.initialPasswordRequired=!1):(this.changePassword=!0,this.initialPasswordRequired=!0)},e.prototype.toggleChangePassword=function(){this.changePassword=!this.changePassword,this.changePassword||this.getModelConfig("userPassword")&&delete this.model.config.userPassword},e.prototype.uploadKeystore=function(e){return e?e&&e.length>0?this.opcuaService.updateKeystore(e,this.keystore):void 0:this.opcuaService.uploadKeystore(this.keystore)},e.prototype.removeKeystore=function(e){if(e&&e.config&&e.config.keystoreBinaryId&&e.config.keystoreBinaryId.length>0)return this.authSwitch=!1,this.opcuaService.removeKeystore(this.server.config.keystoreBinaryId)},e.prototype.resetUserAuthentication=function(){this.model.config.userName=null,this.model.config.userPassword=null,this.model.config.userIdentityMode="none"},e.prototype.resetKeyBasedAuthentication=function(){this.authSwitch=!0,this.model.config.keystorePass=null,this.model.config.certificatePass=null,this.model.config.keystoreBinaryId="",this.model.config.keystoreFilename="",this.model.config.userIdentityMode="none"},e.prototype.restoreUserData=function(){this.model.config.userName=this._server.config.userName,this.model.config.userIdentityMode="userAndPassword"},e.prototype.restoreKeyBasedData=function(){this.authSwitch=!1,this.model.config.keystorePass=this._server.config.keystorePass,this.model.config.certificatePass=this._server.config.certificatePass,this.model.config.keystoreBinaryId=this._server.config.keystoreBinaryId,this.model.config.keystoreFilename=this._server.config.keystoreFilename,this.model.config.userIdentityMode="certificate"},e.prototype.getServerConfig=function(){var e={securityMode:this.NONE,userIdentityMode:"none"};return this.server&&this.server.config&&(e=this.server.config),e},e.prototype.setCurrentSecurityMode=function(){var e=this.getServerConfig().securityMode;if(e)if(this.securityPolicies.sign.find((function(t){return t===e})))this.currentSecMode=this.SIGN;else{var t=this.securityPolicies.sign_enc.find((function(t){return t===e}));this.currentSecMode=t?this.SIGN_ENC:this.NONE}},e.prototype.setCurrentAuthenticationMode=function(){switch(this.getServerConfig().userIdentityMode){case"certificate":this.authenticationMode=this.KEY_BASED;break;case"userAndPassword":this.authenticationMode=this.USER_PASSWORD;break;case"Anonymous":this.authenticationMode=this.ANONYM;break;case"UserName":this.authenticationMode=this.USER_PASSWORD;break;case"Certificate":this.authenticationMode=this.KEY_BASED;break;default:this.authenticationMode=this.ANONYM}},e.prototype.getModelConfig=function(e){if(this.model&&this.model.config&&e&&e.length>0)return i.has(this.model.config,e)?this.model.config[""+e]:void 0},e.ctorParameters=function(){return[{type:A}]},N([t.ViewChild("opcuaConfigForm",{static:!1})],e.prototype,"opcuaConfigForm",void 0),N([t.ViewChild(a.DropAreaComponent,{static:!1})],e.prototype,"dropArea",void 0),N([t.Output()],e.prototype,"canceled",void 0),N([t.Output()],e.prototype,"removed",void 0),N([t.Output()],e.prototype,"saved",void 0),N([t.Input()],e.prototype,"server",null),e=N([t.Component({selector:"opcua-server-config",template:'<form #opcuaConfigForm="ngForm" class="card card-scroll" *ngIf="server">\n  <div class="card-header flex-wrap">\n    <button\n      class="btn btn-clean visible-sm visible-xs"\n      title="{{ \'Back\' | translate }}"\n      (click)="cancel()"\n    >\n      <i c8yIcon="chevron-left"></i\n      ><span translate>Back</span></button\n    ><br />\n    \x3c!-- SERVER NAME --\x3e\n    <label class="editable" style="width: 100%;">\n      <input\n        type="text"\n        class="form-control input-lg"\n        placeholder="{{ \'Server name\' | translate }}"\n        id="name"\n        name="name"\n        [(ngModel)]="model.name"\n        required\n      />\n    </label>\n  </div>\n  <div class="inner-scroll">\n    <div class="card-block bg-gray-lighter p-t-16">\n      <div class="tight-grid">\n        <div class="col-sm-6">\n          <label style="width: 100%;" translate>Server connection</label>\n          <button\n            type="button"\n            class="btn m-t-4"\n            name="serverConnection"\n            [(ngModel)]="targetConnectionState"\n            (ngModelChange)="setServerConnection($event)"\n            btnCheckbox\n            btnCheckboxTrue="1"\n            btnCheckboxFalse="0"\n          >\n            <span\n              title="{{ \'Enabled\' | translate }}"\n              [hidden]="targetConnectionState !== \'1\'"\n              translate\n              >Enabled</span\n            >\n            <span\n              title="{{ \'Disabled\' | translate }}"\n              [hidden]="targetConnectionState !== \'0\'"\n              translate\n              >Disabled</span\n            >\n          </button>\n        </div>\n        <div class="col-sm-6">\n          <label translate>Connection status</label>\n          <div class="form-control-static">\n            <device-status class="p-r-8" [mo]="server"></device-status>\n            <span>{{ connectionStatusLabel | translate }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="card-block">\n      \x3c!-- SERVER URL--\x3e\n      <c8y-form-group>\n        <label for="configServerUrl" translate>Server URL</label>\n        <input\n          type="text"\n          class="form-control"\n          id="configServerUrl"\n          name="serverUrl"\n          [(ngModel)]="model.config.serverUrl"\n          c8yDefaultValidation="opcuaBrowsePath"\n          required\n        />\n      </c8y-form-group>\n\n      \x3c!-- TIMEOUT & STATUS-CHECK-INTERVAL--\x3e\n      <div class="tight-grid">\n        <div class="col-md-6">\n          <c8y-form-group>\n            <label for="config.timeout" translate>Timeout</label>\n            <div class="input-group">\n              <input\n                type="number"\n                class="form-control"\n                id="config.timeout"\n                name="timeout"\n                [min]="minIntervalNumber"\n                placeholder="{{ \'e.g.\' | translate }} 30"\n                [(ngModel)]="model.config.timeout"\n                required\n              />\n              <span class="input-group-addon units" translate>\n                seconds\n              </span>\n            </div>\n          </c8y-form-group>\n        </div>\n        <div class="col-md-6">\n          <c8y-form-group>\n            <label for="config.statusCheckInterval" translate>Status check interval</label>\n            <div class="input-group">\n              <input\n                type="number"\n                class="form-control"\n                id="config.statusCheckInterval"\n                name="statusCheckInterval"\n                [min]="minIntervalNumber"\n                placeholder="{{ \'e.g.\' | translate }} 40"\n                [(ngModel)]="model.config.statusCheckInterval"\n                required\n              />\n              <span class="input-group-addon units" translate>\n                seconds\n              </span>\n            </div>\n          </c8y-form-group>\n        </div>\n      </div>\n\n      \x3c!-- SECURITY MODE --\x3e\n      <div class="tight-grid">\n        <div class="col-md-6">\n          <div class="form-group">\n            \x3c!-- NONE, SIGN, SIGN & ENCRYPT--\x3e\n            <label for="config.securityMode" translate>Security mode</label>\n            <div class="c8y-select-wrapper">\n              <select\n                class="form-control"\n                id="config.securityMode"\n                [(ngModel)]="currentSecMode"\n                (ngModelChange)="setPolicy($event)"\n                name="securityMode"\n                required\n              >\n                <option *ngFor="let mode of securityModes" [ngValue]="mode">{{ mode }}</option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n        <div *ngIf="currentSecMode === NONE" class="col-md-6">\n          <div class="form-group">\n            <label for="config.securityPolicy" translate>Security policy</label>\n            <input\n              type="text"\n              class="form-control"\n              id="config.securityPolicy"\n              name="securityPolicy"\n              [readonly]="true"\n              [(ngModel)]="model.config.securityMode"\n              required\n            />\n          </div>\n        </div>\n        <div *ngIf="currentSecMode !== NONE" class="col-md-6">\n          <div class="form-group">\n            <label for="config.securityPolicy" translate>Security policy</label>\n            <div class="c8y-select-wrapper">\n              <select\n                *ngIf="currentSecMode === SIGN"\n                class="form-control"\n                id="config.securityPolicy"\n                [(ngModel)]="model.config.securityMode"\n                name="securityPolicy"\n                required\n              >\n                <option *ngFor="let policy of securityPolicies.sign" [ngValue]="policy">{{\n                  policy\n                }}</option>\n              </select>\n              <select\n                *ngIf="currentSecMode === SIGN_ENC"\n                class="form-control"\n                id="config.securityPolicy"\n                [(ngModel)]="model.config.securityMode"\n                name="securityPolicy"\n                required\n              >\n                <option *ngFor="let policy of securityPolicies.sign_enc" [ngValue]="policy">{{\n                  policy\n                }}</option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- AUTHENTICATION --\x3e\n      <div class="form-group">\n        <label for="config.authenticationMode" translate>Authentication</label>\n        <div class="c8y-select-wrapper">\n          <select\n            class="form-control"\n            id="config.authenticationMode"\n            [(ngModel)]="authenticationMode"\n            name="authenticationMode"\n            (ngModelChange)="updateAuthentication($event)"\n            required\n          >\n            <option *ngFor="let auth of authenticationModes" [ngValue]="auth">{{\n              auth.value | translate\n            }}</option>\n          </select>\n          <span></span>\n        </div>\n      </div>\n\n      \x3c!-- User/Pw--\x3e\n      <div *ngIf="authenticationMode.id === 2" class="tight-grid">\n        <div class="col-md-12">\n          <div class="form-group">\n            <label for="config.userName" translate>Username</label>\n            <input\n              type="text"\n              class="form-control"\n              id="config.userName"\n              name="userName"\n              placeholder="{{ \'e.g. joe.doe`LOCALIZE`\' | translate }}"\n              [(ngModel)]="model.config.userName"\n              autocomplete="new-password"\n              required\n            />\n          </div>\n        </div>\n        \x3c!-- change password section BEGINS--\x3e\n        <div class="col-md-6">\n          <div class="form-group" *ngIf="!initialPasswordRequired">\n            <button type="button" class="btn btn-default" (click)="toggleChangePassword()">\n              <ng-container *ngIf="!changePassword">\n                {{ \'Change password\' | translate }}\n              </ng-container>\n              <ng-container *ngIf="changePassword">\n                {{ \'Cancel password change\' | translate }}\n              </ng-container>\n            </button>\n          </div>\n\n          <div class="form-group">\n            <div *ngIf="changePassword">\n              <label for="config.password" translate>Password</label>\n              <input\n                type="password"\n                class="form-control"\n                id="config.userPassword"\n                name="password"\n                [(ngModel)]="model.config.userPassword"\n                autocomplete="new-password"\n                required\n              />\n            </div>\n          </div>\n        </div>\n        \x3c!-- change password section ENDS--\x3e\n      </div>\n      \x3c!-- Key-based --\x3e\n      <div *ngIf="authenticationMode.id === 3" class="tight-grid">\n        \x3c!-- KEYSTORE PASSWORD --\x3e\n        <div class="col-md-6">\n          <div class="form-group">\n            <label for="config.keystorePass" translate>Keystore password</label>\n            <input\n              type="password"\n              class="form-control"\n              id="config.keystorePass"\n              name="keystorePass"\n              [(ngModel)]="model.config.keystorePass"\n              required\n            />\n          </div>\n        </div>\n        <div class="col-md-6">\n          <div class="form-group">\n            <label for="config.certificatePass" translate>Certificate password</label>\n            <input\n              type="password"\n              class="form-control"\n              id="config.certificatePass"\n              name="keystorePass"\n              [(ngModel)]="model.config.certificatePass"\n              required\n            />\n          </div>\n        </div>\n        \x3c!-- UPLOAD KEYSTORE --\x3e\n        <div class="col-md-12">\n          <div class="form-group">\n            <label for="certificateUpload" translate>Upload keystore</label>\n            <input\n              type="text"\n              [readonly]="true"\n              name="certificateUpload"\n              class="form-control m-b-8"\n              [ngModel]="fileName"\n              placeholder="{{ \'e.g.\' | translate }} yourKeystore.jks"\n              required\n            />\n            <c8y-drop-area\n              (dropped)="uploadFile($event)"\n              [loadingMessage]="\'Importing, please wait.\' | translate"\n              [title]="\'Import keystore with jks file extension\' | translate"\n            >\n            </c8y-drop-area>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="card-footer separator text-center">\n    <button title="{{ \'Cancel\' | translate }}" class="btn btn-default" (click)="cancel()" translate>\n      Cancel\n    </button>\n    <button title="{{ \'Remove\' | translate }}" class="btn btn-danger" (click)="remove()" translate>\n      Remove\n    </button>\n    \x3c!-- Add [disabled]="method()" when form is invalid--\x3e\n    <button\n      title="{{ \'Save\' | translate }}"\n      class="btn btn-primary"\n      (click)="save()"\n      [disabled]="!opcuaConfigForm.valid"\n      translate\n    >\n      Save\n    </button>\n  </div> \n</form>\n'})],e)}(),U=function(){function e(){this.serverList=[],this.present=new t.EventEmitter}return e.prototype.presentConfig=function(e){e.active=!0,this.present.emit(e)},N([t.Input()],e.prototype,"serverList",void 0),N([t.Output()],e.prototype,"present",void 0),e=N([t.Component({selector:"opcua-server-list",template:'\x3c!-- add active class to c8y-stacked-item when clicked --\x3e\n<div\n  class="c8y-stacked-item"\n  [class.active]="server.active"\n  *ngFor="let server of serverList"\n  (click)="presentConfig(server)"\n>\n  <i [c8yIcon]="\'server\'" style="font-size:1.4em;" class="text-gray-darker"></i>\n  <div class="p-l-16 text-truncate">\n    <p id="serverName" class="text-truncate">{{ server.name }}</p>\n    <small id="serverUrl" class="text-truncate text-muted">{{ server.config.serverUrl }}</small>\n  </div>\n  <div class="flex-item-right p-l-8 d-flex">\n    <device-status class="p-r-8" [mo]="server"></device-status>\n    <a\n      title="{{ server.quickInfo.padlockMsg | translate }}"\n      placement="left"\n      class="text-gray-darker"\n    >\n      <i [c8yIcon]="server.quickInfo.padlock"></i>\n    </a>\n  </div>\n</div>\n'})],e)}(),V=function(){function e(){this.type="c8y_OpcuaServer"}return e.prototype.canActivate=function(e){var t=e.data.contextData;return t&&t.type===this.type},e=N([t.Injectable()],e)}(),G=function(){function e(e,t,n,i){this.opcuaService=e,this.alertService=t,this.translateService=n,this.context=i,this.serverObjectList=[],this.initialServerObject={id:"",name:"New Server",config:{securityMode:"NONE",keystorePass:null,keystoreBinaryId:null,keystoreFilename:"",certificatePass:null,serverUrl:"",userName:"",userPassword:"",rescanCron:null,timeout:null,autoReconnect:!0,statusCheckInterval:null,valid:!0},quickInfo:{padlock:"unlock",padlockMsg:""},active:!0},this.active=!1,this.moId="",this.NEW_SERVER_ID="new",this.initialServerObject.id=this.NEW_SERVER_ID}var n,i;return e.prototype.ngOnInit=function(){return C(this,void 0,void 0,(function(){var e,t,n,i,s=this;return x(this,(function(o){switch(o.label){case 0:return this.moId=this.opcuaService.getMoId(),this.moId&&this.moId.length>0?[4,this.opcuaService.getServers(this.moId)]:[3,7];case 1:return(e=o.sent())&&200!==e.status?e.json?[4,e.json()]:[3,3]:[3,5];case 2:return n=o.sent(),[3,4];case 3:n=void 0,o.label=4;case 4:return t=n,this.alertService.addServerFailure({data:t,res:e}),[3,7];case 5:return i=this,[4,e.json()];case 6:i.serverObjectList=o.sent(),this.serverObjectList.map((function(e){return s.setQuickInfo(e)})),o.label=7;case 7:return[2]}}))}))},e.prototype.localServerObjectExist=function(){var e=this;return!!this.serverObjectList.find((function(t){return t.id===e.NEW_SERVER_ID}))},e.prototype.addServer=function(){var e=this.initialServerObject;this.serverObjectList.push(e),this.onPresent(e)},e.prototype.onSaved=function(e){e&&e.id&&(e.gatewayId=this.moId,e.id===this.NEW_SERVER_ID?this.createServer(e):this.updateServer(e))},e.prototype.reloadTabs=function(){this.context&&this.context.refreshTabs()},e.prototype.onCanceled=function(e){e&&e.id&&e.id===this.NEW_SERVER_ID?this.removeServerObjectListById(e.id):(this.serverObjectList.forEach((function(t){t.id===e.id&&(t.active=!1)})),delete this.server)},e.prototype.onRemoved=function(e){e.id===this.NEW_SERVER_ID?this.onCanceled(e):this.removeServer(e)},e.prototype.getKeystore=function(e){return C(this,void 0,void 0,(function(){return x(this,(function(t){switch(t.label){case 0:return[4,this.opcuaService.getKeystore(e)];case 1:return[2,t.sent().data]}}))}))},e.prototype.onPresent=function(e){return C(this,void 0,void 0,(function(){var t,n;return x(this,(function(i){switch(i.label){case 0:if(!(e&&e.id!==this.NEW_SERVER_ID&&e.config&&e.config.keystoreBinaryId))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.getKeystore(e.config.keystoreBinaryId)];case 2:return t=i.sent(),e.config.keystoreFilename=t.name,[3,4];case 3:return n=i.sent(),this.server=Object.assign({},e),console.log("Could not get existing keystore:",n),[3,4];case 4:return this.serverObjectList.length>0&&(this.serverObjectList.forEach((function(t){t.active=!1,t.id===e.id&&(t.active=!0,e.active=t.active)})),this.setQuickInfo(e),this.server=Object.assign({},e)),[2]}}))}))},e.prototype.createServer=function(e){return C(this,void 0,void 0,(function(){var t;return x(this,(function(n){switch(n.label){case 0:return[4,this.opcuaService.createServer(e)];case 1:return[4,n.sent().json()];case 2:return t=n.sent(),this.updateServerObjectListById(this.NEW_SERVER_ID,t),this.reloadTabs(),[2]}}))}))},e.prototype.updateServer=function(e){return C(this,void 0,void 0,(function(){var t;return x(this,(function(n){switch(n.label){case 0:return[4,this.opcuaService.updateServer(e)];case 1:return(t=n.sent())&&this.updateServerObjectListById(t.id,t),[2]}}))}))},e.prototype.removeServer=function(e){return C(this,void 0,void 0,(function(){var t;return x(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.opcuaService.removeServer(e)];case 1:return n.sent(),this.removeServerObjectListById(e.id),this.reloadTabs(),[3,3];case 2:return t=n.sent(),console.log("Could not remove OPC UA server:",t),[3,3];case 3:return[2]}}))}))},e.prototype.removeServerObjectListById=function(e){var t=this;this.serverObjectList.forEach((function(n,i){n.id===e&&(t.serverObjectList.splice(i,1),delete t.server)}))},e.prototype.updateServerObjectListById=function(e,t){var n=this.serverObjectList.findIndex((function(t){return t.id===e}));n>-1&&(this.setQuickInfo(t),this.serverObjectList[n]=t),delete this.server},e.prototype.setQuickInfo=function(e){e.quickInfo={padlock:"unlock",padlockMsg:""},e&&e.config&&e.config.securityMode&&(e.quickInfo.padlock="NONE"!==e.config.securityMode?"lock":"unlock",e.quickInfo.padlockMsg=this.translateService.instant(a.gettext("The security policy is set to {{param}}."),{param:e.config.securityMode}))},e.ctorParameters=function(){return[{type:A},{type:a.AlertService},{type:u.TranslateService},{type:a.ContextRouteComponent,decorators:[{type:t.Optional}]}]},e=N([t.Component({selector:"opcua-servers",template:'<div class="row split-scroll">\n  <div class="col-md-6 scroll-column has-footer">\n    <div class="c8y-nav-stacked inner-scroll">\n      <h4 class="m-b-8" translate>OPC UA servers</h4>\n      <p class="m-b-24" translate>\n        Below you can configure one or more OPC UA servers. The OPC UA agent will connect to these servers if they are enabled and the connection state is set to "connected".\n      </p>\n      <opcua-server-list [serverList]="serverObjectList" (present)="onPresent($event)">\n      </opcua-server-list>\n    </div>\n    <div class="scroll-column-footer">\n      <button\n        title="{{ \'Add server\' | translate }}"\n        class="btn btn-add-block"\n        [disabled]="localServerObjectExist()"\n        (click)="addServer()"\n      >\n        <i [c8yIcon]="\'plus-circle\'"></i>\n        {{ \'Add server\' | translate }}\n      </button>\n    </div>\n  </div>\n\n  <opcua-server-config\n    class="col-md-6 scroll-column fast animated"\n    [ngClass]="{ slideInRight: server, slideOutRight: !server }"\n    (canceled)="onCanceled($event)"\n    (removed)="onRemoved($event)"\n    (saved)="onSaved($event)"\n    [server]="server"\n  >\n  </opcua-server-config>\n</div>\n'}),(n=3,i=t.Optional(),function(e,t){i(e,t,n)})],e)}(),K=function(){function e(){this.moId=""}return Object.defineProperty(e.prototype,"model",{set:function(e){this.moId=e.referencedServerId,this._model=e,this.autoScan=e.enabled?"1":"0"},enumerable:!0,configurable:!0}),e.prototype.setAutoScanOption=function(e){this._model.enabled="0"!==e},N([t.Input()],e.prototype,"model",null),e=N([t.Component({selector:"opcua-device-protocol-description",template:'<div class="card m-b-4">\n  <div class="card-block">\n    <div class="row">\n      <div class="col-md-7">\n        <div class="form-group">\n          <label translate>Name</label>\n          <label class="editable" [ngClass]="{ updated: ctrlName.dirty }">\n            <input\n              type="text"\n              class="form-control"\n              name="name"\n              #ctrlName="ngModel"\n              [(ngModel)]="_model.name"\n            />\n          </label>\n        </div>\n        <div class="form-group">\n          <label translate>Description</label>\n          <label class="editable" [ngClass]="{ updated: ctrlDescription.dirty }">\n            <textarea\n              class="form-control"\n              rows="1"\n              name="description"\n              #ctrlDescription="ngModel"\n              [(ngModel)]="_model.description"\n            ></textarea>\n            <span *ngIf="_model.description">\n              {{ _model.description }}\n            </span>\n          </label>\n        </div>\n        <div class="flex-row">\n          <div style="min-width: 120px;">\n            <button\n              type="button"\n              class="btn m-t-4"\n              name="autoScanAddressSpace"\n              [(ngModel)]="autoScan"\n              (ngModelChange)="setAutoScanOption($event)"\n              btnCheckbox\n              btnCheckboxTrue="1"\n              btnCheckboxFalse="0"\n              ngDefaultControl\n            >\n              <span *ngIf="autoScan === \'1\'">\n                <i c8yIcon="check" class="text-success"></i>\n                {{ \'Active\' | translate }}\n              </span>\n              <span *ngIf="autoScan === \'0\'">\n                <i c8yIcon="ban" class="text-danger"></i> \n                {{ \'Inactive\' | translate }}\n              </span>\n            </button>\n          </div>\n          <small class="m-l-16 text-muted">\n            {{ \'When active, the gateway scans the address space of all servers and automatically applies this device protocol to all nodes matching the criteria.\' | translate }}\n          </small>\n        </div>\n      </div>\n      <div class="col-md-5">\n        <dl class="dl-horizontal m-b-0">\n          <dt><label translate>Device protocol type</label></dt>\n          <dd>\n            <span class="label label-info m-r-8 text-capitalize">\n              {{ _model.fieldbusType }}\n            </span>\n          </dd>\n          <dt><label class="small" translate>ID</label></dt>\n          <dd style="font-size:1.5em">{{ _model.id }}</dd>\n          <dt><label class="small" translate>Date created</label></dt>\n          <dd>{{ _model.creationTime | c8yDate }}</dd>\n          <dt><label class="small" translate>Last update</label></dt>\n          <dd>{{ _model.lastUpdated | c8yDate }}</dd>\n          <dt><label class="small" translate>Fieldbus version</label></dt>\n          <dd>{{ _model.fieldbusVersion }}</dd>\n        </dl>\n      </div>\n    </div>\n  </div>\n</div>\n',viewProviders:[{provide:n.ControlContainer,useExisting:n.NgForm}]})],e)}(),$=function(){function e(e,t,n){this.treeControl=e,this.addressSpaceService=t,this.serverId=n,this.dataChange=new o.BehaviorSubject([]),this.treeControl.isExpanded=function(e){return e.expanded}}return Object.defineProperty(e.prototype,"data",{get:function(){return this.dataChange.value},set:function(e){this.treeControl.dataNodes=e,this.dataChange.next(e)},enumerable:!0,configurable:!0}),e.prototype.connect=function(e){var t=this;return this.treeControl.expansionModel.onChange.subscribe((function(e){(e.added||e.removed)&&t.handleTreeControl(e)})),o.merge(e.viewChange,this.dataChange).pipe(f.map((function(){return t.data})))},e.prototype.handleTreeControl=function(e){var t=this;e.added&&e.added.forEach((function(e){return t.toggleNode(e,!0)})),e.removed&&e.removed.slice().reverse().forEach((function(e){return t.toggleNode(e,!1)}))},e.prototype.toggleNode=function(e,t){return C(this,void 0,void 0,(function(){var n;return x(this,(function(i){switch(i.label){case 0:return e.children&&0!==e.children.length?[3,3]:(e.currentlyLoadingChildren=!0,[4,this.addressSpaceService.getChildrenOf(e,this.serverId)]);case 1:return[4,i.sent().json()];case 2:n=i.sent(),e.children=n||[],e.children=e.children.map((function(t){return t.parentNode=e,t})),e.currentlyLoadingChildren=!1,this.treeControl.expand(e),i.label=3;case 3:return e.expanded=t&&e.children.length>0,this.refreshNestedTree(this.data),[2,Promise.resolve(e)]}}))}))},e.prototype.catch=function(){},e.prototype.refreshNestedTree=function(e){this.data=[],this.dataChange.next(e),this.triggerResize()},e.prototype.triggerResize=function(){setTimeout((function(){try{window.dispatchEvent(new Event("resize"))}catch(e){}}),200)},e}(),H=function(){function e(e,n,i){var s=this;this.addressSpaceService=e,this.opcuaService=n,this.alertService=i,this.focusEmitter=new t.EventEmitter,this.selectedNode=new t.EventEmitter,this.dataSource=null,this.loading=!1,this.getChildren=function(e){return e.expanded?e.children:[]},this.hasChild=function(e,t){return s.addressSpaceService.childrenAvailable(t.references)}}return Object.defineProperty(e.prototype,"moId",{set:function(e){this._moId=e||void 0},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.initializeDataSet()},e.prototype.ngOnChanges=function(e){e.moId&&e.moId.currentValue!==e.moId.previousValue&&this.initializeDataSet()},e.prototype.initializeDataSet=function(){var e=this;this.nodeNavDataSubscription=this.addressSpaceService.getNodeNavData$().subscribe((function(t){return e.openNode(t)})),this.subscriptionRef=this.focusEmitter.subscribe((function(t){e.focused=e.isFocusedNode(t)?void 0:t}))},e.prototype.ngOnDestroy=function(){this.addressSpaceService.resetTreeToRootNode(),this.nodeNavDataSubscription&&!this.nodeNavDataSubscription.closed&&this.nodeNavDataSubscription.unsubscribe(),this.subscriptionRef&&!this.subscriptionRef.closed&&this.subscriptionRef.unsubscribe()},e.prototype.openNode=function(e){return C(this,void 0,void 0,(function(){var t,n,i,s,o;return x(this,(function(r){switch(r.label){case 0:return t=e.node,n=e.selectedAncestorIds,t&&t.nodeId&&n&&0===n.length&&(i=t.nodeId),[4,this.setupTree(i)];case 1:return r.sent(),n&&0!==n.length?e&&this.dataSource?((s=p.clone(n)).shift(),[4,this.dataSource.toggleNode(this.dataSource.data[0],!0)]):[3,3]:[2];case 2:o=r.sent(),this.setChildNodes(o.children,s),this.toggleFocusedNode(t),r.label=3;case 3:return[2]}}))}))},e.prototype.setChildNodes=function(e,t){var n=this;e&&t.forEach((function(i){return C(n,void 0,void 0,(function(){var n,s,o;return x(this,(function(r){switch(r.label){case 0:return(n=e.find((function(e){return e.nodeId===i})))&&t.length>0?((s=t.findIndex((function(e){return e===i})))>=0&&t.splice(s,1),[4,this.dataSource.toggleNode(n,!0)]):[3,2];case 1:o=r.sent(),this.setChildNodes(o.children,t),r.label=2;case 2:return[2]}}))}))}))},e.prototype.setupTree=function(e){return C(this,void 0,void 0,(function(){var t,n,i,s;return x(this,(function(o){switch(o.label){case 0:return this.loading=!0,this._moId&&0!==this._moId.length||(this._moId=this.opcuaService.getMoId()),[4,this.addressSpaceService.getNode(this._moId,e)];case 1:return(t=o.sent())?200===t.status?[3,5]:t.json?[4,t.json()]:[3,3]:[3,8];case 2:return i=o.sent(),[3,4];case 3:i=void 0,o.label=4;case 4:return n=i,this.alertService.addServerFailure({data:n,res:t}),this.dataSource=void 0,[3,7];case 5:return[4,t.json()];case 6:s=o.sent(),this.nestedTreeControl=new l.NestedTreeControl(this.getChildren),this.dataSource=new $(this.nestedTreeControl,this.addressSpaceService,this._moId),this.dataSource.data=[s],o.label=7;case 7:return this.loading=!1,[3,9];case 8:this.loading=!1,o.label=9;case 9:return[2]}}))}))},e.prototype.getMoId=function(){return this._moId&&0!==this._moId.length?this._moId:this.opcuaService.getMoId()},e.prototype.getIcon=function(e){return this.addressSpaceService.getIcon(e)},e.prototype.toggleFocusedNode=function(e){var t=[];this.getRelativePath(e,t),e.relativePath=t,this.selectedNode.emit(e),this.focused=this.isFocusedNode(e)?void 0:e},e.prototype.isFocusedNode=function(e){return!!this.focused&&e.nodeId===this.focused.nodeId},e.prototype.getRelativePath=function(e,t){e.parentNode&&(t.unshift(e.browseName),this.getRelativePath(e.parentNode,t))},e.ctorParameters=function(){return[{type:M},{type:A},{type:a.AlertService}]},N([t.Input()],e.prototype,"moId",null),N([t.Input()],e.prototype,"node",void 0),N([t.Input()],e.prototype,"focusEmitter",void 0),N([t.Output()],e.prototype,"selectedNode",void 0),e=N([t.Component({selector:"opcua-address-space-tree",template:'<div class="card-block" *ngIf="dataSource && !loading">\n  <cdk-tree [dataSource]="dataSource" [treeControl]="nestedTreeControl">\n    \x3c!-- This is the tree node template for leaf nodes --\x3e\n    <cdk-nested-tree-node\n      *cdkTreeNodeDef="let node"\n      (click)="toggleFocusedNode(node)"\n      [ngClass]="{ strong: isFocusedNode(node) }"\n      class="interact"\n    >\n      <span>\n        <i\n          class="m-r-4 interact"\n          [c8yIcon]="getIcon(node.nodeClassName)"\n          [ngClass]="{ strong: isFocusedNode(node) }"\n        ></i>\n        {{ node.displayName }}\n      </span>\n    </cdk-nested-tree-node>\n    \x3c!-- This is the tree node template for expandable nodes --\x3e\n    <cdk-nested-tree-node *cdkTreeNodeDef="let node; when: hasChild">\n      <div class="flex-row">\n        <button\n          cdkTreeNodeToggle\n          class="btn-clean text-primary m-r-4"\n          [disabled]="node.currentlyLoadingChildren"\n        >\n          <i\n            [ngClass]="{ \'dlt-c8y-icon-plus-square\': !node.expanded, \'dlt-c8y-icon-minus-square\': node.expanded }"\n          ></i>\n        </button>\n        <i\n          class="m-r-4 interact"\n          [c8yIcon]="getIcon(node.nodeClassName)"\n        ></i>\n        <span\n          (click)="toggleFocusedNode(node)"\n          [ngClass]="{ strong: isFocusedNode(node) }"\n          class="interact"\n        >\n          {{ node.displayName }}\n        </span>\n        <span\n          class="m-l-4"\n          [style.visibility]="node.currentlyLoadingChildren ? \'visible\' : \'hidden\'"\n        >\n          <i class="dlt-c8y-icon-circle-o-notch icon-spin"></i>\n        </span>\n      </div>\n      <ng-container cdkTreeNodeOutlet></ng-container>\n    </cdk-nested-tree-node>\n  </cdk-tree>\n</div>\n<div class="p-8" *ngIf="loading">\n  <div class="spinner p-relative">\n    <div class="rect1"></div>\n    <div class="rect2"></div>\n    <div class="rect3"></div>\n    <div class="rect4"></div>\n    <div class="rect5"></div>\n  </div>\n</div>\n<div class="alert alert-info m-t-16" *ngIf="!dataSource && !loading" translate>\n  No source data available to fetch address space.\n</div>\n'})],e)}(),z=function(){function e(e){this.inventoryService=e,this.opcuaServers=[],this.selectedItems=[],this.filteredList=[],this.checked={},this.sizeToShowFilter=5,this.constraints={browsePathMatchesRegex:"",matchesNodeIds:[],serverObjectHasFragment:"",matchesServerIds:[]},this.placeholderSelectServerIds=a.gettext("Select server IDs from list"),this.updateSelectedItem=new t.EventEmitter}return e.prototype.ngOnInit=function(){return C(this,void 0,void 0,(function(){var e,t,n=this;return x(this,(function(i){switch(i.label){case 0:return[4,this.inventoryService.list({pageSize:1e3,withTotalPages:!0,type:"c8y_OpcuaServer"})];case 1:return e=i.sent().data,this.opcuaServers=e,this.filteredList=e,this.selectedItems=[],t=this.constraints.matchesServerIds,e.forEach((function(e){t&&t.length>0&&t.find((function(t){return t===e.id}))&&(n.selectedItems.push(e),n.checked[e.id]=!0,n.showServerIds=!0)})),[2]}}))}))},Object.defineProperty(e.prototype,"model",{get:function(){return this._model},set:function(e){e&&e.applyConstraints&&(this.constraints=e.applyConstraints),this._model=e},enumerable:!0,configurable:!0}),e.prototype.serverIdsSelected=function(e){this.constraints&&(this.constraints.matchesServerIds=e.map((function(e){return e.id}))),this.selectedItems=e},e.prototype.onChangeNodeId=function(e){e.target.checked?(this.showRootNodes=!0,this.add()):(this.showRootNodes=!1,this.constraints.matchesNodeIds=[])},e.prototype.onChangeShowServerIds=function(e){e.target.checked?this.showServerIds=!0:(this.constraints.matchesServerIds=[],this.showServerIds=!1,this.selectedItems=[],this.checked={})},e.prototype.onChangeShowBrowsePath=function(e){e.target.checked?this.showBrowsePath=!0:(this.constraints.browsePathMatchesRegex="",this.showBrowsePath=!1)},e.prototype.onChangeShowServerFragment=function(e){e.target.checked?this.showServerFragment=!0:(this.constraints.serverObjectHasFragment="",this.showServerFragment=!1)},e.prototype.add=function(){this.constraints.matchesNodeIds.push("")},e.prototype.remove=function(e){this.constraints.matchesNodeIds.splice(e,1)},e.prototype.trackByFn=function(e,t){return e},e.prototype.updateConstraints=function(e){this.constraints&&(this.constraints.matchesServerIds=e.map((function(e){return e.id})))},e.prototype.filterItems=function(e){if(0!==e.length){var t=new RegExp(e,"i");this.filteredList=this.opcuaServers.filter((function(e){var n=e.name,i=e.id;return t.test(n)||t.test(i)}))}else this.filteredList=this.opcuaServers},e.prototype.isChecked=function(e){return this.checked[e.id]},e.prototype.onSelect=function(e,t){e?(this.selectedItems.push(t),this.checked[t.id]=e):(this.selectedItems=i.reject(this.selectedItems,{id:t.id}),delete this.checked[t.id]),this.updateSelectedItem.emit(!0),this.updateConstraints(this.selectedItems)},e.ctorParameters=function(){return[{type:s.InventoryService}]},N([t.Input()],e.prototype,"model",null),e=N([t.Component({selector:"opcua-auto-apply",template:'<div class="row">\n  <div class="col-md-4">\n    <p translate>\n      Specifying auto-apply constraints allows you to limit the scope where the device protocols are\n      applied, for example by specifying a set of possible servers or node IDs.\n    </p>\n    <p translate>\n      If no constraints are set, device protocols are applied at any fitting location on the OPC UA\n      server.\n    </p>\n  </div>\n\n  <div class="col-md-6">\n    <ul class="list-group" style="box-shadow: none;">\n      \x3c!-- Limit device type to a set of servers --\x3e\n      <li class="list-group-item">\n        <label\n          title="{{ \'Limit device protocol to a set of servers\' | translate }}"\n          class="c8y-checkbox"\n        >\n          <input\n            type="checkbox"\n            [checked]="\n              constraints.matchesServerIds !== null && constraints.matchesServerIds.length > 0\n            "\n            (change)="onChangeShowServerIds($event)"\n          />\n          <span></span>\n          <span class="m-l-8">\n            {{ \'Limit device protocol to a set of servers\' | translate }}\n          </span>\n        </label>\n        <div\n          class="collapse"\n          [collapse]="\n            (!showServerIds &&\n              (constraints.matchesServerIds !== null && constraints.matchesServerIds.length < 1)) ||\n            (!showServerIds && constraints.matchesServerIds === null)\n          "\n        >\n          <c8y-form-group>\n            <c8y-select\n              [items]="opcuaServers"\n              [selected]="selectedItems"\n              [placeholder]="placeholderSelectServerIds"\n              (onChange)="serverIdsSelected($event)"\n              [updateItems]="updateSelectedItem"\n            >\n              <c8y-li *ngIf="opcuaServers.length > sizeToShowFilter">\n                <div class="p-l-8 p-r-8">\n                 <c8y-filter [icon]="\'search\'"  (onSearch)="filterItems($event)"></c8y-filter>\n                </div>\n              </c8y-li>\n              <c8y-li *ngIf="filteredList && filteredList.length === 0">\n                <c8y-li-body> \n                  <div class="c8y-empty-state text-left">\n                  <p>{{ \'No items to display.\' | translate }}</p>\n                </div>\n                </c8y-li-body>\n              </c8y-li>\n              <c8y-li *ngFor="let item of filteredList">\n                <c8y-li-checkbox\n                  [selected]="isChecked(item)"\n                  (onSelect)="onSelect($event, item)"\n                ></c8y-li-checkbox>\n                <c8y-li-body>{{ item.name | translate }}<br>\n                  <span class="text-label-small m-r-4" translate>ID</span> <small>{{ item.id }}</small>\n                </c8y-li-body>\n              </c8y-li>\n            </c8y-select>\n          </c8y-form-group>\n        </div>\n      </li>\n      \x3c!-- Limit device type scope in the address space --\x3e\n      <li class="list-group-item">\n        <label\n          title="{{ \'Limit device protocol scope in the address space\' | translate }}"\n          class="c8y-checkbox"\n        >\n          <input\n            type="checkbox"\n            [checked]="\n              constraints.browsePathMatchesRegex !== null &&\n              constraints.browsePathMatchesRegex.length > 0\n            "\n            (change)="onChangeShowBrowsePath($event)"\n          />\n          <span></span>\n          <span class="m-l-8">\n            {{ \'Limit device protocol scope in the address space\' | translate }}\n          </span>\n        </label>\n        <div\n          class="collapse"\n          [isAnimated]="true"\n          [collapse]="\n            (!showBrowsePath &&\n              constraints.browsePathMatchesRegex !== null &&\n              constraints.browsePathMatchesRegex.length < 1) ||\n            (!showBrowsePath && constraints.browsePathMatchesRegex === null)\n          "\n        >\n          <c8y-form-group class="m-t-8 m-b-8">\n            <input\n              name="browsePath"\n              type="text"\n              class="form-control"\n              placeholder="{{ \'e.g.\' | translate }} /objects/devices/.*"\n              [(ngModel)]="constraints.browsePathMatchesRegex"\n              ngDefaultControl\n            />\n          </c8y-form-group>\n        </div>\n      </li>\n      \x3c!-- Limit device type to servers with a certain fragment--\x3e\n      <li class="list-group-item">\n        <label\n          title="{{ \'Limit device protocol to servers with a certain fragment\' | translate }}"\n          class="c8y-checkbox"\n        >\n          <input\n            type="checkbox"\n            [checked]="constraints.serverObjectHasFragment !== null && constraints.serverObjectHasFragment.length > 0"\n            (change)="onChangeShowServerFragment($event)"\n          />\n          <span></span>\n          <span class="m-l-8">\n            {{ \'Limit device protocol to servers with a certain fragment\' | translate }}\n          </span>\n        </label>\n        <div\n          class="collapse"\n          [isAnimated]="true"\n          [collapse]="(!showServerFragment && constraints.serverObjectHasFragment !== null && constraints.serverObjectHasFragment.length < 1) || (!showServerFragment && constraints.serverObjectHasFragment === null)"\n        >\n          <c8y-form-group class="m-t-8 m-b-8">\n            <input\n              name="serverFragment"\n              type="text"\n              class="form-control"\n              placeholder="{{ \'e.g.\' | translate }} c8y_SomeServerMarker"\n              [(ngModel)]="constraints.serverObjectHasFragment"\n              ngDefaultControl\n            />\n          </c8y-form-group>\n        </div>\n      </li>\n      \x3c!-- Limit device type to a specific root node ID --\x3e\n      <li class="list-group-item">\n        <label\n          title="{{ \'Limit device protocol to specific root nodes ID\' | translate }}"\n          class="c8y-checkbox"\n        >\n          <input\n            type="checkbox"\n            [checked]="constraints.matchesNodeIds !== null && constraints.matchesNodeIds.length > 0"\n            (change)="onChangeNodeId($event)"\n          />\n          <span></span>\n          <span class="m-l-8">\n            {{ \'Limit device protocol to specific root nodes ID\' | translate }}\n          </span>\n        </label>\n        <div\n          class="collapse"\n          [isAnimated]="true"\n          [collapse]="(!showRootNodes && constraints.matchesNodeIds !== null && constraints.matchesNodeIds.length < 1) || ( !showRootNodes && constraints.matchesNodeIds === null)"\n        >\n            <ul c8yInputGroupListContainer class="list-unstyled p-t-16">\n              <li\n                class="m-b-8"\n                *ngFor="let item of constraints.matchesNodeIds; let i = index; trackBy: trackByFn"\n              >\n                <c8y-input-group-list [index]="i" (onAdd)="add()" (onRemove)="remove($event)">\n                  <c8y-form-group class="form-group--tooltip-validation">\n                    <input\n                      type="text"\n                      class="form-control"\n                      placeholder="{{ \'e.g.\' | translate }} nodeId"\n                      [(ngModel)]="constraints.matchesNodeIds[i]"\n                      [required]="true"\n                    />\n                  </c8y-form-group>\n                </c8y-input-group-list>\n              </li>\n            </ul> \n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n'})],e)}(),W=[{context:a.ViewContext.Device,path:"opcua-servers",component:G,label:a.gettext("OPC UA server"),icon:"server",canActivate:[R,L]},{context:a.ViewContext.Device,path:"address-space",component:q,label:a.gettext("Address space"),icon:"cloud-network",canActivate:[V,L]}],Y=[{path:"deviceprotocols/opcuaV2/:id",component:j}],J=W,Q=function(){function e(){}return e=N([t.NgModule({declarations:[G,U,B,q,H,O,K,j,_,T,E,k,F,z,D],imports:[a.CoreModule,a.FormsModule,n.ReactiveFormsModule,a.DropAreaModule,d.ButtonsModule,l.CdkTreeModule,r.RouterModule.forRoot(Y,{useHash:!0}),g.TooltipModule.forRoot(),m.PopoverModule.forRoot(),a.DeviceStatusModule,y.BrowserAnimationsModule,h.CollapseModule.forRoot(),v.BsDropdownModule.forRoot()],entryComponents:[H,q,G],providers:[R,V,L,A,M,{provide:a.HOOK_ONCE_ROUTE,useValue:J,multi:!0}]})],e)}(),Z=c.downgradeComponent({component:H,inputs:["moId"],outputs:["selectedNode"]}),X="c8y.upgrade.opcua",ee=(b.module(X,[]).directive("c8yOpcuaAddressSpaceTree",Z),[X]);S.registerNgModule(ee),e.AddressSpaceService=M,e.DynamicDataSource=$,e.OpcuaAddressSpaceComponent=q,e.OpcuaAddressSpaceDetailComponent=O,e.OpcuaAddressSpaceTreeComponent=H,e.OpcuaAgentGuard=R,e.OpcuaAutoApplySettingsComponent=z,e.OpcuaDeviceProtocolBrowsePathValidation=D,e.OpcuaDeviceProtocolDataReportingComponent=_,e.OpcuaDeviceProtocolDescription=K,e.OpcuaDeviceProtocolDetailComponent=j,e.OpcuaDeviceProtocolMapping=T,e.OpcuaDeviceProtocolMappingCustomAction=k,e.OpcuaDeviceProtocolObjectMapping=E,e.OpcuaDeviceProtocolObjectMappingStatus=F,e.OpcuaMicroserviceGuard=L,e.OpcuaProtocolModule=Q,e.OpcuaServerConfigComponent=B,e.OpcuaServerGuard=V,e.OpcuaServerListComponent=U,e.OpcuaServersComponent=G,e.OpcuaService=A,e.ng1Modules=ee,e.Éµ0=J,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=c8y-ngx-components-protocol-opcua.umd.min.js.map