import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { NgModelGroup, ControlContainer } from '@angular/forms';
import { get } from 'lodash-es';
var OpcuaDeviceProtocolMappingCustomAction = /** @class */ (function () {
    function OpcuaDeviceProtocolMappingCustomAction() {
        this.hasCustomAction = false;
        // no translation needed
        this.placeholders = '${value}, ${serverId}, ${nodeId}, ${deviceId}';
    }
    OpcuaDeviceProtocolMappingCustomAction.prototype.getHeaderPair = function () {
        return { key: '', value: '' };
    };
    Object.defineProperty(OpcuaDeviceProtocolMappingCustomAction.prototype, "headers", {
        get: function () {
            return this.customAction.headers;
        },
        enumerable: true,
        configurable: true
    });
    OpcuaDeviceProtocolMappingCustomAction.prototype.addHeader = function () {
        var headers = this.customAction.headers;
        headers.push(this.getHeaderPair());
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.updateCustomAction = function () {
        this.hasCustomAction = !this.hasCustomAction;
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.removeCustomAction = function (index) {
        var headers = this.customAction.headers;
        headers.splice(index, 1);
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.trackByIndex = function (index) {
        return index;
    };
    OpcuaDeviceProtocolMappingCustomAction.prototype.ngOnInit = function () {
        if (get(this.customAction, 'endpoint')) {
            this.hasCustomAction = true;
        }
    };
    tslib_1.__decorate([
        Input()
    ], OpcuaDeviceProtocolMappingCustomAction.prototype, "customAction", void 0);
    OpcuaDeviceProtocolMappingCustomAction = tslib_1.__decorate([
        Component({
            selector: 'opcua-device-protocol-mapping-customaction',
            template: "<div class=\"list-group\">\n  <div class=\"list-group-item\">\n    <div class=\"flex-row\">\n      <div class=\"list-item-switch\">\n        <label class=\"c8y-switch\">\n          <input\n            type=\"checkbox\"\n            name=\"hasCustomAction\"\n            [(ngModel)]=\"hasCustomAction\"\n            (click)=\"updateCustomAction()\"\n          />\n          <span></span>\n        </label>\n      </div>\n      <div class=\"list-item-icon\">\n        <i c8yIcon=\"wrench\"></i>\n      </div>\n      <div class=\"list-item-title\" translate>\n        Custom action\n      </div>\n    </div>\n    <div [collapse]=\"!hasCustomAction\" [isAnimated]=\"true\">\n      <div class=\"p-t-8\" *ngIf=\"hasCustomAction\">\n        <fieldset ngModelGroup=\"headers\">\n          <div class=\"legend form-block\" translate>Headers</div>\n          <div class=\"tight-grid flex-row hidden-xs\">\n            <div class=\"col-sm-4\">\n              <label translate>Key</label>\n            </div>\n            <div class=\"col-sm-4\">\n              <label translate>Value</label>\n            </div>\n          </div>\n          <div\n            *ngFor=\"let header of headers; trackBy: trackByIndex; let i = index; last as isLast\"\n            class=\"flex-row tight-grid row\"\n            [ngModelGroup]=\"i\"\n          >\n            <div class=\"col-xs-5 col-sm-4\">\n              <c8y-form-group class=\"form-group-sm\">\n                <label class=\"visible-xs\" translate>Key</label>\n                <div class=\"input-group\">\n                  <input\n                    class=\"form-control\"\n                    type=\"text\"\n                    name=\"key\"\n                    placeholder=\"{{ 'e.g.' | translate }} Content-Type\"\n                    required\n                    [(ngModel)]=\"header.key\"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-xs-5 col-sm-4\">\n              <c8y-form-group class=\"form-group-sm\">\n                <label class=\"visible-xs\" translate>Value</label>\n                <div class=\"input-group\">\n                  <input\n                    class=\"form-control\"\n                    type=\"text\"\n                    name=\"value\"\n                    placeholder=\"{{ 'e.g.' | translate }} application/json\"\n                    required\n                    [(ngModel)]=\"header.value\"\n                  />\n                </div>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-xs-2\">\n              <div class=\"form-group\">\n                <label class=\"visible-xs\">&nbsp;</label>\n                <button class=\"btn btn-clean\" *ngIf=\"customAction.headers.length !== 1\">\n                  <i c8yIcon=\"minus-circle\" class=\"text-danger\" (click)=\"removeCustomAction(i)\"></i>\n                </button>\n                <button class=\"btn btn-clean\" *ngIf=\"isLast\">\n                  <i c8yIcon=\"plus-circle\" class=\"text-primary\" (click)=\"addHeader()\"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </fieldset>\n        <div class=\"legend form-block\" translate>Action</div>\n        <div class=\"row\">\n          <div class=\"col-md-4\">\n            <c8y-form-group class=\"form-group-sm\">\n              <label>\n                <span translate>Endpoint</span>\n              </label>\n              <div class=\"input-group\">\n                <input\n                  class=\"form-control\"\n                  type=\"text\"\n                  name=\"endpoint\"\n                  placeholder=\"{{ 'e.g.' | translate }} http://localhost:1080/cucumber\"\n                  required\n                  [(ngModel)]=\"customAction.endpoint\"\n                />\n              </div>\n            </c8y-form-group>\n          </div>\n          <div class=\"col-md-4\">\n            <c8y-form-group class=\"form-group-sm\">\n              <label translate>Body template</label>\n              <textarea\n                #model='ngModel'\n                [heightPerRow]=\"40\"\n                class=\"form-control\"\n                rows=\"3\"\n                name=\"bodyTemplate\"\n                placeholder=\"({{'required' | translate}})\"\n                [(ngModel)]=\"customAction.bodyTemplate\"\n                required\n              ></textarea>\n              <div class=\"help-block\" *ngIf=\"model.untouched || !model.errors\">\n                {{ 'The following placeholders are available:' | translate }} {{ placeholders }}\n              </div>\n            </c8y-form-group>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
            viewProviders: [{ provide: ControlContainer, useExisting: NgModelGroup }]
        })
    ], OpcuaDeviceProtocolMappingCustomAction);
    return OpcuaDeviceProtocolMappingCustomAction;
}());
export { OpcuaDeviceProtocolMappingCustomAction };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtZGV2aWNlLXByb3RvY29sLW1hcHBpbmctY3VzdG9tYWN0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvcHJvdG9jb2wtb3BjdWEvIiwic291cmNlcyI6WyJvcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy1jdXN0b21hY3Rpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQU9oQztJQUxBO1FBU0Usb0JBQWUsR0FBRyxLQUFLLENBQUM7UUFDeEIsd0JBQXdCO1FBQ2YsaUJBQVksR0FBVywrQ0FBK0MsQ0FBQztJQWlDbEYsQ0FBQztJQS9CQyw4REFBYSxHQUFiO1FBQ0UsT0FBTyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFDRCxzQkFBSSwyREFBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQztRQUNuQyxDQUFDOzs7T0FBQTtJQUVELDBEQUFTLEdBQVQ7UUFDVSxJQUFBLG1DQUFPLENBQXVCO1FBQ3RDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELG1FQUFrQixHQUFsQjtRQUNFLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQy9DLENBQUM7SUFFRCxtRUFBa0IsR0FBbEIsVUFBbUIsS0FBSztRQUNkLElBQUEsbUNBQU8sQ0FBdUI7UUFFdEMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELDZEQUFZLEdBQVosVUFBYSxLQUFhO1FBQ3hCLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVELHlEQUFRLEdBQVI7UUFDRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1NBQzdCO0lBQ0gsQ0FBQztJQXBDUTtRQUFSLEtBQUssRUFBRTtnRkFBYztJQUZYLHNDQUFzQztRQUxsRCxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsNENBQTRDO1lBQ3RELGtxSkFBZ0U7WUFDaEUsYUFBYSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxDQUFDO1NBQzFFLENBQUM7T0FDVyxzQ0FBc0MsQ0F1Q2xEO0lBQUQsNkNBQUM7Q0FBQSxBQXZDRCxJQXVDQztTQXZDWSxzQ0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nTW9kZWxHcm91cCwgQ29udHJvbENvbnRhaW5lciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ29wY3VhLWRldmljZS1wcm90b2NvbC1tYXBwaW5nLWN1c3RvbWFjdGlvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGN1YS1kZXZpY2UtcHJvdG9jb2wtbWFwcGluZy1jdXN0b21hY3Rpb24uaHRtbCcsXG4gIHZpZXdQcm92aWRlcnM6IFt7IHByb3ZpZGU6IENvbnRyb2xDb250YWluZXIsIHVzZUV4aXN0aW5nOiBOZ01vZGVsR3JvdXAgfV1cbn0pXG5leHBvcnQgY2xhc3MgT3BjdWFEZXZpY2VQcm90b2NvbE1hcHBpbmdDdXN0b21BY3Rpb24gaW1wbGVtZW50cyBPbkluaXQge1xuICBfbW9kZWw6IGFueTtcbiAgQElucHV0KCkgY3VzdG9tQWN0aW9uO1xuXG4gIGhhc0N1c3RvbUFjdGlvbiA9IGZhbHNlO1xuICAvLyBubyB0cmFuc2xhdGlvbiBuZWVkZWRcbiAgcmVhZG9ubHkgcGxhY2Vob2xkZXJzOiBzdHJpbmcgPSAnJHt2YWx1ZX0sICR7c2VydmVySWR9LCAke25vZGVJZH0sICR7ZGV2aWNlSWR9JztcblxuICBnZXRIZWFkZXJQYWlyKCkge1xuICAgIHJldHVybiB7IGtleTogJycsIHZhbHVlOiAnJyB9O1xuICB9XG4gIGdldCBoZWFkZXJzKCkge1xuICAgIHJldHVybiB0aGlzLmN1c3RvbUFjdGlvbi5oZWFkZXJzO1xuICB9XG5cbiAgYWRkSGVhZGVyKCkge1xuICAgIGNvbnN0IHsgaGVhZGVycyB9ID0gdGhpcy5jdXN0b21BY3Rpb247XG4gICAgaGVhZGVycy5wdXNoKHRoaXMuZ2V0SGVhZGVyUGFpcigpKTtcbiAgfVxuXG4gIHVwZGF0ZUN1c3RvbUFjdGlvbigpIHtcbiAgICB0aGlzLmhhc0N1c3RvbUFjdGlvbiA9ICF0aGlzLmhhc0N1c3RvbUFjdGlvbjtcbiAgfVxuXG4gIHJlbW92ZUN1c3RvbUFjdGlvbihpbmRleCkge1xuICAgIGNvbnN0IHsgaGVhZGVycyB9ID0gdGhpcy5jdXN0b21BY3Rpb247XG5cbiAgICBoZWFkZXJzLnNwbGljZShpbmRleCwgMSk7XG4gIH1cblxuICB0cmFja0J5SW5kZXgoaW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKGdldCh0aGlzLmN1c3RvbUFjdGlvbiwgJ2VuZHBvaW50JykpIHtcbiAgICAgIHRoaXMuaGFzQ3VzdG9tQWN0aW9uID0gdHJ1ZTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==