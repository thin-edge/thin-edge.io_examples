import * as tslib_1 from "tslib";
import { BaseDeviceGridColumn } from './base.device-grid-column';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
import { PushStatus, SendStatus, gettext } from '@c8y/ngx-components';
var StatusDeviceGridColumn = /** @class */ (function (_super) {
    tslib_1.__extends(StatusDeviceGridColumn, _super);
    function StatusDeviceGridColumn() {
        var _a, _b, _c, _d, _e, _f, _g;
        var _this = _super.call(this) || this;
        var responseIntervalPath = 'c8y_RequiredAvailability.responseInterval';
        var responseIntervalLessThanOrEqualTo0 = (_a = {}, _a[responseIntervalPath] = { __le: 0 }, _a);
        var responseIntervalNotDefined = { __not: { __has: responseIntervalPath } };
        var availabilityStatusPath = 'c8y_Availability.status';
        var availabilityStatusAvailable = (_b = {}, _b[availabilityStatusPath] = SendStatus.AVAILABLE, _b);
        var availabilityStatusUnavailable = (_c = {}, _c[availabilityStatusPath] = SendStatus.UNAVAILABLE, _c);
        var availabilityStatusMaintenance = (_d = {}, _d[availabilityStatusPath] = SendStatus.MAINTENANCE, _d);
        var availabilityStatusNotDefined = { __not: { __has: availabilityStatusPath } };
        var connectionStatusPath = 'c8y_Connection.status';
        var connectionStatusConnected = (_e = {}, _e[connectionStatusPath] = PushStatus.CONNECTED, _e);
        var connectionStatusDisconnected = (_f = {}, _f[connectionStatusPath] = PushStatus.DISCONNECTED, _f);
        var connectionStatusMaintenance = (_g = {}, _g[connectionStatusPath] = PushStatus.MAINTENANCE, _g);
        var deviceUnderMaintenance = {
            __or: [
                responseIntervalLessThanOrEqualTo0,
                availabilityStatusMaintenance,
                connectionStatusMaintenance
            ]
        };
        var deviceNotUnderMaintenance = {
            // using __and of __nots because backend does not support __not with __ors
            __and: [
                { __not: responseIntervalLessThanOrEqualTo0 },
                { __not: availabilityStatusMaintenance },
                { __not: connectionStatusMaintenance }
            ]
        };
        _this.name = 'status';
        _this.header = gettext('Status');
        _this.dataType = "icon" /* Icon */;
        _this.cellRendererComponent = StatusCellRendererComponent;
        _this.filterable = true;
        _this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendOnline: {
                        type: 'boolean'
                    },
                    sendOffline: {
                        type: 'boolean'
                    },
                    sendUnknown: {
                        type: 'boolean'
                    },
                    sendNotMonitored: {
                        type: 'boolean'
                    },
                    pushOnline: {
                        type: 'boolean'
                    },
                    pushOffline: {
                        type: 'boolean'
                    },
                    pushNotMonitored: {
                        type: 'boolean'
                    },
                    maintenance: {
                        type: 'boolean'
                    }
                }
            },
            form: [
                {
                    type: 'template',
                    template: "<label><span translate>" + gettext('Show devices with send status') + "</span>:</label>"
                },
                {
                    key: 'sendOnline',
                    title: gettext('Online')
                },
                {
                    key: 'sendOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'sendUnknown',
                    title: gettext('Unknown')
                },
                {
                    key: 'sendNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: "<label><span translate>" + gettext('Show devices with push status') + "</span>:</label>"
                },
                {
                    key: 'pushOnline',
                    title: gettext('Online')
                },
                {
                    key: 'pushOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'pushNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: "<label><span translate>" + gettext('Show devices with maintenance status') + "</span>:</label>"
                },
                {
                    key: 'maintenance',
                    title: gettext('Device is under maintenance')
                }
            ],
            getFilter: function (model) {
                var filter = {};
                var ors = [];
                if (model) {
                    if (model.sendOnline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, availabilityStatusAvailable]
                        });
                    }
                    if (model.sendOffline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, availabilityStatusUnavailable]
                        });
                    }
                    if (model.sendUnknown) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, availabilityStatusNotDefined]
                        });
                    }
                    if (model.sendNotMonitored || model.pushNotMonitored) {
                        ors.push(responseIntervalNotDefined);
                    }
                    if (model.pushOnline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, connectionStatusConnected]
                        });
                    }
                    if (model.pushOffline) {
                        ors.push({
                            __and: [deviceNotUnderMaintenance, connectionStatusDisconnected]
                        });
                    }
                    if (model.maintenance) {
                        ors.push(deviceUnderMaintenance);
                    }
                    if (ors.length) {
                        filter.__or = ors;
                    }
                }
                return filter;
            }
        };
        _this.sortable = true;
        _this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
        return _this;
    }
    return StatusDeviceGridColumn;
}(BaseDeviceGridColumn));
export { StatusDeviceGridColumn };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvZGV2aWNlLWdyaWQvIiwic291cmNlcyI6WyJjb2x1bW5zL3N0YXR1cy5kZXZpY2UtZ3JpZC1jb2x1bW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQy9FLE9BQU8sRUFBa0IsVUFBVSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RjtJQUE0QyxrREFBb0I7SUFDOUQ7O1FBQUEsWUFDRSxpQkFBTyxTQTBLUjtRQXhLQyxJQUFNLG9CQUFvQixHQUFHLDJDQUEyQyxDQUFDO1FBQ3pFLElBQU0sa0NBQWtDLGFBQUssR0FBQyxvQkFBb0IsSUFBRyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsS0FBRSxDQUFDO1FBQ25GLElBQU0sMEJBQTBCLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsb0JBQW9CLEVBQUUsRUFBRSxDQUFDO1FBRTlFLElBQU0sc0JBQXNCLEdBQUcseUJBQXlCLENBQUM7UUFDekQsSUFBTSwyQkFBMkIsYUFBSyxHQUFDLHNCQUFzQixJQUFHLFVBQVUsQ0FBQyxTQUFTLEtBQUUsQ0FBQztRQUN2RixJQUFNLDZCQUE2QixhQUFLLEdBQUMsc0JBQXNCLElBQUcsVUFBVSxDQUFDLFdBQVcsS0FBRSxDQUFDO1FBQzNGLElBQU0sNkJBQTZCLGFBQUssR0FBQyxzQkFBc0IsSUFBRyxVQUFVLENBQUMsV0FBVyxLQUFFLENBQUM7UUFDM0YsSUFBTSw0QkFBNEIsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLENBQUM7UUFFbEYsSUFBTSxvQkFBb0IsR0FBRyx1QkFBdUIs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QUssQ0FBQyxXQUFXLEVBQUU7d0JBQ3JCLEdBQUcsQ0FBQyxJQUFJLENBQUM7NEJBQ1AsS0FBSyxFQUFFLENBQUMseUJBQXlCLEVBQUUsNEJBQTRCLENBQUM7eUJBQ2pFLENBQUMsQ0FBQztxQkFDSjtvQkFDRCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUU7d0JBQ3JCLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztxQkFDbEM7b0JBRUQsSUFBSSxHQUFHLENBQUMsTUFBTSxFQUFFO3dCQUNkLE1BQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO3FCQUNuQjtpQkFDRjtnQkFDRCxPQUFPLE1BQU0sQ0FBQztZQUNoQixDQUFDO1NBQ0YsQ0FBQztRQUVGLEtBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLEtBQUksQ0FBQyxhQUFhLEdBQUc7WUFDbkIsa0JBQWtCLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxDQUFDO1NBQ3ZELENBQUM7O0lBQ0osQ0FBQztJQUNILDZCQUFDO0FBQUQsQ0FBQyxBQTdLRCxDQUE0QyxvQkFBb0IsR0E2Sy9EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZURldmljZUdyaWRDb2x1bW4gfSBmcm9tICcuL2Jhc2UuZGV2aWNlLWdyaWQtY29sdW1uJztcbmltcG9ydCB7IFN0YXR1c0NlbGxSZW5kZXJlckNvbXBvbmVudCB9IGZyb20gJy4vc3RhdHVzLmNlbGwtcmVuZGVyZXIuY29tcG9uZW50JztcbmltcG9ydCB7IENvbHVtbkRhdGFUeXBlLCBQdXNoU3RhdHVzLCBTZW5kU3RhdHVzLCBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5cbmV4cG9ydCBjbGFzcyBTdGF0dXNEZXZpY2VHcmlkQ29sdW1uIGV4dGVuZHMgQmFzZURldmljZUdyaWRDb2x1bW4ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgY29uc3QgcmVzcG9uc2VJbnRlcnZhbFBhdGggPSAnYzh5X1JlcXVpcmVkQXZhaWxhYmlsaXR5LnJlc3BvbnNlSW50ZXJ2YWwnO1xuICAgIGNvbnN0IHJlc3BvbnNlSW50ZXJ2YWxMZXNzVGhhbk9yRXF1YWxUbzAgPSB7IFtyZXNwb25zZUludGVydmFsUGF0aF06IHsgX19sZTogMCB9IH07XG4gICAgY29uc3QgcmVzcG9uc2VJbnRlcnZhbE5vdERlZmluZWQgPSB7IF9fbm90OiB7IF9faGFzOiByZXNwb25zZUludGVydmFsUGF0aCB9IH07XG5cbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNQYXRoID0gJ2M4eV9BdmFpbGFiaWxpdHkuc3RhdHVzJztcbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNBdmFpbGFibGUgPSB7IFthdmFpbGFiaWxpdHlTdGF0dXNQYXRoXTogU2VuZFN0YXR1cy5BVkFJTEFCTEUgfTtcbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNVbmF2YWlsYWJsZSA9IHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiBTZW5kU3RhdHVzLlVOQVZBSUxBQkxFIH07XG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzTWFpbnRlbmFuY2UgPSB7IFthdmFpbGFiaWxpdHlTdGF0dXNQYXRoXTogU2VuZFN0YXR1cy5NQUlOVEVOQU5DRSB9O1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c05vdERlZmluZWQgPSB7IF9fbm90OiB7IF9faGFzOiBhdmFpbGFiaWxpdHlTdGF0dXNQYXRoIH0gfTtcblxuICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXNQYXRoID0gJ2M4eV9Db25uZWN0aW9uLnN0YXR1cyc7XG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c0Nvbm5lY3RlZCA9IHsgW2Nvbm5lY3Rpb25TdGF0dXNQYXRoXTogUHVzaFN0YXR1cy5DT05ORUNURUQgfTtcbiAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzRGlzY29ubmVjdGVkID0geyBbY29ubmVjdGlvblN0YXR1c1BhdGhdOiBQdXNoU3RhdHVzLkRJU0NPTk5FQ1RFRCB9O1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXNNYWludGVuYW5jZSA9IHsgW2Nvbm5lY3Rpb25TdGF0dXNQYXRoXTogUHVzaFN0YXR1cy5NQUlOVEVOQU5DRSB9O1xuXG4gICAgY29uc3QgZGV2aWNlVW5kZXJNYWludGVuYW5jZSA9IHtcbiAgICAgIF9fb3I6IFtcbiAgICAgICAgcmVzcG9uc2VJbnRlcnZhbExlc3NUaGFuT3JFcXVhbFRvMCxcbiAgICAgICAgYXZhaWxhYmlsaXR5U3RhdHVzTWFpbnRlbmFuY2UsXG4gICAgICAgIGNvbm5lY3Rpb25TdGF0dXNNYWludGVuYW5jZVxuICAgICAgXVxuICAgIH07XG4gICAgY29uc3QgZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSA9IHtcbiAgICAgIC8vIHVzaW5nIF9fYW5kIG9mIF9fbm90cyBiZWNhdXNlIGJhY2tlbmQgZG9lcyBub3Qgc3VwcG9ydCBfX25vdCB3aXRoIF9fb3JzXG4gICAgICBfX2FuZDogW1xuICAgICAgICB7IF9fbm90OiByZXNwb25zZUludGVydmFsTGVzc1RoYW5PckVxdWFsVG8wIH0sXG4gICAgICAgIHsgX19ub3Q6IGF2YWlsYWJpbGl0eVN0YXR1c01haW50ZW5hbmNlIH0sXG4gICAgICAgIHsgX19ub3Q6IGNvbm5lY3Rpb25TdGF0dXNNYWludGVuYW5jZSB9XG4gICAgICBdXG4gICAgfTtcblxuICAgIHRoaXMubmFtZSA9ICdzdGF0dXMnO1xuICAgIHRoaXMuaGVhZGVyID0gZ2V0dGV4dCgnU3RhdHVzJyk7XG4gICAgdGhpcy5kYXRhVHlwZSA9IENvbHVtbkRhdGFUeXBlLkljb247XG4gICAgdGhpcy5jZWxsUmVuZGVyZXJDb21wb25lbnQgPSBTdGF0dXNDZWxsUmVuZGVyZXJDb21wb25lbnQ7XG5cbiAgICB0aGlzLmZpbHRlcmFibGUgPSB0cnVlO1xuICAgIHRoaXMuZmlsdGVyaW5nQ29uZmlnID0ge1xuICAgICAgc2NoZW1hOiB7XG4gICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgc2VuZE9ubGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kT2ZmbGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kVW5rbm93bjoge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHB1c2hPbmxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaE9mZmxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaE5vdE1vbml0b3JlZDoge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYWludGVuYW5jZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZm9ybTogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ3RlbXBsYXRlJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogYDxsYWJlbD48c3BhbiB0cmFuc2xhdGU+JHtnZXR0ZXh0KFxuICAgICAgICAgICAgJ1Nob3cgZGV2aWNlcyB3aXRoIHNlbmQgc3RhdHVzJ1xuICAgICAgICAgICl9PC9zcGFuPjo8L2xhYmVsPmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmRPbmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPbmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnc2VuZE9mZmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPZmZsaW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmRVbmtub3duJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnVW5rbm93bicpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kTm90TW9uaXRvcmVkJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnTm90IG1vbml0b3JlZCcpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAndGVtcGxhdGUnLFxuICAgICAgICAgIHRlbXBsYXRlOiBgPGxhYmVsPjxzcGFuIHRyYW5zbGF0ZT4ke2dldHRleHQoXG4gICAgICAgICAgICAnU2hvdyBkZXZpY2VzIHdpdGggcHVzaCBzdGF0dXMnXG4gICAgICAgICAgKX08L3NwYW4+OjwvbGFiZWw+YFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAncHVzaE9ubGluZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09ubGluZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdwdXNoT2ZmbGluZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09mZmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAncHVzaE5vdE1vbml0b3JlZCcsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ05vdCBtb25pdG9yZWQnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ3RlbXBsYXRlJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogYDxsYWJlbD48c3BhbiB0cmFuc2xhdGU+JHtnZXR0ZXh0KFxuICAgICAgICAgICAgJ1Nob3cgZGV2aWNlcyB3aXRoIG1haW50ZW5hbmNlIHN0YXR1cydcbiAgICAgICAgICApfTwvc3Bhbj46PC9sYWJlbD5gXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdtYWludGVuYW5jZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ0RldmljZSBpcyB1bmRlciBtYWludGVuYW5jZScpXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICBnZXRGaWx0ZXIobW9kZWwpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyOiBhbnkgPSB7fTtcbiAgICAgICAgY29uc3Qgb3JzID0gW107XG5cbiAgICAgICAgaWYgKG1vZGVsKSB7XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRPbmxpbmUpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBhdmFpbGFiaWxpdHlTdGF0dXNBdmFpbGFibGVdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRPZmZsaW5lKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgYXZhaWxhYmlsaXR5U3RhdHVzVW5hdmFpbGFibGVdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRVbmtub3duKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgYXZhaWxhYmlsaXR5U3RhdHVzTm90RGVmaW5lZF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwuc2VuZE5vdE1vbml0b3JlZCB8fCBtb2RlbC5wdXNoTm90TW9uaXRvcmVkKSB7XG4gICAgICAgICAgICBvcnMucHVzaChyZXNwb25zZUludGVydmFsTm90RGVmaW5lZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5wdXNoT25saW5lKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgY29ubmVjdGlvblN0YXR1c0Nvbm5lY3RlZF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwucHVzaE9mZmxpbmUpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19hbmQ6IFtkZXZpY2VOb3RVbmRlck1haW50ZW5hbmNlLCBjb25uZWN0aW9uU3RhdHVzRGlzY29ubmVjdGVkXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5tYWludGVuYW5jZSkge1xuICAgICAgICAgICAgb3JzLnB1c2goZGV2aWNlVW5kZXJNYWludGVuYW5jZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZpbHRlci5fX29yID0gb3JzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlsdGVyO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnNvcnRhYmxlID0gdHJ1ZTtcbiAgICB0aGlzLnNvcnRpbmdDb25maWcgPSB7XG4gICAgICBwYXRoU29ydGluZ0NvbmZpZ3M6IFt7IHBhdGg6IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggfV1cbiAgICB9O1xuICB9XG59XG4iXX0=