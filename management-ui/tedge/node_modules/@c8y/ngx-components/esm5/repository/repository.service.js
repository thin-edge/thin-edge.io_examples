import * as tslib_1 from "tslib";
import { of, from, throwError, merge } from 'rxjs';
import { map, switchMap, takeWhile, take, filter, withLatestFrom } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { isNil, isUndefined, assign, set, head, get, isString, pick, cloneDeep, remove, find, forEach, map as _map } from 'lodash-es';
import { AlertService, gettext } from '@c8y/ngx-components';
import { InventoryService, InventoryBinaryService, IResult, IManagedObject, IManagedObjectBinary, IIdentified, QueriesUtil, IResultList, IFetchResponse, IOperation, OperationService, Realtime, OperationStatus, IEvent, EventService, EventBinaryService, IdReference } from '@c8y/client';
import { RepositoryType, REPOSITORY_BINARY_TYPES } from './repository.model';
var RepositoryService = /** @class */ (function () {
    function RepositoryService(inventory, inventoryBinary, operation, alert, event, realtime, eventBinary) {
        this.inventory = inventory;
        this.inventoryBinary = inventoryBinary;
        this.operation = operation;
        this.alert = alert;
        this.event = event;
        this.realtime = realtime;
        this.eventBinary = eventBinary;
        this.dateFrom = new Date(0);
        this.dateTo = new Date(Date.now() + 86400000); // 1 day in the future
        this.queriesUtil = new QueriesUtil();
    }
    /**
     * Lists repository entries of given type.
     * @param type The type of repository entries to list.
     * @param options Extra listing options.
     */
    RepositoryService.prototype.listRepositoryEntries = function (type, options) {
        var defaultOrder = [{ name: 1 }];
        var defaultFilters = { type: type };
        var legacyFilters = { __has: "url" };
        var filters = {};
        var fullQuery = (options && options.query) || {};
        fullQuery = this.queriesUtil.addOrderbys(fullQuery, defaultOrder, 'prepend');
        fullQuery = this.queriesUtil.addAndFilter(fullQuery, defaultFilters);
        if (options && options.partialTextFilter) {
            var _a = options.partialTextFilter, partialText_1 = _a.partialText, properties = _a.properties;
            var orFilter = { __or: properties.map(function (property) {
                    var _a;
                    return (_a = {}, _a[property] = "*" + partialText_1 + "*", _a);
                }) };
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, orFilter);
        }
        if (options && options.partialName) {
            // backwards compatibility if
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, { name: "*" + options.partialName + "*" });
        }
        if (options && options.skipLegacy) {
            fullQuery = this.queriesUtil.addAndFilter(fullQuery, { __not: legacyFilters });
        }
        filters = tslib_1.__assign({ query: this.queriesUtil.buildQuery(fullQuery), pageSize: 50, withTotalPages: true }, ((options && options.params) || {}));
        return this.inventory.list(filters);
    };
    // TODO: merge with create()
    RepositoryService.prototype.save = function (data, type, mo) {
        if (mo === void 0) { mo = {}; }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var existingUrl, response;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        switch (type) {
                            case RepositoryType.CONFIGURATION: {
                                Object.assign(mo, {
                                    type: RepositoryType.CONFIGURATION,
                                    configurationType: data.selected ? data.selected.configurationType : undefined,
                                    name: data.version,
                                    description: data.description,
                                    deviceType: data.deviceType,
                                    c8y_Global: {}
                                });
                                if (!data.deviceType && mo.id) {
                                    mo.deviceType = null;
                                }
                                if (!data.selected && mo.id) {
                                    mo.configurationType = null;
                                }
                                break;
                            }
                        }
                        existingUrl = mo.url;
                        if (!data.binary.url) return [3 /*break*/, 1];
                        mo.url = data.binary.url;
                        return [3 /*break*/, 3];
                    case 1:
                        if (!data.binary.file) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.inventoryBinary.create(data.binary.file, {
                                c8y_Global: {}
                            })];
                    case 2:
                        response = _a.sent();
                        mo.url = response.data.self;
                        _a.label = 3;
                    case 3:
                        if (mo.id) {
                            return [2 /*return*/, this.updateEntry(mo, existingUrl)];
                        }
                        return [2 /*return*/, this.createEntry(mo)];
                }
            });
        });
    };
    RepositoryService.prototype.create = function (modal, type) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (type) {
                    case RepositoryType.FIRMWARE:
                    case RepositoryType.SOFTWARE:
                        return [2 /*return*/, this.createFirmwareOrSoftware(modal, type)];
                }
                return [2 /*return*/];
            });
        });
    };
    RepositoryService.prototype.createFirmwareOrSoftware = function (modal, type) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var binary, binaryURL, repositoryEntry, repositoryBinary, mos, selectedId, _a, file, url, error_1;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        mos = [];
                        selectedId = modal.selected.id, _a = modal.binary, file = _a.file, url = _a.url;
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 9, , 10]);
                        if (!file) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.saveBinary(file)];
                    case 2:
                        (binary = (_b.sent()).data);
                        (binaryURL = binary.self);
                        mos.push(binary);
                        return [3 /*break*/, 4];
                    case 3:
                        binaryURL = url;
                        _b.label = 4;
                    case 4: return [4 /*yield*/, this.createOrUpdateRepositoryEntry(modal, type)];
                    case 5:
                        (repositoryEntry = (_b.sent()).data);
                        if (isNil(selectedId)) {
                            mos.push(repositoryEntry);
                        }
                        return [4 /*yield*/, this.createRepositoryBinary(modal, binaryURL, type, repositoryEntry)];
                    case 6:
                        (repositoryBinary = (_b.sent()).data);
                        mos.push(repositoryBinary);
                        if (!file) return [3 /*break*/, 8];
                        return [4 /*yield*/, this.linkBinary(repositoryBinary, binary)];
                    case 7:
                        _b.sent();
                        _b.label = 8;
                    case 8: return [2 /*return*/, repositoryEntry];
                    case 9:
                        error_1 = _b.sent();
                        this.cleanUp(mos);
                        this.errorMsg();
                        // Propagate error
                        throw error_1;
                    case 10: return [2 /*return*/];
                }
            });
        });
    };
    RepositoryService.prototype.saveBinary = function (file) {
        return this.inventoryBinary.create(file, { c8y_Global: {} });
    };
    RepositoryService.prototype.createOrUpdateRepositoryEntry = function (modal, type) {
        var _a = modal.selected, id = _a.id, name = _a.name, description = modal.description, deviceType = modal.deviceType;
        var mo = {
            id: id,
            name: id ? undefined : name,
            description: description,
            type: id ? undefined : type,
            c8y_Global: {}
        };
        if (deviceType) {
            set(mo, 'c8y_Filter.type', deviceType);
        }
        return id
            ? this.inventory.update(mo)
            : this.inventory.create(mo);
    };
    RepositoryService.prototype.createRepositoryBinary = function (modal, binaryURL, type, parent) {
        var mo = this.prepareRepositoryBinaryMO(modal, binaryURL, type);
        return this.inventory.childAdditionsCreate(mo, parent);
    };
    RepositoryService.prototype.prepareRepositoryBinaryMO = function (modal, binaryURL, type) {
        var _a;
        var version = modal.version, patchVersion = modal.patchVersion, dependency = modal.dependency;
        var result = (_a = {
                type: REPOSITORY_BINARY_TYPES[type]
            },
            _a[type] = {
                url: binaryURL
            },
            _a.c8y_Global = {},
            _a);
        if (dependency) {
            set(result, [type, 'version'], patchVersion);
            assign(result, {
                c8y_Patch: {
                    dependency: dependency.c8y_Firmware.version
                }
            });
        }
        else {
            set(result, [type, 'version'], version);
        }
        return result;
    };
    RepositoryService.prototype.linkBinary = function (repositoryBinary, binary) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var repositoryBinaryId, binaryId;
            return tslib_1.__generator(this, function (_a) {
                repositoryBinaryId = repositoryBinary.id;
                if (binary) {
                    binaryId = binary.id;
                    return [2 /*return*/, this.inventory.childAdditionsAdd(binaryId, repositoryBinaryId)];
                }
                return [2 /*return*/];
            });
        });
    };
    RepositoryService.prototype.cleanUp = function (mosToDelete) {
        var _this = this;
        mosToDelete.forEach(function (mo) {
            var c8y_IsBinary = mo.c8y_IsBinary;
            isUndefined(c8y_IsBinary) ? _this.delete(mo) : _this.inventoryBinary.delete(mo);
        });
    };
    RepositoryService.prototype.delete = function (entity) {
        return this.inventory.delete(entity, { forceCascade: true });
    };
    RepositoryService.prototype.errorMsg = function () {
        var msg = gettext('Failed to save');
        this.alert.danger(msg);
    };
    RepositoryService.prototype.getBaseVersionsCount$ = function (entry) {
        if (this.isLegacyEntry(entry)) {
            return of(1);
        }
        return from(this.listBaseVersions(entry, { pageSize: 1, withTotalPages: true })).pipe(map(function (_a) {
            var paging = _a.paging;
            return paging.totalPages;
        }));
    };
    RepositoryService.prototype.getBaseVersionFromMO = function (mo) {
        return this.isPatch(mo) ? get(mo, 'c8y_Patch.dependency') : get(mo, 'c8y_Firmware.version');
    };
    RepositoryService.prototype.isPatch = function (mo) {
        return !!get(mo, 'c8y_Patch.dependency');
    };
    RepositoryService.prototype.getPatchVersionsCount$ = function (entry, baseVersion) {
        if (this.isLegacyEntry(baseVersion)) {
            return of(0);
        }
        return from(this.listPatchVersions(entry, baseVersion, { pageSize: 1, withTotalPages: true })).pipe(map(function (_a) {
            var paging = _a.paging;
            return paging.totalPages;
        }));
    };
    RepositoryService.prototype.isLegacyEntry = function (entry) {
        return Boolean(entry.url);
    };
    /**
     * Lists all versions (base and patch ones) of given top level entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param params Additional query params.
     */
    RepositoryService.prototype.listAllVersions = function (entry, params) {
        if (params === void 0) { params = {}; }
        if (this.isLegacyEntry(entry)) {
            return this.getBaseVersionResultListForLegacyEntry(entry);
        }
        var VERSION_FILTER_ORDER = {
            __filter: {},
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, VERSION_FILTER_ORDER, params);
    };
    /**
     * Lists base versions of given top level entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param params Additional query params.
     */
    RepositoryService.prototype.listBaseVersions = function (entry, params) {
        if (params === void 0) { params = {}; }
        if (this.isLegacyEntry(entry)) {
            return this.getBaseVersionResultListForLegacyEntry(entry);
        }
        var NO_PATCH_FILTER_ORDER = {
            __filter: {
                __not: { __has: 'c8y_Patch' }
            },
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, NO_PATCH_FILTER_ORDER, params);
    };
    /**
     * Lists patch versions of given base version under the entry.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * @param entry Top level repository entry.
     * @param baseVersion Base version.
     * @param params Additional query params.
     */
    RepositoryService.prototype.listPatchVersions = function (entry, baseVersion, params) {
        if (params === void 0) { params = {}; }
        var version = isString(baseVersion) ? baseVersion : get(baseVersion, 'c8y_Firmware.version');
        var PATCH_FILTER_ORDER = {
            __filter: {
                'c8y_Patch.dependency': version
            },
            __orderby: [{ 'creationTime.date': -1 }, { creationTime: -1 }]
        };
        return this.listChildren(entry, PATCH_FILTER_ORDER, params);
    };
    /**
     * Lists patch versions of given base version under the entry including the base version.
     * Versions are ordered by creation time (assuming the earlier created, the older the version).
     * In terms of legacy base version the entry gets transformed to fit the needed data model.
     * @param entry Top level repository entry.
     * @param baseVersion Base version.
     * @param params Additional query params.
     */
    RepositoryService.prototype.listBaseVersionAndPatches = function (entry, baseVersion, params) {
        if (params === void 0) { params = {}; }
        if (this.isLegacyEntry(entry)) {
            return Promise.resolve({
                data: [
                    Object.assign({
                        c8y_Firmware: {
                            version: entry.version,
                            url: entry.url
                        }
                    }, entry)
                ]
            });
        }
        var PATCH_FILTER_ORDER = {
            __filter: {
                __or: {
                    'c8y_Patch.dependency': baseVersion.c8y_Firmware.version,
                    'c8y_Firmware.version': baseVersion.c8y_Firmware.version
                }
            },
            __orderby: [{ 'c8y_Patch.dependency': 1 }, { 'c8y_Firmware.version': 1 }]
        };
        return this.listChildren(entry, PATCH_FILTER_ORDER, params);
    };
    RepositoryService.prototype.listChildren = function (entry, filters, params) {
        if (filters === void 0) { filters = {}; }
        if (params === void 0) { params = {}; }
        var childrenFilters = { __bygroupid: entry.id };
        var query = this.queriesUtil.addAndFilter(filters, childrenFilters);
        // FIXME: needed because of issue in forOf directive (...)
        params.withTotalPages = true;
        return this.inventory.listQuery(query, params);
    };
    /**
     * Fetches all items from the list starting with the provided page.
     * @param firstPage The first page of the list to fetch all items for.
     */
    RepositoryService.prototype.fetchAllItemsFromList = function (firstPage) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var allItems, _a, paging, items;
            var _b;
            return tslib_1.__generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        if (!!firstPage.then) return [3 /*break*/, 1];
                        allItems = tslib_1.__spread(firstPage);
                        return [3 /*break*/, 5];
                    case 1: return [4 /*yield*/, firstPage];
                    case 2:
                        _a = _c.sent(), paging = _a.paging, items = _a.data;
                        allItems = tslib_1.__spread(items);
                        _c.label = 3;
                    case 3:
                        if (!(paging && paging.nextPage)) return [3 /*break*/, 5];
                        return [4 /*yield*/, paging.next()];
                    case 4:
                        (_b = _c.sent(), paging = _b.paging, items = _b.data);
                        allItems = tslib_1.__spread(allItems, items);
                        return [3 /*break*/, 3];
                    case 5: return [2 /*return*/, allItems];
                }
            });
        });
    };
    /**
     * Gets top level repository entry managed object for base or patch version.
     * @param mo Base or patch version managed object with parents.
     */
    RepositoryService.prototype.getRepositoryEntryMO$ = function (mo) {
        if (!mo) {
            return of(undefined);
        }
        var _a = tslib_1.__read(get(mo, 'additionParents.references'), 1), reference = _a[0];
        var id = get(reference, 'managedObject.id');
        return id
            ? from(this.inventory.detail(id, { withChildren: false })).pipe(map(function (_a) {
                var data = _a.data;
                return data;
            }))
            : of(undefined);
    };
    /**
     * Gets base or patch version managed object.
     * @param deviceRepositoryFragment Device repository fragment.
     * @param type Top level repository entry type.
     * @param configuration Configuration object with options:
     * - **skipLegacy** - `boolean` - Exclude legacy entries.
     * - **filters** - `object` - Filter object.
     *
     * @deprecated as it doesn't support 'missing url' case
     */
    RepositoryService.prototype.getRepositoryBinaryMoByVersion = function (deviceRepositoryFragment, type, _a) {
        var _b;
        var _c = _a === void 0 ? {} : _a, _d = _c.skipLegacy, skipLegacy = _d === void 0 ? false : _d, _e = _c.filters, filters = _e === void 0 ? {} : _e;
        var version = deviceRepositoryFragment.version, url = deviceRepositoryFragment.url, name = deviceRepositoryFragment.name;
        var repositoryBinaryType = REPOSITORY_BINARY_TYPES[type];
        var query;
        var newModelBaseVersionQuery = (_b = {},
            _b[type + ".version"] = version,
            _b[type + ".url"] = url,
            _b.type = repositoryBinaryType,
            _b);
        var legacyVersionQuery = { url: url, type: type, name: name };
        filters = tslib_1.__assign({ withChildren: false, withParents: true }, filters);
        if (skipLegacy) {
            query = {
                __and: tslib_1.__assign({}, newModelBaseVersionQuery)
            };
        }
        else {
            query = {
                __or: [{ __and: tslib_1.__assign({}, newModelBaseVersionQuery) }, { __and: tslib_1.__assign({}, legacyVersionQuery) }]
            };
        }
        return this.inventory.listQuery(query, filters).then(function (_a) {
            var data = _a.data;
            return head(data);
        });
    };
    RepositoryService.prototype.getBinaryName$ = function (binaryUrl) {
        if (!binaryUrl) {
            return of('---');
        }
        var binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
        if (!binaryId) {
            return of(binaryUrl);
        }
        return this.inventory.detail$(binaryId).pipe(map(function (mo) { return mo.name; }));
    };
    /**
     * Generates an inventory query object which can be used to find
     * repository entries of specified type matching the type of provided device.
     * @param repositoryType The type of repository entries which will be queried with the generated query.
     * @param device The device for which matching repository entries will be queried with the generated query.
     */
    RepositoryService.prototype.getDeviceTypeQuery = function (repositoryType, device) {
        var result = { type: repositoryType };
        if (device.type) {
            if (repositoryType === RepositoryType.CONFIGURATION) {
                result = this.queriesUtil.addAndFilter(result, {
                    __or: [{ deviceType: device.type }, { __not: { __has: "deviceType" } }]
                });
            }
            else {
                result = this.queriesUtil.addAndFilter(result, {
                    __or: [
                        { 'c8y_Filter.type': device.type },
                        { 'c8y_Filter.type': '' },
                        { __not: { __has: "c8y_Filter.type" } }
                    ]
                });
            }
        }
        return result;
    };
    /**
     * Generates an inventory query object which can be used to find configuration repository entries
     * matching the type of provided device and specified configuration type.
     * @param device The device for which matching repository entries will be queried with the generated query.
     * @param configurationType Configuration type for which matching repository entries will be queried with the generated query.
     */
    RepositoryService.prototype.getConfigurationTypeQuery = function (device, configurationType) {
        var query = this.getDeviceTypeQuery(RepositoryType.CONFIGURATION, device);
        return this.queriesUtil.addAndFilter(query, {
            __or: [
                { configurationType: configurationType },
                { configurationType: '' },
                { __not: { __has: "configurationType" } }
            ]
        });
    };
    /**
     * Gets the list of software installed in the device in the uniform format.
     * Supports c8y_SoftwareList and c8y_Software fragments.
     * @param device The device whose software list should be returned.
     */
    RepositoryService.prototype.getDeviceSoftwareList = function (device) {
        if (device.c8y_SoftwareList) {
            return cloneDeep(device.c8y_SoftwareList);
        }
        if (device.c8y_Software) {
            return _map(device.c8y_Software, function (version, name) { return ({ name: name, version: version }); });
        }
        return [];
    };
    /**
     * Prepares a software update operation for given device and the list of changes, and sends it to the device.
     * @param device The device which the operation should be prepared for and sent to.
     * @param changes The list of software changes which should be applied.
     */
    RepositoryService.prototype.createSoftwareUpdateOperation = function (device, changes) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var operation;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        operation = this.getSoftwareUpdateOperation(device, changes);
                        return [4 /*yield*/, this.operation.create(operation)];
                    case 1: return [2 /*return*/, (_a.sent()).data];
                }
            });
        });
    };
    /**
     * Prepares a software update operation for given device and changes.
     * Returned operation type depends on device's supported operations.
     * Supports c8y_SoftwareUpdate, c8y_SoftwareList, and c8y_Software operations.
     * @param device The device for which operation should be prepared.
     * @param changes The list of software changes which should be applied.
     */
    RepositoryService.prototype.getSoftwareUpdateOperation = function (device, changes) {
        var operation = {
            deviceId: device.id,
            description: "Apply software changes: " + changes
                .map(function (change) {
                return change.action + " \"" + change.name + "\"" + (change.version ? " (version: " + change.version + ")" : '');
            })
                .join(', ')
        };
        if (device.c8y_SupportedOperations.includes('c8y_SoftwareUpdate')) {
            operation.c8y_SoftwareUpdate = cloneDeep(changes);
        }
        else if (device.c8y_SupportedOperations.includes('c8y_SoftwareList')) {
            operation.c8y_SoftwareList = cloneDeep(device.c8y_SoftwareList) || [];
            changes.forEach(function (change) {
                var deviceSoftware = pick(change, ['name', 'version', 'url']);
                if (change.action === 'delete') {
                    remove(operation.c8y_SoftwareList, deviceSoftware);
                }
                if (change.action === 'install') {
                    operation.c8y_SoftwareList.push(deviceSoftware);
                }
            });
        }
        else if (device.c8y_SupportedOperations.includes('c8y_Software')) {
            operation.c8y_Software = cloneDeep(device.c8y_Software) || {};
            changes.forEach(function (change) {
                if (change.action === 'delete') {
                    delete operation.c8y_Software[change.name];
                }
                if (change.action === 'install') {
                    operation.c8y_Software[change.name] = change.version;
                }
            });
        }
        return operation;
    };
    /**
     * Extracts the list of device software changes from given operation in the context of given device.
     * @param operation The operation from which the list should be extracted.
     * @param device The target device of the operation.
     */
    RepositoryService.prototype.getDeviceSoftwareChangesFromOperation = function (operation, device) {
        if (operation.c8y_SoftwareUpdate) {
            return cloneDeep(operation.c8y_SoftwareUpdate);
        }
        if (operation.c8y_SoftwareList) {
            return this.getDeviceSoftwareChangesFromSoftwareListOperation(operation, device);
        }
        if (operation.c8y_Software) {
            return this.getDeviceSoftwareChangesFromSoftwareOperation(operation, device);
        }
        return [];
    };
    /**
     * Prepares a firmware update operation for given device and the selected repository binary, and sends it to the device.
     * @param device The device which the operation should be prepared for and sent to.
     * @param selectedOption The selected repository binary option.
     */
    RepositoryService.prototype.createFirmwareUpdateOperation = function (device, selectedOption) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var operation;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        operation = this.getFirmwareUpdateOperation(device, selectedOption);
                        return [4 /*yield*/, this.operation.create(operation)];
                    case 1: return [2 /*return*/, (_a.sent()).data];
                }
            });
        });
    };
    /**
     * Prepares a firmware update operation for given device and selected version.
     * Supports c8y_Firmware operation.
     * @param device The device for which operation should be prepared.
     * @param selectedOption Selected firmware version.
     */
    RepositoryService.prototype.getFirmwareUpdateOperation = function (device, selectedOption) {
        delete selectedOption.id;
        var operation = {
            deviceId: device.id,
            description: "Update firmware to: \"" + selectedOption.name + "\"" + (selectedOption.version ? " (version: " + selectedOption.version + ")" : ''),
            c8y_Firmware: tslib_1.__assign({}, selectedOption)
        };
        return operation;
    };
    /**
     * Prepares a configuration file upload operation for given device and configuration type.
     * @param device The device for which operation should be prepared.
     * @param configurationType Selected configuration type.
     * @param isLegacy  A legacy operation is created without a configurationType.
     */
    RepositoryService.prototype.getUploadConfigurationFileOperation = function (device, configurationType, isLegacy) {
        if (isLegacy === void 0) { isLegacy = false; }
        if (isLegacy) {
            return {
                deviceId: device.id,
                description: "Retrieve configuration snapshot from device " + device.name,
                c8y_UploadConfigFile: {}
            };
        }
        return {
            deviceId: device.id,
            description: "Retrieve " + configurationType + " configuration snapshot from device " + device.name,
            c8y_UploadConfigFile: {
                type: configurationType
            }
        };
    };
    /**
     * Prepares a configuration file download operation for given device and configuration type.
     * @param device The device for which operation should be prepared.
     * @param configurationType Selected configuration type.
     * @param binaryUrl The url of a binary to be downloaded.
     * @param isLegacy A legacy operation is created without a configurationType.
     */
    RepositoryService.prototype.getDownloadConfigurationFileOperation = function (device, configurationType, configSnapshot, isLegacy) {
        if (isLegacy === void 0) { isLegacy = false; }
        if (isLegacy) {
            return {
                deviceId: device.id,
                description: "Send configuration snapshot " + configSnapshot.name + " to device " + device.name,
                c8y_DownloadConfigFile: {
                    url: configSnapshot.binaryUrl,
                    c8y_ConfigurationDump: {
                        id: configSnapshot.id
                    }
                }
            };
        }
        return {
            deviceId: device.id,
            description: "Send configuration snapshot " + configSnapshot.name + " of configuration type " + configurationType + " to device " + device.name,
            c8y_DownloadConfigFile: {
                url: configSnapshot.binaryUrl,
                type: configurationType
            }
        };
    };
    /**
     * Gets the last firmware update operation for given device.
     * Looks for c8y_Firmware operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    RepositoryService.prototype.getLastFirmwareUpdateOperation = function (deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var filters;
            return tslib_1.__generator(this, function (_a) {
                filters = {
                    deviceId: deviceId,
                    dateFrom: new Date(0).toISOString(),
                    dateTo: new Date(Date.now()).toISOString(),
                    revert: true,
                    pageSize: 1
                };
                return [2 /*return*/, this.getFirstMatchingOperation([tslib_1.__assign({}, filters, { fragmentType: 'c8y_Firmware' })])];
            });
        });
    };
    /**
     * Gets the last software update operation for given device.
     * Looks for c8y_SoftwareUpdate, c8y_SoftwareList, or c8y_Software operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    RepositoryService.prototype.getLastSoftwareUpdateOperation = function (deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var filters;
            return tslib_1.__generator(this, function (_a) {
                filters = {
                    deviceId: deviceId,
                    dateFrom: new Date(0).toISOString(),
                    dateTo: new Date(Date.now()).toISOString(),
                    revert: true,
                    pageSize: 1
                };
                return [2 /*return*/, this.getFirstMatchingOperation([
                        tslib_1.__assign({}, filters, { fragmentType: 'c8y_SoftwareUpdate' }),
                        tslib_1.__assign({}, filters, { fragmentType: 'c8y_SoftwareList' }),
                        tslib_1.__assign({}, filters, { fragmentType: 'c8y_Software' })
                    ])];
            });
        });
    };
    /**
     * Iterates over the list of filters and queries the operations.
     * If a query returns at least one operation, the first one will be returned.
     * Otherwise the next query will be performed.
     * If none of the queries returns any operation, null will be returned.
     * @param filtersList The list of filters for the queries.
     */
    RepositoryService.prototype.getFirstMatchingOperation = function (filtersList) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var matchingOperation, filtersList_1, filtersList_1_1, filters, operations, e_1_1;
            var e_1, _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        matchingOperation = null;
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 6, 7, 8]);
                        filtersList_1 = tslib_1.__values(filtersList), filtersList_1_1 = filtersList_1.next();
                        _b.label = 2;
                    case 2:
                        if (!!filtersList_1_1.done) return [3 /*break*/, 5];
                        filters = filtersList_1_1.value;
                        return [4 /*yield*/, this.operation.list(filters)];
                    case 3:
                        operations = (_b.sent()).data;
                        if (operations.length) {
                            matchingOperation = operations[0];
                            return [3 /*break*/, 5];
                        }
                        _b.label = 4;
                    case 4:
                        filtersList_1_1 = filtersList_1.next();
                        return [3 /*break*/, 2];
                    case 5: return [3 /*break*/, 8];
                    case 6:
                        e_1_1 = _b.sent();
                        e_1 = { error: e_1_1 };
                        return [3 /*break*/, 8];
                    case 7:
                        try {
                            if (filtersList_1_1 && !filtersList_1_1.done && (_a = filtersList_1.return)) _a.call(filtersList_1);
                        }
                        finally { if (e_1) throw e_1.error; }
                        return [7 /*endfinally*/];
                    case 8: return [2 /*return*/, matchingOperation];
                }
            });
        });
    };
    /**
     * Creates the operation and returns an observable to track its progress.
     * Fails the observable when the operation returns FAILED status.
     * Completes the observable when the operation returns SUCCESSFUL status.
     * @param operation The operation to create and track.
     */
    RepositoryService.prototype.createObservedOperation = function (operation) {
        var _this = this;
        return from(this.operation.create(operation)).pipe(map(function (_a) {
            var data = _a.data;
            return data;
        }), take(1), switchMap(function (createdOperation) { return _this.observeOperation(createdOperation); }));
    };
    /**
     * Returns an observable to track progress of given operation.
     * Fails the observable when the operation returns FAILED status.
     * Completes the observable when the operation returns SUCCESSFUL status.
     * @param operation The operation to be observed.
     */
    RepositoryService.prototype.observeOperation = function (operation) {
        var _this = this;
        var observedOperation$ = of(operation);
        var operationUpdates$ = observedOperation$.pipe(switchMap(function (observedOperation) {
            return _this.realtime.observable("/operations/" + observedOperation.deviceId);
        }), map(function (_a) {
            var data = _a.data;
            return data;
        }), withLatestFrom(observedOperation$), filter(function (_a) {
            var _b = tslib_1.__read(_a, 2), operationUpdate = _b[0], observedOperation = _b[1];
            return operationUpdate.id === observedOperation.id;
        }), switchMap(function (_a) {
            var _b = tslib_1.__read(_a, 1), operationUpdate = _b[0];
            if (operationUpdate.status === OperationStatus.FAILED) {
                return throwError(operationUpdate);
            }
            return of(operationUpdate);
        }), takeWhile(function (operationUpdate) { return operationUpdate.status !== OperationStatus.SUCCESSFUL; }, true));
        return merge(observedOperation$, operationUpdates$);
    };
    /**
     * Gets a single event with latest creationTime for the given device Id and event type.
     * @param deviceId The device Id for which the events should be queried.
     * @param type Event type.
     */
    RepositoryService.prototype.getLatestConfigurationEvent = function (deviceId, type) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var eventFilter, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        eventFilter = {
                            source: deviceId,
                            type: type,
                            dateFrom: this.dateFrom.toISOString(),
                            dateTo: this.dateTo.toISOString(),
                            pageSize: 1
                        };
                        return [4 /*yield*/, this.event.list(eventFilter)];
                    case 1:
                        data = (_a.sent()).data;
                        return [2 /*return*/, data[0]];
                }
            });
        });
    };
    /**
     * Gets a list of operations for the given device Id, and operation type.
     * @param deviceId The device Id for which the operation should be queried.
     * @param operationType Operation type fragment.
     */
    RepositoryService.prototype.getConfigFileOperationList = function (deviceId, operationType) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var operationFilter;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        operationFilter = {
                            deviceId: deviceId,
                            fragmentType: operationType,
                            dateFrom: this.dateFrom.toISOString(),
                            dateTo: this.dateTo.toISOString(),
                            revert: true,
                            pageSize: 2000
                        };
                        return [4 /*yield*/, this.operation.list(operationFilter)];
                    case 1: return [2 /*return*/, (_a.sent()).data];
                }
            });
        });
    };
    /**
     * Gets latest uploaded configuration snapshot for the given device, and configuration type.
     * @param device The device for which the configuration snapshot was uploaded.
     * @param configurationType Selected configuration type.
     */
    RepositoryService.prototype.getConfigSnapshot = function (device, configurationType) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var event, configSnapshot, _a, ex_1, msg;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.getLatestConfigurationEvent(device.id, configurationType)];
                    case 1:
                        event = _b.sent();
                        if (!event) return [3 /*break*/, 6];
                        configSnapshot = {
                            time: event.time,
                            name: event.text,
                            deviceType: device.type,
                            configurationType: configurationType
                        };
                        _b.label = 2;
                    case 2:
                        _b.trys.push([2, 5, , 6]);
                        _a = configSnapshot;
                        return [4 /*yield*/, this.eventBinary.download(event)];
                    case 3: return [4 /*yield*/, (_b.sent()).text()];
                    case 4:
                        _a.binary = _b.sent();
                        if (event.c8y_IsBinary) {
                            configSnapshot.binaryType = event.c8y_IsBinary.type;
                        }
                        return [3 /*break*/, 6];
                    case 5:
                        ex_1 = _b.sent();
                        msg = gettext('Could not get the binary.');
                        this.alert.danger(msg);
                        return [3 /*break*/, 6];
                    case 6: return [2 /*return*/, configSnapshot];
                }
            });
        });
    };
    RepositoryService.prototype.getLegacyConfigSnapshot = function (deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var configSnapshot, mo, device, snapshotId, ex_2, _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.inventory.detail(deviceId, { withChildren: false })];
                    case 1:
                        device = (_b.sent()).data;
                        snapshotId = device.c8y_ConfigurationDump && device.c8y_ConfigurationDump.id;
                        if (!snapshotId) {
                            return [2 /*return*/];
                        }
                        _b.label = 2;
                    case 2:
                        _b.trys.push([2, 4, , 5]);
                        return [4 /*yield*/, this.inventory.detail(snapshotId)];
                    case 3:
                        mo = (_b.sent()).data;
                        return [3 /*break*/, 5];
                    case 4:
                        ex_2 = _b.sent();
                        return [3 /*break*/, 5];
                    case 5:
                        if (!mo) return [3 /*break*/, 7];
                        configSnapshot = {
                            time: mo.creationTime,
                            name: mo.name
                        };
                        _a = configSnapshot;
                        return [4 /*yield*/, this.getBinaryText(mo.url, { allowExternal: false })];
                    case 6:
                        _a.binary = _b.sent();
                        _b.label = 7;
                    case 7: return [2 /*return*/, configSnapshot];
                }
            });
        });
    };
    /**
     * Returns a binary object as text.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **allowExternal** - `boolean` - allows downloading external binary file
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    RepositoryService.prototype.getBinaryText = function (binaryUrl, options) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var binaryId, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
                        if (!(!binaryId && options.allowExternal)) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.getExternalBinaryResponse(binaryUrl, options)];
                    case 1:
                        res = _a.sent();
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, this.getInternalBinaryResponse(binaryId, options)];
                    case 3:
                        res = _a.sent();
                        _a.label = 4;
                    case 4:
                        if (!res) {
                            return [2 /*return*/, null];
                        }
                        return [2 /*return*/, res.text()];
                }
            });
        });
    };
    /**
     * Returns a binary object as File.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **allowExternal** - `boolean` - allows downloading external binary file
     */
    RepositoryService.prototype.getBinaryFile = function (binaryUrl, options) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var binaryId, _a, name, contentType, res, _b, arrayBuffer;
            return tslib_1.__generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        binaryId = this.inventoryBinary.getIdFromUrl(binaryUrl);
                        if (!binaryId && !options.allowExternal) {
                            return [2 /*return*/, null];
                        }
                        return [4 /*yield*/, this.inventory.detail(binaryId)];
                    case 1:
                        _a = (_c.sent()).data, name = _a.name, contentType = _a.contentType;
                        if (!!!binaryId) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.getInternalBinaryResponse(binaryId)];
                    case 2:
                        _b = _c.sent();
                        return [3 /*break*/, 5];
                    case 3: return [4 /*yield*/, this.getExternalBinaryResponse(binaryUrl)];
                    case 4:
                        _b = _c.sent();
                        _c.label = 5;
                    case 5:
                        res = _b;
                        return [4 /*yield*/, res.arrayBuffer()];
                    case 6:
                        arrayBuffer = _c.sent();
                        return [2 /*return*/, new File([arrayBuffer], name, { type: contentType })];
                }
            });
        });
    };
    /**
     * Gets the last configuration update operation for given device.
     * Looks for c8y_Configuration and c8y_SendConfiguration operations.
     * @param deviceId The ID of the device to find an operation for.
     */
    RepositoryService.prototype.getLastConfigUpdateOperation = function (deviceId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var filters;
            return tslib_1.__generator(this, function (_a) {
                filters = {
                    deviceId: deviceId,
                    dateFrom: new Date(0).toISOString(),
                    dateTo: new Date(Date.now()).toISOString(),
                    revert: true,
                    pageSize: 1
                };
                return [2 /*return*/, this.getFirstMatchingOperation([
                        tslib_1.__assign({}, filters, { fragmentType: 'c8y_Configuration' }),
                        tslib_1.__assign({}, filters, { fragmentType: 'c8y_SendConfiguration' })
                    ])];
            });
        });
    };
    /**
     * Prepares a configuration download operation for given device and its current configuration.
     * Supports c8y_SendConfiguration operation.
     * @param device The device for which operation should be prepared.
     */
    RepositoryService.prototype.createTextBasedConfigurationReloadOperation = function (device) {
        return {
            deviceId: device.id,
            description: gettext('Requested current configuration'),
            c8y_SendConfiguration: {}
        };
    };
    /**
     * Prepares a configuration update operation for the given device.
     * Supports c8y_Configuration operation.
     * @param device The device for which operation should be prepared.
     * @param config The configuration which will update the existing one.
     */
    RepositoryService.prototype.createTextBasedConfigurationUpdateOperation = function (device, config) {
        return {
            deviceId: device.id,
            description: gettext('Configuration update'),
            c8y_Configuration: {
                config: config
            }
        };
    };
    RepositoryService.prototype.getBinary = function (binaryId) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var ex_3, msg;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.inventoryBinary.download(binaryId)];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2:
                        ex_3 = _a.sent();
                        msg = gettext('Could not get the binary.');
                        this.alert.danger(msg);
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * Gets all available snapshots from the repository for the given device.
     * @param device The device for which the snapshots should be prepared.
     * @param configurationType Selected configuration type.
     */
    RepositoryService.prototype.getSnapshotsFromRepository = function (device, configurationType) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var searchQuery, res;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        searchQuery = this.getConfigurationTypeQuery(device, configurationType);
                        return [4 /*yield*/, this.listRepositoryEntries(RepositoryType.CONFIGURATION, {
                                query: searchQuery,
                                params: { pageSize: 100 }
                            })];
                    case 1:
                        res = _a.sent();
                        return [2 /*return*/, res.data];
                }
            });
        });
    };
    /**
     * Returns a binary object.
     * @param binaryId binary ID
     * @param options The object with additional options:
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    RepositoryService.prototype.getInternalBinaryResponse = function (binaryId, options) {
        if (options === void 0) { options = {}; }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var res, ex_4, msg;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.inventoryBinary.download(binaryId)];
                    case 1:
                        res = _a.sent();
                        return [3 /*break*/, 3];
                    case 2:
                        ex_4 = _a.sent();
                        if (!options.noAlerts) {
                            msg = gettext('Could not get the binary.');
                            this.alert.danger(msg);
                        }
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/, res];
                }
            });
        });
    };
    /**
     * Returns a binary object.
     * @param binaryUrl The URL to find binary
     * @param options The object with additional options:
     * - **noAlerts** - `boolean` - do not display an alert message; defaults to `false`
     */
    RepositoryService.prototype.getExternalBinaryResponse = function (binaryUrl, options) {
        if (options === void 0) { options = {}; }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var res, fetchRes, _a, msg;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _b.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, fetch(binaryUrl)];
                    case 1:
                        fetchRes = _b.sent();
                        if (fetchRes.status >= 400) {
                            throw res;
                        }
                        res = fetchRes;
                        return [3 /*break*/, 3];
                    case 2:
                        _a = _b.sent();
                        if (!options.noAlerts) {
                            msg = gettext('Could not get the external binary');
                            this.alert.danger(msg);
                        }
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/, res];
                }
            });
        });
    };
    RepositoryService.prototype.createEntry = function (mo) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var binaryId, newMo;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.inventoryBinary.getIdFromUrl(mo.url)];
                    case 1:
                        binaryId = _a.sent();
                        return [4 /*yield*/, this.inventory.create(mo)];
                    case 2:
                        newMo = _a.sent();
                        if (!binaryId) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.inventory.childAdditionsAdd(binaryId, newMo.data)];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4: return [2 /*return*/, newMo];
                }
            });
        });
    };
    RepositoryService.prototype.updateEntry = function (mo, url) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var existingBinaryId, newBinaryId, id;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.inventoryBinary.getIdFromUrl(url)];
                    case 1:
                        existingBinaryId = _a.sent();
                        return [4 /*yield*/, this.inventoryBinary.getIdFromUrl(mo.url)];
                    case 2:
                        newBinaryId = _a.sent();
                        if (!(existingBinaryId && existingBinaryId !== newBinaryId)) return [3 /*break*/, 4];
                        id = this.inventoryBinary.getIdFromUrl(url);
                        return [4 /*yield*/, this.inventoryBinary.delete(id)];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4:
                        if (!newBinaryId) return [3 /*break*/, 6];
                        return [4 /*yield*/, this.inventory.childAdditionsAdd(newBinaryId, mo)];
                    case 5:
                        _a.sent();
                        _a.label = 6;
                    case 6: return [2 /*return*/, this.inventory.update(mo)];
                }
            });
        });
    };
    RepositoryService.prototype.getBaseVersionResultListForLegacyEntry = function (entry) {
        var _a;
        return Promise.resolve({
            res: {},
            data: [
                tslib_1.__assign({}, entry, (_a = {}, _a[entry.type] = {
                    version: entry.version,
                    url: entry.url
                }, _a))
            ]
        });
    };
    RepositoryService.prototype.getDeviceSoftwareChangesFromSoftwareListOperation = function (operation, device) {
        var changes = [];
        forEach(device.c8y_SoftwareList, function (deviceSoftware) {
            var operationSoftware = find(operation.c8y_SoftwareList, { name: deviceSoftware.name });
            if ((operationSoftware && operationSoftware.version) !==
                (deviceSoftware && deviceSoftware.version)) {
                changes.push(tslib_1.__assign({}, deviceSoftware, { action: 'delete' }));
            }
        });
        forEach(operation.c8y_SoftwareList, function (operationSoftware) {
            var deviceSoftware = find(device.c8y_SoftwareList, { name: operationSoftware.name });
            if ((operationSoftware && operationSoftware.version) !==
                (deviceSoftware && deviceSoftware.version)) {
                changes.push(tslib_1.__assign({}, operationSoftware, { action: 'install' }));
            }
        });
        return changes;
    };
    RepositoryService.prototype.getDeviceSoftwareChangesFromSoftwareOperation = function (operation, device) {
        var changes = [];
        forEach(device.c8y_Software, function (deviceSoftwareVersion, deviceSoftwareName) {
            if (operation.c8y_Software[deviceSoftwareName] !== deviceSoftwareVersion) {
                changes.push({
                    name: deviceSoftwareName,
                    version: deviceSoftwareVersion,
                    action: 'delete'
                });
            }
        });
        forEach(operation.c8y_Software, function (operationSoftwareVersion, operationSoftwareName) {
            if (device.c8y_Software[operationSoftwareName] !== operationSoftwareVersion) {
                changes.push({
                    name: operationSoftwareName,
                    version: operationSoftwareVersion,
                    action: 'install'
                });
            }
        });
        return changes;
    };
    RepositoryService.ctorParameters = function () { return [
        { type: InventoryService },
        { type: InventoryBinaryService },
        { type: OperationService },
        { type: AlertService },
        { type: EventService },
        { type: Realtime },
        { type: EventBinaryService }
    ]; };
    RepositoryService = tslib_1.__decorate([
        Injectable()
    ], RepositoryService);
    return RepositoryService;
}());
export { RepositoryService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvc2l0b3J5LyIsInNvdXJjZXMiOlsicmVwb3NpdG9yeS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQWMsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUNMLEtBQUssRUFDTCxXQUFXLEVBQ1gsTUFBTSxFQUNOLEdBQUcsRUFDSCxJQUFJLEVBQ0osR0FBRyxFQUNILFFBQVEsRUFDUixJQUFJLEVBQ0osU0FBUyxFQUNULE1BQU0sRUFDTixJQUFJLEVBQ0osT0FBTyxFQUNQLEdBQUcsSUFBSSxJQUFJLEVBQ1osTUFBTSxXQUFXLENBQUM7QUFDbkIsT0FBTyxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLHNCQUFzQixFQUN0QixPQUFPLEVBQ1AsY0FBYyxFQUNkLG9CQUFvQixFQUNwQixXQUFXLEVBQ1gsV0FBVyxFQUNYLFdBQVcsRUFDWCxjQUFjLEVBQ2QsVUFBVSxFQUNWLGdCQUFnQixFQUNoQixRQUFRLEVBQ1IsZUFBZSxFQUNmLE1BQU0sRUFDTixZQUFZLEVBQ1osa0JBQWtCLEVBQ2xCLFdBQVcsRUFDWixNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBT0wsY0FBYyxFQUNkLHVCQUF1QixFQU14QixNQUFNLG9CQUFvQixDQUFDO0FBRzVCO0lBS0UsMkJBQ1UsU0FBMkIsRUFDM0IsZUFBdUMsRUFDdkMsU0FB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cEM3QjtJQUFELHdCQUFDO0NBQUEsQUFucENELElBbXBDQztTQW5wQ1ksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIGZyb20sIHRocm93RXJyb3IsIG1lcmdlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHN3aXRjaE1hcCwgdGFrZVdoaWxlLCB0YWtlLCBmaWx0ZXIsIHdpdGhMYXRlc3RGcm9tIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgaXNOaWwsXG4gIGlzVW5kZWZpbmVkLFxuICBhc3NpZ24sXG4gIHNldCxcbiAgaGVhZCxcbiAgZ2V0LFxuICBpc1N0cmluZyxcbiAgcGljayxcbiAgY2xvbmVEZWVwLFxuICByZW1vdmUsXG4gIGZpbmQsXG4gIGZvckVhY2gsXG4gIG1hcCBhcyBfbWFwXG59IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UsIGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7XG4gIEludmVudG9yeVNlcnZpY2UsXG4gIEludmVudG9yeUJpbmFyeVNlcnZpY2UsXG4gIElSZXN1bHQsXG4gIElNYW5hZ2VkT2JqZWN0LFxuICBJTWFuYWdlZE9iamVjdEJpbmFyeSxcbiAgSUlkZW50aWZpZWQsXG4gIFF1ZXJpZXNVdGlsLFxuICBJUmVzdWx0TGlzdCxcbiAgSUZldGNoUmVzcG9uc2UsXG4gIElPcGVyYXRpb24sXG4gIE9wZXJhdGlvblNlcnZpY2UsXG4gIFJlYWx0aW1lLFxuICBPcGVyYXRpb25TdGF0dXMsXG4gIElFdmVudCxcbiAgRXZlbnRTZXJ2aWNlLFxuICBFdmVudEJpbmFyeVNlcnZpY2UsXG4gIElkUmVmZXJlbmNlXG59IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7XG4gIFJlcG9zaXRvcnlDYXRlZ29yeSxcbiAgUmVwb3NpdG9yeUJpbmFyeSxcbiAgRmlybXdhcmVCaW5hcnksXG4gIFNvZnR3YXJlQmluYXJ5LFxuICBGaXJtd2FyZVBhdGNoQmluYXJ5LFxuICBNb2RhbE1vZGVsLFxuICBSZXBvc2l0b3J5VHlwZSxcbiAgUkVQT1NJVE9SWV9CSU5BUllfVFlQRVMsXG4gIERldmljZUZpcm13YXJlLFxuICBEZXZpY2VTb2Z0d2FyZSxcbiAgRGV2aWNlU29mdHdhcmVDaGFuZ2UsXG4gIFNlbGVjdGVkUmVwb3NpdG9yeUJpbmFyeSxcbiAgQ29uZmlndXJhdGlvblNuYXBzaG90XG59IGZyb20gJy4vcmVwb3NpdG9yeS5tb2RlbCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5U2VydmljZSB7XG4gIHJlYWRvbmx5IGRhdGVGcm9tID0gbmV3IERhdGUoMCk7XG4gIHJlYWRvbmx5IGRhdGVUbyA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA4NjQwMDAwMCk7IC8vIDEgZGF5IGluIHRoZSBmdXR1cmVcbiAgcHJpdmF0ZSBxdWVyaWVzVXRpbDogUXVlcmllc1V0aWw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBpbnZlbnRvcnk6IEludmVudG9yeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbnZlbnRvcnlCaW5hcnk6IEludmVudG9yeUJpbmFyeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBvcGVyYXRpb246IE9wZXJhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhbGVydDogQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgZXZlbnQ6IEV2ZW50U2VydmljZSxcbiAgICBwcml2YXRlIHJlYWx0aW1lOiBSZWFsdGltZSxcbiAgICBwcml2YXRlIGV2ZW50QmluYXJ5OiBFdmVudEJpbmFyeVNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5xdWVyaWVzVXRpbCA9IG5ldyBRdWVyaWVzVXRpbCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RzIHJlcG9zaXRvcnkgZW50cmllcyBvZiBnaXZlbiB0eXBlLlxuICAgKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiByZXBvc2l0b3J5IGVudHJpZXMgdG8gbGlzdC5cbiAgICogQHBhcmFtIG9wdGlvbnMgRXh0cmEgbGlzdGluZyBvcHRpb25zLlxuICAgKi9cbiAgbGlzdFJlcG9zaXRvcnlFbnRyaWVzKFxuICAgIHR5cGU6IFJlcG9zaXRvcnlUeXBlLFxuICAgIG9wdGlvbnM/OiB7XG4gICAgICAvKiogQWRkaXRpb25hbCBxdWVyeS4gKi9cbiAgICAgIHF1ZXJ5PzogYW55O1xuICAgICAgLyoqIChkZXByZWNhdGVkIC0gdG8gYmUgcmVtb3ZlZCkgT25seSBpbmNsdWRlIGVudHJpZXMgd2l0aCBtYXRjaGluZyBwYXJ0aWFsIG5hbWVzLiAqL1xuICAgICAgcGFydGlhbE5hbWU/OiBzdHJpbmc7XG4gICAgICAvKiogSW5jbHVkZSBlbnRyaWVzIHdpdGggbWF0Y2hpbmcgcGFydGlhbCB0ZXh0IGluIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcy4gKi9cbiAgICAgIHBhcnRpYWxUZXh0RmlsdGVyPzogeyBwYXJ0aWFsVGV4dDogc3RyaW5nOyBwcm9wZXJ0aWVzOiBzdHJpbmdbXSB9O1xuICAgICAgLyoqIEV4Y2x1ZGUgbGVnYWN5IGVudHJpZXMuICovXG4gICAgICBza2lwTGVnYWN5PzogYm9vbGVhbjtcbiAgICAgIC8qKiBPdGhlciByZXF1ZXN0IHBhcmFtcy4gKi9cbiAgICAgIHBhcmFtcz86IGFueTtcbiAgICB9XG4gICkge1xuICAgIGNvbnN0IGRlZmF1bHRPcmRlciA9IFt7IG5hbWU6IDEgfV07XG4gICAgY29uc3QgZGVmYXVsdEZpbHRlcnMgPSB7IHR5cGUgfTtcbiAgICBjb25zdCBsZWdhY3lGaWx0ZXJzID0geyBfX2hhczogYHVybGAgfTtcbiAgICBsZXQgZmlsdGVycyA9IHt9O1xuXG4gICAgbGV0IGZ1bGxRdWVyeSA9IChvcHRpb25zICYmIG9wdGlvbnMucXVlcnkpIHx8IHt9O1xuICAgIGZ1bGxRdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkT3JkZXJieXMoZnVsbFF1ZXJ5LCBkZWZhdWx0T3JkZXIsICdwcmVwZW5kJyk7XG5cbiAgICBmdWxsUXVlcnkgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihmdWxsUXVlcnksIGRlZmF1bHRGaWx0ZXJzKTtcblxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucGFydGlhbFRleHRGaWx0ZXIpIHtcbiAgICAgIGNvbnN0IHsgcGFydGlhbFRleHQsIHByb3BlcnRpZXMgfSA9IG9wdGlvbnMucGFydGlhbFRleHRGaWx0ZXI7XG4gICAgICBjb25zdCBvckZpbHRlciA9IHsgX19vcjogcHJvcGVydGllcy5tYXAocHJvcGVydHkgPT4gKHsgW3Byb3BlcnR5XTogYCoke3BhcnRpYWxUZXh0fSpgIH0pKSB9O1xuICAgICAgZnVsbFF1ZXJ5ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIoZnVsbFF1ZXJ5LCBvckZpbHRlcik7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJ0aWFsTmFtZSkge1xuICAgICAgLy8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgaWZcbiAgICAgIGZ1bGxRdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKGZ1bGxRdWVyeSwgeyBuYW1lOiBgKiR7b3B0aW9ucy5wYXJ0aWFsTmFtZX0qYCB9KTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNraXBMZWdhY3kpIHtcbiAgICAgIGZ1bGxRdWVyeSA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKGZ1bGxRdWVyeSwgeyBfX25vdDogbGVnYWN5RmlsdGVycyB9KTtcbiAgICB9XG5cbiAgICBmaWx0ZXJzID0ge1xuICAgICAgcXVlcnk6IHRoaXMucXVlcmllc1V0aWwuYnVpbGRRdWVyeShmdWxsUXVlcnkpLFxuICAgICAgcGFnZVNpemU6IDUwLFxuICAgICAgd2l0aFRvdGFsUGFnZXM6IHRydWUsXG4gICAgICAuLi4oKG9wdGlvbnMgJiYgb3B0aW9ucy5wYXJhbXMpIHx8IHt9KVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5Lmxpc3QoZmlsdGVycyk7XG4gIH1cblxuICAvLyBUT0RPOiBtZXJnZSB3aXRoIGNyZWF0ZSgpXG4gIGFzeW5jIHNhdmUoZGF0YTogTW9kYWxNb2RlbCwgdHlwZTogUmVwb3NpdG9yeVR5cGUsIG1vOiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0PiA9IHt9KSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFJlcG9zaXRvcnlUeXBlLkNPTkZJR1VSQVRJT046IHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihtbywge1xuICAgICAgICAgIHR5cGU6IFJlcG9zaXRvcnlUeXBlLkNPTkZJR1VSQVRJT04sXG4gICAgICAgICAgY29uZmlndXJhdGlvblR5cGU6IGRhdGEuc2VsZWN0ZWQgPyBkYXRhLnNlbGVjdGVkLmNvbmZpZ3VyYXRpb25UeXBlIDogdW5kZWZpbmVkLFxuICAgICAgICAgIG5hbWU6IGRhdGEudmVyc2lvbixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICBkZXZpY2VUeXBlOiBkYXRhLmRldmljZVR5cGUsXG4gICAgICAgICAgYzh5X0dsb2JhbDoge31cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghZGF0YS5kZXZpY2VUeXBlICYmIG1vLmlkKSB7XG4gICAgICAgICAgbW8uZGV2aWNlVHlwZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkYXRhLnNlbGVjdGVkICYmIG1vLmlkKSB7XG4gICAgICAgICAgbW8uY29uZmlndXJhdGlvblR5cGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGV4aXN0aW5nVXJsID0gbW8udXJsO1xuICAgIGlmIChkYXRhLmJpbmFyeS51cmwpIHtcbiAgICAgIG1vLnVybCA9IGRhdGEuYmluYXJ5LnVybDtcbiAgICB9IGVsc2UgaWYgKGRhdGEuYmluYXJ5LmZpbGUpIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuY3JlYXRlKGRhdGEuYmluYXJ5LmZpbGUsIHtcbiAgICAgICAgYzh5X0dsb2JhbDoge31cbiAgICAgIH0gYXMgUGFydGlhbDxJTWFuYWdlZE9iamVjdD4pO1xuICAgICAgbW8udXJsID0gcmVzcG9uc2UuZGF0YS5zZWxmO1xuICAgIH1cblxuICAgIGlmIChtby5pZCkge1xuICAgICAgcmV0dXJuIHRoaXMudXBkYXRlRW50cnkobW8sIGV4aXN0aW5nVXJsKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlRW50cnkobW8pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlKG1vZGFsOiBNb2RhbE1vZGVsLCB0eXBlOiBSZXBvc2l0b3J5VHlwZSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBSZXBvc2l0b3J5VHlwZS5GSVJNV0FSRTpcbiAgICAgIGNhc2UgUmVwb3NpdG9yeVR5cGUuU09GVFdBUkU6XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUZpcm13YXJlT3JTb2Z0d2FyZShtb2RhbCwgdHlwZSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY3JlYXRlRmlybXdhcmVPclNvZnR3YXJlKFxuICAgIG1vZGFsOiBNb2RhbE1vZGVsLFxuICAgIHR5cGU6IFJlcG9zaXRvcnlUeXBlXG4gICk6IFByb21pc2U8UmVwb3NpdG9yeUNhdGVnb3J5PiB7XG4gICAgbGV0IGJpbmFyeTogSU1hbmFnZWRPYmplY3RCaW5hcnk7XG4gICAgbGV0IGJpbmFyeVVSTDogc3RyaW5nO1xuICAgIGxldCByZXBvc2l0b3J5RW50cnk6IFJlcG9zaXRvcnlDYXRlZ29yeTtcbiAgICBsZXQgcmVwb3NpdG9yeUJpbmFyeTogRmlybXdhcmVCaW5hcnkgfCBTb2Z0d2FyZUJpbmFyeTtcbiAgICBjb25zdCBtb3MgPSBbXTtcbiAgICBjb25zdCB7XG4gICAgICBzZWxlY3RlZDogeyBpZDogc2VsZWN0ZWRJZCB9LFxuICAgICAgYmluYXJ5OiB7IGZpbGUsIHVybCB9XG4gICAgfSA9IG1vZGFsO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZmlsZSkge1xuICAgICAgICAoeyBkYXRhOiBiaW5hcnkgfSA9IGF3YWl0IHRoaXMuc2F2ZUJpbmFyeShmaWxlKSk7XG4gICAgICAgICh7IHNlbGY6IGJpbmFyeVVSTCB9ID0gYmluYXJ5KTtcbiAgICAgICAgbW9zLnB1c2goYmluYXJ5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJpbmFyeVVSTCA9IHVybDtcbiAgICAgIH1cblxuICAgICAgKHsgZGF0YTogcmVwb3NpdG9yeUVudHJ5IH0gPSBhd2FpdCB0aGlzLmNyZWF0ZU9yVXBkYXRlUmVwb3NpdG9yeUVudHJ5KG1vZGFsLCB0eXBlKSk7XG4gICAgICBpZiAoaXNOaWwoc2VsZWN0ZWRJZCkpIHtcbiAgICAgICAgbW9zLnB1c2gocmVwb3NpdG9yeUVudHJ5KTtcbiAgICAgIH1cblxuICAgICAgKHsgZGF0YTogcmVwb3NpdG9yeUJpbmFyeSB9ID0gYXdhaXQgdGhpcy5jcmVhdGVSZXBvc2l0b3J5QmluYXJ5KFxuICAgICAgICBtb2RhbCxcbiAgICAgICAgYmluYXJ5VVJMLFxuICAgICAgICB0eXBlLFxuICAgICAgICByZXBvc2l0b3J5RW50cnlcbiAgICAgICkpO1xuICAgICAgbW9zLnB1c2gocmVwb3NpdG9yeUJpbmFyeSk7XG5cbiAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubGlua0JpbmFyeShyZXBvc2l0b3J5QmluYXJ5LCBiaW5hcnkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVwb3NpdG9yeUVudHJ5O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmNsZWFuVXAobW9zKTtcbiAgICAgIHRoaXMuZXJyb3JNc2coKTtcblxuICAgICAgLy8gUHJvcGFnYXRlIGVycm9yXG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBzYXZlQmluYXJ5KGZpbGU6IEZpbGUpOiBQcm9taXNlPElSZXN1bHQ8SU1hbmFnZWRPYmplY3RCaW5hcnk+PiB7XG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5QmluYXJ5LmNyZWF0ZShmaWxlLCB7IGM4eV9HbG9iYWw6IHt9IH0gYXMgUGFydGlhbDxJTWFuYWdlZE9iamVjdD4pO1xuICB9XG5cbiAgY3JlYXRlT3JVcGRhdGVSZXBvc2l0b3J5RW50cnkoXG4gICAgbW9kYWw6IE1vZGFsTW9kZWwsXG4gICAgdHlwZTogUmVwb3NpdG9yeVR5cGVcbiAgKTogUHJvbWlzZTxJUmVzdWx0PFJlcG9zaXRvcnlDYXRlZ29yeT4+IHtcbiAgICBjb25zdCB7XG4gICAgICBzZWxlY3RlZDogeyBpZCwgbmFtZSB9LFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICBkZXZpY2VUeXBlXG4gICAgfSA9IG1vZGFsO1xuXG4gICAgY29uc3QgbW8gPSB7XG4gICAgICBpZCxcbiAgICAgIG5hbWU6IGlkID8gdW5kZWZpbmVkIDogbmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgdHlwZTogaWQgPyB1bmRlZmluZWQgOiB0eXBlLFxuICAgICAgYzh5X0dsb2JhbDoge31cbiAgICB9O1xuXG4gICAgaWYgKGRldmljZVR5cGUpIHtcbiAgICAgIHNldChtbywgJ2M4eV9GaWx0ZXIudHlwZScsIGRldmljZVR5cGUpO1xuICAgIH1cblxuICAgIHJldHVybiBpZFxuICAgICAgPyAodGhpcy5pbnZlbnRvcnkudXBkYXRlKG1vKSBhcyBQcm9taXNlPElSZXN1bHQ8UmVwb3NpdG9yeUNhdGVnb3J5Pj4pXG4gICAgICA6ICh0aGlzLmludmVudG9yeS5jcmVhdGUobW8pIGFzIFByb21pc2U8SVJlc3VsdDxSZXBvc2l0b3J5Q2F0ZWdvcnk+Pik7XG4gIH1cblxuICBjcmVhdGVSZXBvc2l0b3J5QmluYXJ5KFxuICAgIG1vZGFsOiBNb2RhbE1vZGVsLFxuICAgIGJpbmFyeVVSTDogc3RyaW5nLFxuICAgIHR5cGU6IFJlcG9zaXRvcnlUeXBlLFxuICAgIHBhcmVudDogUmVwb3NpdG9yeUNhdGVnb3J5XG4gICk6IFByb21pc2U8SVJlc3VsdDxGaXJtd2FyZUJpbmFyeSB8IFNvZnR3YXJlQmluYXJ5IHwgRmlybXdhcmVQYXRjaEJpbmFyeT4+IHtcbiAgICBjb25zdCBtbyA9IHRoaXMucHJlcGFyZVJlcG9zaXRvcnlCaW5hcnlNTyhtb2RhbCwgYmluYXJ5VVJMLCB0eXBlKTtcblxuICAgIHJldHVybiB0aGlzLmludmVudG9yeS5jaGlsZEFkZGl0aW9uc0NyZWF0ZShtbywgcGFyZW50KSBhcyBQcm9taXNlPFxuICAgICAgSVJlc3VsdDxGaXJtd2FyZUJpbmFyeSB8IFNvZnR3YXJlQmluYXJ5IHwgRmlybXdhcmVQYXRjaEJpbmFyeT5cbiAgICA+O1xuICB9XG5cbiAgcHJlcGFyZVJlcG9zaXRvcnlCaW5hcnlNTyhtb2RhbDogTW9kYWxNb2RlbCwgYmluYXJ5VVJMOiBzdHJpbmcsIHR5cGU6IFJlcG9zaXRvcnlUeXBlKSB7XG4gICAgY29uc3QgeyB2ZXJzaW9uLCBwYXRjaFZlcnNpb24sIGRlcGVuZGVuY3kgfSA9IG1vZGFsO1xuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIHR5cGU6IFJFUE9TSVRPUllfQklOQVJZX1RZUEVTW3R5cGVdLFxuICAgICAgW3R5cGVdOiB7XG4gICAgICAgIHVybDogYmluYXJ5VVJMXG4gICAgICB9LFxuICAgICAgYzh5X0dsb2JhbDoge31cbiAgICB9O1xuXG4gICAgaWYgKGRlcGVuZGVuY3kpIHtcbiAgICAgIHNldChyZXN1bHQsIFt0eXBlLCAndmVyc2lvbiddLCBwYXRjaFZlcnNpb24pO1xuICAgICAgYXNzaWduKHJlc3VsdCwge1xuICAgICAgICBjOHlfUGF0Y2g6IHtcbiAgICAgICAgICBkZXBlbmRlbmN5OiBkZXBlbmRlbmN5LmM4eV9GaXJtd2FyZS52ZXJzaW9uXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXQocmVzdWx0LCBbdHlwZSwgJ3ZlcnNpb24nXSwgdmVyc2lvbik7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBhc3luYyBsaW5rQmluYXJ5KFxuICAgIHJlcG9zaXRvcnlCaW5hcnk6IEZpcm13YXJlQmluYXJ5IHwgU29mdHdhcmVCaW5hcnksXG4gICAgYmluYXJ5OiBJTWFuYWdlZE9iamVjdEJpbmFyeVxuICApIHtcbiAgICBjb25zdCB7IGlkOiByZXBvc2l0b3J5QmluYXJ5SWQgfSA9IHJlcG9zaXRvcnlCaW5hcnk7XG4gICAgaWYgKGJpbmFyeSkge1xuICAgICAgY29uc3QgeyBpZDogYmluYXJ5SWQgfSA9IGJpbmFyeTtcbiAgICAgIHJldHVybiB0aGlzLmludmVudG9yeS5jaGlsZEFkZGl0aW9uc0FkZChiaW5hcnlJZCwgcmVwb3NpdG9yeUJpbmFyeUlkKTtcbiAgICB9XG4gIH1cblxuICBjbGVhblVwKG1vc1RvRGVsZXRlOiBJSWRlbnRpZmllZFtdKSB7XG4gICAgbW9zVG9EZWxldGUuZm9yRWFjaChtbyA9PiB7XG4gICAgICBjb25zdCB7IGM4eV9Jc0JpbmFyeSB9ID0gbW87XG4gICAgICBpc1VuZGVmaW5lZChjOHlfSXNCaW5hcnkpID8gdGhpcy5kZWxldGUobW8pIDogdGhpcy5pbnZlbnRvcnlCaW5hcnkuZGVsZXRlKG1vKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZShlbnRpdHk6IElJZGVudGlmaWVkKTogUHJvbWlzZTxJUmVzdWx0PG51bGw+PiB7XG4gICAgcmV0dXJuIHRoaXMuaW52ZW50b3J5LmRlbGV0ZShlbnRpdHksIHsgZm9yY2VDYXNjYWRlOiB0cnVlIH0pO1xuICB9XG5cbiAgZXJyb3JNc2coKSB7XG4gICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnRmFpbGVkIHRvIHNhdmUnKTtcbiAgICB0aGlzLmFsZXJ0LmRhbmdlcihtc2cpO1xuICB9XG5cbiAgZ2V0QmFzZVZlcnNpb25zQ291bnQkKGVudHJ5OiBJTWFuYWdlZE9iamVjdCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgaWYgKHRoaXMuaXNMZWdhY3lFbnRyeShlbnRyeSkpIHtcbiAgICAgIHJldHVybiBvZigxKTtcbiAgICB9XG4gICAgcmV0dXJuIGZyb20odGhpcy5saXN0QmFzZVZlcnNpb25zKGVudHJ5LCB7IHBhZ2VTaXplOiAxLCB3aXRoVG90YWxQYWdlczogdHJ1ZSB9KSkucGlwZShcbiAgICAgIG1hcCgoeyBwYWdpbmcgfSkgPT4gcGFnaW5nLnRvdGFsUGFnZXMpXG4gICAgKTtcbiAgfVxuXG4gIGdldEJhc2VWZXJzaW9uRnJvbU1PKG1vOiBSZXBvc2l0b3J5QmluYXJ5KTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pc1BhdGNoKG1vKSA/IGdldChtbywgJ2M4eV9QYXRjaC5kZXBlbmRlbmN5JykgOiBnZXQobW8sICdjOHlfRmlybXdhcmUudmVyc2lvbicpO1xuICB9XG5cbiAgaXNQYXRjaChtbzogUmVwb3NpdG9yeUJpbmFyeSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIWdldChtbywgJ2M4eV9QYXRjaC5kZXBlbmRlbmN5Jyk7XG4gIH1cblxuICBnZXRQYXRjaFZlcnNpb25zQ291bnQkKGVudHJ5OiBJTWFuYWdlZE9iamVjdCwgYmFzZVZlcnNpb246IEZpcm13YXJlQmluYXJ5KTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBpZiAodGhpcy5pc0xlZ2FjeUVudHJ5KGJhc2VWZXJzaW9uKSkge1xuICAgICAgcmV0dXJuIG9mKDApO1xuICAgIH1cbiAgICByZXR1cm4gZnJvbShcbiAgICAgIHRoaXMubGlzdFBhdGNoVmVyc2lvbnMoZW50cnksIGJhc2VWZXJzaW9uLCB7IHBhZ2VTaXplOiAxLCB3aXRoVG90YWxQYWdlczogdHJ1ZSB9KVxuICAgICkucGlwZShtYXAoKHsgcGFnaW5nIH0pID0+IHBhZ2luZy50b3RhbFBhZ2VzKSk7XG4gIH1cblxuICBpc0xlZ2FjeUVudHJ5KGVudHJ5OiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0Pik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKGVudHJ5LnVybCk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgYWxsIHZlcnNpb25zIChiYXNlIGFuZCBwYXRjaCBvbmVzKSBvZiBnaXZlbiB0b3AgbGV2ZWwgZW50cnkuXG4gICAqIFZlcnNpb25zIGFyZSBvcmRlcmVkIGJ5IGNyZWF0aW9uIHRpbWUgKGFzc3VtaW5nIHRoZSBlYXJsaWVyIGNyZWF0ZWQsIHRoZSBvbGRlciB0aGUgdmVyc2lvbikuXG4gICAqIEBwYXJhbSBlbnRyeSBUb3AgbGV2ZWwgcmVwb3NpdG9yeSBlbnRyeS5cbiAgICogQHBhcmFtIHBhcmFtcyBBZGRpdGlvbmFsIHF1ZXJ5IHBhcmFtcy5cbiAgICovXG4gIGxpc3RBbGxWZXJzaW9ucyhlbnRyeTogUGFydGlhbDxJTWFuYWdlZE9iamVjdD4sIHBhcmFtcyA9IHt9KSB7XG4gICAgaWYgKHRoaXMuaXNMZWdhY3lFbnRyeShlbnRyeSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEJhc2VWZXJzaW9uUmVzdWx0TGlzdEZvckxlZ2FjeUVudHJ5KGVudHJ5KTtcbiAgICB9XG5cbiAgICBjb25zdCBWRVJTSU9OX0ZJTFRFUl9PUkRFUiA9IHtcbiAgICAgIF9fZmlsdGVyOiB7fSxcbiAgICAgIF9fb3JkZXJieTogW3sgJ2NyZWF0aW9uVGltZS5kYXRlJzogLTEgfSwgeyBjcmVhdGlvblRpbWU6IC0xIH1dXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5saXN0Q2hpbGRyZW4oZW50cnksIFZFUlNJT05fRklMVEVSX09SREVSLCBwYXJhbXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RzIGJhc2UgdmVyc2lvbnMgb2YgZ2l2ZW4gdG9wIGxldmVsIGVudHJ5LlxuICAgKiBWZXJzaW9ucyBhcmUgb3JkZXJlZCBieSBjcmVhdGlvbiB0aW1lIChhc3N1bWluZyB0aGUgZWFybGllciBjcmVhdGVkLCB0aGUgb2xkZXIgdGhlIHZlcnNpb24pLlxuICAgKiBAcGFyYW0gZW50cnkgVG9wIGxldmVsIHJlcG9zaXRvcnkgZW50cnkuXG4gICAqIEBwYXJhbSBwYXJhbXMgQWRkaXRpb25hbCBxdWVyeSBwYXJhbXMuXG4gICAqL1xuICBsaXN0QmFzZVZlcnNpb25zKGVudHJ5OiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0PiwgcGFyYW1zID0ge30pIHtcbiAgICBpZiAodGhpcy5pc0xlZ2FjeUVudHJ5KGVudHJ5KSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0QmFzZVZlcnNpb25SZXN1bHRMaXN0Rm9yTGVnYWN5RW50cnkoZW50cnkpO1xuICAgIH1cblxuICAgIGNvbnN0IE5PX1BBVENIX0ZJTFRFUl9PUkRFUiA9IHtcbiAgICAgIF9fZmlsdGVyOiB7XG4gICAgICAgIF9fbm90OiB7IF9faGFzOiAnYzh5X1BhdGNoJyB9XG4gICAgICB9LFxuICAgICAgX19vcmRlcmJ5OiBbeyAnY3JlYXRpb25UaW1lLmRhdGUnOiAtMSB9LCB7IGNyZWF0aW9uVGltZTogLTEgfV1cbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmxpc3RDaGlsZHJlbihlbnRyeSwgTk9fUEFUQ0hfRklMVEVSX09SREVSLCBwYXJhbXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RzIHBhdGNoIHZlcnNpb25zIG9mIGdpdmVuIGJhc2UgdmVyc2lvbiB1bmRlciB0aGUgZW50cnkuXG4gICAqIFZlcnNpb25zIGFyZSBvcmRlcmVkIGJ5IGNyZWF0aW9uIHRpbWUgKGFzc3VtaW5nIHRoZSBlYXJsaWVyIGNyZWF0ZWQsIHRoZSBvbGRlciB0aGUgdmVyc2lvbikuXG4gICAqIEBwYXJhbSBlbnRyeSBUb3AgbGV2ZWwgcmVwb3NpdG9yeSBlbnRyeS5cbiAgICogQHBhcmFtIGJhc2VWZXJzaW9uIEJhc2UgdmVyc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcyBBZGRpdGlvbmFsIHF1ZXJ5IHBhcmFtcy5cbiAgICovXG4gIGxpc3RQYXRjaFZlcnNpb25zKGVudHJ5OiBJTWFuYWdlZE9iamVjdCwgYmFzZVZlcnNpb246IEZpcm13YXJlQmluYXJ5IHwgc3RyaW5nLCBwYXJhbXMgPSB7fSkge1xuICAgIGNvbnN0IHZlcnNpb24gPSBpc1N0cmluZyhiYXNlVmVyc2lvbikgPyBiYXNlVmVyc2lvbiA6IGdldChiYXNlVmVyc2lvbiwgJ2M4eV9GaXJtd2FyZS52ZXJzaW9uJyk7XG4gICAgY29uc3QgUEFUQ0hfRklMVEVSX09SREVSID0ge1xuICAgICAgX19maWx0ZXI6IHtcbiAgICAgICAgJ2M4eV9QYXRjaC5kZXBlbmRlbmN5JzogdmVyc2lvblxuICAgICAgfSxcbiAgICAgIF9fb3JkZXJieTogW3sgJ2NyZWF0aW9uVGltZS5kYXRlJzogLTEgfSwgeyBjcmVhdGlvblRpbWU6IC0xIH1dXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5saXN0Q2hpbGRyZW4oZW50cnksIFBBVENIX0ZJTFRFUl9PUkRFUiwgcGFyYW1zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0cyBwYXRjaCB2ZXJzaW9ucyBvZiBnaXZlbiBiYXNlIHZlcnNpb24gdW5kZXIgdGhlIGVudHJ5IGluY2x1ZGluZyB0aGUgYmFzZSB2ZXJzaW9uLlxuICAgKiBWZXJzaW9ucyBhcmUgb3JkZXJlZCBieSBjcmVhdGlvbiB0aW1lIChhc3N1bWluZyB0aGUgZWFybGllciBjcmVhdGVkLCB0aGUgb2xkZXIgdGhlIHZlcnNpb24pLlxuICAgKiBJbiB0ZXJtcyBvZiBsZWdhY3kgYmFzZSB2ZXJzaW9uIHRoZSBlbnRyeSBnZXRzIHRyYW5zZm9ybWVkIHRvIGZpdCB0aGUgbmVlZGVkIGRhdGEgbW9kZWwuXG4gICAqIEBwYXJhbSBlbnRyeSBUb3AgbGV2ZWwgcmVwb3NpdG9yeSBlbnRyeS5cbiAgICogQHBhcmFtIGJhc2VWZXJzaW9uIEJhc2UgdmVyc2lvbi5cbiAgICogQHBhcmFtIHBhcmFtcyBBZGRpdGlvbmFsIHF1ZXJ5IHBhcmFtcy5cbiAgICovXG4gIGxpc3RCYXNlVmVyc2lvbkFuZFBhdGNoZXMoZW50cnk6IElNYW5hZ2VkT2JqZWN0LCBiYXNlVmVyc2lvbjogSU1hbmFnZWRPYmplY3QsIHBhcmFtcyA9IHt9KSB7XG4gICAgaWYgKHRoaXMuaXNMZWdhY3lFbnRyeShlbnRyeSkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICBkYXRhOiBbXG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYzh5X0Zpcm13YXJlOiB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbjogZW50cnkudmVyc2lvbixcbiAgICAgICAgICAgICAgICB1cmw6IGVudHJ5LnVybFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW50cnlcbiAgICAgICAgICApXG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IFBBVENIX0ZJTFRFUl9PUkRFUiA9IHtcbiAgICAgIF9fZmlsdGVyOiB7XG4gICAgICAgIF9fb3I6IHtcbiAgICAgICAgICAnYzh5X1BhdGNoLmRlcGVuZGVuY3knOiBiYXNlVmVyc2lvbi5jOHlfRmlybXdhcmUudmVyc2lvbixcbiAgICAgICAgICAnYzh5X0Zpcm13YXJlLnZlcnNpb24nOiBiYXNlVmVyc2lvbi5jOHlfRmlybXdhcmUudmVyc2lvblxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgX19vcmRlcmJ5OiBbeyAnYzh5X1BhdGNoLmRlcGVuZGVuY3knOiAxIH0sIHsgJ2M4eV9GaXJtd2FyZS52ZXJzaW9uJzogMSB9XVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMubGlzdENoaWxkcmVuKGVudHJ5LCBQQVRDSF9GSUxURVJfT1JERVIsIHBhcmFtcyk7XG4gIH1cblxuICBsaXN0Q2hpbGRyZW4oZW50cnk6IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+LCBmaWx0ZXJzID0ge30sIHBhcmFtczogYW55ID0ge30pIHtcbiAgICBjb25zdCBjaGlsZHJlbkZpbHRlcnMgPSB7IF9fYnlncm91cGlkOiBlbnRyeS5pZCB9O1xuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIoZmlsdGVycywgY2hpbGRyZW5GaWx0ZXJzKTtcbiAgICAvLyBGSVhNRTogbmVlZGVkIGJlY2F1c2Ugb2YgaXNzdWUgaW4gZm9yT2YgZGlyZWN0aXZlICguLi4pXG4gICAgcGFyYW1zLndpdGhUb3RhbFBhZ2VzID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkubGlzdFF1ZXJ5KHF1ZXJ5LCBwYXJhbXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoZXMgYWxsIGl0ZW1zIGZyb20gdGhlIGxpc3Qgc3RhcnRpbmcgd2l0aCB0aGUgcHJvdmlkZWQgcGFnZS5cbiAgICogQHBhcmFtIGZpcnN0UGFnZSBUaGUgZmlyc3QgcGFnZSBvZiB0aGUgbGlzdCB0byBmZXRjaCBhbGwgaXRlbXMgZm9yLlxuICAgKi9cbiAgYXN5bmMgZmV0Y2hBbGxJdGVtc0Zyb21MaXN0KGZpcnN0UGFnZSkge1xuICAgIGxldCBhbGxJdGVtcztcblxuICAgIGlmICghZmlyc3RQYWdlLnRoZW4pIHtcbiAgICAgIGFsbEl0ZW1zID0gWy4uLmZpcnN0UGFnZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB7IHBhZ2luZywgZGF0YTogaXRlbXMgfSA9IGF3YWl0IGZpcnN0UGFnZTtcbiAgICAgIGFsbEl0ZW1zID0gWy4uLml0ZW1zXTtcblxuICAgICAgd2hpbGUgKHBhZ2luZyAmJiBwYWdpbmcubmV4dFBhZ2UpIHtcbiAgICAgICAgKHsgcGFnaW5nLCBkYXRhOiBpdGVtcyB9ID0gYXdhaXQgcGFnaW5nLm5leHQoKSk7XG4gICAgICAgIGFsbEl0ZW1zID0gWy4uLmFsbEl0ZW1zLCAuLi5pdGVtc107XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGFsbEl0ZW1zO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdG9wIGxldmVsIHJlcG9zaXRvcnkgZW50cnkgbWFuYWdlZCBvYmplY3QgZm9yIGJhc2Ugb3IgcGF0Y2ggdmVyc2lvbi5cbiAgICogQHBhcmFtIG1vIEJhc2Ugb3IgcGF0Y2ggdmVyc2lvbiBtYW5hZ2VkIG9iamVjdCB3aXRoIHBhcmVudHMuXG4gICAqL1xuICBnZXRSZXBvc2l0b3J5RW50cnlNTyQobW86IElNYW5hZ2VkT2JqZWN0KTogT2JzZXJ2YWJsZTxJTWFuYWdlZE9iamVjdCB8IHVuZGVmaW5lZD4ge1xuICAgIGlmICghbW8pIHtcbiAgICAgIHJldHVybiBvZih1bmRlZmluZWQpO1xuICAgIH1cbiAgICBjb25zdCBbcmVmZXJlbmNlXSA9IGdldChtbywgJ2FkZGl0aW9uUGFyZW50cy5yZWZlcmVuY2VzJyk7XG4gICAgY29uc3QgaWQgPSBnZXQocmVmZXJlbmNlLCAnbWFuYWdlZE9iamVjdC5pZCcpO1xuICAgIHJldHVybiBpZFxuICAgICAgPyBmcm9tKHRoaXMuaW52ZW50b3J5LmRldGFpbChpZCwgeyB3aXRoQ2hpbGRyZW46IGZhbHNlIH0pKS5waXBlKG1hcCgoeyBkYXRhIH0pID0+IGRhdGEpKVxuICAgICAgOiBvZih1bmRlZmluZWQpO1xuICB9XG4gIC8qKlxuICAgKiBHZXRzIGJhc2Ugb3IgcGF0Y2ggdmVyc2lvbiBtYW5hZ2VkIG9iamVjdC5cbiAgICogQHBhcmFtIGRldmljZVJlcG9zaXRvcnlGcmFnbWVudCBEZXZpY2UgcmVwb3NpdG9yeSBmcmFnbWVudC5cbiAgICogQHBhcmFtIHR5cGUgVG9wIGxldmVsIHJlcG9zaXRvcnkgZW50cnkgdHlwZS5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb24gQ29uZmlndXJhdGlvbiBvYmplY3Qgd2l0aCBvcHRpb25zOlxuICAgKiAtICoqc2tpcExlZ2FjeSoqIC0gYGJvb2xlYW5gIC0gRXhjbHVkZSBsZWdhY3kgZW50cmllcy5cbiAgICogLSAqKmZpbHRlcnMqKiAtIGBvYmplY3RgIC0gRmlsdGVyIG9iamVjdC5cbiAgICpcbiAgICogQGRlcHJlY2F0ZWQgYXMgaXQgZG9lc24ndCBzdXBwb3J0ICdtaXNzaW5nIHVybCcgY2FzZVxuICAgKi9cbiAgZ2V0UmVwb3NpdG9yeUJpbmFyeU1vQnlWZXJzaW9uKFxuICAgIGRldmljZVJlcG9zaXRvcnlGcmFnbWVudDogRGV2aWNlRmlybXdhcmUgfCBEZXZpY2VTb2Z0d2FyZSxcbiAgICB0eXBlOiBSZXBvc2l0b3J5VHlwZSxcbiAgICB7IHNraXBMZWdhY3kgPSBmYWxzZSwgZmlsdGVycyA9IHt9IH06IHsgc2tpcExlZ2FjeT86IGJvb2xlYW47IGZpbHRlcnM/OiBvYmplY3QgfSA9IHt9XG4gICk6IFByb21pc2U8SU1hbmFnZWRPYmplY3Q+IHtcbiAgICBjb25zdCB7IHZlcnNpb24sIHVybCwgbmFtZSB9ID0gZGV2aWNlUmVwb3NpdG9yeUZyYWdtZW50O1xuICAgIGNvbnN0IHJlcG9zaXRvcnlCaW5hcnlUeXBlID0gUkVQT1NJVE9SWV9CSU5BUllfVFlQRVNbdHlwZV07XG4gICAgbGV0IHF1ZXJ5O1xuICAgIGNvbnN0IG5ld01vZGVsQmFzZVZlcnNpb25RdWVyeSA9IHtcbiAgICAgIFtgJHt0eXBlfS52ZXJzaW9uYF06IHZlcnNpb24sXG4gICAgICBbYCR7dHlwZX0udXJsYF06IHVybCxcbiAgICAgIHR5cGU6IHJlcG9zaXRvcnlCaW5hcnlUeXBlXG4gICAgfTtcbiAgICBjb25zdCBsZWdhY3lWZXJzaW9uUXVlcnkgPSB7IHVybCwgdHlwZSwgbmFtZSB9O1xuICAgIGZpbHRlcnMgPSB7IHdpdGhDaGlsZHJlbjogZmFsc2UsIHdpdGhQYXJlbnRzOiB0cnVlLCAuLi5maWx0ZXJzIH07XG5cbiAgICBpZiAoc2tpcExlZ2FjeSkge1xuICAgICAgcXVlcnkgPSB7XG4gICAgICAgIF9fYW5kOiB7XG4gICAgICAgICAgLi4ubmV3TW9kZWxCYXNlVmVyc2lvblF1ZXJ5XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHF1ZXJ5ID0ge1xuICAgICAgICBfX29yOiBbeyBfX2FuZDogeyAuLi5uZXdNb2RlbEJhc2VWZXJzaW9uUXVlcnkgfSB9LCB7IF9fYW5kOiB7IC4uLmxlZ2FjeVZlcnNpb25RdWVyeSB9IH1dXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmludmVudG9yeS5saXN0UXVlcnkocXVlcnksIGZpbHRlcnMpLnRoZW4oKHsgZGF0YSB9KSA9PiBoZWFkKGRhdGEpKTtcbiAgfVxuXG4gIGdldEJpbmFyeU5hbWUkKGJpbmFyeVVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICBpZiAoIWJpbmFyeVVybCkge1xuICAgICAgcmV0dXJuIG9mKCctLS0nKTtcbiAgICB9XG5cbiAgICBjb25zdCBiaW5hcnlJZCA9IHRoaXMuaW52ZW50b3J5QmluYXJ5LmdldElkRnJvbVVybChiaW5hcnlVcmwpO1xuICAgIGlmICghYmluYXJ5SWQpIHtcbiAgICAgIHJldHVybiBvZihiaW5hcnlVcmwpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5pbnZlbnRvcnkuZGV0YWlsJChiaW5hcnlJZCkucGlwZShtYXAobW8gPT4gbW8ubmFtZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBhbiBpbnZlbnRvcnkgcXVlcnkgb2JqZWN0IHdoaWNoIGNhbiBiZSB1c2VkIHRvIGZpbmRcbiAgICogcmVwb3NpdG9yeSBlbnRyaWVzIG9mIHNwZWNpZmllZCB0eXBlIG1hdGNoaW5nIHRoZSB0eXBlIG9mIHByb3ZpZGVkIGRldmljZS5cbiAgICogQHBhcmFtIHJlcG9zaXRvcnlUeXBlIFRoZSB0eXBlIG9mIHJlcG9zaXRvcnkgZW50cmllcyB3aGljaCB3aWxsIGJlIHF1ZXJpZWQgd2l0aCB0aGUgZ2VuZXJhdGVkIHF1ZXJ5LlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG1hdGNoaW5nIHJlcG9zaXRvcnkgZW50cmllcyB3aWxsIGJlIHF1ZXJpZWQgd2l0aCB0aGUgZ2VuZXJhdGVkIHF1ZXJ5LlxuICAgKi9cbiAgZ2V0RGV2aWNlVHlwZVF1ZXJ5KHJlcG9zaXRvcnlUeXBlOiBSZXBvc2l0b3J5VHlwZSwgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCk6IG9iamVjdCB7XG4gICAgbGV0IHJlc3VsdCA9IHsgdHlwZTogcmVwb3NpdG9yeVR5cGUgfTtcbiAgICBpZiAoZGV2aWNlLnR5cGUpIHtcbiAgICAgIGlmIChyZXBvc2l0b3J5VHlwZSA9PT0gUmVwb3NpdG9yeVR5cGUuQ09ORklHVVJBVElPTikge1xuICAgICAgICByZXN1bHQgPSB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihyZXN1bHQsIHtcbiAgICAgICAgICBfX29yOiBbeyBkZXZpY2VUeXBlOiBkZXZpY2UudHlwZSB9LCB7IF9fbm90OiB7IF9faGFzOiBgZGV2aWNlVHlwZWAgfSB9XVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMucXVlcmllc1V0aWwuYWRkQW5kRmlsdGVyKHJlc3VsdCwge1xuICAgICAgICAgIF9fb3I6IFtcbiAgICAgICAgICAgIHsgJ2M4eV9GaWx0ZXIudHlwZSc6IGRldmljZS50eXBlIH0sXG4gICAgICAgICAgICB7ICdjOHlfRmlsdGVyLnR5cGUnOiAnJyB9LFxuICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogYGM4eV9GaWx0ZXIudHlwZWAgfSB9XG4gICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgYW4gaW52ZW50b3J5IHF1ZXJ5IG9iamVjdCB3aGljaCBjYW4gYmUgdXNlZCB0byBmaW5kIGNvbmZpZ3VyYXRpb24gcmVwb3NpdG9yeSBlbnRyaWVzXG4gICAqIG1hdGNoaW5nIHRoZSB0eXBlIG9mIHByb3ZpZGVkIGRldmljZSBhbmQgc3BlY2lmaWVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBtYXRjaGluZyByZXBvc2l0b3J5IGVudHJpZXMgd2lsbCBiZSBxdWVyaWVkIHdpdGggdGhlIGdlbmVyYXRlZCBxdWVyeS5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIENvbmZpZ3VyYXRpb24gdHlwZSBmb3Igd2hpY2ggbWF0Y2hpbmcgcmVwb3NpdG9yeSBlbnRyaWVzIHdpbGwgYmUgcXVlcmllZCB3aXRoIHRoZSBnZW5lcmF0ZWQgcXVlcnkuXG4gICAqL1xuICBnZXRDb25maWd1cmF0aW9uVHlwZVF1ZXJ5KGRldmljZTogSU1hbmFnZWRPYmplY3QsIGNvbmZpZ3VyYXRpb25UeXBlOiBzdHJpbmcpOiBvYmplY3Qge1xuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5nZXREZXZpY2VUeXBlUXVlcnkoUmVwb3NpdG9yeVR5cGUuQ09ORklHVVJBVElPTiwgZGV2aWNlKTtcbiAgICByZXR1cm4gdGhpcy5xdWVyaWVzVXRpbC5hZGRBbmRGaWx0ZXIocXVlcnksIHtcbiAgICAgIF9fb3I6IFtcbiAgICAgICAgeyBjb25maWd1cmF0aW9uVHlwZSB9LFxuICAgICAgICB7IGNvbmZpZ3VyYXRpb25UeXBlOiAnJyB9LFxuICAgICAgICB7IF9fbm90OiB7IF9faGFzOiBgY29uZmlndXJhdGlvblR5cGVgIH0gfVxuICAgICAgXVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGxpc3Qgb2Ygc29mdHdhcmUgaW5zdGFsbGVkIGluIHRoZSBkZXZpY2UgaW4gdGhlIHVuaWZvcm0gZm9ybWF0LlxuICAgKiBTdXBwb3J0cyBjOHlfU29mdHdhcmVMaXN0IGFuZCBjOHlfU29mdHdhcmUgZnJhZ21lbnRzLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2Ugd2hvc2Ugc29mdHdhcmUgbGlzdCBzaG91bGQgYmUgcmV0dXJuZWQuXG4gICAqL1xuICBnZXREZXZpY2VTb2Z0d2FyZUxpc3QoZGV2aWNlOiBJTWFuYWdlZE9iamVjdCk6IERldmljZVNvZnR3YXJlW10ge1xuICAgIGlmIChkZXZpY2UuYzh5X1NvZnR3YXJlTGlzdCkge1xuICAgICAgcmV0dXJuIGNsb25lRGVlcChkZXZpY2UuYzh5X1NvZnR3YXJlTGlzdCk7XG4gICAgfVxuICAgIGlmIChkZXZpY2UuYzh5X1NvZnR3YXJlKSB7XG4gICAgICByZXR1cm4gX21hcChkZXZpY2UuYzh5X1NvZnR3YXJlLCAodmVyc2lvbiwgbmFtZSkgPT4gKHsgbmFtZSwgdmVyc2lvbiB9KSk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIHNvZnR3YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZSBhbmQgdGhlIGxpc3Qgb2YgY2hhbmdlcywgYW5kIHNlbmRzIGl0IHRvIHRoZSBkZXZpY2UuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSB3aGljaCB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZCBmb3IgYW5kIHNlbnQgdG8uXG4gICAqIEBwYXJhbSBjaGFuZ2VzIFRoZSBsaXN0IG9mIHNvZnR3YXJlIGNoYW5nZXMgd2hpY2ggc2hvdWxkIGJlIGFwcGxpZWQuXG4gICAqL1xuICBhc3luYyBjcmVhdGVTb2Z0d2FyZVVwZGF0ZU9wZXJhdGlvbihcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LFxuICAgIGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW11cbiAgKTogUHJvbWlzZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gdGhpcy5nZXRTb2Z0d2FyZVVwZGF0ZU9wZXJhdGlvbihkZXZpY2UsIGNoYW5nZXMpO1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy5vcGVyYXRpb24uY3JlYXRlKG9wZXJhdGlvbikpLmRhdGE7XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBzb2Z0d2FyZSB1cGRhdGUgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIGNoYW5nZXMuXG4gICAqIFJldHVybmVkIG9wZXJhdGlvbiB0eXBlIGRlcGVuZHMgb24gZGV2aWNlJ3Mgc3VwcG9ydGVkIG9wZXJhdGlvbnMuXG4gICAqIFN1cHBvcnRzIGM4eV9Tb2Z0d2FyZVVwZGF0ZSwgYzh5X1NvZnR3YXJlTGlzdCwgYW5kIGM4eV9Tb2Z0d2FyZSBvcGVyYXRpb25zLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqIEBwYXJhbSBjaGFuZ2VzIFRoZSBsaXN0IG9mIHNvZnR3YXJlIGNoYW5nZXMgd2hpY2ggc2hvdWxkIGJlIGFwcGxpZWQuXG4gICAqL1xuICBnZXRTb2Z0d2FyZVVwZGF0ZU9wZXJhdGlvbihkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LCBjaGFuZ2VzOiBEZXZpY2VTb2Z0d2FyZUNoYW5nZVtdKTogSU9wZXJhdGlvbiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uOiBJT3BlcmF0aW9uID0ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgQXBwbHkgc29mdHdhcmUgY2hhbmdlczogJHtjaGFuZ2VzXG4gICAgICAgIC5tYXAoXG4gICAgICAgICAgY2hhbmdlID0+XG4gICAgICAgICAgICBgJHtjaGFuZ2UuYWN0aW9ufSBcIiR7Y2hhbmdlLm5hbWV9XCIke1xuICAgICAgICAgICAgICBjaGFuZ2UudmVyc2lvbiA/IGAgKHZlcnNpb246ICR7Y2hhbmdlLnZlcnNpb259KWAgOiAnJ1xuICAgICAgICAgICAgfWBcbiAgICAgICAgKVxuICAgICAgICAuam9pbignLCAnKX1gXG4gICAgfTtcbiAgICBpZiAoZGV2aWNlLmM4eV9TdXBwb3J0ZWRPcGVyYXRpb25zLmluY2x1ZGVzKCdjOHlfU29mdHdhcmVVcGRhdGUnKSkge1xuICAgICAgb3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVVwZGF0ZSA9IGNsb25lRGVlcChjaGFuZ2VzKTtcbiAgICB9IGVsc2UgaWYgKGRldmljZS5jOHlfU3VwcG9ydGVkT3BlcmF0aW9ucy5pbmNsdWRlcygnYzh5X1NvZnR3YXJlTGlzdCcpKSB7XG4gICAgICBvcGVyYXRpb24uYzh5X1NvZnR3YXJlTGlzdCA9IGNsb25lRGVlcChkZXZpY2UuYzh5X1NvZnR3YXJlTGlzdCkgfHwgW107XG4gICAgICBjaGFuZ2VzLmZvckVhY2goY2hhbmdlID0+IHtcbiAgICAgICAgY29uc3QgZGV2aWNlU29mdHdhcmU6IERldmljZVNvZnR3YXJlID0gcGljayhjaGFuZ2UsIFsnbmFtZScsICd2ZXJzaW9uJywgJ3VybCddKTtcbiAgICAgICAgaWYgKGNoYW5nZS5hY3Rpb24gPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgcmVtb3ZlKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0LCBkZXZpY2VTb2Z0d2FyZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYW5nZS5hY3Rpb24gPT09ICdpbnN0YWxsJykge1xuICAgICAgICAgIG9wZXJhdGlvbi5jOHlfU29mdHdhcmVMaXN0LnB1c2goZGV2aWNlU29mdHdhcmUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGRldmljZS5jOHlfU3VwcG9ydGVkT3BlcmF0aW9ucy5pbmNsdWRlcygnYzh5X1NvZnR3YXJlJykpIHtcbiAgICAgIG9wZXJhdGlvbi5jOHlfU29mdHdhcmUgPSBjbG9uZURlZXAoZGV2aWNlLmM4eV9Tb2Z0d2FyZSkgfHwge307XG4gICAgICBjaGFuZ2VzLmZvckVhY2goY2hhbmdlID0+IHtcbiAgICAgICAgaWYgKGNoYW5nZS5hY3Rpb24gPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgZGVsZXRlIG9wZXJhdGlvbi5jOHlfU29mdHdhcmVbY2hhbmdlLm5hbWVdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2UuYWN0aW9uID09PSAnaW5zdGFsbCcpIHtcbiAgICAgICAgICBvcGVyYXRpb24uYzh5X1NvZnR3YXJlW2NoYW5nZS5uYW1lXSA9IGNoYW5nZS52ZXJzaW9uO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG9wZXJhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0cyB0aGUgbGlzdCBvZiBkZXZpY2Ugc29mdHdhcmUgY2hhbmdlcyBmcm9tIGdpdmVuIG9wZXJhdGlvbiBpbiB0aGUgY29udGV4dCBvZiBnaXZlbiBkZXZpY2UuXG4gICAqIEBwYXJhbSBvcGVyYXRpb24gVGhlIG9wZXJhdGlvbiBmcm9tIHdoaWNoIHRoZSBsaXN0IHNob3VsZCBiZSBleHRyYWN0ZWQuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIHRhcmdldCBkZXZpY2Ugb2YgdGhlIG9wZXJhdGlvbi5cbiAgICovXG4gIGdldERldmljZVNvZnR3YXJlQ2hhbmdlc0Zyb21PcGVyYXRpb24oXG4gICAgb3BlcmF0aW9uOiBJT3BlcmF0aW9uLFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3RcbiAgKTogRGV2aWNlU29mdHdhcmVDaGFuZ2VbXSB7XG4gICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVVcGRhdGUpIHtcbiAgICAgIHJldHVybiBjbG9uZURlZXAob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZVVwZGF0ZSk7XG4gICAgfVxuICAgIGlmIChvcGVyYXRpb24uYzh5X1NvZnR3YXJlTGlzdCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RGV2aWNlU29mdHdhcmVDaGFuZ2VzRnJvbVNvZnR3YXJlTGlzdE9wZXJhdGlvbihvcGVyYXRpb24sIGRldmljZSk7XG4gICAgfVxuICAgIGlmIChvcGVyYXRpb24uYzh5X1NvZnR3YXJlKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXREZXZpY2VTb2Z0d2FyZUNoYW5nZXNGcm9tU29mdHdhcmVPcGVyYXRpb24ob3BlcmF0aW9uLCBkZXZpY2UpO1xuICAgIH1cbiAgICByZXR1cm4gW107XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBmaXJtd2FyZSB1cGRhdGUgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UgYW5kIHRoZSBzZWxlY3RlZCByZXBvc2l0b3J5IGJpbmFyeSwgYW5kIHNlbmRzIGl0IHRvIHRoZSBkZXZpY2UuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSB3aGljaCB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZCBmb3IgYW5kIHNlbnQgdG8uXG4gICAqIEBwYXJhbSBzZWxlY3RlZE9wdGlvbiBUaGUgc2VsZWN0ZWQgcmVwb3NpdG9yeSBiaW5hcnkgb3B0aW9uLlxuICAgKi9cbiAgYXN5bmMgY3JlYXRlRmlybXdhcmVVcGRhdGVPcGVyYXRpb24oXG4gICAgZGV2aWNlOiBJTWFuYWdlZE9iamVjdCxcbiAgICBzZWxlY3RlZE9wdGlvbjogU2VsZWN0ZWRSZXBvc2l0b3J5QmluYXJ5XG4gICk6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGNvbnN0IG9wZXJhdGlvbiA9IHRoaXMuZ2V0RmlybXdhcmVVcGRhdGVPcGVyYXRpb24oZGV2aWNlLCBzZWxlY3RlZE9wdGlvbik7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLm9wZXJhdGlvbi5jcmVhdGUob3BlcmF0aW9uKSkuZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGZpcm13YXJlIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZSBhbmQgc2VsZWN0ZWQgdmVyc2lvbi5cbiAgICogU3VwcG9ydHMgYzh5X0Zpcm13YXJlIG9wZXJhdGlvbi5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCBvcGVyYXRpb24gc2hvdWxkIGJlIHByZXBhcmVkLlxuICAgKiBAcGFyYW0gc2VsZWN0ZWRPcHRpb24gU2VsZWN0ZWQgZmlybXdhcmUgdmVyc2lvbi5cbiAgICovXG4gIGdldEZpcm13YXJlVXBkYXRlT3BlcmF0aW9uKFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgc2VsZWN0ZWRPcHRpb246IFNlbGVjdGVkUmVwb3NpdG9yeUJpbmFyeVxuICApOiBJT3BlcmF0aW9uIHtcbiAgICBkZWxldGUgc2VsZWN0ZWRPcHRpb24uaWQ7XG5cbiAgICBjb25zdCBvcGVyYXRpb246IElPcGVyYXRpb24gPSB7XG4gICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgZGVzY3JpcHRpb246IGBVcGRhdGUgZmlybXdhcmUgdG86IFwiJHtzZWxlY3RlZE9wdGlvbi5uYW1lfVwiJHtcbiAgICAgICAgc2VsZWN0ZWRPcHRpb24udmVyc2lvbiA/IGAgKHZlcnNpb246ICR7c2VsZWN0ZWRPcHRpb24udmVyc2lvbn0pYCA6ICcnXG4gICAgICB9YCxcbiAgICAgIGM4eV9GaXJtd2FyZTogeyAuLi5zZWxlY3RlZE9wdGlvbiB9XG4gICAgfTtcblxuICAgIHJldHVybiBvcGVyYXRpb247XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBjb25maWd1cmF0aW9uIGZpbGUgdXBsb2FkIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCBjb25maWd1cmF0aW9uIHR5cGUuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIFNlbGVjdGVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGlzTGVnYWN5ICBBIGxlZ2FjeSBvcGVyYXRpb24gaXMgY3JlYXRlZCB3aXRob3V0IGEgY29uZmlndXJhdGlvblR5cGUuXG4gICAqL1xuICBnZXRVcGxvYWRDb25maWd1cmF0aW9uRmlsZU9wZXJhdGlvbihcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LFxuICAgIGNvbmZpZ3VyYXRpb25UeXBlOiBzdHJpbmcsXG4gICAgaXNMZWdhY3k6IGJvb2xlYW4gPSBmYWxzZVxuICApOiBJT3BlcmF0aW9uIHtcbiAgICBpZiAoaXNMZWdhY3kpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUmV0cmlldmUgY29uZmlndXJhdGlvbiBzbmFwc2hvdCBmcm9tIGRldmljZSAke2RldmljZS5uYW1lfWAsXG4gICAgICAgIGM4eV9VcGxvYWRDb25maWdGaWxlOiB7fVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICBkZXNjcmlwdGlvbjogYFJldHJpZXZlICR7Y29uZmlndXJhdGlvblR5cGV9IGNvbmZpZ3VyYXRpb24gc25hcHNob3QgZnJvbSBkZXZpY2UgJHtcbiAgICAgICAgZGV2aWNlLm5hbWVcbiAgICAgIH1gLFxuICAgICAgYzh5X1VwbG9hZENvbmZpZ0ZpbGU6IHtcbiAgICAgICAgdHlwZTogY29uZmlndXJhdGlvblR5cGVcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBhcmVzIGEgY29uZmlndXJhdGlvbiBmaWxlIGRvd25sb2FkIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCBjb25maWd1cmF0aW9uIHR5cGUuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRldmljZSBmb3Igd2hpY2ggb3BlcmF0aW9uIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIFNlbGVjdGVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGJpbmFyeVVybCBUaGUgdXJsIG9mIGEgYmluYXJ5IHRvIGJlIGRvd25sb2FkZWQuXG4gICAqIEBwYXJhbSBpc0xlZ2FjeSBBIGxlZ2FjeSBvcGVyYXRpb24gaXMgY3JlYXRlZCB3aXRob3V0IGEgY29uZmlndXJhdGlvblR5cGUuXG4gICAqL1xuICBnZXREb3dubG9hZENvbmZpZ3VyYXRpb25GaWxlT3BlcmF0aW9uKFxuICAgIGRldmljZTogSU1hbmFnZWRPYmplY3QsXG4gICAgY29uZmlndXJhdGlvblR5cGU6IHN0cmluZyxcbiAgICBjb25maWdTbmFwc2hvdDogQ29uZmlndXJhdGlvblNuYXBzaG90LFxuICAgIGlzTGVnYWN5OiBib29sZWFuID0gZmFsc2VcbiAgKTogSU9wZXJhdGlvbiB7XG4gICAgaWYgKGlzTGVnYWN5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgICBkZXNjcmlwdGlvbjogYFNlbmQgY29uZmlndXJhdGlvbiBzbmFwc2hvdCAke2NvbmZpZ1NuYXBzaG90Lm5hbWV9IHRvIGRldmljZSAke2RldmljZS5uYW1lfWAsXG4gICAgICAgIGM4eV9Eb3dubG9hZENvbmZpZ0ZpbGU6IHtcbiAgICAgICAgICB1cmw6IGNvbmZpZ1NuYXBzaG90LmJpbmFyeVVybCxcbiAgICAgICAgICBjOHlfQ29uZmlndXJhdGlvbkR1bXA6IHtcbiAgICAgICAgICAgIGlkOiBjb25maWdTbmFwc2hvdC5pZFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGRldmljZUlkOiBkZXZpY2UuaWQsXG4gICAgICBkZXNjcmlwdGlvbjogYFNlbmQgY29uZmlndXJhdGlvbiBzbmFwc2hvdCAke1xuICAgICAgICBjb25maWdTbmFwc2hvdC5uYW1lXG4gICAgICB9IG9mIGNvbmZpZ3VyYXRpb24gdHlwZSAke2NvbmZpZ3VyYXRpb25UeXBlfSB0byBkZXZpY2UgJHtkZXZpY2UubmFtZX1gLFxuICAgICAgYzh5X0Rvd25sb2FkQ29uZmlnRmlsZToge1xuICAgICAgICB1cmw6IGNvbmZpZ1NuYXBzaG90LmJpbmFyeVVybCxcbiAgICAgICAgdHlwZTogY29uZmlndXJhdGlvblR5cGVcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGxhc3QgZmlybXdhcmUgdXBkYXRlIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlLlxuICAgKiBMb29rcyBmb3IgYzh5X0Zpcm13YXJlIG9wZXJhdGlvbnMuXG4gICAqIEBwYXJhbSBkZXZpY2VJZCBUaGUgSUQgb2YgdGhlIGRldmljZSB0byBmaW5kIGFuIG9wZXJhdGlvbiBmb3IuXG4gICAqL1xuICBhc3luYyBnZXRMYXN0RmlybXdhcmVVcGRhdGVPcGVyYXRpb24oZGV2aWNlSWQ6IHN0cmluZyB8IG51bWJlcik6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICBkZXZpY2VJZCxcbiAgICAgIGRhdGVGcm9tOiBuZXcgRGF0ZSgwKS50b0lTT1N0cmluZygpLFxuICAgICAgZGF0ZVRvOiBuZXcgRGF0ZShEYXRlLm5vdygpKS50b0lTT1N0cmluZygpLFxuICAgICAgcmV2ZXJ0OiB0cnVlLFxuICAgICAgcGFnZVNpemU6IDFcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZpcnN0TWF0Y2hpbmdPcGVyYXRpb24oW3sgLi4uZmlsdGVycywgZnJhZ21lbnRUeXBlOiAnYzh5X0Zpcm13YXJlJyB9XSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGFzdCBzb2Z0d2FyZSB1cGRhdGUgb3BlcmF0aW9uIGZvciBnaXZlbiBkZXZpY2UuXG4gICAqIExvb2tzIGZvciBjOHlfU29mdHdhcmVVcGRhdGUsIGM4eV9Tb2Z0d2FyZUxpc3QsIG9yIGM4eV9Tb2Z0d2FyZSBvcGVyYXRpb25zLlxuICAgKiBAcGFyYW0gZGV2aWNlSWQgVGhlIElEIG9mIHRoZSBkZXZpY2UgdG8gZmluZCBhbiBvcGVyYXRpb24gZm9yLlxuICAgKi9cbiAgYXN5bmMgZ2V0TGFzdFNvZnR3YXJlVXBkYXRlT3BlcmF0aW9uKGRldmljZUlkOiBzdHJpbmcgfCBudW1iZXIpOiBQcm9taXNlPElPcGVyYXRpb24+IHtcbiAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgZGV2aWNlSWQsXG4gICAgICBkYXRlRnJvbTogbmV3IERhdGUoMCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGRhdGVUbzogbmV3IERhdGUoRGF0ZS5ub3coKSkudG9JU09TdHJpbmcoKSxcbiAgICAgIHJldmVydDogdHJ1ZSxcbiAgICAgIHBhZ2VTaXplOiAxXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5nZXRGaXJzdE1hdGNoaW5nT3BlcmF0aW9uKFtcbiAgICAgIHsgLi4uZmlsdGVycywgZnJhZ21lbnRUeXBlOiAnYzh5X1NvZnR3YXJlVXBkYXRlJyB9LFxuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfU29mdHdhcmVMaXN0JyB9LFxuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfU29mdHdhcmUnIH1cbiAgICBdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJdGVyYXRlcyBvdmVyIHRoZSBsaXN0IG9mIGZpbHRlcnMgYW5kIHF1ZXJpZXMgdGhlIG9wZXJhdGlvbnMuXG4gICAqIElmIGEgcXVlcnkgcmV0dXJucyBhdCBsZWFzdCBvbmUgb3BlcmF0aW9uLCB0aGUgZmlyc3Qgb25lIHdpbGwgYmUgcmV0dXJuZWQuXG4gICAqIE90aGVyd2lzZSB0aGUgbmV4dCBxdWVyeSB3aWxsIGJlIHBlcmZvcm1lZC5cbiAgICogSWYgbm9uZSBvZiB0aGUgcXVlcmllcyByZXR1cm5zIGFueSBvcGVyYXRpb24sIG51bGwgd2lsbCBiZSByZXR1cm5lZC5cbiAgICogQHBhcmFtIGZpbHRlcnNMaXN0IFRoZSBsaXN0IG9mIGZpbHRlcnMgZm9yIHRoZSBxdWVyaWVzLlxuICAgKi9cbiAgYXN5bmMgZ2V0Rmlyc3RNYXRjaGluZ09wZXJhdGlvbihmaWx0ZXJzTGlzdDogYW55W10pOiBQcm9taXNlPElPcGVyYXRpb24+IHtcbiAgICBsZXQgbWF0Y2hpbmdPcGVyYXRpb24gPSBudWxsO1xuXG4gICAgZm9yIChjb25zdCBmaWx0ZXJzIG9mIGZpbHRlcnNMaXN0KSB7XG4gICAgICBjb25zdCBvcGVyYXRpb25zID0gKGF3YWl0IHRoaXMub3BlcmF0aW9uLmxpc3QoZmlsdGVycykpLmRhdGE7XG4gICAgICBpZiAob3BlcmF0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgbWF0Y2hpbmdPcGVyYXRpb24gPSBvcGVyYXRpb25zWzBdO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWF0Y2hpbmdPcGVyYXRpb247XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB0aGUgb3BlcmF0aW9uIGFuZCByZXR1cm5zIGFuIG9ic2VydmFibGUgdG8gdHJhY2sgaXRzIHByb2dyZXNzLlxuICAgKiBGYWlscyB0aGUgb2JzZXJ2YWJsZSB3aGVuIHRoZSBvcGVyYXRpb24gcmV0dXJucyBGQUlMRUQgc3RhdHVzLlxuICAgKiBDb21wbGV0ZXMgdGhlIG9ic2VydmFibGUgd2hlbiB0aGUgb3BlcmF0aW9uIHJldHVybnMgU1VDQ0VTU0ZVTCBzdGF0dXMuXG4gICAqIEBwYXJhbSBvcGVyYXRpb24gVGhlIG9wZXJhdGlvbiB0byBjcmVhdGUgYW5kIHRyYWNrLlxuICAgKi9cbiAgY3JlYXRlT2JzZXJ2ZWRPcGVyYXRpb24ob3BlcmF0aW9uOiBJT3BlcmF0aW9uKTogT2JzZXJ2YWJsZTxJT3BlcmF0aW9uPiB7XG4gICAgcmV0dXJuIGZyb20odGhpcy5vcGVyYXRpb24uY3JlYXRlKG9wZXJhdGlvbikpLnBpcGUoXG4gICAgICBtYXAoKHsgZGF0YSB9KSA9PiBkYXRhKSxcbiAgICAgIHRha2UoMSksXG4gICAgICBzd2l0Y2hNYXAoY3JlYXRlZE9wZXJhdGlvbiA9PiB0aGlzLm9ic2VydmVPcGVyYXRpb24oY3JlYXRlZE9wZXJhdGlvbikpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIG9ic2VydmFibGUgdG8gdHJhY2sgcHJvZ3Jlc3Mgb2YgZ2l2ZW4gb3BlcmF0aW9uLlxuICAgKiBGYWlscyB0aGUgb2JzZXJ2YWJsZSB3aGVuIHRoZSBvcGVyYXRpb24gcmV0dXJucyBGQUlMRUQgc3RhdHVzLlxuICAgKiBDb21wbGV0ZXMgdGhlIG9ic2VydmFibGUgd2hlbiB0aGUgb3BlcmF0aW9uIHJldHVybnMgU1VDQ0VTU0ZVTCBzdGF0dXMuXG4gICAqIEBwYXJhbSBvcGVyYXRpb24gVGhlIG9wZXJhdGlvbiB0byBiZSBvYnNlcnZlZC5cbiAgICovXG4gIG9ic2VydmVPcGVyYXRpb24ob3BlcmF0aW9uOiBJT3BlcmF0aW9uKTogT2JzZXJ2YWJsZTxJT3BlcmF0aW9uPiB7XG4gICAgY29uc3Qgb2JzZXJ2ZWRPcGVyYXRpb24kID0gb2Yob3BlcmF0aW9uKTtcbiAgICBjb25zdCBvcGVyYXRpb25VcGRhdGVzJCA9IG9ic2VydmVkT3BlcmF0aW9uJC5waXBlKFxuICAgICAgc3dpdGNoTWFwKG9ic2VydmVkT3BlcmF0aW9uID0+XG4gICAgICAgIHRoaXMucmVhbHRpbWUub2JzZXJ2YWJsZShgL29wZXJhdGlvbnMvJHtvYnNlcnZlZE9wZXJhdGlvbi5kZXZpY2VJZH1gKVxuICAgICAgKSxcbiAgICAgIG1hcCgoeyBkYXRhIH0pID0+IGRhdGEpLFxuICAgICAgd2l0aExhdGVzdEZyb20ob2JzZXJ2ZWRPcGVyYXRpb24kKSxcbiAgICAgIGZpbHRlcigoW29wZXJhdGlvblVwZGF0ZSwgb2JzZXJ2ZWRPcGVyYXRpb25dKSA9PiBvcGVyYXRpb25VcGRhdGUuaWQgPT09IG9ic2VydmVkT3BlcmF0aW9uLmlkKSxcbiAgICAgIHN3aXRjaE1hcCgoW29wZXJhdGlvblVwZGF0ZV0pID0+IHtcbiAgICAgICAgaWYgKG9wZXJhdGlvblVwZGF0ZS5zdGF0dXMgPT09IE9wZXJhdGlvblN0YXR1cy5GQUlMRUQpIHtcbiAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihvcGVyYXRpb25VcGRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvZihvcGVyYXRpb25VcGRhdGUpO1xuICAgICAgfSksXG4gICAgICB0YWtlV2hpbGUob3BlcmF0aW9uVXBkYXRlID0+IG9wZXJhdGlvblVwZGF0ZS5zdGF0dXMgIT09IE9wZXJhdGlvblN0YXR1cy5TVUNDRVNTRlVMLCB0cnVlKVxuICAgICk7XG4gICAgcmV0dXJuIG1lcmdlKG9ic2VydmVkT3BlcmF0aW9uJCwgb3BlcmF0aW9uVXBkYXRlcyQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYSBzaW5nbGUgZXZlbnQgd2l0aCBsYXRlc3QgY3JlYXRpb25UaW1lIGZvciB0aGUgZ2l2ZW4gZGV2aWNlIElkIGFuZCBldmVudCB0eXBlLlxuICAgKiBAcGFyYW0gZGV2aWNlSWQgVGhlIGRldmljZSBJZCBmb3Igd2hpY2ggdGhlIGV2ZW50cyBzaG91bGQgYmUgcXVlcmllZC5cbiAgICogQHBhcmFtIHR5cGUgRXZlbnQgdHlwZS5cbiAgICovXG4gIGFzeW5jIGdldExhdGVzdENvbmZpZ3VyYXRpb25FdmVudChcbiAgICBkZXZpY2VJZDogc3RyaW5nIHwgbnVtYmVyLFxuICAgIHR5cGU6IHN0cmluZ1xuICApOiBQcm9taXNlPElFdmVudCB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IGV2ZW50RmlsdGVyOiBvYmplY3QgPSB7XG4gICAgICBzb3VyY2U6IGRldmljZUlkLFxuICAgICAgdHlwZSxcbiAgICAgIGRhdGVGcm9tOiB0aGlzLmRhdGVGcm9tLnRvSVNPU3RyaW5nKCksXG4gICAgICBkYXRlVG86IHRoaXMuZGF0ZVRvLnRvSVNPU3RyaW5nKCksXG4gICAgICBwYWdlU2l6ZTogMVxuICAgIH07XG5cbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHRoaXMuZXZlbnQubGlzdChldmVudEZpbHRlcik7XG4gICAgcmV0dXJuIGRhdGFbMF07XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhIGxpc3Qgb2Ygb3BlcmF0aW9ucyBmb3IgdGhlIGdpdmVuIGRldmljZSBJZCwgYW5kIG9wZXJhdGlvbiB0eXBlLlxuICAgKiBAcGFyYW0gZGV2aWNlSWQgVGhlIGRldmljZSBJZCBmb3Igd2hpY2ggdGhlIG9wZXJhdGlvbiBzaG91bGQgYmUgcXVlcmllZC5cbiAgICogQHBhcmFtIG9wZXJhdGlvblR5cGUgT3BlcmF0aW9uIHR5cGUgZnJhZ21lbnQuXG4gICAqL1xuICBhc3luYyBnZXRDb25maWdGaWxlT3BlcmF0aW9uTGlzdChcbiAgICBkZXZpY2VJZDogc3RyaW5nIHwgbnVtYmVyLFxuICAgIG9wZXJhdGlvblR5cGU6IHN0cmluZ1xuICApOiBQcm9taXNlPElPcGVyYXRpb25bXT4ge1xuICAgIGNvbnN0IG9wZXJhdGlvbkZpbHRlcjogb2JqZWN0ID0ge1xuICAgICAgZGV2aWNlSWQsXG4gICAgICBmcmFnbWVudFR5cGU6IG9wZXJhdGlvblR5cGUsXG4gICAgICBkYXRlRnJvbTogdGhpcy5kYXRlRnJvbS50b0lTT1N0cmluZygpLFxuICAgICAgZGF0ZVRvOiB0aGlzLmRhdGVUby50b0lTT1N0cmluZygpLFxuICAgICAgcmV2ZXJ0OiB0cnVlLFxuICAgICAgcGFnZVNpemU6IDIwMDBcbiAgICB9O1xuXG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLm9wZXJhdGlvbi5saXN0KG9wZXJhdGlvbkZpbHRlcikpLmRhdGE7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBsYXRlc3QgdXBsb2FkZWQgY29uZmlndXJhdGlvbiBzbmFwc2hvdCBmb3IgdGhlIGdpdmVuIGRldmljZSwgYW5kIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCB0aGUgY29uZmlndXJhdGlvbiBzbmFwc2hvdCB3YXMgdXBsb2FkZWQuXG4gICAqIEBwYXJhbSBjb25maWd1cmF0aW9uVHlwZSBTZWxlY3RlZCBjb25maWd1cmF0aW9uIHR5cGUuXG4gICAqL1xuICBhc3luYyBnZXRDb25maWdTbmFwc2hvdChcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0LFxuICAgIGNvbmZpZ3VyYXRpb25UeXBlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxDb25maWd1cmF0aW9uU25hcHNob3QgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCBldmVudDogSUV2ZW50ID0gYXdhaXQgdGhpcy5nZXRMYXRlc3RDb25maWd1cmF0aW9uRXZlbnQoZGV2aWNlLmlkLCBjb25maWd1cmF0aW9uVHlwZSk7XG4gICAgbGV0IGNvbmZpZ1NuYXBzaG90OiBDb25maWd1cmF0aW9uU25hcHNob3Q7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBjb25maWdTbmFwc2hvdCA9IHtcbiAgICAgICAgdGltZTogZXZlbnQudGltZSxcbiAgICAgICAgbmFtZTogZXZlbnQudGV4dCxcbiAgICAgICAgZGV2aWNlVHlwZTogZGV2aWNlLnR5cGUsXG4gICAgICAgIGNvbmZpZ3VyYXRpb25UeXBlXG4gICAgICB9O1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uZmlnU25hcHNob3QuYmluYXJ5ID0gYXdhaXQgKGF3YWl0IHRoaXMuZXZlbnRCaW5hcnkuZG93bmxvYWQoZXZlbnQpKS50ZXh0KCk7XG4gICAgICAgIGlmIChldmVudC5jOHlfSXNCaW5hcnkpIHtcbiAgICAgICAgICBjb25maWdTbmFwc2hvdC5iaW5hcnlUeXBlID0gZXZlbnQuYzh5X0lzQmluYXJ5LnR5cGU7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgIGNvbnN0IG1zZyA9IGdldHRleHQoJ0NvdWxkIG5vdCBnZXQgdGhlIGJpbmFyeS4nKTtcbiAgICAgICAgdGhpcy5hbGVydC5kYW5nZXIobXNnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNvbmZpZ1NuYXBzaG90O1xuICB9XG5cbiAgYXN5bmMgZ2V0TGVnYWN5Q29uZmlnU25hcHNob3QoZGV2aWNlSWQpIHtcbiAgICBsZXQgY29uZmlnU25hcHNob3Q6IENvbmZpZ3VyYXRpb25TbmFwc2hvdDtcbiAgICBsZXQgbW87XG4gICAgY29uc3QgZGV2aWNlID0gKGF3YWl0IHRoaXMuaW52ZW50b3J5LmRldGFpbChkZXZpY2VJZCwgeyB3aXRoQ2hpbGRyZW46IGZhbHNlIH0pKS5kYXRhO1xuICAgIGNvbnN0IHNuYXBzaG90SWQgPSBkZXZpY2UuYzh5X0NvbmZpZ3VyYXRpb25EdW1wICYmIGRldmljZS5jOHlfQ29uZmlndXJhdGlvbkR1bXAuaWQ7XG4gICAgaWYgKCFzbmFwc2hvdElkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIG1vID0gKGF3YWl0IHRoaXMuaW52ZW50b3J5LmRldGFpbChzbmFwc2hvdElkKSkuZGF0YTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgLy8gZG8gbm90aGluZ1xuICAgIH1cbiAgICBpZiAobW8pIHtcbiAgICAgIGNvbmZpZ1NuYXBzaG90ID0ge1xuICAgICAgICB0aW1lOiBtby5jcmVhdGlvblRpbWUsXG4gICAgICAgIG5hbWU6IG1vLm5hbWVcbiAgICAgIH07XG4gICAgICBjb25maWdTbmFwc2hvdC5iaW5hcnkgPSBhd2FpdCB0aGlzLmdldEJpbmFyeVRleHQobW8udXJsLCB7IGFsbG93RXh0ZXJuYWw6IGZhbHNlIH0pO1xuICAgIH1cbiAgICByZXR1cm4gY29uZmlnU25hcHNob3Q7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGJpbmFyeSBvYmplY3QgYXMgdGV4dC5cbiAgICogQHBhcmFtIGJpbmFyeVVybCBUaGUgVVJMIHRvIGZpbmQgYmluYXJ5XG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKiphbGxvd0V4dGVybmFsKiogLSBgYm9vbGVhbmAgLSBhbGxvd3MgZG93bmxvYWRpbmcgZXh0ZXJuYWwgYmluYXJ5IGZpbGVcbiAgICogLSAqKm5vQWxlcnRzKiogLSBgYm9vbGVhbmAgLSBkbyBub3QgZGlzcGxheSBhbiBhbGVydCBtZXNzYWdlOyBkZWZhdWx0cyB0byBgZmFsc2VgXG4gICAqL1xuICBhc3luYyBnZXRCaW5hcnlUZXh0KFxuICAgIGJpbmFyeVVybDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHsgYWxsb3dFeHRlcm5hbDogYm9vbGVhbjsgbm9BbGVydHM/OiBib29sZWFuIH1cbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBiaW5hcnlJZCA9IHRoaXMuaW52ZW50b3J5QmluYXJ5LmdldElkRnJvbVVybChiaW5hcnlVcmwpO1xuICAgIGxldCByZXM7XG4gICAgaWYgKCFiaW5hcnlJZCAmJiBvcHRpb25zLmFsbG93RXh0ZXJuYWwpIHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuZ2V0RXh0ZXJuYWxCaW5hcnlSZXNwb25zZShiaW5hcnlVcmwsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMgPSBhd2FpdCB0aGlzLmdldEludGVybmFsQmluYXJ5UmVzcG9uc2UoYmluYXJ5SWQsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBpZiAoIXJlcykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiByZXMudGV4dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBiaW5hcnkgb2JqZWN0IGFzIEZpbGUuXG4gICAqIEBwYXJhbSBiaW5hcnlVcmwgVGhlIFVSTCB0byBmaW5kIGJpbmFyeVxuICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb2JqZWN0IHdpdGggYWRkaXRpb25hbCBvcHRpb25zOlxuICAgKiAtICoqYWxsb3dFeHRlcm5hbCoqIC0gYGJvb2xlYW5gIC0gYWxsb3dzIGRvd25sb2FkaW5nIGV4dGVybmFsIGJpbmFyeSBmaWxlXG4gICAqL1xuICBhc3luYyBnZXRCaW5hcnlGaWxlKGJpbmFyeVVybDogc3RyaW5nLCBvcHRpb25zOiB7IGFsbG93RXh0ZXJuYWw6IGJvb2xlYW4gfSk6IFByb21pc2U8RmlsZT4ge1xuICAgIGNvbnN0IGJpbmFyeUlkID0gdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKGJpbmFyeVVybCk7XG4gICAgaWYgKCFiaW5hcnlJZCAmJiAhb3B0aW9ucy5hbGxvd0V4dGVybmFsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gQFRPRE86IG5vdGUgdGhhdCBpdCBkb2Vzbid0IHNvbHZlIGlzc3VlIHdpdGggZXh0ZXJuYWwgYmluYXJ5IGhlcmUsIHN1Y2ggdXJsIHdvbid0IGhhdmUgYmluYXJ5SWQsIHNvIHdlIHdvbid0IGtub3cgdGhlIG5hbWUgb3IgY29udGVudFR5cGUgdG8gdXNlIGluIEZpbGUgY29uc3RydWN0b3IsIGxldCdzIGFkZCBhIEBGSVhNRSBjb21tZW50IGZvciBub3c/XG4gICAgY29uc3QgeyBuYW1lLCBjb250ZW50VHlwZSB9ID0gKGF3YWl0IHRoaXMuaW52ZW50b3J5LmRldGFpbChiaW5hcnlJZCkpLmRhdGE7XG4gICAgY29uc3QgcmVzID0gISFiaW5hcnlJZFxuICAgICAgPyBhd2FpdCB0aGlzLmdldEludGVybmFsQmluYXJ5UmVzcG9uc2UoYmluYXJ5SWQpXG4gICAgICA6IGF3YWl0IHRoaXMuZ2V0RXh0ZXJuYWxCaW5hcnlSZXNwb25zZShiaW5hcnlVcmwpO1xuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgcmVzLmFycmF5QnVmZmVyKCk7XG4gICAgcmV0dXJuIG5ldyBGaWxlKFthcnJheUJ1ZmZlcl0sIG5hbWUsIHsgdHlwZTogY29udGVudFR5cGUgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbGFzdCBjb25maWd1cmF0aW9uIHVwZGF0ZSBvcGVyYXRpb24gZm9yIGdpdmVuIGRldmljZS5cbiAgICogTG9va3MgZm9yIGM4eV9Db25maWd1cmF0aW9uIGFuZCBjOHlfU2VuZENvbmZpZ3VyYXRpb24gb3BlcmF0aW9ucy5cbiAgICogQHBhcmFtIGRldmljZUlkIFRoZSBJRCBvZiB0aGUgZGV2aWNlIHRvIGZpbmQgYW4gb3BlcmF0aW9uIGZvci5cbiAgICovXG4gIGFzeW5jIGdldExhc3RDb25maWdVcGRhdGVPcGVyYXRpb24oZGV2aWNlSWQ6IHN0cmluZyB8IG51bWJlcik6IFByb21pc2U8SU9wZXJhdGlvbj4ge1xuICAgIGNvbnN0IGZpbHRlcnMgPSB7XG4gICAgICBkZXZpY2VJZCxcbiAgICAgIGRhdGVGcm9tOiBuZXcgRGF0ZSgwKS50b0lTT1N0cmluZygpLFxuICAgICAgZGF0ZVRvOiBuZXcgRGF0ZShEYXRlLm5vdygpKS50b0lTT1N0cmluZygpLFxuICAgICAgcmV2ZXJ0OiB0cnVlLFxuICAgICAgcGFnZVNpemU6IDFcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZpcnN0TWF0Y2hpbmdPcGVyYXRpb24oW1xuICAgICAgeyAuLi5maWx0ZXJzLCBmcmFnbWVudFR5cGU6ICdjOHlfQ29uZmlndXJhdGlvbicgfSxcbiAgICAgIHsgLi4uZmlsdGVycywgZnJhZ21lbnRUeXBlOiAnYzh5X1NlbmRDb25maWd1cmF0aW9uJyB9XG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICogUHJlcGFyZXMgYSBjb25maWd1cmF0aW9uIGRvd25sb2FkIG9wZXJhdGlvbiBmb3IgZ2l2ZW4gZGV2aWNlIGFuZCBpdHMgY3VycmVudCBjb25maWd1cmF0aW9uLlxuICAgKiBTdXBwb3J0cyBjOHlfU2VuZENvbmZpZ3VyYXRpb24gb3BlcmF0aW9uLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqL1xuICBjcmVhdGVUZXh0QmFzZWRDb25maWd1cmF0aW9uUmVsb2FkT3BlcmF0aW9uKGRldmljZTogSU1hbmFnZWRPYmplY3QpOiBJT3BlcmF0aW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBnZXR0ZXh0KCdSZXF1ZXN0ZWQgY3VycmVudCBjb25maWd1cmF0aW9uJyksXG4gICAgICBjOHlfU2VuZENvbmZpZ3VyYXRpb246IHt9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlcyBhIGNvbmZpZ3VyYXRpb24gdXBkYXRlIG9wZXJhdGlvbiBmb3IgdGhlIGdpdmVuIGRldmljZS5cbiAgICogU3VwcG9ydHMgYzh5X0NvbmZpZ3VyYXRpb24gb3BlcmF0aW9uLlxuICAgKiBAcGFyYW0gZGV2aWNlIFRoZSBkZXZpY2UgZm9yIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgcHJlcGFyZWQuXG4gICAqIEBwYXJhbSBjb25maWcgVGhlIGNvbmZpZ3VyYXRpb24gd2hpY2ggd2lsbCB1cGRhdGUgdGhlIGV4aXN0aW5nIG9uZS5cbiAgICovXG4gIGNyZWF0ZVRleHRCYXNlZENvbmZpZ3VyYXRpb25VcGRhdGVPcGVyYXRpb24oZGV2aWNlOiBJTWFuYWdlZE9iamVjdCwgY29uZmlnOiBzdHJpbmcpOiBJT3BlcmF0aW9uIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGV2aWNlSWQ6IGRldmljZS5pZCxcbiAgICAgIGRlc2NyaXB0aW9uOiBnZXR0ZXh0KCdDb25maWd1cmF0aW9uIHVwZGF0ZScpLFxuICAgICAgYzh5X0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgY29uZmlnXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldEJpbmFyeShiaW5hcnlJZDogSWRSZWZlcmVuY2UpOiBQcm9taXNlPElGZXRjaFJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5kb3dubG9hZChiaW5hcnlJZCk7XG4gICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgIGNvbnN0IG1zZyA9IGdldHRleHQoJ0NvdWxkIG5vdCBnZXQgdGhlIGJpbmFyeS4nKTtcbiAgICAgIHRoaXMuYWxlcnQuZGFuZ2VyKG1zZyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGF2YWlsYWJsZSBzbmFwc2hvdHMgZnJvbSB0aGUgcmVwb3NpdG9yeSBmb3IgdGhlIGdpdmVuIGRldmljZS5cbiAgICogQHBhcmFtIGRldmljZSBUaGUgZGV2aWNlIGZvciB3aGljaCB0aGUgc25hcHNob3RzIHNob3VsZCBiZSBwcmVwYXJlZC5cbiAgICogQHBhcmFtIGNvbmZpZ3VyYXRpb25UeXBlIFNlbGVjdGVkIGNvbmZpZ3VyYXRpb24gdHlwZS5cbiAgICovXG4gIGFzeW5jIGdldFNuYXBzaG90c0Zyb21SZXBvc2l0b3J5KGRldmljZSwgY29uZmlndXJhdGlvblR5cGUpIHtcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHRoaXMuZ2V0Q29uZmlndXJhdGlvblR5cGVRdWVyeShkZXZpY2UsIGNvbmZpZ3VyYXRpb25UeXBlKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmxpc3RSZXBvc2l0b3J5RW50cmllcyhSZXBvc2l0b3J5VHlwZS5DT05GSUdVUkFUSU9OLCB7XG4gICAgICBxdWVyeTogc2VhcmNoUXVlcnksXG4gICAgICBwYXJhbXM6IHsgcGFnZVNpemU6IDEwMCB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcy5kYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBiaW5hcnkgb2JqZWN0LlxuICAgKiBAcGFyYW0gYmluYXJ5SWQgYmluYXJ5IElEXG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKipub0FsZXJ0cyoqIC0gYGJvb2xlYW5gIC0gZG8gbm90IGRpc3BsYXkgYW4gYWxlcnQgbWVzc2FnZTsgZGVmYXVsdHMgdG8gYGZhbHNlYFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRJbnRlcm5hbEJpbmFyeVJlc3BvbnNlKFxuICAgIGJpbmFyeUlkOiBJZFJlZmVyZW5jZSxcbiAgICBvcHRpb25zOiB7IG5vQWxlcnRzPzogYm9vbGVhbiB9ID0ge31cbiAgKTogUHJvbWlzZTxJRmV0Y2hSZXNwb25zZT4ge1xuICAgIGxldCByZXM7XG4gICAgdHJ5IHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmRvd25sb2FkKGJpbmFyeUlkKTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgaWYgKCFvcHRpb25zLm5vQWxlcnRzKSB7XG4gICAgICAgIGNvbnN0IG1zZyA9IGdldHRleHQoJ0NvdWxkIG5vdCBnZXQgdGhlIGJpbmFyeS4nKTtcbiAgICAgICAgdGhpcy5hbGVydC5kYW5nZXIobXNnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgYmluYXJ5IG9iamVjdC5cbiAgICogQHBhcmFtIGJpbmFyeVVybCBUaGUgVVJMIHRvIGZpbmQgYmluYXJ5XG4gICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvYmplY3Qgd2l0aCBhZGRpdGlvbmFsIG9wdGlvbnM6XG4gICAqIC0gKipub0FsZXJ0cyoqIC0gYGJvb2xlYW5gIC0gZG8gbm90IGRpc3BsYXkgYW4gYWxlcnQgbWVzc2FnZTsgZGVmYXVsdHMgdG8gYGZhbHNlYFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRFeHRlcm5hbEJpbmFyeVJlc3BvbnNlKFxuICAgIGJpbmFyeVVybDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHsgbm9BbGVydHM/OiBib29sZWFuIH0gPSB7fVxuICApOiBQcm9taXNlPElGZXRjaFJlc3BvbnNlPiB7XG4gICAgbGV0IHJlcztcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmV0Y2hSZXMgPSBhd2FpdCBmZXRjaChiaW5hcnlVcmwpO1xuICAgICAgaWYgKGZldGNoUmVzLnN0YXR1cyA+PSA0MDApIHtcbiAgICAgICAgdGhyb3cgcmVzO1xuICAgICAgfVxuICAgICAgcmVzID0gZmV0Y2hSZXM7XG4gICAgfSBjYXRjaCB7XG4gICAgICBpZiAoIW9wdGlvbnMubm9BbGVydHMpIHtcbiAgICAgICAgY29uc3QgbXNnID0gZ2V0dGV4dCgnQ291bGQgbm90IGdldCB0aGUgZXh0ZXJuYWwgYmluYXJ5Jyk7XG4gICAgICAgIHRoaXMuYWxlcnQuZGFuZ2VyKG1zZyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUVudHJ5KG1vOiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0Pikge1xuICAgIGNvbnN0IGJpbmFyeUlkID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKG1vLnVybCk7XG4gICAgY29uc3QgbmV3TW8gPSBhd2FpdCB0aGlzLmludmVudG9yeS5jcmVhdGUobW8pO1xuICAgIGlmIChiaW5hcnlJZCkge1xuICAgICAgYXdhaXQgdGhpcy5pbnZlbnRvcnkuY2hpbGRBZGRpdGlvbnNBZGQoYmluYXJ5SWQsIG5ld01vLmRhdGEpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3TW87XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUVudHJ5KG1vOiBQYXJ0aWFsPElNYW5hZ2VkT2JqZWN0PiwgdXJsKSB7XG4gICAgY29uc3QgZXhpc3RpbmdCaW5hcnlJZCA9IGF3YWl0IHRoaXMuaW52ZW50b3J5QmluYXJ5LmdldElkRnJvbVVybCh1cmwpO1xuICAgIGNvbnN0IG5ld0JpbmFyeUlkID0gYXdhaXQgdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKG1vLnVybCk7XG4gICAgaWYgKGV4aXN0aW5nQmluYXJ5SWQgJiYgZXhpc3RpbmdCaW5hcnlJZCAhPT0gbmV3QmluYXJ5SWQpIHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5pbnZlbnRvcnlCaW5hcnkuZ2V0SWRGcm9tVXJsKHVybCk7XG4gICAgICBhd2FpdCB0aGlzLmludmVudG9yeUJpbmFyeS5kZWxldGUoaWQpO1xuICAgIH1cbiAgICBpZiAobmV3QmluYXJ5SWQpIHtcbiAgICAgIGF3YWl0IHRoaXMuaW52ZW50b3J5LmNoaWxkQWRkaXRpb25zQWRkKG5ld0JpbmFyeUlkLCBtbyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmludmVudG9yeS51cGRhdGUobW8pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRCYXNlVmVyc2lvblJlc3VsdExpc3RGb3JMZWdhY3lFbnRyeShlbnRyeSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgcmVzOiB7fSBhcyBJRmV0Y2hSZXNwb25zZSxcbiAgICAgIGRhdGE6IFtcbiAgICAgICAge1xuICAgICAgICAgIC4uLmVudHJ5LFxuICAgICAgICAgIFtlbnRyeS50eXBlXToge1xuICAgICAgICAgICAgdmVyc2lvbjogZW50cnkudmVyc2lvbixcbiAgICAgICAgICAgIHVybDogZW50cnkudXJsXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSBhcyBJUmVzdWx0TGlzdDxJTWFuYWdlZE9iamVjdD4pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZXZpY2VTb2Z0d2FyZUNoYW5nZXNGcm9tU29mdHdhcmVMaXN0T3BlcmF0aW9uKFxuICAgIG9wZXJhdGlvbjogSU9wZXJhdGlvbixcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0XG4gICk6IERldmljZVNvZnR3YXJlQ2hhbmdlW10ge1xuICAgIGNvbnN0IGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW10gPSBbXTtcbiAgICBmb3JFYWNoKGRldmljZS5jOHlfU29mdHdhcmVMaXN0LCBkZXZpY2VTb2Z0d2FyZSA9PiB7XG4gICAgICBjb25zdCBvcGVyYXRpb25Tb2Z0d2FyZSA9IGZpbmQob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZUxpc3QsIHsgbmFtZTogZGV2aWNlU29mdHdhcmUubmFtZSB9KTtcbiAgICAgIGlmIChcbiAgICAgICAgKG9wZXJhdGlvblNvZnR3YXJlICYmIG9wZXJhdGlvblNvZnR3YXJlLnZlcnNpb24pICE9PVxuICAgICAgICAoZGV2aWNlU29mdHdhcmUgJiYgZGV2aWNlU29mdHdhcmUudmVyc2lvbilcbiAgICAgICkge1xuICAgICAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgICAgIC4uLmRldmljZVNvZnR3YXJlLFxuICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZSdcbiAgICAgICAgfSBhcyBEZXZpY2VTb2Z0d2FyZUNoYW5nZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZm9yRWFjaChvcGVyYXRpb24uYzh5X1NvZnR3YXJlTGlzdCwgb3BlcmF0aW9uU29mdHdhcmUgPT4ge1xuICAgICAgY29uc3QgZGV2aWNlU29mdHdhcmUgPSBmaW5kKGRldmljZS5jOHlfU29mdHdhcmVMaXN0LCB7IG5hbWU6IG9wZXJhdGlvblNvZnR3YXJlLm5hbWUgfSk7XG4gICAgICBpZiAoXG4gICAgICAgIChvcGVyYXRpb25Tb2Z0d2FyZSAmJiBvcGVyYXRpb25Tb2Z0d2FyZS52ZXJzaW9uKSAhPT1cbiAgICAgICAgKGRldmljZVNvZnR3YXJlICYmIGRldmljZVNvZnR3YXJlLnZlcnNpb24pXG4gICAgICApIHtcbiAgICAgICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgICAgICAuLi5vcGVyYXRpb25Tb2Z0d2FyZSxcbiAgICAgICAgICBhY3Rpb246ICdpbnN0YWxsJ1xuICAgICAgICB9IGFzIERldmljZVNvZnR3YXJlQ2hhbmdlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGV2aWNlU29mdHdhcmVDaGFuZ2VzRnJvbVNvZnR3YXJlT3BlcmF0aW9uKFxuICAgIG9wZXJhdGlvbjogSU9wZXJhdGlvbixcbiAgICBkZXZpY2U6IElNYW5hZ2VkT2JqZWN0XG4gICk6IERldmljZVNvZnR3YXJlQ2hhbmdlW10ge1xuICAgIGNvbnN0IGNoYW5nZXM6IERldmljZVNvZnR3YXJlQ2hhbmdlW10gPSBbXTtcbiAgICBmb3JFYWNoKGRldmljZS5jOHlfU29mdHdhcmUsIChkZXZpY2VTb2Z0d2FyZVZlcnNpb24sIGRldmljZVNvZnR3YXJlTmFtZSkgPT4ge1xuICAgICAgaWYgKG9wZXJhdGlvbi5jOHlfU29mdHdhcmVbZGV2aWNlU29mdHdhcmVOYW1lXSAhPT0gZGV2aWNlU29mdHdhcmVWZXJzaW9uKSB7XG4gICAgICAgIGNoYW5nZXMucHVzaCh7XG4gICAgICAgICAgbmFtZTogZGV2aWNlU29mdHdhcmVOYW1lLFxuICAgICAgICAgIHZlcnNpb246IGRldmljZVNvZnR3YXJlVmVyc2lvbixcbiAgICAgICAgICBhY3Rpb246ICdkZWxldGUnXG4gICAgICAgIH0gYXMgRGV2aWNlU29mdHdhcmVDaGFuZ2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGZvckVhY2gob3BlcmF0aW9uLmM4eV9Tb2Z0d2FyZSwgKG9wZXJhdGlvblNvZnR3YXJlVmVyc2lvbiwgb3BlcmF0aW9uU29mdHdhcmVOYW1lKSA9PiB7XG4gICAgICBpZiAoZGV2aWNlLmM4eV9Tb2Z0d2FyZVtvcGVyYXRpb25Tb2Z0d2FyZU5hbWVdICE9PSBvcGVyYXRpb25Tb2Z0d2FyZVZlcnNpb24pIHtcbiAgICAgICAgY2hhbmdlcy5wdXNoKHtcbiAgICAgICAgICBuYW1lOiBvcGVyYXRpb25Tb2Z0d2FyZU5hbWUsXG4gICAgICAgICAgdmVyc2lvbjogb3BlcmF0aW9uU29mdHdhcmVWZXJzaW9uLFxuICAgICAgICAgIGFjdGlvbjogJ2luc3RhbGwnXG4gICAgICAgIH0gYXMgRGV2aWNlU29mdHdhcmVDaGFuZ2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjaGFuZ2VzO1xuICB9XG59XG4iXX0=